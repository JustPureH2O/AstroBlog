<!DOCTYPE html><html lang="zh-CN" class="bg-(--page-bg) text-[14px] md:text-[16px]" data-astro-cid-sckkx6r4 style="--bannerOffset: 15vh;--banner-height-home: 65vh;--banner-height: 35vh;--configHue: 240;--page-width: 90rem;"> <head><meta charset="UTF-8"><title>基础数据结构 线段树 - JustPureH2O 的博客</title><meta name="description" content="这是 JustPureH2O 的个人博客，主打高中文化课知识整理、信息竞赛算法、信息竞赛题解以及一些学校生活中的趣事逸闻"><meta name="keywords" content="JustPureH2O, Firefly, Fuwari, Astro, ACGN, 博客, 学术博客, OI, NOIp, CSP, 信息学奥林匹克竞赛, 洛谷题解, 个人博客, 静态博客"><meta name="author" content="JustPureH<sub>2</sub>O"><meta property="og:site_name" content="JustPureH2O 的博客"><meta property="og:url" content="https://justpureh2o.cn/articles/48920/"><meta property="og:title" content="基础数据结构 线段树 - JustPureH2O 的博客"><meta property="og:description" content="这是 JustPureH2O 的个人博客，主打高中文化课知识整理、信息竞赛算法、信息竞赛题解以及一些学校生活中的趣事逸闻"><meta property="og:type" content="article"><meta name="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://justpureh2o.cn/articles/48920/"><meta name="twitter:title" content="基础数据结构 线段树 - JustPureH2O 的博客"><meta name="twitter:description" content="这是 JustPureH2O 的个人博客，主打高中文化课知识整理、信息竞赛算法、信息竞赛题解以及一些学校生活中的趣事逸闻"><meta name="viewport" content="width=device-width"><meta name="generator" content="Astro v5.17.1"><link rel="icon" href="/favicon.jpg"><!-- Set the theme before the page is rendered to avoid a flash --><script>(function(){const BANNER_HEIGHT_EXTEND = 30;
const PAGE_WIDTH = 90;
const configHue = 240;
const defaultMode = "system";
const defaultWallpaperMode = "banner";
const isWallpaperSwitchable = true;
const darkTheme = "one-dark-pro";
const lightTheme = "one-light";
const baseUrl = "/";

      // 主题初始化 - 与setting-utils.ts保持一致
      const LIGHT_MODE = "light";
      const DARK_MODE = "dark";
      const SYSTEM_MODE = "system";

      // 获取存储的主题，如果没有则使用默认值
      const theme = localStorage.getItem("theme") || defaultMode;

      // 获取系统主题
      function getSystemTheme() {
        return window.matchMedia("(prefers-color-scheme: dark)").matches
          ? DARK_MODE
          : LIGHT_MODE;
      }

      // 解析主题（如果是system模式，则获取系统主题）
      function resolveTheme(themeValue) {
        if (themeValue === SYSTEM_MODE) {
          return getSystemTheme();
        }
        return themeValue;
      }

      const resolvedTheme = resolveTheme(theme);
      const isDark = resolvedTheme === DARK_MODE;

      // 应用主题
      if (isDark) {
        document.documentElement.classList.add("dark");
      } else {
        document.documentElement.classList.remove("dark");
      }

      // Set the theme for Expressive Code
      document.documentElement.setAttribute(
        "data-theme",
        isDark ? darkTheme : lightTheme
      );

      // Load the hue from local storage
      const hue = localStorage.getItem("hue") || configHue;
      document.documentElement.style.setProperty("--hue", hue);

      // calculate the --banner-height-extend, which needs to be a multiple of 4 to avoid blurry text
      // 使用更准确的窗口高度计算
      function calculateBannerHeightExtend() {
        let offset = Math.floor(
          window.innerHeight * (BANNER_HEIGHT_EXTEND / 100)
        );
        offset = offset - (offset % 4);
        document.documentElement.style.setProperty(
          "--banner-height-extend",
          `${offset}px`
        );
      }

      // 立即设置初始值
      calculateBannerHeightExtend();

      // 在下一帧重新计算精确值（仅在值变化时更新，避免闪烁）
      requestAnimationFrame(() => {
        const oldValue = parseInt(
          document.documentElement.style.getPropertyValue(
            "--banner-height-extend"
          )
        );
        calculateBannerHeightExtend();
        const newValue = parseInt(
          document.documentElement.style.getPropertyValue(
            "--banner-height-extend"
          )
        );
        // 如果值变化了，再更新一次确保准确
        if (Math.abs(oldValue - newValue) > 4) {
          // 如果有明显变化，延迟一帧再更新，避免闪烁
          requestAnimationFrame(calculateBannerHeightExtend);
        }
      });

      // 初始化壁纸模式 - 在页面渲染前应用
      const WALLPAPER_BANNER = "banner";
      const WALLPAPER_OVERLAY = "overlay";
      const WALLPAPER_NONE = "none";
      const wallpaperMode = isWallpaperSwitchable
        ? localStorage.getItem("wallpaperMode") || defaultWallpaperMode
        : defaultWallpaperMode;

      // 设置data-wallpaper-mode属性
      document.documentElement.setAttribute(
        "data-wallpaper-mode",
        wallpaperMode
      );

      // 立即执行函数来处理DOM
      (function applyWallpaperMode() {
        // 使用 requestAnimationFrame 确保在下一帧之前执行
        requestAnimationFrame(function () {
          // 根据模式隐藏显示对应元素
          if (
            wallpaperMode === WALLPAPER_NONE ||
            wallpaperMode === WALLPAPER_OVERLAY
          ) {
            // 隐藏横幅
            if (document.body) {
              document.body.classList.remove("enable-banner");
              document.body.classList.add("no-banner-layout");
            }
          } else {
            if (document.body) {
              document.body.classList.add("enable-banner");
              document.body.classList.remove("no-banner-layout");
            }
          }

          // 全屏壁纸模式
          if (wallpaperMode === WALLPAPER_OVERLAY) {
            if (document.body) {
              document.body.classList.add("wallpaper-transparent");
            }
          } else {
            if (document.body) {
              document.body.classList.remove("wallpaper-transparent");
            }
          }

          // 处理wallpaper-wrapper的显示
          const wallpaperWrapper = document.getElementById("wallpaper-wrapper");

          // 检查当前是否为首页
          const isHomePage =
            window.location.pathname === baseUrl ||
            (baseUrl !== '/' && window.location.pathname === baseUrl.replace(/\/$/, '')) ||
            window.location.pathname === "/";

          if (wallpaperMode === WALLPAPER_OVERLAY) {
            // 全屏壁纸透明模式：切换为 overlay 显示
            if (wallpaperWrapper) {
              wallpaperWrapper.classList.add("wallpaper-overlay");
              wallpaperWrapper.style.display = "block";
              wallpaperWrapper.classList.remove("hidden", "opacity-0", "mobile-hide-banner");
              wallpaperWrapper.classList.add("opacity-100");
              wallpaperWrapper.style.top = "";
            }
          } else if (wallpaperMode === WALLPAPER_NONE) {
            // 纯色背景：隐藏壁纸
            if (wallpaperWrapper) {
              wallpaperWrapper.style.display = "none";
              wallpaperWrapper.classList.add("hidden", "opacity-0");
            }
          } else {
            // banner模式：以 banner 方式显示
            if (wallpaperWrapper) {
              wallpaperWrapper.classList.remove("wallpaper-overlay");
              const isMobile = window.innerWidth < 1024;
              // 移动端非首页时隐藏banner（初始状态直接隐藏，不需要动画）
              // 桌面端始终显示banner
              if (isMobile && !isHomePage) {
                wallpaperWrapper.style.display = "none";
                wallpaperWrapper.classList.add("mobile-hide-banner");
              } else {
                wallpaperWrapper.style.display = "block";
                wallpaperWrapper.classList.remove("mobile-hide-banner");
              }
            }
          }

          // 处理主内容区域位置
          const mainContentWrapper = document.querySelector(
            ".absolute.w-full.z-30"
          );
          if (mainContentWrapper) {
            const isMobile = window.innerWidth < 1024;
            // 只在移动端非首页时调整主内容位置
            if (isMobile && !isHomePage) {
              mainContentWrapper.classList.add("mobile-main-no-banner");
            } else {
              mainContentWrapper.classList.remove("mobile-main-no-banner");
            }
          }

          // 处理credit元素
          const creditDesktop = document.getElementById(
            "banner-credit-desktop"
          );
          const creditMobile = document.getElementById("banner-credit-mobile");
          if (
            wallpaperMode === WALLPAPER_OVERLAY ||
            wallpaperMode === WALLPAPER_NONE
          ) {
            if (creditDesktop) creditDesktop.style.display = "none";
            if (creditMobile) creditMobile.style.display = "none";
          } else {
            if (creditDesktop) creditDesktop.style.display = "";
            if (creditMobile) creditMobile.style.display = "";
          }

          // 处理banner homeText元素
          const bannerTextOverlay = document.querySelector(
            ".banner-text-overlay"
          );
          if (bannerTextOverlay) {
            const isHomePage =
              window.location.pathname === baseUrl || 
              (baseUrl !== '/' && window.location.pathname === baseUrl.replace(/\/$/, '')) ||
              window.location.pathname === "/";
            if (wallpaperMode === WALLPAPER_BANNER && isHomePage) {
              bannerTextOverlay.classList.remove("hidden");
            } else {
              bannerTextOverlay.classList.add("hidden");
            }
          }
        });
      })();

      // 初始化水波纹动画状态 - 在 html 元素上设置属性，CSS 会立即生效
      (function applyWavesEnabled() {
        const wavesEnabled = localStorage.getItem("wavesEnabled");
        if (wavesEnabled !== null) {
          document.documentElement.setAttribute("data-waves-enabled", wavesEnabled);
        }
      })();

      // 初始化横幅标题显示状态 - 在 html 元素上设置属性，CSS 会立即生效
      (function applyBannerTitleEnabled() {
        const bannerTitleEnabled = localStorage.getItem("bannerTitleEnabled");
        if (bannerTitleEnabled !== null) {
          document.documentElement.setAttribute("data-banner-title-enabled", bannerTitleEnabled);
        }
      })();
    })();</script><!-- defines global css variables. This will be applied to <html> <body> and some other elements idk why --><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","headline":"基础数据结构 线段树","description":"基础数据结构 线段树","keywords":["oi","算法","数据结构"],"author":{"@type":"Person","name":"JustPureH<sub>2</sub>O","url":"https://justpureh2o.cn/"},"datePublished":"2024-08-08","inLanguage":"zh-CN"}</script><link rel="alternate" type="application/rss+xml" title="JustPureH<sub>2</sub>O" href="https://justpureh2o.cn/rss.xml"><!-- Font Manager --><!-- 字体样式表链接 --><style>
        @font-face {
          font-family: "CANG";
          src: url("/fonts/CangErYuMoW02.woff2") ;
          
          
          font-display: swap;
          
        }
      </style><style>
        @font-face {
          font-family: "Logo";
          src: url("/fonts/HFSnakylines.woff2") ;
          
          
          font-display: swap;
          
        }
      </style><!-- 字体预加载链接 --><link rel="preload" href="/fonts/CangErYuMoW02.woff2" as="font" type="font/woff2" crossorigin><link rel="preload" href="/fonts/HFSnakylines.woff2" as="font" type="font/woff2" crossorigin><!-- 全局字体样式 --><style>
    :root {
      --font-family-custom: "CANG", "Logo";
      --font-family-fallback: system-ui, -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, sans-serif;
    }
    
    /* 应用自定义字体到body */
    body {
      font-family: "CANG", "Logo", "system-ui, -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, sans-serif", system-ui, -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, sans-serif;
    }
    
    /* 为每个选中的字体生成对应的CSS类 */
    
        .font-CEYMW02,
        .font-CEYMW02 * {
          font-family: "CANG", var(--font-family-fallback) !important;
        }
      

        .font-Logo,
        .font-Logo * {
          font-family: "Logo", var(--font-family-fallback) !important;
        }
      
    
    /* 为整体启用字体的body添加类名 */
    .font-CangErYuMoW02-enabled,
.font-HFSnakylines-enabled,
.font-system-enabled {
      /* 字体相关的全局样式可以在这里添加 */
    }
  </style><script type="module">if(document.fonts&&void 0!==document.fonts.ready&&document.fonts.ready.then(()=>{console.log("All fonts have been loaded"),document.dispatchEvent(new CustomEvent("fontsLoaded"))}).catch(e=>{console.warn("Font loading failed:",e)}),"undefined"!=typeof PerformanceObserver){const n=new PerformanceObserver(e=>{e.getEntries().forEach(e=>{e.entryType})});try{n.observe({entryTypes:["resource"]})}catch(e){}}</script><link rel="stylesheet" href="/_astro/_slug_.DbsgE-iU.css">
<style>.inline-icon.svelte-ktjbt7 svg{width:1em;height:1em;display:inline-block;vertical-align:middle;fill:currentColor}
</style>
<link rel="stylesheet" href="/_astro/about.CLMvY_Mt.css">
<style>.card-base[data-astro-cid-zetdm5md]{animation:fadeInUp .6s ease-out}@keyframes fadeInUp{0%{opacity:0;transform:translateY(30px)}to{opacity:1;transform:translateY(0)}}a[data-astro-cid-zetdm5md]:hover{transform:translateY(-2px);box-shadow:0 4px 12px rgba(var(--primary-rgb),.3)}
</style>
<link rel="stylesheet" href="/_astro/_page_.BnLI_Dh8.css">
<link rel="stylesheet" href="/_astro/_slug_.DKTHhkWL.css">
<style>.responsive-pagination[data-astro-cid-zhblusy6]{max-width:100%;overflow-x:auto;-webkit-overflow-scrolling:touch}.mobile-pagination[data-astro-cid-zhblusy6]{display:flex;padding:0 1rem}.desktop-pagination[data-astro-cid-zhblusy6]{display:none}@media(min-width:768px){.mobile-pagination[data-astro-cid-zhblusy6]{display:none}.desktop-pagination[data-astro-cid-zhblusy6]{display:flex}}@media(max-width:640px){.mobile-pagination[data-astro-cid-zhblusy6]{padding:0 .5rem}.mobile-pagination[data-astro-cid-zhblusy6] button[data-astro-cid-zhblusy6]{padding:.25rem}}@media(max-width:480px){.mobile-pagination[data-astro-cid-zhblusy6]{padding:0 .25rem}.mobile-pagination[data-astro-cid-zhblusy6] .space-x-1[data-astro-cid-zhblusy6]>[data-astro-cid-zhblusy6]+[data-astro-cid-zhblusy6]{margin-left:.125rem}}.responsive-pagination[data-astro-cid-zhblusy6] button[data-astro-cid-zhblusy6]{transition:all .2s ease-in-out}@media(prefers-contrast:high){.responsive-pagination[data-astro-cid-zhblusy6] button[data-astro-cid-zhblusy6]{border:1px solid currentColor}}@media(prefers-reduced-motion:reduce){.responsive-pagination[data-astro-cid-zhblusy6] button[data-astro-cid-zhblusy6]{transition:none}}@media(hover:none)and (pointer:coarse){.responsive-pagination[data-astro-cid-zhblusy6] button[data-astro-cid-zhblusy6]{min-height:44px;min-width:44px}.mobile-pagination[data-astro-cid-zhblusy6] button[data-astro-cid-zhblusy6]{min-height:40px;min-width:40px}}@media(max-width:768px)and (orientation:landscape){.mobile-pagination[data-astro-cid-zhblusy6]{padding:0 .5rem}.mobile-pagination[data-astro-cid-zhblusy6] button[data-astro-cid-zhblusy6]{padding:.25rem}}.line-clamp-2[data-astro-cid-rkgclaxv]{display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
mark{background:transparent;color:var(--primary);font-weight:600;padding:0 .1em}
body.wallpaper-transparent .usage-info-box{background-color:rgba(var(--primary-rgb, 70, 130, 180),.15)!important}:root.dark body.wallpaper-transparent .usage-info-box{background-color:oklch(from var(--primary) l c h / .15)!important}
input.svelte-1n2o1uz:focus{outline:0}.search-panel.svelte-1n2o1uz{max-height:calc(100vh - 100px);overflow-y:auto}#display-setting.svelte-zyhyi5 input[type=range]:where(.svelte-zyhyi5){-webkit-appearance:none;height:1.5rem;background-image:var(--color-selection-bar);transition:background-image .15s ease-in-out}#display-setting.svelte-zyhyi5 input[type=range]:where(.svelte-zyhyi5)::-webkit-slider-thumb{-webkit-appearance:none;height:1rem;width:.5rem;border-radius:.125rem;background:#ffffffb3;box-shadow:none}#display-setting.svelte-zyhyi5 input[type=range]:where(.svelte-zyhyi5)::-webkit-slider-thumb:hover{background:#fffc}#display-setting.svelte-zyhyi5 input[type=range]:where(.svelte-zyhyi5)::-webkit-slider-thumb:active{background:#fff9}#display-setting.svelte-zyhyi5 input[type=range]:where(.svelte-zyhyi5)::-moz-range-thumb{-webkit-appearance:none;height:1rem;width:.5rem;border-radius:.125rem;border-width:0;background:#ffffffb3;box-shadow:none}#display-setting.svelte-zyhyi5 input[type=range]:where(.svelte-zyhyi5)::-moz-range-thumb:hover{background:#fffc}#display-setting.svelte-zyhyi5 input[type=range]:where(.svelte-zyhyi5)::-moz-range-thumb:active{background:#fff9}#display-setting.svelte-zyhyi5 input[type=range]:where(.svelte-zyhyi5)::-ms-thumb{-webkit-appearance:none;height:1rem;width:.5rem;border-radius:.125rem;background:#ffffffb3;box-shadow:none}#display-setting.svelte-zyhyi5 input[type=range]:where(.svelte-zyhyi5)::-ms-thumb:hover{background:#fffc}#display-setting.svelte-zyhyi5 input[type=range]:where(.svelte-zyhyi5)::-ms-thumb:active{background:#fff9}
</style><script type="module" src="/_astro/page.CCaY6Sby.js"></script></head> <body class="min-h-screen enable-banner enable-card-border font-CangErYuMoW02-enabled font-HFSnakylines-enabled font-system-enabled" data-astro-cid-sckkx6r4 style="--bannerOffset: 15vh;--banner-height-home: 65vh;--banner-height: 35vh;--configHue: 240;--page-width: 90rem;"> <!-- 页面顶部渐变高光效果 - 只在full和semifull模式下显示 --> <div class="top-gradient-highlight" data-astro-cid-sckkx6r4 style="--bannerOffset: 15vh;--banner-height-home: 65vh;--banner-height: 35vh;--configHue: 240;--page-width: 90rem;"></div> <!-- 全局配置载体 --><div id="config-carrier" data-hue="240" data-wallpaper-mode="banner"></div>     <div id="top-row" class="z-50 pointer-events-none relative transition-all duration-700 mx-auto max-w-(--page-width) px-0 md:px-4"> <div id="navbar-wrapper" class="pointer-events-auto sticky top-0 transition-all"> <div id="navbar" class="z-50" style="--navbar-glass-blur: 3px;" data-transparent-mode="semifull" data-enable-blur="true" data-is-home="false" data-full-width="false"> <div class="overflow-visible! h-18 mx-auto flex items-center px-4 justify-between max-w-(--page-width)"> <a href="/" class="btn-plain scale-animation rounded-lg h-13 px-5 font-bold active:scale-95"> <div class="flex flex-row items-center text-md dark:text-white text-black"> <img src="/favicon.jpg" alt="JustPureH2OLogo" class="h-7 w-7 mb-1 mr-2 object-contain" fetchpriority="high"> <span style="font-family:'Logo','system-ui'">JustPure<b><span style="color:#0080c0">H</span><sub style="color:#ff9800">2</sub><span style="color:#0080c0">O</span></b></span> </div> </a> <div class="hidden lg:flex items-center space-x-1"> <div class="dropdown-container" data-dropdown data-astro-cid-fhdapijq> <a aria-label="主页" href="/" class="btn-plain scale-animation rounded-lg h-11 font-bold px-5 active:scale-95" data-astro-cid-fhdapijq> <div class="flex items-center" data-astro-cid-fhdapijq> <svg width="1em" height="1em" class="text-[1.1rem] mr-2 navbar-icon" data-astro-cid-fhdapijq="true" data-icon="material-symbols:home">   <symbol id="ai:material-symbols:home" viewBox="0 0 24 24"><path fill="currentColor" d="M4 21V9l8-6l8 6v12h-6v-7h-4v7z"/></symbol><use href="#ai:material-symbols:home"></use>  </svg> 主页  </div> </a> </div>  <script type="module">function e(e,t,n){t.setAttribute("aria-expanded","true"),n.classList.remove("opacity-0","invisible","pointer-events-none","translate-y-[-8px]"),n.classList.add("opacity-100","visible","pointer-events-auto","translate-y-0")}function t(e,t,n){t.setAttribute("aria-expanded","false"),n.classList.add("opacity-0","invisible","pointer-events-none","translate-y-[-8px]"),n.classList.remove("opacity-100","visible","pointer-events-auto","translate-y-0")}document.addEventListener("DOMContentLoaded",function(){const n=document.querySelectorAll("[data-dropdown]");n.forEach(n=>{const o=n.querySelector("[data-dropdown-trigger]"),r=n.querySelector("[data-dropdown-menu]"),a=n.querySelectorAll(".dropdown-item");o&&r&&(o.addEventListener("keydown",function(i){"Enter"===i.key||" "===i.key?(i.preventDefault(),function(n,o,r){const a="true"===o.getAttribute("aria-expanded");a?t(n,o,r):e(n,o,r)}(n,o,r)):"ArrowDown"===i.key?(i.preventDefault(),e(n,o,r),a.length>0&&a[0].focus()):"Escape"===i.key&&t(n,o,r)}),a.forEach((e,i)=>{e.addEventListener("keydown",function(e){if("ArrowDown"===e.key){e.preventDefault();const t=(i+1)%a.length;a[t].focus()}else if("ArrowUp"===e.key){e.preventDefault();const t=(i-1+a.length)%a.length;a[t].focus()}else"Escape"===e.key&&(t(n,o,r),o.focus())})}))}),document.addEventListener("click",function(e){n.forEach(n=>{if(!n.contains(e.target)){const e=n.querySelector("[data-dropdown-trigger]"),o=n.querySelector("[data-dropdown-menu]");e&&o&&t(n,e,o)}})})});</script><div class="dropdown-container" data-dropdown data-astro-cid-fhdapijq> <a aria-label="归档" href="/archive/" class="btn-plain scale-animation rounded-lg h-11 font-bold px-5 active:scale-95" data-astro-cid-fhdapijq> <div class="flex items-center" data-astro-cid-fhdapijq> <svg width="1em" height="1em" class="text-[1.1rem] mr-2 navbar-icon" data-astro-cid-fhdapijq="true" data-icon="material-symbols:archive">   <symbol id="ai:material-symbols:archive" viewBox="0 0 24 24"><path fill="currentColor" d="m12 18l4-4l-1.4-1.4l-1.6 1.6V10h-2v4.2l-1.6-1.6L8 14zm-7 3q-.825 0-1.412-.587T3 19V6.525q0-.35.113-.675t.337-.6L4.7 3.725q.275-.35.687-.538T6.25 3h11.5q.45 0 .863.188t.687.537l1.25 1.525q.225.275.338.6t.112.675V19q0 .825-.587 1.413T19 21zm.4-15h13.2l-.85-1H6.25z"/></symbol><use href="#ai:material-symbols:archive"></use>  </svg> 归档  </div> </a> </div>  <div class="dropdown-container" data-dropdown data-astro-cid-fhdapijq> <a aria-label="友链" href="/friends/" class="btn-plain scale-animation rounded-lg h-11 font-bold px-5 active:scale-95" data-astro-cid-fhdapijq> <div class="flex items-center" data-astro-cid-fhdapijq> <svg width="1em" height="1em" class="text-[1.1rem] mr-2 navbar-icon" data-astro-cid-fhdapijq="true" data-icon="material-symbols:group">   <symbol id="ai:material-symbols:group" viewBox="0 0 24 24"><path fill="currentColor" d="M1 20v-2.8q0-.85.438-1.562T2.6 14.55q1.55-.775 3.15-1.162T9 13t3.25.388t3.15 1.162q.725.375 1.163 1.088T17 17.2V20zm18 0v-3q0-1.1-.612-2.113T16.65 13.15q1.275.15 2.4.513t2.1.887q.9.5 1.375 1.112T23 17v3zM9 12q-1.65 0-2.825-1.175T5 8t1.175-2.825T9 4t2.825 1.175T13 8t-1.175 2.825T9 12m10-4q0 1.65-1.175 2.825T15 12q-.275 0-.7-.062t-.7-.138q.675-.8 1.038-1.775T15 8t-.362-2.025T13.6 4.2q.35-.125.7-.163T15 4q1.65 0 2.825 1.175T19 8"/></symbol><use href="#ai:material-symbols:group"></use>  </svg> 友链  </div> </a> </div>  <div class="dropdown-container" data-dropdown data-astro-cid-fhdapijq> <a aria-label="留言" href="/guestbook/" class="btn-plain scale-animation rounded-lg h-11 font-bold px-5 active:scale-95" data-astro-cid-fhdapijq> <div class="flex items-center" data-astro-cid-fhdapijq> <svg width="1em" height="1em" class="text-[1.1rem] mr-2 navbar-icon" data-astro-cid-fhdapijq="true" data-icon="material-symbols:chat">   <symbol id="ai:material-symbols:chat" viewBox="0 0 24 24"><path fill="currentColor" d="M2 22V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18H6zm4-8h8v-2H6zm0-3h12V9H6zm0-3h12V6H6z"/></symbol><use href="#ai:material-symbols:chat"></use>  </svg> 留言  </div> </a> </div>  <div class="dropdown-container" data-dropdown data-astro-cid-fhdapijq> <button class="btn-plain scale-animation rounded-lg h-11 font-bold px-5 active:scale-95 dropdown-trigger" aria-expanded="false" aria-haspopup="true" data-dropdown-trigger data-astro-cid-fhdapijq> <div class="flex items-center" data-astro-cid-fhdapijq> <svg width="1em" height="1em" class="text-[1.1rem] mr-2 navbar-icon" data-astro-cid-fhdapijq="true" data-icon="material-symbols:info">   <symbol id="ai:material-symbols:info" viewBox="0 0 24 24"><path fill="currentColor" d="M11 17h2v-6h-2zm1-8q.425 0 .713-.288T13 8t-.288-.712T12 7t-.712.288T11 8t.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137T2.788 15.9T2 12t.788-3.9t2.137-3.175T8.1 2.788T12 2t3.9.788t3.175 2.137T21.213 8.1T22 12t-.788 3.9t-2.137 3.175t-3.175 2.138T12 22"/></symbol><use href="#ai:material-symbols:info"></use>  </svg> 关于 <svg width="1em" height="1em" class="text-[1.25rem] transition-transform duration-200 dropdown-arrow ml-1" data-astro-cid-fhdapijq="true" data-icon="material-symbols:keyboard-arrow-down-rounded">   <symbol id="ai:material-symbols:keyboard-arrow-down-rounded" viewBox="0 0 24 24"><path fill="currentColor" d="M12 14.975q-.2 0-.375-.062T11.3 14.7l-4.6-4.6q-.275-.275-.275-.7t.275-.7t.7-.275t.7.275l3.9 3.9l3.9-3.9q.275-.275.7-.275t.7.275t.275.7t-.275.7l-4.6 4.6q-.15.15-.325.213t-.375.062"/></symbol><use href="#ai:material-symbols:keyboard-arrow-down-rounded"></use>  </svg> </div> </button>
		<div class="dropdown-menu" data-dropdown-menu data-astro-cid-fhdapijq> <div class="float-panel p-2 dropdown-content" role="none"> <a href="/sponsor/" class="flex transition whitespace-nowrap items-center justify-start! w-full btn-plain scale-animation rounded-lg h-9 px-3 font-medium active:scale-95 mb-0.5  dropdown-item"> <svg width="1em" height="1em" class="text-[1.25rem] mr-3 navbar-icon" data-astro-cid-fhdapijq="true" data-icon="material-symbols:favorite">   <symbol id="ai:material-symbols:favorite" viewBox="0 0 24 24"><path fill="currentColor" d="m12 21l-1.45-1.3q-2.525-2.275-4.175-3.925T3.75 12.812T2.388 10.4T2 8.15Q2 5.8 3.575 4.225T7.5 2.65q1.3 0 2.475.55T12 4.75q.85-1 2.025-1.55t2.475-.55q2.35 0 3.925 1.575T22 8.15q0 1.15-.387 2.25t-1.363 2.412t-2.625 2.963T13.45 19.7z"/></symbol><use href="#ai:material-symbols:favorite"></use>  </svg><span data-astro-cid-fhdapijq>赞助</span>  </a><a href="/about/" class="flex transition whitespace-nowrap items-center justify-start! w-full btn-plain scale-animation rounded-lg h-9 px-3 font-medium active:scale-95   dropdown-item"> <svg width="1em" height="1em" class="text-[1.25rem] mr-3 navbar-icon" data-astro-cid-fhdapijq="true" data-icon="material-symbols:person">   <symbol id="ai:material-symbols:person" viewBox="0 0 24 24"><path fill="currentColor" d="M12 12q-1.65 0-2.825-1.175T8 8t1.175-2.825T12 4t2.825 1.175T16 8t-1.175 2.825T12 12m-8 8v-2.8q0-.85.438-1.562T5.6 14.55q1.55-.775 3.15-1.162T12 13t3.25.388t3.15 1.162q.725.375 1.163 1.088T20 17.2V20z"/></symbol><use href="#ai:material-symbols:person"></use>  </svg><span data-astro-cid-fhdapijq>关于我</span>  </a> </div> </div> </div>   </div> <div class="flex"> <!--<SearchPanel client:load>--> <style>astro-island,astro-slot,astro-static-slot{display:contents}</style><script>(()=>{var e=async t=>{await(await t())()};(self.Astro||(self.Astro={})).load=e;window.dispatchEvent(new Event("astro:load"));})();</script><script>(()=>{var A=Object.defineProperty;var g=(i,o,a)=>o in i?A(i,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):i[o]=a;var d=(i,o,a)=>g(i,typeof o!="symbol"?o+"":o,a);{let i={0:t=>m(t),1:t=>a(t),2:t=>new RegExp(t),3:t=>new Date(t),4:t=>new Map(a(t)),5:t=>new Set(a(t)),6:t=>BigInt(t),7:t=>new URL(t),8:t=>new Uint8Array(t),9:t=>new Uint16Array(t),10:t=>new Uint32Array(t),11:t=>1/0*t},o=t=>{let[l,e]=t;return l in i?i[l](e):void 0},a=t=>t.map(o),m=t=>typeof t!="object"||t===null?t:Object.fromEntries(Object.entries(t).map(([l,e])=>[l,o(e)]));class y extends HTMLElement{constructor(){super(...arguments);d(this,"Component");d(this,"hydrator");d(this,"hydrate",async()=>{var b;if(!this.hydrator||!this.isConnected)return;let e=(b=this.parentElement)==null?void 0:b.closest("astro-island[ssr]");if(e){e.addEventListener("astro:hydrate",this.hydrate,{once:!0});return}let c=this.querySelectorAll("astro-slot"),n={},h=this.querySelectorAll("template[data-astro-template]");for(let r of h){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(n[r.getAttribute("data-astro-template")||"default"]=r.innerHTML,r.remove())}for(let r of c){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(n[r.getAttribute("name")||"default"]=r.innerHTML)}let p;try{p=this.hasAttribute("props")?m(JSON.parse(this.getAttribute("props"))):{}}catch(r){let s=this.getAttribute("component-url")||"<unknown>",v=this.getAttribute("component-export");throw v&&(s+=` (export ${v})`),console.error(`[hydrate] Error parsing props for component ${s}`,this.getAttribute("props"),r),r}let u;await this.hydrator(this)(this.Component,p,n,{client:this.getAttribute("client")}),this.removeAttribute("ssr"),this.dispatchEvent(new CustomEvent("astro:hydrate"))});d(this,"unmount",()=>{this.isConnected||this.dispatchEvent(new CustomEvent("astro:unmount"))})}disconnectedCallback(){document.removeEventListener("astro:after-swap",this.unmount),document.addEventListener("astro:after-swap",this.unmount,{once:!0})}connectedCallback(){if(!this.hasAttribute("await-children")||document.readyState==="interactive"||document.readyState==="complete")this.childrenConnectedCallback();else{let e=()=>{document.removeEventListener("DOMContentLoaded",e),c.disconnect(),this.childrenConnectedCallback()},c=new MutationObserver(()=>{var n;((n=this.lastChild)==null?void 0:n.nodeType)===Node.COMMENT_NODE&&this.lastChild.nodeValue==="astro:end"&&(this.lastChild.remove(),e())});c.observe(this,{childList:!0}),document.addEventListener("DOMContentLoaded",e)}}async childrenConnectedCallback(){let e=this.getAttribute("before-hydration-url");e&&await import(e),this.start()}async start(){let e=JSON.parse(this.getAttribute("opts")),c=this.getAttribute("client");if(Astro[c]===void 0){window.addEventListener(`astro:${c}`,()=>this.start(),{once:!0});return}try{await Astro[c](async()=>{let n=this.getAttribute("renderer-url"),[h,{default:p}]=await Promise.all([import(this.getAttribute("component-url")),n?import(n):()=>()=>{}]),u=this.getAttribute("component-export")||"default";if(!u.includes("."))this.Component=h[u];else{this.Component=h;for(let f of u.split("."))this.Component=this.Component[f]}return this.hydrator=p,this.hydrate},e,this)}catch(n){console.error(`[astro-island] Error hydrating ${this.getAttribute("component-url")}`,n)}}attributeChangedCallback(){this.hydrate()}}d(y,"observedAttributes",["props"]),customElements.get("astro-island")||customElements.define("astro-island",y)}})();</script><astro-island uid="2E2BQ" component-url="/_astro/Search.Cq5dHFFM.js" component-export="default" renderer-url="/_astro/client.svelte.C7wO1dt2.js" props="{}" ssr client="load" opts="{&quot;name&quot;:&quot;Search&quot;,&quot;value&quot;:true}" await-children><!--[--><div id="search-bar" class="hidden lg:flex transition-all items-center h-11 mr-2 rounded-lg bg-black/4 hover:bg-black/6 focus-within:bg-black/6 dark:bg-white/5 dark:hover:bg-white/10 dark:focus-within:bg-white/10"><!--[--><span class="inline-icon inline-flex items-center justify-center text-base absolute text-[1.25rem] pointer-events-none ml-3 transition my-auto text-black/30 dark:text-white/30 svelte-ktjbt7" aria-hidden="true"><!----><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><path fill="currentColor" d="m19.6 21l-6.3-6.3q-.75.6-1.725.95T9.5 16q-2.725 0-4.612-1.888T3 9.5t1.888-4.612T9.5 3t4.613 1.888T16 9.5q0 1.1-.35 2.075T14.7 13.3l6.3 6.3zM9.5 14q1.875 0 3.188-1.312T14 9.5t-1.312-3.187T9.5 5T6.313 6.313T5 9.5t1.313 3.188T9.5 14"/></svg><!----></span><!--]--><!----> <input placeholder="搜索" value="" class="transition-all pl-10 text-sm bg-transparent outline-0 h-full w-40 active:w-60 focus:w-60 text-black/50 dark:text-white/50 svelte-1n2o1uz"/></div> <button aria-label="Search Panel" id="search-switch" class="btn-plain scale-animation lg:hidden! rounded-lg w-11 h-11 active:scale-90"><!--[--><span class="inline-icon inline-flex items-center justify-center text-base text-[1.25rem] svelte-ktjbt7" aria-hidden="true"><!----><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><path fill="currentColor" d="m19.6 21l-6.3-6.3q-.75.6-1.725.95T9.5 16q-2.725 0-4.612-1.888T3 9.5t1.888-4.612T9.5 3t4.613 1.888T16 9.5q0 1.1-.35 2.075T14.7 13.3l6.3 6.3zM9.5 14q1.875 0 3.188-1.312T14 9.5t-1.312-3.187T9.5 5T6.313 6.313T5 9.5t1.313 3.188T9.5 14"/></svg><!----></span><!--]--><!----></button> <div id="search-panel" class="float-panel float-panel-closed search-panel absolute md:w-120 top-20 left-4 md:left-[unset] right-4 shadow-2xl rounded-2xl p-2 svelte-1n2o1uz"><div id="search-bar-inside" class="flex relative lg:hidden transition-all items-center h-11 rounded-xl bg-black/4 hover:bg-black/6 focus-within:bg-black/6 dark:bg-white/5 dark:hover:bg-white/10 dark:focus-within:bg-white/10"><!--[--><span class="inline-icon inline-flex items-center justify-center text-base absolute text-[1.25rem] pointer-events-none ml-3 transition my-auto text-black/30 dark:text-white/30 svelte-ktjbt7" aria-hidden="true"><!----><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><path fill="currentColor" d="m19.6 21l-6.3-6.3q-.75.6-1.725.95T9.5 16q-2.725 0-4.612-1.888T3 9.5t1.888-4.612T9.5 3t4.613 1.888T16 9.5q0 1.1-.35 2.075T14.7 13.3l6.3 6.3zM9.5 14q1.875 0 3.188-1.312T14 9.5t-1.312-3.187T9.5 5T6.313 6.313T5 9.5t1.313 3.188T9.5 14"/></svg><!----></span><!--]--><!----> <input placeholder="搜索" value="" class="pl-10 absolute inset-0 text-sm bg-transparent outline-0 focus:w-60 text-black/50 dark:text-white/50 svelte-1n2o1uz"/></div> <!--[!--><!--[!--><!--[--><div class="transition first-of-type:mt-2 lg:first-of-type:mt-0 block rounded-xl text-lg px-3 py-2 text-50">找不到相关结果。</div><!--]--><!--]--><!--]--></div><!--]--><!--astro:end--></astro-island> <button aria-label="音乐" class="btn-plain scale-animation rounded-lg h-11 w-11 active:scale-90" id="music-player-switch"> <svg width="1em" height="1em" viewBox="0 0 24 24" class="text-[1.25rem]" data-icon="material-symbols:music-note-rounded">   <use href="#ai:material-symbols:music-note-rounded"></use>  </svg> </button> <button aria-label="Display Settings" class="btn-plain scale-animation rounded-lg h-11 w-11 active:scale-90" id="display-settings-switch"> <svg width="1em" height="1em" class="text-[1.25rem]" data-icon="material-symbols:palette-outline">   <symbol id="ai:material-symbols:palette-outline" viewBox="0 0 24 24"><path fill="currentColor" d="M12 22q-2.05 0-3.875-.788t-3.187-2.15t-2.15-3.187T2 12q0-2.075.813-3.9t2.2-3.175T8.25 2.788T12.2 2q2 0 3.775.688t3.113 1.9t2.125 2.875T22 11.05q0 2.875-1.75 4.413T16 17h-1.85q-.225 0-.312.125t-.088.275q0 .3.375.863t.375 1.287q0 1.25-.687 1.85T12 22m-5.5-9q.65 0 1.075-.425T8 11.5t-.425-1.075T6.5 10t-1.075.425T5 11.5t.425 1.075T6.5 13m3-4q.65 0 1.075-.425T11 7.5t-.425-1.075T9.5 6t-1.075.425T8 7.5t.425 1.075T9.5 9m5 0q.65 0 1.075-.425T16 7.5t-.425-1.075T14.5 6t-1.075.425T13 7.5t.425 1.075T14.5 9m3 4q.65 0 1.075-.425T19 11.5t-.425-1.075T17.5 10t-1.075.425T16 11.5t.425 1.075T17.5 13M12 20q.225 0 .363-.125t.137-.325q0-.35-.375-.825T11.75 17.3q0-1.05.725-1.675T14.25 15H16q1.65 0 2.825-.962T20 11.05q0-3.025-2.312-5.038T12.2 4Q8.8 4 6.4 6.325T4 12q0 3.325 2.338 5.663T12 20"/></symbol><use href="#ai:material-symbols:palette-outline"></use>  </svg> </button>  <astro-island uid="2meg6l" component-url="/_astro/LightDarkSwitch.BIzP3CBg.js" component-export="default" renderer-url="/_astro/client.svelte.C7wO1dt2.js" props="{}" ssr client="load" opts="{&quot;name&quot;:&quot;LightDarkSwitch&quot;,&quot;value&quot;:true}" await-children><!--[--><div class="relative z-50"><button aria-label="Light/Dark Mode" aria-haspopup="menu" class="relative btn-plain scale-animation rounded-lg h-11 w-11 active:scale-90" id="scheme-switch"><div class="absolute inset-0 flex items-center justify-center"><!--[--><span class="inline-icon inline-flex items-center justify-center text-base text-[1.25rem] svelte-ktjbt7" aria-hidden="true"><!----><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><path fill="currentColor" d="M11 3V2q0-.425.288-.712T12 1t.713.288T13 2v1q0 .425-.288.713T12 4t-.712-.288T11 3m0 19v-1q0-.425.288-.712T12 20t.713.288T13 21v1q0 .425-.288.713T12 23t-.712-.288T11 22m11-9h-1q-.425 0-.712-.288T20 12t.288-.712T21 11h1q.425 0 .713.288T23 12t-.288.713T22 13M3 13H2q-.425 0-.712-.288T1 12t.288-.712T2 11h1q.425 0 .713.288T4 12t-.288.713T3 13m16.75-7.325l-.35.35q-.275.275-.687.275T18 6q-.275-.275-.288-.687t.263-.713l.375-.375q.275-.3.7-.3t.725.3t.288.725t-.313.725M6.025 19.4l-.375.375q-.275.3-.7.3t-.725-.3t-.288-.725t.313-.725l.35-.35q.275-.275.688-.275T6 18q.275.275.288.688t-.263.712m12.3.35l-.35-.35q-.275-.275-.275-.687T18 18q.275-.275.688-.287t.712.262l.375.375q.3.275.3.7t-.3.725t-.725.288t-.725-.313M4.6 6.025l-.375-.375q-.3-.275-.3-.7t.3-.725t.725-.288t.725.313l.35.35q.275.275.275.688T6 6q-.275.275-.687.288T4.6 6.025M12 18q-2.5 0-4.25-1.75T6 12t1.75-4.25T12 6t4.25 1.75T18 12t-1.75 4.25T12 18m0-2q1.675 0 2.838-1.162T16 12t-1.162-2.838T12 8T9.162 9.163T8 12t1.163 2.838T12 16m0-4"/></svg><!----></span><!--]--><!----></div> <div class="absolute inset-0 flex items-center justify-center opacity-0"><!--[--><span class="inline-icon inline-flex items-center justify-center text-base text-[1.25rem] svelte-ktjbt7" aria-hidden="true"><!----><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><path fill="currentColor" d="M12 21q-3.775 0-6.387-2.613T3 12q0-3.45 2.25-5.988T11 3.05q.325-.05.575.088t.4.362t.163.525t-.188.575q-.425.65-.638 1.375T11.1 7.5q0 2.25 1.575 3.825T16.5 12.9q.775 0 1.538-.225t1.362-.625q.275-.175.563-.162t.512.137q.25.125.388.375t.087.6q-.35 3.45-2.937 5.725T12 21m0-2q2.2 0 3.95-1.213t2.55-3.162q-.5.125-1 .2t-1 .075q-3.075 0-5.238-2.163T9.1 7.5q0-.5.075-1t.2-1q-1.95.8-3.163 2.55T5 12q0 2.9 2.05 4.95T12 19m-.25-6.75"/></svg><!----></span><!--]--><!----></div></button> <div id="theme-mode-panel" class="absolute transition float-panel-closed top-11 -right-2 pt-5 z-50" role="menu" aria-labelledby="scheme-switch"><div class="float-panel p-2" role="none"><!--[--><button class="flex transition whitespace-nowrap items-center justify-start! w-full btn-plain scale-animation rounded-lg h-9 px-3 font-medium active:scale-95 mb-0.5 current-theme-btn" role="menuitem"><!--[--><!--[--><span class="inline-icon inline-flex items-center justify-center text-base text-[1.25rem] mr-3 svelte-ktjbt7" aria-hidden="true"><!----><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><path fill="currentColor" d="M11 3V2q0-.425.288-.712T12 1t.713.288T13 2v1q0 .425-.288.713T12 4t-.712-.288T11 3m0 19v-1q0-.425.288-.712T12 20t.713.288T13 21v1q0 .425-.288.713T12 23t-.712-.288T11 22m11-9h-1q-.425 0-.712-.288T20 12t.288-.712T21 11h1q.425 0 .713.288T23 12t-.288.713T22 13M3 13H2q-.425 0-.712-.288T1 12t.288-.712T2 11h1q.425 0 .713.288T4 12t-.288.713T3 13m16.75-7.325l-.35.35q-.275.275-.687.275T18 6q-.275-.275-.288-.687t.263-.713l.375-.375q.275-.3.7-.3t.725.3t.288.725t-.313.725M6.025 19.4l-.375.375q-.275.3-.7.3t-.725-.3t-.288-.725t.313-.725l.35-.35q.275-.275.688-.275T6 18q.275.275.288.688t-.263.712m12.3.35l-.35-.35q-.275-.275-.275-.687T18 18q.275-.275.688-.287t.712.262l.375.375q.3.275.3.7t-.3.725t-.725.288t-.725-.313M4.6 6.025l-.375-.375q-.3-.275-.3-.7t.3-.725t.725-.288t.725.313l.35.35q.275.275.275.688T6 6q-.275.275-.687.288T4.6 6.025M12 18q-2.5 0-4.25-1.75T6 12t1.75-4.25T12 6t4.25 1.75T18 12t-1.75 4.25T12 18m0-2q1.675 0 2.838-1.162T16 12t-1.162-2.838T12 8T9.162 9.163T8 12t1.163 2.838T12 16m0-4"/></svg><!----></span><!--]--><!----> 亮色<!----><!--]--></button><!----> <button class="flex transition whitespace-nowrap items-center justify-start! w-full btn-plain scale-animation rounded-lg h-9 px-3 font-medium active:scale-95 mb-0.5" role="menuitem"><!--[--><!--[--><span class="inline-icon inline-flex items-center justify-center text-base text-[1.25rem] mr-3 svelte-ktjbt7" aria-hidden="true"><!----><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><path fill="currentColor" d="M12 21q-3.775 0-6.387-2.613T3 12q0-3.45 2.25-5.988T11 3.05q.325-.05.575.088t.4.362t.163.525t-.188.575q-.425.65-.638 1.375T11.1 7.5q0 2.25 1.575 3.825T16.5 12.9q.775 0 1.538-.225t1.362-.625q.275-.175.563-.162t.512.137q.25.125.388.375t.087.6q-.35 3.45-2.937 5.725T12 21m0-2q2.2 0 3.95-1.213t2.55-3.162q-.5.125-1 .2t-1 .075q-3.075 0-5.238-2.163T9.1 7.5q0-.5.075-1t.2-1q-1.95.8-3.163 2.55T5 12q0 2.9 2.05 4.95T12 19m-.25-6.75"/></svg><!----></span><!--]--><!----> 暗色<!----><!--]--></button><!----> <button class="flex transition whitespace-nowrap items-center justify-start! w-full btn-plain scale-animation rounded-lg h-9 px-3 font-medium active:scale-95" role="menuitem"><!--[--><!--[--><span class="inline-icon inline-flex items-center justify-center text-base text-[1.25rem] mr-3 svelte-ktjbt7" aria-hidden="true"><!----><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><path fill="currentColor" d="M10.2 13.7h3.65l.625 1.825q.075.2.263.338t.412.137q.375 0 .588-.312t.087-.663l-2.85-7.55q-.075-.225-.275-.35T12.275 7h-.55q-.225 0-.425.125t-.275.35L8.175 15q-.125.35.088.675t.612.325q.25 0 .438-.137t.262-.363zm.45-1.3l1.3-3.75h.1l1.3 3.75zm-2 7.6H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12t.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5t.738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737t-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5t-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"/></svg><!----></span><!--]--><!----> 跟随系统<!----><!--]--></button><!----><!----><!--]--></div><!----></div></div><!--]--><!--astro:end--></astro-island> <button aria-label="Menu" name="Nav Menu" class="btn-plain scale-animation rounded-lg w-11 h-11 active:scale-90 lg:hidden!" id="nav-menu-switch"> <svg width="1em" height="1em" class="text-[1.25rem]" data-icon="material-symbols:menu-rounded">   <symbol id="ai:material-symbols:menu-rounded" viewBox="0 0 24 24"><path fill="currentColor" d="M4 18q-.425 0-.712-.288T3 17t.288-.712T4 16h16q.425 0 .713.288T21 17t-.288.713T20 18zm0-5q-.425 0-.712-.288T3 12t.288-.712T4 11h16q.425 0 .713.288T21 12t-.288.713T20 13zm0-5q-.425 0-.712-.288T3 7t.288-.712T4 6h16q.425 0 .713.288T21 7t-.288.713T20 8z"/></symbol><use href="#ai:material-symbols:menu-rounded"></use>  </svg> </button> </div> <div id="music-nav-panel" class="float-panel float-panel-closed absolute transition-all right-16 p-2 pt-4.5 w-80 z-50"> <div id="music-widget-qpu84ul" class="music-player-widget w-full relative transition-all duration-300" role="region" aria-label="音乐" data-astro-cid-reypjcyh> <!-- Top Row: Cover & Info --> <div class="flex items-center gap-2 mb-2 px-1" data-astro-cid-reypjcyh> <!-- Circular Cover --> <div class="relative shrink-0 w-14 h-14 group" data-astro-cid-reypjcyh> <div class="w-full h-full rounded-full overflow-hidden shadow-lg border-2 border-white dark:border-neutral-700 relative z-10 bg-[var(--primary)]/10 flex items-center justify-center" data-astro-cid-reypjcyh> <svg width="1em" height="1em" viewBox="0 0 24 24" class="text-2xl text-[var(--primary)] opacity-40 absolute" aria-hidden="true" data-astro-cid-reypjcyh="true" data-icon="material-symbols:music-note-rounded">   <use href="#ai:material-symbols:music-note-rounded"></use>  </svg> <img class="music-cover w-full h-full object-cover animate-spin-slow relative z-10 opacity-0 transition-opacity duration-300" src="" alt="封面" style="animation-play-state: paused;" data-astro-cid-reypjcyh> </div> </div> <!-- Info Section --> <div class="flex-1 min-w-0 flex flex-col overflow-hidden" data-astro-cid-reypjcyh> <div class="flex items-center justify-between overflow-hidden gap-2" data-astro-cid-reypjcyh> <div class="flex-1 min-w-0 overflow-hidden relative" data-astro-cid-reypjcyh> <h3 class="music-title font-bold text-base text-neutral-800 dark:text-neutral-100 leading-tight truncate" data-astro-cid-reypjcyh> 音乐 </h3> </div> <!-- Top Right: Lyric Toggle --> <button class="btn-lrc-toggle hover:text-[var(--primary)] transition-all duration-300 p-0.5 pr-2 transform active:scale-95 text-neutral-400 shrink-0 " title="歌词" aria-label="歌词" data-astro-cid-reypjcyh> <svg width="1em" height="1em" viewBox="0 0 24 24" class="icon-lrc-off text-xl" aria-hidden="true" data-astro-cid-reypjcyh="true" data-icon="material-symbols:subtitles-off-outline-rounded">   <use href="#ai:material-symbols:subtitles-off-outline-rounded"></use>  </svg> <svg width="1em" height="1em" viewBox="0 0 24 24" class="icon-lrc-on text-xl hidden" aria-hidden="true" data-astro-cid-reypjcyh="true" data-icon="material-symbols:subtitles-outline-rounded">   <use href="#ai:material-symbols:subtitles-outline-rounded"></use>  </svg> </button> </div> <div class="min-w-0 overflow-hidden" data-astro-cid-reypjcyh> <p class="music-artist text-xs font-medium text-neutral-500 dark:text-neutral-400 truncate" data-astro-cid-reypjcyh> 暂未播放 </p> </div> <!-- Time Display & Volume --> <div class="flex items-center gap-3 text-neutral-400 h-5" data-astro-cid-reypjcyh> <div class="text-[10px] font-mono flex items-center gap-1 shrink-0 h-full" aria-live="polite" data-astro-cid-reypjcyh> <span class="current-time" data-astro-cid-reypjcyh>0:00</span> <span class="opacity-50" aria-hidden="true" data-astro-cid-reypjcyh>/</span> <span class="total-time" data-astro-cid-reypjcyh>0:00</span> </div> <!-- Volume (Always visible) --> <div class="flex items-center gap-1 bg-transparent h-full" data-astro-cid-reypjcyh> <button class="btn-mute hover:text-[var(--primary)] transition-colors p-0.5 rounded-md flex items-center" title="音量" aria-label="音量" data-astro-cid-reypjcyh> <svg width="1em" height="1em" viewBox="0 0 24 24" class=" icon-vol-high text-lg" aria-hidden="true" data-astro-cid-reypjcyh="true" data-icon="material-symbols:volume-up-rounded">   <use href="#ai:material-symbols:volume-up-rounded"></use>  </svg> <svg width="1em" height="1em" viewBox="0 0 24 24" class="icon-vol-mute text-lg hidden" aria-hidden="true" data-astro-cid-reypjcyh="true" data-icon="material-symbols:volume-off-rounded">   <use href="#ai:material-symbols:volume-off-rounded"></use>  </svg> </button> <div class="w-16 transition-all duration-300 ease-out flex items-center" data-astro-cid-reypjcyh> <div class="vol-container h-1 w-16 bg-neutral-200 dark:bg-neutral-600 rounded-full cursor-pointer relative ml-1" role="slider" aria-label="音量" aria-valuemin="0" aria-valuemax="100" aria-valuenow="70" data-astro-cid-reypjcyh> <div class="vol-bar absolute left-0 top-0 h-full bg-[var(--primary)] rounded-full w-[70%]" data-astro-cid-reypjcyh></div> </div> </div> </div> </div> </div> </div> <!-- Progress Bar (Slim) --> <div class="progress-container relative w-full h-1 bg-neutral-100 dark:bg-neutral-700/50 rounded-full cursor-pointer touch-none mb-2 group mt-2" role="slider" aria-label="播放进度" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0" data-astro-cid-reypjcyh> <div class="progress-bar absolute left-0 top-0 h-full bg-[var(--primary)] rounded-full w-0 transition-[width] duration-100" data-astro-cid-reypjcyh></div> <!-- Hover Thumb --> <div class="progress-thumb absolute top-1/2 -mt-1.5 -ml-1.5 w-3 h-3 bg-[var(--primary)] ring-2 ring-white dark:ring-neutral-800 rounded-full shadow-sm scale-0 group-hover:scale-100 transition-transform duration-200" data-astro-cid-reypjcyh></div> </div> <!-- Controls Row --> <div class="flex items-center justify-between px-1 select-none" data-astro-cid-reypjcyh> <!-- Repeat Mode --> <button class="btn-repeat text-neutral-300 dark:text-neutral-600 hover:text-[var(--primary)] transition-colors p-2 active:scale-95" title="切换播放模式" aria-label="切换播放模式" data-astro-cid-reypjcyh> <svg width="1em" height="1em" viewBox="0 0 24 24" class="icon-repeat text-xl" aria-hidden="true" data-astro-cid-reypjcyh="true" data-icon="material-symbols:repeat-rounded">   <use href="#ai:material-symbols:repeat-rounded"></use>  </svg> <svg width="1em" height="1em" viewBox="0 0 24 24" class="icon-repeat-one text-xl hidden" aria-hidden="true" data-astro-cid-reypjcyh="true" data-icon="material-symbols:repeat-one-rounded">   <use href="#ai:material-symbols:repeat-one-rounded"></use>  </svg> <svg width="1em" height="1em" viewBox="0 0 24 24" class="icon-shuffle text-xl hidden" aria-hidden="true" data-astro-cid-reypjcyh="true" data-icon="material-symbols:shuffle-rounded">   <use href="#ai:material-symbols:shuffle-rounded"></use>  </svg> </button> <!-- Prev --> <button class="btn-prev text-neutral-600 dark:text-neutral-300 hover:text-[var(--primary)] transition-colors p-2 active:scale-95" title="上一首" aria-label="上一首" data-astro-cid-reypjcyh> <svg width="1em" height="1em" viewBox="0 0 24 24" class="text-3xl" aria-hidden="true" data-astro-cid-reypjcyh="true" data-icon="material-symbols:skip-previous-rounded">   <use href="#ai:material-symbols:skip-previous-rounded"></use>  </svg> </button> <!-- Play/Pause (Feature) --> <button class="btn-play w-12 h-12 bg-[var(--btn-regular-bg)] hover:bg-[var(--btn-regular-bg-hover)] active:bg-[var(--btn-regular-bg-active)] text-[var(--primary)] rounded-full flex items-center justify-center transition-all duration-300" title="播放" aria-label="播放" data-astro-cid-reypjcyh> <svg width="1em" height="1em" viewBox="0 0 24 24" class="icon-play text-3xl ml-0.5" aria-hidden="true" data-astro-cid-reypjcyh="true" data-icon="material-symbols:play-arrow-rounded">   <use href="#ai:material-symbols:play-arrow-rounded"></use>  </svg> <svg width="1em" height="1em" viewBox="0 0 24 24" class="icon-pause text-3xl hidden" aria-hidden="true" data-astro-cid-reypjcyh="true" data-icon="material-symbols:pause-rounded">   <use href="#ai:material-symbols:pause-rounded"></use>  </svg> </button> <!-- Next --> <button class="btn-next text-neutral-600 dark:text-neutral-300 hover:text-[var(--primary)] transition-colors p-2 active:scale-95" title="下一首" aria-label="下一首" data-astro-cid-reypjcyh> <svg width="1em" height="1em" viewBox="0 0 24 24" class="text-3xl" aria-hidden="true" data-astro-cid-reypjcyh="true" data-icon="material-symbols:skip-next-rounded">   <use href="#ai:material-symbols:skip-next-rounded"></use>  </svg> </button> <!-- Playlist Toggle Arrow --> <button class="btn-drawer-toggle text-neutral-400 hover:text-[var(--primary)] transition-all duration-300 p-2 transform active:scale-95" title="列表" aria-label="列表" data-astro-cid-reypjcyh> <svg width="1em" height="1em" viewBox="0 0 24 24" class="text-xl" aria-hidden="true" data-astro-cid-reypjcyh="true" data-icon="mdi:playlist-music">   <use href="#ai:mdi:playlist-music"></use>  </svg> </button> </div> <!-- Lyrics Drawer --> <div class="lrc-drawer grid transition-all duration-300 ease-[cubic-bezier(0.4,0,0.2,1)] grid-rows-[0fr] opacity-0" data-astro-cid-reypjcyh> <div class="overflow-hidden min-h-0" data-astro-cid-reypjcyh> <div class="mt-2 pt-2 border-t border-neutral-100 dark:border-white/5 mx-1" data-astro-cid-reypjcyh> <div class="lrc-container h-48 overflow-y-auto custom-scrollbar flex flex-col items-center gap-2 p-4 py-24 text-center relative scroll-smooth" role="listbox" aria-label="歌词" data-astro-cid-reypjcyh> <div class="text-neutral-400 text-sm py-10" role="option" data-astro-cid-reypjcyh>暂无歌词</div> </div> </div> </div> </div> <!-- Playlist Drawer (Accordion) --> <div class="playlist-drawer grid transition-all duration-300 ease-[cubic-bezier(0.4,0,0.2,1)] grid-rows-[0fr] opacity-0" data-astro-cid-reypjcyh> <div class="overflow-hidden min-h-0" data-astro-cid-reypjcyh> <div class="mt-2 pt-2 border-t border-neutral-100 dark:border-white/5 mx-1" data-astro-cid-reypjcyh> <div class="playlist-container max-h-48 overflow-y-auto custom-scrollbar pr-1 pb-1 flex flex-col gap-1" role="listbox" aria-label="列表" data-astro-cid-reypjcyh> <!-- Items --> </div> </div> </div> </div> <!-- Hidden Audio --> <audio class="audio-player hidden" crossorigin="anonymous" title="音频播放器" data-astro-cid-reypjcyh></audio> <!-- Loading Overlay --> <div class="music-loading absolute inset-0 z-20 flex flex-col items-center justify-center bg-white/60 dark:bg-[#1e1e1e]/60 backdrop-blur-[2px] transition-opacity duration-300 opacity-0 pointer-events-none rounded-xl" aria-busy="true" aria-hidden="true" data-astro-cid-reypjcyh> <div class="w-8 h-8 text-[var(--primary)] animate-spin" data-astro-cid-reypjcyh> <svg width="1em" height="1em" viewBox="0 0 24 24" class="text-3xl" aria-hidden="true" data-astro-cid-reypjcyh="true" data-icon="material-symbols:sync-rounded">   <use href="#ai:material-symbols:sync-rounded"></use>  </svg> </div> </div> </div> <template id="playlist-item-template-music-widget-qpu84ul" data-astro-cid-reypjcyh> <div class="playlist-item flex items-center gap-3 p-2 rounded-lg cursor-pointer hover:bg-neutral-50 dark:hover:bg-white/5 transition-colors group" data-astro-cid-reypjcyh> <div class="w-8 h-8 rounded-md overflow-hidden shrink-0 relative bg-neutral-200 dark:bg-neutral-700" data-astro-cid-reypjcyh> <img src="" class="item-cover w-full h-full object-cover" loading="lazy" alt="" data-astro-cid-reypjcyh> <!-- Active Indicator overlay --> <div class="item-active-overlay absolute inset-0 bg-[var(--primary)]/20 hidden items-center justify-center" data-astro-cid-reypjcyh> <svg width="1em" height="1em" viewBox="0 0 24 24" class="text-[var(--primary)] text-sm" data-astro-cid-reypjcyh="true" data-icon="material-symbols:graphic-eq-rounded">   <use href="#ai:material-symbols:graphic-eq-rounded"></use>  </svg> </div> </div> <div class="flex-1 min-w-0" data-astro-cid-reypjcyh> <div class="item-title text-xs font-bold text-neutral-700 dark:text-neutral-200 truncate group-hover:text-[var(--primary)] transition-colors" data-astro-cid-reypjcyh></div> <div class="item-artist text-[10px] text-neutral-400 truncate" data-astro-cid-reypjcyh></div> </div> </div> </template> <script>(function(){const playerConfigStr = "{\"mode\":\"meting\",\"meting\":{\"api\":\"https://api.i-meto.com/meting/api?server=:server&type=:type&id=:id&r=:r\",\"server\":\"netease\",\"type\":\"playlist\",\"id\":\"12830312100\",\"auth\":\"\",\"fallbackApis\":[\"https://api.injahow.cn/meting/?server=:server&type=:type&id=:id\",\"https://api.moeyao.cn/meting/?server=:server&type=:type&id=:id\"]},\"localPlaylist\":[],\"volume\":0.7,\"playMode\":\"list\",\"showLyrics\":true,\"i18n\":{\"noPlaying\":\"暂未播放\",\"lyrics\":\"歌词\",\"volume\":\"音量\",\"playMode\":\"切换播放模式\",\"prev\":\"上一首\",\"next\":\"下一首\",\"playlist\":\"列表\",\"noLyrics\":\"暂无歌词\",\"loadingLyrics\":\"正在加载歌词...\",\"failedLyrics\":\"歌词加载失败\",\"noSongs\":\"暂无歌曲\",\"error\":\"播放器错误\",\"play\":\"播放\",\"pause\":\"暂停\",\"progress\":\"播放进度\",\"noCover\":\"暂无封面\"}}";
const widgetId = "music-widget-qpu84ul";

(function () {
    const config = JSON.parse(playerConfigStr);
    const widget = document.getElementById(widgetId);
    
    // If widget not found (e.g. removed), stop
    if (!widget) return;

    const ui = {
        widget: widget,
        loading: widget.querySelector('.music-loading'),
        cover: widget.querySelector('.music-cover'),
        title: widget.querySelector('.music-title'),
        artist: widget.querySelector('.music-artist'),
        progressBar: widget.querySelector('.progress-bar'),
        progressThumb: widget.querySelector('.progress-thumb'),
        progressContainer: widget.querySelector('.progress-container'),
        currentTime: widget.querySelector('.current-time'),
        totalTime: widget.querySelector('.total-time'),
        btnPlay: widget.querySelector('.btn-play'),
        iconPlay: widget.querySelector('.icon-play'),
        iconPause: widget.querySelector('.icon-pause'),
        btnPrev: widget.querySelector('.btn-prev'),
        btnNext: widget.querySelector('.btn-next'),
        btnRepeat: widget.querySelector('.btn-repeat'),
        iconRepeat: widget.querySelector('.icon-repeat'),
        iconRepeatOne: widget.querySelector('.icon-repeat-one'),
        iconShuffle: widget.querySelector('.icon-shuffle'),
        btnMute: widget.querySelector('.btn-mute'),
        iconVolHigh: widget.querySelector('.icon-vol-high'),
        iconVolMute: widget.querySelector('.icon-vol-mute'),
        volContainer: widget.querySelector('.vol-container'),
        volBar: widget.querySelector('.vol-bar'),
        btnLrc: widget.querySelector('.btn-lrc-toggle'),
        iconLrcOn: widget.querySelector('.icon-lrc-on'),
        iconLrcOff: widget.querySelector('.icon-lrc-off'),
        lrcDrawer: widget.querySelector('.lrc-drawer'),
        lrcContainer: widget.querySelector('.lrc-container'),
        btnDrawer: widget.querySelector('.btn-drawer-toggle'),
        playlistDrawer: widget.querySelector('.playlist-drawer'),
        playlistContainer: widget.querySelector('.playlist-container'),
        audio: widget.querySelector('.audio-player'),
        itemTemplate: document.getElementById(`playlist-item-template-${widgetId}`)
    };

    // Verify all critical UI elements exist (may be null during Swup page transitions)
    const _critical = [ui.btnPlay, ui.audio, ui.btnRepeat, ui.btnMute, ui.volContainer,
        ui.btnDrawer, ui.btnLrc, ui.lrcDrawer, ui.lrcContainer,
        ui.progressContainer, ui.btnNext, ui.btnPrev, ui.loading,
        ui.cover, ui.title, ui.artist, ui.playlistContainer, ui.itemTemplate];
    if (_critical.some(function(el) { return !el; })) return;

    const state = {
        playlist: [],
        currentIndex: 0,
        isPlaying: false,
        isLoading: false,
        playMode: 0, // 0: List, 1: One, 2: Rand
        lastVolume: localStorage.getItem('music-player-volume') !== null 
            ? parseFloat(localStorage.getItem('music-player-volume')) 
            : (config.volume ?? 0.7),
        isMuted: false,
        lyrics: [], // Parsed lyrics: {time: seconds, text: string}
        currentLrcIndex: -1,
        isUserScrolling: false,
        scrollTimeout: null
    };

    // Initialize state from config
    if (config.playMode === 'random') {
            state.playMode = 2; // Rand
    } else if (config.playMode === 'one') {
            state.playMode = 1; // One
    } else {
            state.playMode = 0; // List (default)
    }

    // UI Helpers
    function setLoading(bool) {
        state.isLoading = bool;
        if (bool) {
            ui.loading.classList.remove('opacity-0', 'pointer-events-none');
        } else {
            ui.loading.classList.add('opacity-0', 'pointer-events-none');
        }
    }

    function formatTime(seconds) {
        if (!seconds || isNaN(seconds)) return "0:00";
        const min = Math.floor(seconds / 60);
        const sec = Math.floor(seconds % 60);
        return `${min}:${sec.toString().padStart(2, '0')}`;
    }

    function parseLRC(lrc) {
        if (!lrc) return [];
        const lines = lrc.split('\n');
        const result = [];
        const timeReg = /\[(\d{2}):(\d{2})\.(\d{2,3})\]/g;
        
        lines.forEach(line => {
            const matches = Array.from(line.matchAll(timeReg));
            if (matches.length > 0) {
                const text = line.replace(timeReg, '').trim();
                if (text) {
                    matches.forEach(match => {
                        const m = parseInt(match[1]);
                        const s = parseInt(match[2]);
                        const ms = parseInt(match[3]);
                        const time = m * 60 + s + ms / (match[3].length === 3 ? 1000 : 100);
                        result.push({ time, text });
                    });
                }
            }
        });
        return result.sort((a, b) => a.time - b.time);
    }

    function renderLyrics(lrcText) {
        state.lyrics = parseLRC(lrcText);
        ui.lrcContainer.innerHTML = '';
        
        if (state.lyrics.length === 0) {
            ui.lrcContainer.innerHTML = `<div class="text-neutral-400 text-sm py-10" role="option">${config.i18n.noLyrics}</div>`;
            return;
        }

        state.lyrics.forEach((line, index) => {
            const lineEl = document.createElement('div');
            lineEl.className = 'lrc-line transition-all duration-300 text-sm text-neutral-400 py-1 cursor-pointer hover:text-[var(--primary)]';
            lineEl.innerText = line.text;
            lineEl.dataset.index = index;
            lineEl.setAttribute('role', 'option');
            lineEl.setAttribute('aria-label', line.text);
            lineEl.onclick = () => {
                ui.audio.currentTime = line.time;
            };
            ui.lrcContainer.appendChild(lineEl);
        });
    }

    function updateLyricSync(currentTime, forceScroll = false) {
        if (!state.lyrics || state.lyrics.length === 0) return;

        let index = -1;
        for (let i = 0; i < state.lyrics.length; i++) {
            if (currentTime >= state.lyrics[i].time) {
                index = i;
            } else {
                break;
            }
        }

        // Always update UI classes when index changes
        if (index !== state.currentLrcIndex) {
                const lines = ui.lrcContainer.querySelectorAll('.lrc-line');
                lines.forEach((line, i) => {
                    if (i === index) {
                        line.classList.add('text-[var(--primary)]', 'font-bold', 'text-base');
                        line.classList.remove('text-neutral-400', 'text-sm');
                    } else {
                        line.classList.remove('text-[var(--primary)]', 'font-bold', 'text-base');
                        line.classList.add('text-neutral-400', 'text-sm');
                    }
                });
                state.currentLrcIndex = index;
        }

        // Handle scrolling separately so it can be forced even if index hasn't changed
        if (index !== -1 && (!state.isUserScrolling || forceScroll)) {
            const line = ui.lrcContainer.querySelector(`.lrc-line[data-index="${index}"]`);
            if (line) {
                const containerHeight = ui.lrcContainer.clientHeight;
                // Use line.offsetTop relative to its offsetParent (the container with relative)
                const lineOffset = line.offsetTop;
                const lineHeight = line.offsetHeight;
                
                const targetScroll = lineOffset - (containerHeight / 2) + (lineHeight / 2);
                
                ui.lrcContainer.scrollTo({
                    top: targetScroll,
                    behavior: forceScroll ? 'auto' : 'smooth'
                });
            }
        }
    }

    // Core Init
    async function init() {
        setLoading(true);
        try {
            if (config.mode === 'meting' && config.meting) {
                await fetchMetingData();
            } else if (config.mode === 'local') {
                state.playlist = config.localPlaylist || [];
            }

            if (state.playlist.length > 0) {
                renderPlaylist();
                // If random mode is initial setting, shuffle start
                let startIndex = 0;
                if (state.playMode === 2) {
                    startIndex = Math.floor(Math.random() * state.playlist.length);
                }
                
                loadTrack(startIndex, false);
                initVolume();
                updateModeUI(); // Reflect initial mode in UI
            } else {
                ui.title.innerText = config.i18n.noSongs;
            }
        } catch (e) {
            console.error("Music Init Error", e);
            ui.title.innerText = config.i18n.error;
        } finally {
            setLoading(false);
        }
    }

    async function fetchMetingData() {
        if (!config.meting) return;
        const { api, server, type, id, auth, fallbackApis } = config.meting;
        
        const apis = [api, ...(fallbackApis || [])];
        
        for (const baseApi of apis) {
            if (!baseApi) continue;
            try {
                let fetchUrl = baseApi.replace(':server', server).replace(':type', type).replace(':id', id).replace(':r', Math.random());
                if (auth) fetchUrl += `&auth=${auth}`;

                const res = await fetch(fetchUrl);
                if (!res.ok) throw new Error(`HTTP error! status: ${res.status}`);
                const data = await res.json();
                
                if (Array.isArray(data) && data.length > 0) {
                    state.playlist = data.map(item => ({
                        name: item.title || item.name || 'Unknown',
                        artist: item.author || item.artist || 'Unknown',
                        url: item.url,
                        pic: item.pic || item.cover || '',
                        lrc: item.lrc
                    }));
                    return; // Found data, exit loop
                }
            } catch (e) {
                console.warn(`Meting API fetch failed for ${baseApi}`, e);
            }
        }
        throw new Error("All Meting APIs failed");
    }

    function renderPlaylist() {
        ui.playlistContainer.innerHTML = '';
        state.playlist.forEach((track, idx) => {
            const clone = ui.itemTemplate.content.cloneNode(true);
            const itemEl = clone.querySelector('.playlist-item');
            const img = clone.querySelector('.item-cover');
            const title = clone.querySelector('.item-title');
            const artist = clone.querySelector('.item-artist');
            
            img.src = track.pic || '';
            img.alt = `${track.name} - ${track.artist}`;
            title.innerText = track.name;
            artist.innerText = track.artist;
            
            // Active State logic handled in updatePlaylistUI
            itemEl.dataset.index = idx;
            itemEl.setAttribute('role', 'option');
            itemEl.setAttribute('aria-label', `${track.name} - ${track.artist}`);
            itemEl.onclick = () => {
                if (state.currentIndex === idx && !ui.audio.paused) {
                    togglePlay();
                } else {
                    loadTrack(idx, true);
                }
            };
            ui.playlistContainer.appendChild(clone);
        });
    }

    function loadTrack(index, autoPlay = false) {
        if (index < 0 || index >= state.playlist.length) return;
        state.currentIndex = index;
        const track = state.playlist[index];

        ui.title.innerText = track.name;
        ui.title.title = track.name;
        ui.artist.innerText = track.artist;
        ui.artist.title = track.artist;
        
        if (track.pic) {
            ui.cover.classList.add('opacity-0');
            ui.cover.src = track.pic;
            ui.cover.alt = `${track.name} - ${track.artist}`;
        } else {
            ui.cover.src = '';
            ui.cover.classList.add('opacity-0');
            ui.cover.alt = config.i18n.noCover;
        }
        
        ui.audio.src = track.url;
        
        // Reset cover rotation
        ui.cover.classList.remove('animate-spin-slow');
        void ui.cover.offsetWidth;
        ui.cover.classList.add('animate-spin-slow');
        ui.cover.style.animationPlayState = 'paused';
        
        // Reset Progress
        ui.progressBar.style.width = '0%';
        ui.progressContainer.setAttribute('aria-valuenow', '0');
        ui.currentTime.innerText = '0:00';
        ui.totalTime.innerText = '0:00';

        // Reset Lyrics
        state.lyrics = [];
        state.currentLrcIndex = -1;
        ui.lrcContainer.innerHTML = `<div class="text-neutral-400 text-sm py-10">${config.i18n.loadingLyrics}</div>`;
        
        if (track.lrc) {
            const isLrcUrl = /^(https?:)?\/\//.test(track.lrc)
                || track.lrc.startsWith('/')
                || /\.(lrc|txt)(\?|#|$)/i.test(track.lrc);

            if (isLrcUrl) {
                fetch(track.lrc)
                    .then(res => res.text())
                    .then(text => renderLyrics(text))
                    .catch(() => ui.lrcContainer.innerHTML = `<div class="text-neutral-400 text-sm py-10">${config.i18n.failedLyrics}</div>`);
            } else {
                renderLyrics(track.lrc);
            }
        } else {
            ui.lrcContainer.innerHTML = `<div class="text-neutral-400 text-sm py-10">${config.i18n.noLyrics}</div>`;
        }

        updatePlaylistUI();

        if (autoPlay) {
            ui.audio.play().then(() => {
                updatePlayState(true);
            }).catch(e => console.warn(e));
        } else {
            updatePlayState(false);
        }
    }

    function updatePlayState(isPlaying) {
        state.isPlaying = isPlaying;
        if (isPlaying) {
            ui.btnPlay.classList.add('bg-[var(--primary)]', 'text-white', 'hover:brightness-110');
            ui.btnPlay.classList.remove('bg-[var(--btn-regular-bg)]', 'hover:bg-[var(--btn-regular-bg-hover)]', 'active:bg-[var(--btn-regular-bg-active)]', 'text-[var(--primary)]');
            ui.iconPlay.classList.add('hidden');
            ui.iconPause.classList.remove('hidden');
            ui.cover.style.animationPlayState = 'running';
            ui.btnPlay.setAttribute('aria-label', config.i18n.pause);
            ui.btnPlay.title = config.i18n.pause;
        } else {
            ui.btnPlay.classList.remove('bg-[var(--primary)]', 'text-white', 'hover:brightness-110');
            ui.btnPlay.classList.add('bg-[var(--btn-regular-bg)]', 'hover:bg-[var(--btn-regular-bg-hover)]', 'active:bg-[var(--btn-regular-bg-active)]', 'text-[var(--primary)]');
            ui.iconPlay.classList.remove('hidden');
            ui.iconPause.classList.add('hidden');
            ui.cover.style.animationPlayState = 'paused';
            ui.btnPlay.setAttribute('aria-label', config.i18n.play);
            ui.btnPlay.title = config.i18n.play;
        }
    }

    function togglePlay() {
        if (ui.audio.paused) {
            ui.audio.play().then(() => updatePlayState(true));
        } else {
            ui.audio.pause();
            updatePlayState(false);
        }
    }

    function playNext(auto = false) {
        let nextIndex;
        if (state.playMode === 1 && auto) { 
            // Single Loop
            ui.audio.currentTime = 0;
            ui.audio.play(); 
            return;
        } else if (state.playMode === 2) { 
            // Random
            nextIndex = Math.floor(Math.random() * state.playlist.length);
        } else {
            // List Loop
            nextIndex = (state.currentIndex + 1) % state.playlist.length;
        }
        loadTrack(nextIndex, true);
    }

    function playPrev() {
        let prevIndex = (state.currentIndex - 1 + state.playlist.length) % state.playlist.length;
        if (state.playMode === 2) {
                prevIndex = Math.floor(Math.random() * state.playlist.length);
        }
        loadTrack(prevIndex, true);
    }

    function updatePlaylistUI() {
            const items = ui.playlistContainer.querySelectorAll('.playlist-item');
            items.forEach(el => {
                const idx = parseInt(el.dataset.index);
                const overlay = el.querySelector('.item-active-overlay');
                const title = el.querySelector('.item-title');
                if (idx === state.currentIndex) {
                    el.classList.add('bg-neutral-100', 'dark:bg-white/10');
                    el.setAttribute('aria-current', 'true');
                    overlay.classList.remove('hidden');
                    overlay.classList.add('flex');
                    title.classList.add('text-[var(--primary)]');
                } else {
                    el.classList.remove('bg-neutral-100', 'dark:bg-white/10');
                    el.removeAttribute('aria-current');
                    overlay.classList.add('hidden');
                    overlay.classList.remove('flex');
                    title.classList.remove('text-[var(--primary)]');
                }
            });
    }

    // Mode Logic
    // Mode 0: List (Def), Mode 1: One, Mode 2: Rand
    // Button Repeat: Cycle 0 -> 1 -> 2 -> 0
    
    function updateModeUI() {
        const primaryColor = 'text-[var(--primary)]';

        // Always primary color if we want to indicate it's interactable, or conditionally
        // Usually Loop List is 'inactive' (grey) or 'active' (primary). 
        // Let's make: List=Grey (default), One=Primary, Rand=Primary
        
        if (state.playMode === 0) {
                ui.btnRepeat.className = `p-2 active:scale-95 transition-colors text-neutral-300 dark:text-neutral-600 hover:text-[var(--primary)]`;
                ui.iconRepeat.classList.remove('hidden');
                ui.iconRepeatOne.classList.add('hidden');
                ui.iconShuffle.classList.add('hidden');
        } else if (state.playMode === 1) {
                ui.btnRepeat.className = `p-2 active:scale-95 transition-colors ${primaryColor}`;
                ui.iconRepeat.classList.add('hidden');
                ui.iconRepeatOne.classList.remove('hidden');
                ui.iconShuffle.classList.add('hidden');
        } else {
                ui.btnRepeat.className = `p-2 active:scale-95 transition-colors ${primaryColor}`;
                ui.iconRepeat.classList.add('hidden');
                ui.iconRepeatOne.classList.add('hidden');
                ui.iconShuffle.classList.remove('hidden');
        }
    }

    ui.btnRepeat.addEventListener('click', () => {
            // Cycle: 0 -> 1 -> 2 -> 0
            state.playMode = (state.playMode + 1) % 3;
            updateModeUI();
    });

    // Volume Logic
    function initVolume() {
        ui.audio.volume = state.lastVolume;
        updateVolumeUI();
    }

    function updateVolumeUI() {
        const pct = state.isMuted ? 0 : state.lastVolume * 100;
        ui.volBar.style.width = `${pct}%`;
        ui.volContainer.setAttribute('aria-valuenow', Math.round(pct).toString());
        
        if (state.isMuted || state.lastVolume === 0) {
            ui.iconVolHigh.classList.add('hidden');
            ui.iconVolMute.classList.remove('hidden');
        } else {
            ui.iconVolHigh.classList.remove('hidden');
            ui.iconVolMute.classList.add('hidden');
        }
    }

    ui.btnMute.addEventListener('click', () => {
        state.isMuted = !state.isMuted;
        ui.audio.muted = state.isMuted;
        updateVolumeUI();
    });

    ui.volContainer.addEventListener('click', (e) => {
            const rect = ui.volContainer.getBoundingClientRect();
            const x = e.clientX - rect.left;
            let val = x / rect.width;
            val = Math.max(0, Math.min(1, val));
            
            state.lastVolume = val;
            state.isMuted = false;
            ui.audio.muted = false;
            ui.audio.volume = val;
            localStorage.setItem('music-player-volume', val.toString());
            updateVolumeUI();
    });

    // Drawer Logic
    ui.btnLrc.addEventListener('click', () => {
            const isOpen = ui.lrcDrawer.style.gridTemplateRows === '1fr';
            if (isOpen) {
                ui.lrcDrawer.style.gridTemplateRows = '0fr';
                ui.lrcDrawer.classList.remove('opacity-100');
                ui.lrcDrawer.classList.add('opacity-0');
                ui.btnLrc.classList.remove('text-[var(--primary)]');
                ui.btnLrc.classList.add('text-neutral-400');
                ui.iconLrcOn.classList.add('hidden');
                ui.iconLrcOff.classList.remove('hidden');
            } else {
                // Close playlist if open
                ui.playlistDrawer.style.gridTemplateRows = '0fr';
                ui.playlistDrawer.classList.remove('opacity-100');
                ui.playlistDrawer.classList.add('opacity-0');
                ui.btnDrawer.classList.remove('text-[var(--primary)]');
                ui.btnDrawer.classList.add('text-neutral-400');

                ui.lrcDrawer.style.gridTemplateRows = '1fr';
                ui.lrcDrawer.classList.add('opacity-100');
                ui.lrcDrawer.classList.remove('opacity-0');
                ui.btnLrc.classList.add('text-[var(--primary)]');
                ui.btnLrc.classList.remove('text-neutral-400');
                ui.iconLrcOn.classList.remove('hidden');
                ui.iconLrcOff.classList.add('hidden');
            }
    });

    ui.btnDrawer.addEventListener('click', () => {
            const isOpen = ui.playlistDrawer.style.gridTemplateRows === '1fr';
            if (isOpen) {
                ui.playlistDrawer.style.gridTemplateRows = '0fr';
                ui.playlistDrawer.classList.remove('opacity-100');
                ui.playlistDrawer.classList.add('opacity-0');
                
                ui.btnDrawer.classList.add('text-neutral-400');
                ui.btnDrawer.classList.remove('text-[var(--primary)]');
            } else {
                // Close lyrics if open
                ui.lrcDrawer.style.gridTemplateRows = '0fr';
                ui.lrcDrawer.classList.remove('opacity-100');
                ui.lrcDrawer.classList.add('opacity-0');
                ui.btnLrc.classList.remove('text-[var(--primary)]');
                ui.btnLrc.classList.add('text-neutral-400');

                ui.playlistDrawer.style.gridTemplateRows = '1fr';
                ui.playlistDrawer.classList.add('opacity-100');
                ui.playlistDrawer.classList.remove('opacity-0');
                
                ui.btnDrawer.classList.remove('text-neutral-400');
                ui.btnDrawer.classList.add('text-[var(--primary)]');
            }
    });

    // Core Events
    ui.btnPlay.addEventListener('click', togglePlay);
    ui.btnNext.addEventListener('click', () => playNext(false));
    ui.btnPrev.addEventListener('click', playPrev);

    ui.lrcContainer.addEventListener('wheel', () => {
            state.isUserScrolling = true;
            resetScrollTimeout();
    });
    ui.lrcContainer.addEventListener('touchstart', () => {
            state.isUserScrolling = true;
            resetScrollTimeout();
    });

    function resetScrollTimeout() {
        clearTimeout(state.scrollTimeout);
        state.scrollTimeout = setTimeout(() => {
            state.isUserScrolling = false;
            updateLyricSync(ui.audio.currentTime, true); // Snap back immediately
        }, 3000); // Wait for 3 seconds of no activity
    }

    ui.cover.addEventListener('load', () => {
            ui.cover.classList.remove('opacity-0');
    });
    ui.cover.addEventListener('error', () => {
            ui.cover.classList.add('opacity-0');
    });
    
    ui.audio.addEventListener('timeupdate', () => {
            if (isNaN(ui.audio.duration)) return;
            const currentTime = ui.audio.currentTime;
            const duration = ui.audio.duration;
            const progress = (currentTime / duration) * 100;
            
            ui.progressBar.style.width = `${progress}%`;
            ui.progressThumb.style.left = `${progress}%`;
            ui.progressContainer.setAttribute('aria-valuenow', Math.round(progress).toString());
            
            ui.currentTime.innerText = formatTime(currentTime);
            ui.totalTime.innerText = formatTime(duration);

            updateLyricSync(currentTime);
    });

    ui.audio.addEventListener('ended', () => playNext(true));
    ui.audio.addEventListener('error', () => { /* Handle error */ });
    
    // Global Mutual Exclusion
    window.addEventListener('firefly-music-play', (e) => {
        if (e.detail.id !== widgetId && !ui.audio.paused) {
            ui.audio.pause();
            updatePlayState(false);
        }
    });

    ui.audio.addEventListener('play', () => {
        window.dispatchEvent(new CustomEvent('firefly-music-play', { detail: { id: widgetId } }));
    });
    
    // Seek
    ui.progressContainer.addEventListener('click', (e) => {
        if (!ui.audio.duration) return;
        const rect = ui.progressContainer.getBoundingClientRect();
        const clickX = e.clientX - rect.left;
        const percent = Math.min(Math.max(clickX / rect.width, 0), 1);
        ui.audio.currentTime = percent * ui.audio.duration;
    });

    init();
})();
})();</script>  </div> <div id="nav-menu-panel" class="float-panel float-panel-closed absolute transition-all fixed right-4 px-2 py-2 max-h-[80vh] overflow-y-auto" data-astro-cid-b4siqy5m> <div class="mobile-menu-item" data-astro-cid-b4siqy5m> <!-- 普通链接项目 -->
                <a href="/" class="group flex justify-between items-center py-2 pl-3 pr-1 rounded-lg gap-8
                    hover:bg-(--btn-plain-bg-hover) active:bg-(--btn-plain-bg-active) transition
                " data-astro-cid-b4siqy5m> <div class="flex items-center transition text-black/75 dark:text-white/75 font-bold group-hover:text-(--primary) group-active:text-(--primary)" data-astro-cid-b4siqy5m> <svg width="1em" height="1em" viewBox="0 0 24 24" class="text-[1.1rem] mr-2" data-astro-cid-b4siqy5m="true" data-icon="material-symbols:home">   <use href="#ai:material-symbols:home"></use>  </svg> 主页 </div> <svg width="1em" height="1em" class="transition text-[1.25rem] text-(--primary)" data-astro-cid-b4siqy5m="true" data-icon="material-symbols:chevron-right-rounded">   <symbol id="ai:material-symbols:chevron-right-rounded" viewBox="0 0 24 24"><path fill="currentColor" d="M12.6 12L8.7 8.1q-.275-.275-.275-.7t.275-.7t.7-.275t.7.275l4.6 4.6q.15.15.213.325t.062.375t-.062.375t-.213.325l-4.6 4.6q-.275.275-.7.275t-.7-.275t-.275-.7t.275-.7z"/></symbol><use href="#ai:material-symbols:chevron-right-rounded"></use>  </svg>  </a> </div><div class="mobile-menu-item" data-astro-cid-b4siqy5m> <!-- 普通链接项目 -->
                <a href="/archive/" class="group flex justify-between items-center py-2 pl-3 pr-1 rounded-lg gap-8
                    hover:bg-(--btn-plain-bg-hover) active:bg-(--btn-plain-bg-active) transition
                " data-astro-cid-b4siqy5m> <div class="flex items-center transition text-black/75 dark:text-white/75 font-bold group-hover:text-(--primary) group-active:text-(--primary)" data-astro-cid-b4siqy5m> <svg width="1em" height="1em" viewBox="0 0 24 24" class="text-[1.1rem] mr-2" data-astro-cid-b4siqy5m="true" data-icon="material-symbols:archive">   <use href="#ai:material-symbols:archive"></use>  </svg> 归档 </div> <svg width="1em" height="1em" viewBox="0 0 24 24" class="transition text-[1.25rem] text-(--primary)" data-astro-cid-b4siqy5m="true" data-icon="material-symbols:chevron-right-rounded">   <use href="#ai:material-symbols:chevron-right-rounded"></use>  </svg>  </a> </div><div class="mobile-menu-item" data-astro-cid-b4siqy5m> <!-- 普通链接项目 -->
                <a href="/friends/" class="group flex justify-between items-center py-2 pl-3 pr-1 rounded-lg gap-8
                    hover:bg-(--btn-plain-bg-hover) active:bg-(--btn-plain-bg-active) transition
                " data-astro-cid-b4siqy5m> <div class="flex items-center transition text-black/75 dark:text-white/75 font-bold group-hover:text-(--primary) group-active:text-(--primary)" data-astro-cid-b4siqy5m> <svg width="1em" height="1em" viewBox="0 0 24 24" class="text-[1.1rem] mr-2" data-astro-cid-b4siqy5m="true" data-icon="material-symbols:group">   <use href="#ai:material-symbols:group"></use>  </svg> 友链 </div> <svg width="1em" height="1em" viewBox="0 0 24 24" class="transition text-[1.25rem] text-(--primary)" data-astro-cid-b4siqy5m="true" data-icon="material-symbols:chevron-right-rounded">   <use href="#ai:material-symbols:chevron-right-rounded"></use>  </svg>  </a> </div><div class="mobile-menu-item" data-astro-cid-b4siqy5m> <!-- 普通链接项目 -->
                <a href="/guestbook/" class="group flex justify-between items-center py-2 pl-3 pr-1 rounded-lg gap-8
                    hover:bg-(--btn-plain-bg-hover) active:bg-(--btn-plain-bg-active) transition
                " data-astro-cid-b4siqy5m> <div class="flex items-center transition text-black/75 dark:text-white/75 font-bold group-hover:text-(--primary) group-active:text-(--primary)" data-astro-cid-b4siqy5m> <svg width="1em" height="1em" viewBox="0 0 24 24" class="text-[1.1rem] mr-2" data-astro-cid-b4siqy5m="true" data-icon="material-symbols:chat">   <use href="#ai:material-symbols:chat"></use>  </svg> 留言 </div> <svg width="1em" height="1em" viewBox="0 0 24 24" class="transition text-[1.25rem] text-(--primary)" data-astro-cid-b4siqy5m="true" data-icon="material-symbols:chevron-right-rounded">   <use href="#ai:material-symbols:chevron-right-rounded"></use>  </svg>  </a> </div><div class="mobile-menu-item" data-astro-cid-b4siqy5m> <!-- 有子菜单的项目 -->
                <div class="mobile-dropdown" data-mobile-dropdown data-astro-cid-b4siqy5m> <button class="group flex justify-between items-center py-2 pl-3 pr-1 rounded-lg gap-8 w-full text-left
                            hover:bg-(--btn-plain-bg-hover) active:bg-(--btn-plain-bg-active) transition" data-mobile-dropdown-trigger aria-expanded="false" data-astro-cid-b4siqy5m> <div class="flex items-center transition text-black/75 dark:text-white/75 font-bold group-hover:text-(--primary) group-active:text-(--primary)" data-astro-cid-b4siqy5m> <svg width="1em" height="1em" viewBox="0 0 24 24" class="text-[1.1rem] mr-2" data-astro-cid-b4siqy5m="true" data-icon="material-symbols:info">   <use href="#ai:material-symbols:info"></use>  </svg> 关于 </div> <svg width="1em" height="1em" viewBox="0 0 24 24" class="transition text-[1.25rem] text-(--primary) mobile-dropdown-arrow duration-200" data-astro-cid-b4siqy5m="true" data-icon="material-symbols:keyboard-arrow-down-rounded">   <use href="#ai:material-symbols:keyboard-arrow-down-rounded"></use>  </svg> </button> <div class="mobile-submenu" data-mobile-submenu data-astro-cid-b4siqy5m> <a href="/sponsor/" class="group flex justify-between items-center py-2 pl-6 pr-1 rounded-lg gap-8
                                   hover:bg-(--btn-plain-bg-hover) active:bg-(--btn-plain-bg-active) transition" data-astro-cid-b4siqy5m> <div class="flex items-center transition text-black/60 dark:text-white/60 font-medium group-hover:text-(--primary) group-active:text-(--primary)" data-astro-cid-b4siqy5m> <svg width="1em" height="1em" viewBox="0 0 24 24" class="text-[1.1rem] mr-2" data-astro-cid-b4siqy5m="true" data-icon="material-symbols:favorite">   <use href="#ai:material-symbols:favorite"></use>  </svg> 赞助 </div>  </a><a href="/about/" class="group flex justify-between items-center py-2 pl-6 pr-1 rounded-lg gap-8
                                   hover:bg-(--btn-plain-bg-hover) active:bg-(--btn-plain-bg-active) transition" data-astro-cid-b4siqy5m> <div class="flex items-center transition text-black/60 dark:text-white/60 font-medium group-hover:text-(--primary) group-active:text-(--primary)" data-astro-cid-b4siqy5m> <svg width="1em" height="1em" viewBox="0 0 24 24" class="text-[1.1rem] mr-2" data-astro-cid-b4siqy5m="true" data-icon="material-symbols:person">   <use href="#ai:material-symbols:person"></use>  </svg> 关于我 </div>  </a> </div> </div> </div> </div>  <script type="module">document.addEventListener("DOMContentLoaded",function(){const e=document.querySelectorAll("[data-mobile-dropdown]");e.forEach(t=>{const a=t.querySelector("[data-mobile-dropdown-trigger]"),d=t.querySelector("[data-mobile-submenu]");a&&d&&a.addEventListener("click",function(d){d.preventDefault();const r="true"===t.getAttribute("data-expanded");e.forEach(e=>{if(e!==t){e.setAttribute("data-expanded","false");const t=e.querySelector("[data-mobile-dropdown-trigger]");t&&t.setAttribute("aria-expanded","false")}});const n=!r;t.setAttribute("data-expanded",n.toString()),a.setAttribute("aria-expanded",n.toString())})})});</script> <astro-island uid="16zw3R" component-url="/_astro/DisplaySettingsIntegrated.EEg0u6p6.js" component-export="default" renderer-url="/_astro/client.svelte.C7wO1dt2.js" props="{}" ssr client="load" opts="{&quot;name&quot;:&quot;DisplaySettings&quot;,&quot;value&quot;:true}" await-children><!--[--><!--[--><div id="display-setting" class="float-panel float-panel-closed absolute transition-all w-80 right-4 px-4 py-2 svelte-zyhyi5"><!--[--><div class="mt-2 mb-2"><div class="flex flex-row gap-2 mb-2 items-center justify-between"><div class="flex gap-2 font-bold text-lg text-neutral-900 dark:text-neutral-100 transition relative ml-3 before:w-1 before:h-4 before:rounded-md before:bg-(--primary) before:absolute before:-left-3 before:top-1/2 before:-translate-y-1/2">主题色相 <button aria-label="Reset to Default" class="btn-regular w-7 h-7 rounded-md active:scale-90 opacity-0 pointer-events-none"><div class="text-(--btn-content)"><!--[--><span class="inline-icon inline-flex items-center justify-center text-base text-[0.875rem] svelte-ktjbt7" aria-hidden="true"><!----><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 640 640"><path fill="currentColor" d="M320 128c-56.8 0-107.9 24.7-143.1 64H224c17.7 0 32 14.3 32 32s-14.3 32-32 32H96c-17.7 0-32-14.3-32-32V96c0-17.7 14.3-32 32-32s32 14.3 32 32v54.7C174.9 97.6 243.5 64 320 64c141.4 0 256 114.6 256 256S461.4 576 320 576c-87 0-163.9-43.4-210.1-109.7c-10.1-14.5-6.6-34.4 7.9-44.6s34.4-6.6 44.6 7.9c34.8 49.8 92.4 82.3 157.6 82.3c106 0 192-86 192-192S426 128 320 128"/></svg><!----></span><!--]--><!----></div></button></div> <div class="flex gap-1"><div id="hueValue" class="transition bg-(--btn-regular-bg) w-10 h-7 rounded-md flex justify-center font-bold text-sm items-center text-(--btn-content)">250</div></div></div> <div class="w-full h-6 px-1 bg-[oklch(0.80_0.10_0)] dark:bg-[oklch(0.70_0.10_0)] rounded select-none"><input aria-label="主题色相" type="range" min="0" max="360" value="250" class="slider svelte-zyhyi5" id="colorSlider" step="5" style="width: 100%"/></div></div><!--]--> <!--[--><div class="mt-2 mb-2"><div class="flex gap-2 font-bold text-lg text-neutral-900 dark:text-neutral-100 transition relative ml-3 mb-2 before:w-1 before:h-4 before:rounded-md before:bg-(--primary) before:absolute before:-left-3 before:top-1/2 before:-translate-y-1/2">壁纸模式 <button aria-label="Reset to Default" class="btn-regular w-7 h-7 rounded-md active:scale-90 opacity-0 pointer-events-none"><div class="text-(--btn-content)"><!--[--><span class="inline-icon inline-flex items-center justify-center text-base text-[0.875rem] svelte-ktjbt7" aria-hidden="true"><!----><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 640 640"><path fill="currentColor" d="M320 128c-56.8 0-107.9 24.7-143.1 64H224c17.7 0 32 14.3 32 32s-14.3 32-32 32H96c-17.7 0-32-14.3-32-32V96c0-17.7 14.3-32 32-32s32 14.3 32 32v54.7C174.9 97.6 243.5 64 320 64c141.4 0 256 114.6 256 256S461.4 576 320 576c-87 0-163.9-43.4-210.1-109.7c-10.1-14.5-6.6-34.4 7.9-44.6s34.4-6.6 44.6 7.9c34.8 49.8 92.4 82.3 157.6 82.3c106 0 192-86 192-192S426 128 320 128"/></svg><!----></span><!--]--><!----></div></button></div> <div class="space-y-1 px-1"><button class="w-full btn-regular rounded-md py-2 px-3 flex items-center gap-3 text-left active:scale-95 transition-all relative overflow-hidden bg-(--btn-regular-bg-hover)"><!--[--><span class="inline-icon inline-flex items-center justify-center text-base text-[1.25rem] shrink-0 svelte-ktjbt7" aria-hidden="true"><!----><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><path fill="currentColor" d="M5 21q-.825 0-1.412-.587T3 19V5q0-.825.588-1.412T5 3h14q.825 0 1.413.588T21 5v14q0 .825-.587 1.413T19 21zm0-2h14V5H5zm1-2h12l-3.75-5l-3 4L9 13zm-1 2V5z"/></svg><!----></span><!--]--><!----> <span class="text-sm flex-1">横幅壁纸</span> <!--[--><!--[--><span class="inline-icon inline-flex items-center justify-center text-base text-[1rem] shrink-0 text-(--primary) svelte-ktjbt7" aria-hidden="true"><!----><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><path fill="currentColor" d="m10.6 16.6l7.05-7.05l-1.4-1.4l-5.65 5.65l-2.85-2.85l-1.4 1.4zM12 22q-2.075 0-3.9-.788t-3.175-2.137T2.788 15.9T2 12t.788-3.9t2.137-3.175T8.1 2.788T12 2t3.9.788t3.175 2.137T21.213 8.1T22 12t-.788 3.9t-2.137 3.175t-3.175 2.138T12 22"/></svg><!----></span><!--]--><!--]--></button> <button class="w-full btn-regular rounded-md py-2 px-3 flex items-center gap-3 text-left active:scale-95 transition-all relative overflow-hidden opacity-60"><!--[--><span class="inline-icon inline-flex items-center justify-center text-base text-[1.25rem] shrink-0 svelte-ktjbt7" aria-hidden="true"><!----><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><path fill="currentColor" d="M5 21q-.825 0-1.412-.587T3 19v-6h2v6h6v2zm8 0v-2h6v-6h2v6q0 .825-.587 1.413T19 21zm-7-4l3-4l2.25 3l3-4L18 17zm-3-6V5q0-.825.588-1.412T5 3h6v2H5v6zm16 0V5h-6V3h6q.825 0 1.413.588T21 5v6zm-3.5-1q-.65 0-1.075-.425T14 8.5t.425-1.075T15.5 7t1.075.425T17 8.5t-.425 1.075T15.5 10"/></svg><!----></span><!--]--><!----> <span class="text-sm flex-1">全屏透明</span> <!--[!--><!--]--></button> <button class="w-full btn-regular rounded-md py-2 px-3 flex items-center gap-3 text-left active:scale-95 transition-all relative overflow-hidden opacity-60"><!--[--><span class="inline-icon inline-flex items-center justify-center text-base text-[1.25rem] shrink-0 svelte-ktjbt7" aria-hidden="true"><!----><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><path fill="currentColor" d="m21 18.15l-2-2V5H7.85l-2-2H19q.825 0 1.413.588T21 5zm-1.2 4.45L18.2 21H5q-.825 0-1.412-.587T3 19V5.8L1.4 4.2l1.4-1.4l18.4 18.4zM6 17l3-4l2.25 3l.825-1.1L5 7.825V19h11.175l-2-2zm4.6-3.6"/></svg><!----></span><!--]--><!----> <span class="text-sm flex-1">纯色背景</span> <!--[!--><!--]--></button></div></div><!--]--> <!--[--><div class="mt-2 mb-2"><div class="flex gap-2 font-bold text-lg text-neutral-900 dark:text-neutral-100 transition relative ml-3 mb-2 before:w-1 before:h-4 before:rounded-md before:bg-(--primary) before:absolute before:-left-3 before:top-1/2 before:-translate-y-1/2">文章布局 <button aria-label="Reset to Default" class="btn-regular w-7 h-7 rounded-md active:scale-90 opacity-0 pointer-events-none"><div class="text-(--btn-content)"><!--[--><span class="inline-icon inline-flex items-center justify-center text-base text-[0.875rem] svelte-ktjbt7" aria-hidden="true"><!----><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 640 640"><path fill="currentColor" d="M320 128c-56.8 0-107.9 24.7-143.1 64H224c17.7 0 32 14.3 32 32s-14.3 32-32 32H96c-17.7 0-32-14.3-32-32V96c0-17.7 14.3-32 32-32s32 14.3 32 32v54.7C174.9 97.6 243.5 64 320 64c141.4 0 256 114.6 256 256S461.4 576 320 576c-87 0-163.9-43.4-210.1-109.7c-10.1-14.5-6.6-34.4 7.9-44.6s34.4-6.6 44.6 7.9c34.8 49.8 92.4 82.3 157.6 82.3c106 0 192-86 192-192S426 128 320 128"/></svg><!----></span><!--]--><!----></div></button></div> <div class="flex gap-2"><button aria-label="列表" class="flex-1 btn-regular rounded-md py-2 px-3 flex items-center justify-center gap-2 active:scale-95 transition-all relative overflow-hidden bg-(--btn-regular-bg-hover)" title="列表"><svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M4 6h16v2H4zm0 5h16v2H4zm0 5h16v2H4z"></path></svg> <span class="text-xs font-medium">列表</span> <!--[--><!--[--><span class="inline-icon inline-flex items-center justify-center text-base text-[1rem] shrink-0 text-(--primary) svelte-ktjbt7" aria-hidden="true"><!----><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><path fill="currentColor" d="m10.6 16.6l7.05-7.05l-1.4-1.4l-5.65 5.65l-2.85-2.85l-1.4 1.4zM12 22q-2.075 0-3.9-.788t-3.175-2.137T2.788 15.9T2 12t.788-3.9t2.137-3.175T8.1 2.788T12 2t3.9.788t3.175 2.137T21.213 8.1T22 12t-.788 3.9t-2.137 3.175t-3.175 2.138T12 22"/></svg><!----></span><!--]--><!--]--></button> <button aria-label="网格" class="flex-1 btn-regular rounded-md py-2 px-3 flex items-center justify-center gap-2 active:scale-95 transition-all relative overflow-hidden opacity-60" title="网格"><svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M3 3h7v7H3V3zm0 11h7v7H3v-7zm11-11h7v7h-7V3zm0 11h7v7h-7v-7z"></path></svg> <span class="text-xs font-medium">网格</span> <!--[!--><!--]--></button></div></div><!--]--></div><!--]--><!--]--><!--astro:end--></astro-island> </div> </div> <script type="module">function e(){const e=document.getElementById("navbar");if(!e)return;if("semifull"!==e.getAttribute("data-transparent-mode"))return;if(!("true"===e.getAttribute("data-is-home")))return window.semifullScrollHandler&&(window.removeEventListener("scroll",window.semifullScrollHandler),window.semifullScrollHandler=void 0),void e.classList.add("scrolled");e.classList.remove("scrolled");let t=!1;function n(){(window.pageYOffset||document.documentElement.scrollTop)>50?e.classList.add("scrolled"):e.classList.remove("scrolled"),t=!1}function l(){t||(requestAnimationFrame(n),t=!0)}window.semifullScrollHandler&&window.removeEventListener("scroll",window.semifullScrollHandler),window.semifullScrollHandler=l,window.addEventListener("scroll",l,{passive:!0}),n()}!function(){let e=document.getElementById("display-settings-switch");e&&(e.onclick=function(){let e=document.getElementById("display-setting");e&&e.classList.toggle("float-panel-closed")});let t=document.getElementById("nav-menu-switch");t&&(t.onclick=function(){let e=document.getElementById("nav-menu-panel");e&&e.classList.toggle("float-panel-closed")});let n=document.getElementById("music-player-switch");n&&(n.onclick=function(){let e=document.getElementById("music-nav-panel");e&&e.classList.toggle("float-panel-closed")});let l=document.getElementById("scheme-switch");l&&(l.onclick=function(){let e=document.getElementById("theme-mode-panel");e&&e.classList.toggle("float-panel-closed")}),document.addEventListener("click",function(e){const t=["display-settings-switch","nav-menu-switch","music-player-switch","scheme-switch"];["display-setting","nav-menu-panel","music-nav-panel","theme-mode-panel"].forEach((n,l)=>{const o=document.getElementById(n),s=document.getElementById(t[l]);o&&s&&!o.classList.contains("float-panel-closed")&&e.target instanceof Node&&!o.contains(e.target)&&!s.contains(e.target)&&o.classList.add("float-panel-closed")})})}(),window.initSemifullScrollDetection=e,"loading"===document.readyState?document.addEventListener("DOMContentLoaded",e):e();</script> <script>(function(){const scriptUrl = "/pagefind/pagefind.js";

            {/* 你的 loadPagefind 函数的完整内容放在这里 */}
            async function loadPagefind() {
                try {
                    const response = await fetch(scriptUrl, { method: 'HEAD' });
                    if (!response.ok) {
                        throw new Error(`Pagefind script not found: ${response.status}`);
                    }
                    const pagefind = await import(scriptUrl);
                    await pagefind.options({
                        excerptLength: 20
                    });
                    window.pagefind = pagefind;
                    document.dispatchEvent(new CustomEvent('pagefindready'));
                    console.log('Pagefind loaded and initialized successfully, event dispatched.');
                } catch (error) {
                    console.error('Failed to load Pagefind:', error);
                    window.pagefind = {
                        search: () => Promise.resolve({ results: [] }),
                        options: () => Promise.resolve(),
                    };
                    document.dispatchEvent(new CustomEvent('pagefindloaderror'));
                    console.log('Pagefind load error, event dispatched.');
                }
            }

            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', loadPagefind);
            } else {
                loadPagefind();
            }
        })();</script> </div> </div>  <div id="wallpaper-wrapper" class="absolute z-10 w-full transition duration-700 overflow-hidden mobile-hide-banner" style="top: -30vh; display: none; --overlay-opacity: 0.8; --overlay-z-index: -1; --overlay-blur: 1px;"> <!-- 背景图片显示 --> <div class="relative h-full w-full" id="banner-images-container" data-mobile-count="17" data-desktop-count="80"> <!-- Mobile: 渲染所有移动端图片 --> <div class="banner-image-mobile absolute inset-0 block lg:hidden"> <div class="object-cover h-full w-full overflow-hidden relative"> <div class="transition absolute inset-0 dark:bg-black/10 pointer-events-none"></div> <picture> <source srcset="/_astro/669bb3b6d9c307b7e98bb671.BlQW4HSj_Z2nbGI3.webp 640w, /_astro/669bb3b6d9c307b7e98bb671.BlQW4HSj_Z1Ey5zj.webp 750w, /_astro/669bb3b6d9c307b7e98bb671.BlQW4HSj_fGW9n.webp 1080w" type="image/webp" sizes="100vw">  <img src="/_astro/669bb3b6d9c307b7e98bb671.BlQW4HSj_Z1olgbo.webp" srcset="/_astro/669bb3b6d9c307b7e98bb671.BlQW4HSj_Z2nbGI3.webp 640w, /_astro/669bb3b6d9c307b7e98bb671.BlQW4HSj_Z1Ey5zj.webp 750w, /_astro/669bb3b6d9c307b7e98bb671.BlQW4HSj_fGW9n.webp 1080w" alt="Mobile background image of the blog" style="--fit: cover; --pos: center; object-position: 0% 20%" loading="eager" fetchpriority="high" sizes="100vw" decoding="async" data-astro-image="constrained" width="2408" height="4944" class="w-full h-full object-cover"> </picture>   </div> </div><div class="banner-image-mobile absolute inset-0 hidden"> <div class="object-cover h-full w-full overflow-hidden relative"> <div class="transition absolute inset-0 dark:bg-black/10 pointer-events-none"></div> <picture> <source srcset="/_astro/669f4b7cd9c307b7e9b633e9.BMjJgYT4_1gtDaJ.webp 640w, /_astro/669f4b7cd9c307b7e9b633e9.BMjJgYT4_IPkob.webp 750w, /_astro/669f4b7cd9c307b7e9b633e9.BMjJgYT4_Z1RbLca.webp 1080w" type="image/webp" sizes="100vw">  <img src="/_astro/669f4b7cd9c307b7e9b633e9.BMjJgYT4_ZbFPap.webp" srcset="/_astro/669f4b7cd9c307b7e9b633e9.BMjJgYT4_1gtDaJ.webp 640w, /_astro/669f4b7cd9c307b7e9b633e9.BMjJgYT4_IPkob.webp 750w, /_astro/669f4b7cd9c307b7e9b633e9.BMjJgYT4_Z1RbLca.webp 1080w" alt="Mobile background image of the blog" style="--fit: cover; --pos: center; object-position: 0% 20%" loading="lazy" fetchpriority="low" sizes="100vw" decoding="async" data-astro-image="constrained" width="2282" height="4000" class="w-full h-full object-cover"> </picture>   </div> </div><div class="banner-image-mobile absolute inset-0 hidden"> <div class="object-cover h-full w-full overflow-hidden relative"> <div class="transition absolute inset-0 dark:bg-black/10 pointer-events-none"></div> <picture> <source srcset="/_astro/66a464d6d9c307b7e9427508.BOoP7FXU_ZoCsv9.webp 640w, /_astro/66a464d6d9c307b7e9427508.BOoP7FXU_9Ebna.webp 750w, /_astro/66a464d6d9c307b7e9427508.BOoP7FXU_M55hM.webp 1080w" type="image/webp" sizes="100vw">  <img src="/_astro/66a464d6d9c307b7e9427508.BOoP7FXU_2bRDlf.webp" srcset="/_astro/66a464d6d9c307b7e9427508.BOoP7FXU_ZoCsv9.webp 640w, /_astro/66a464d6d9c307b7e9427508.BOoP7FXU_9Ebna.webp 750w, /_astro/66a464d6d9c307b7e9427508.BOoP7FXU_M55hM.webp 1080w" alt="Mobile background image of the blog" style="--fit: cover; --pos: center; object-position: 0% 20%" loading="lazy" fetchpriority="low" sizes="100vw" decoding="async" data-astro-image="constrained" width="1132" height="2000" class="w-full h-full object-cover"> </picture>   </div> </div><div class="banner-image-mobile absolute inset-0 hidden"> <div class="object-cover h-full w-full overflow-hidden relative"> <div class="transition absolute inset-0 dark:bg-black/10 pointer-events-none"></div> <picture> <source srcset="/_astro/66a464d6d9c307b7e942754e.Bcig3nrF_Xug00.webp 640w, /_astro/66a464d6d9c307b7e942754e.Bcig3nrF_7js7A.webp 750w, /_astro/66a464d6d9c307b7e942754e.Bcig3nrF_Z1D6Y2f.webp 1080w" type="image/webp" sizes="100vw">  <img src="/_astro/66a464d6d9c307b7e942754e.Bcig3nrF_V5eFJ.webp" srcset="/_astro/66a464d6d9c307b7e942754e.Bcig3nrF_Xug00.webp 640w, /_astro/66a464d6d9c307b7e942754e.Bcig3nrF_7js7A.webp 750w, /_astro/66a464d6d9c307b7e942754e.Bcig3nrF_Z1D6Y2f.webp 1080w" alt="Mobile background image of the blog" style="--fit: cover; --pos: center; object-position: 0% 20%" loading="lazy" fetchpriority="low" sizes="100vw" decoding="async" data-astro-image="constrained" width="2208" height="3106" class="w-full h-full object-cover"> </picture>   </div> </div><div class="banner-image-mobile absolute inset-0 hidden"> <div class="object-cover h-full w-full overflow-hidden relative"> <div class="transition absolute inset-0 dark:bg-black/10 pointer-events-none"></div> <picture> <source srcset="/_astro/672c9433d29ded1a8c1222a5.bc9i51yk_PrjnX.webp 636w" type="image/webp" sizes="100vw">  <img src="/_astro/672c9433d29ded1a8c1222a5.bc9i51yk_PrjnX.webp" srcset="/_astro/672c9433d29ded1a8c1222a5.bc9i51yk_PrjnX.webp 636w" alt="Mobile background image of the blog" style="--fit: cover; --pos: center; object-position: 0% 20%" loading="lazy" fetchpriority="low" sizes="100vw" decoding="async" data-astro-image="constrained" width="636" height="956" class="w-full h-full object-cover"> </picture>   </div> </div><div class="banner-image-mobile absolute inset-0 hidden"> <div class="object-cover h-full w-full overflow-hidden relative"> <div class="transition absolute inset-0 dark:bg-black/10 pointer-events-none"></div> <picture> <source srcset="/_astro/673dd9f5d29ded1a8c0506f8.DHk8Q_1K_Z10jvhh.webp 640w, /_astro/673dd9f5d29ded1a8c0506f8.DHk8Q_1K_Z2pcwBK.webp 750w, /_astro/673dd9f5d29ded1a8c0506f8.DHk8Q_1K_Z2eDh7B.webp 1080w" type="image/webp" sizes="100vw">  <img src="/_astro/673dd9f5d29ded1a8c0506f8.DHk8Q_1K_Z1t2wos.webp" srcset="/_astro/673dd9f5d29ded1a8c0506f8.DHk8Q_1K_Z10jvhh.webp 640w, /_astro/673dd9f5d29ded1a8c0506f8.DHk8Q_1K_Z2pcwBK.webp 750w, /_astro/673dd9f5d29ded1a8c0506f8.DHk8Q_1K_Z2eDh7B.webp 1080w" alt="Mobile background image of the blog" style="--fit: cover; --pos: center; object-position: 0% 20%" loading="lazy" fetchpriority="low" sizes="100vw" decoding="async" data-astro-image="constrained" width="1625" height="2000" class="w-full h-full object-cover"> </picture>   </div> </div><div class="banner-image-mobile absolute inset-0 hidden"> <div class="object-cover h-full w-full overflow-hidden relative"> <div class="transition absolute inset-0 dark:bg-black/10 pointer-events-none"></div> <picture> <source srcset="/_astro/67f095920ba3d5a1d7ed88f6.DOTj_Gfa_Z1KHp9h.webp 640w, /_astro/67f095920ba3d5a1d7ed88f6.DOTj_Gfa_1zk1X6.webp 750w, /_astro/67f095920ba3d5a1d7ed88f6.DOTj_Gfa_ZpzAjx.webp 1080w" type="image/webp" sizes="100vw">  <img src="/_astro/67f095920ba3d5a1d7ed88f6.DOTj_Gfa_1GmefU.webp" srcset="/_astro/67f095920ba3d5a1d7ed88f6.DOTj_Gfa_Z1KHp9h.webp 640w, /_astro/67f095920ba3d5a1d7ed88f6.DOTj_Gfa_1zk1X6.webp 750w, /_astro/67f095920ba3d5a1d7ed88f6.DOTj_Gfa_ZpzAjx.webp 1080w" alt="Mobile background image of the blog" style="--fit: cover; --pos: center; object-position: 0% 20%" loading="lazy" fetchpriority="low" sizes="100vw" decoding="async" data-astro-image="constrained" width="3328" height="4864" class="w-full h-full object-cover"> </picture>   </div> </div><div class="banner-image-mobile absolute inset-0 hidden"> <div class="object-cover h-full w-full overflow-hidden relative"> <div class="transition absolute inset-0 dark:bg-black/10 pointer-events-none"></div> <picture> <source srcset="/_astro/67f095920ba3d5a1d7ed88f5.CddhhFDp_egPMP.webp 640w, /_astro/67f095920ba3d5a1d7ed88f5.CddhhFDp_Z16iM2x.webp 750w, /_astro/67f095920ba3d5a1d7ed88f5.CddhhFDp_1zwwrB.webp 1080w" type="image/webp" sizes="100vw">  <img src="/_astro/67f095920ba3d5a1d7ed88f5.CddhhFDp_1WGU3q.webp" srcset="/_astro/67f095920ba3d5a1d7ed88f5.CddhhFDp_egPMP.webp 640w, /_astro/67f095920ba3d5a1d7ed88f5.CddhhFDp_Z16iM2x.webp 750w, /_astro/67f095920ba3d5a1d7ed88f5.CddhhFDp_1zwwrB.webp 1080w" alt="Mobile background image of the blog" style="--fit: cover; --pos: center; object-position: 0% 20%" loading="lazy" fetchpriority="low" sizes="100vw" decoding="async" data-astro-image="constrained" width="3072" height="5120" class="w-full h-full object-cover"> </picture>   </div> </div><div class="banner-image-mobile absolute inset-0 hidden"> <div class="object-cover h-full w-full overflow-hidden relative"> <div class="transition absolute inset-0 dark:bg-black/10 pointer-events-none"></div> <picture> <source srcset="/_astro/134842461.C2ZYA2ZR_2agBPQ.webp 640w, /_astro/134842461.C2ZYA2ZR_Z2hM5ha.webp 750w, /_astro/134842461.C2ZYA2ZR_21M0Uc.webp 1080w" type="image/webp" sizes="100vw">  <img src="/_astro/134842461.C2ZYA2ZR_Z1ahfVJ.webp" srcset="/_astro/134842461.C2ZYA2ZR_2agBPQ.webp 640w, /_astro/134842461.C2ZYA2ZR_Z2hM5ha.webp 750w, /_astro/134842461.C2ZYA2ZR_21M0Uc.webp 1080w" alt="Mobile background image of the blog" style="--fit: cover; --pos: center; object-position: 0% 20%" loading="lazy" fetchpriority="low" sizes="100vw" decoding="async" data-astro-image="constrained" width="3328" height="4864" class="w-full h-full object-cover"> </picture>   </div> </div><div class="banner-image-mobile absolute inset-0 hidden"> <div class="object-cover h-full w-full overflow-hidden relative"> <div class="transition absolute inset-0 dark:bg-black/10 pointer-events-none"></div> <picture> <source srcset="/_astro/137493114.WSP9_eZb_1IYBbO.webp 640w, /_astro/137493114.WSP9_eZb_1cMrqM.webp 750w, /_astro/137493114.WSP9_eZb_26tqgm.webp 1080w" type="image/webp" sizes="100vw">  <img src="/_astro/137493114.WSP9_eZb_Z2kF6uG.webp" srcset="/_astro/137493114.WSP9_eZb_1IYBbO.webp 640w, /_astro/137493114.WSP9_eZb_1cMrqM.webp 750w, /_astro/137493114.WSP9_eZb_26tqgm.webp 1080w" alt="Mobile background image of the blog" style="--fit: cover; --pos: center; object-position: 0% 20%" loading="lazy" fetchpriority="low" sizes="100vw" decoding="async" data-astro-image="constrained" width="2294" height="4000" class="w-full h-full object-cover"> </picture>   </div> </div><div class="banner-image-mobile absolute inset-0 hidden"> <div class="object-cover h-full w-full overflow-hidden relative"> <div class="transition absolute inset-0 dark:bg-black/10 pointer-events-none"></div> <picture> <source srcset="/_astro/132289312.DE0NG6ap_12mfoP.webp 640w, /_astro/132289312.DE0NG6ap_ZYjLHa.webp 750w, /_astro/132289312.DE0NG6ap_Z2ujM6g.webp 1080w" type="image/webp" sizes="100vw">  <img src="/_astro/132289312.DE0NG6ap_2ffiQx.webp" srcset="/_astro/132289312.DE0NG6ap_12mfoP.webp 640w, /_astro/132289312.DE0NG6ap_ZYjLHa.webp 750w, /_astro/132289312.DE0NG6ap_Z2ujM6g.webp 1080w" alt="Mobile background image of the blog" style="--fit: cover; --pos: center; object-position: 0% 20%" loading="lazy" fetchpriority="low" sizes="100vw" decoding="async" data-astro-image="constrained" width="3549" height="4949" class="w-full h-full object-cover"> </picture>   </div> </div><div class="banner-image-mobile absolute inset-0 hidden"> <div class="object-cover h-full w-full overflow-hidden relative"> <div class="transition absolute inset-0 dark:bg-black/10 pointer-events-none"></div> <picture> <source srcset="/_astro/119367678.opJjHX4z_Z2gR7cc.webp 640w, /_astro/119367678.opJjHX4z_KMwSM.webp 750w, /_astro/119367678.opJjHX4z_Z1V4CVM.webp 1080w" type="image/webp" sizes="100vw">  <img src="/_astro/119367678.opJjHX4z_VAfQQ.webp" srcset="/_astro/119367678.opJjHX4z_Z2gR7cc.webp 640w, /_astro/119367678.opJjHX4z_KMwSM.webp 750w, /_astro/119367678.opJjHX4z_Z1V4CVM.webp 1080w" alt="Mobile background image of the blog" style="--fit: cover; --pos: center; object-position: 0% 20%" loading="lazy" fetchpriority="low" sizes="100vw" decoding="async" data-astro-image="constrained" width="2000" height="3000" class="w-full h-full object-cover"> </picture>   </div> </div><div class="banner-image-mobile absolute inset-0 hidden"> <div class="object-cover h-full w-full overflow-hidden relative"> <div class="transition absolute inset-0 dark:bg-black/10 pointer-events-none"></div> <picture> <source srcset="/_astro/rosmontis-nurse.Ce_26aUN_Zn7Bll.webp 640w, /_astro/rosmontis-nurse.Ce_26aUN_1JnHvh.webp 750w, /_astro/rosmontis-nurse.Ce_26aUN_ZVySnA.webp 1080w" type="image/webp" sizes="100vw">  <img src="/_astro/rosmontis-nurse.Ce_26aUN_fQrgg.webp" srcset="/_astro/rosmontis-nurse.Ce_26aUN_Zn7Bll.webp 640w, /_astro/rosmontis-nurse.Ce_26aUN_1JnHvh.webp 750w, /_astro/rosmontis-nurse.Ce_26aUN_ZVySnA.webp 1080w" alt="Mobile background image of the blog" style="--fit: cover; --pos: center; object-position: 0% 20%" loading="lazy" fetchpriority="low" sizes="100vw" decoding="async" data-astro-image="constrained" width="2183" height="2808" class="w-full h-full object-cover"> </picture>   </div> </div><div class="banner-image-mobile absolute inset-0 hidden"> <div class="object-cover h-full w-full overflow-hidden relative"> <div class="transition absolute inset-0 dark:bg-black/10 pointer-events-none"></div> <picture> <source srcset="/_astro/firefly.gfWL53cC_Z20tT8j.webp 640w, /_astro/firefly.gfWL53cC_Z2evVH7.webp 750w, /_astro/firefly.gfWL53cC_ZkLlak.webp 1080w" type="image/webp" sizes="100vw">  <img src="/_astro/firefly.gfWL53cC_ZedWMR.webp" srcset="/_astro/firefly.gfWL53cC_Z20tT8j.webp 640w, /_astro/firefly.gfWL53cC_Z2evVH7.webp 750w, /_astro/firefly.gfWL53cC_ZkLlak.webp 1080w" alt="Mobile background image of the blog" style="--fit: cover; --pos: center; object-position: 0% 20%" loading="lazy" fetchpriority="low" sizes="100vw" decoding="async" data-astro-image="constrained" width="1316" height="2048" class="w-full h-full object-cover"> </picture>   </div> </div><div class="banner-image-mobile absolute inset-0 hidden"> <div class="object-cover h-full w-full overflow-hidden relative"> <div class="transition absolute inset-0 dark:bg-black/10 pointer-events-none"></div> <picture> <source srcset="/_astro/138638248.C_1W3SSV_ZmhqU5.webp 640w, /_astro/138638248.C_1W3SSV_mql4E.webp 750w, /_astro/138638248.C_1W3SSV_ZJ8RDp.webp 1080w" type="image/webp" sizes="100vw">  <img src="/_astro/138638248.C_1W3SSV_Z1kRo0r.webp" srcset="/_astro/138638248.C_1W3SSV_ZmhqU5.webp 640w, /_astro/138638248.C_1W3SSV_mql4E.webp 750w, /_astro/138638248.C_1W3SSV_ZJ8RDp.webp 1080w" alt="Mobile background image of the blog" style="--fit: cover; --pos: center; object-position: 0% 20%" loading="lazy" fetchpriority="low" sizes="100vw" decoding="async" data-astro-image="constrained" width="2592" height="4608" class="w-full h-full object-cover"> </picture>   </div> </div><div class="banner-image-mobile absolute inset-0 hidden"> <div class="object-cover h-full w-full overflow-hidden relative"> <div class="transition absolute inset-0 dark:bg-black/10 pointer-events-none"></div> <picture> <source srcset="/_astro/131915161.uiWSzE6h_ZHaSgy.webp 640w, /_astro/131915161.uiWSzE6h_ZPTIyn.webp 750w, /_astro/131915161.uiWSzE6h_CPbPl.webp 1080w" type="image/webp" sizes="100vw">  <img src="/_astro/131915161.uiWSzE6h_2QAqI.webp" srcset="/_astro/131915161.uiWSzE6h_ZHaSgy.webp 640w, /_astro/131915161.uiWSzE6h_ZPTIyn.webp 750w, /_astro/131915161.uiWSzE6h_CPbPl.webp 1080w" alt="Mobile background image of the blog" style="--fit: cover; --pos: center; object-position: 0% 20%" loading="lazy" fetchpriority="low" sizes="100vw" decoding="async" data-astro-image="constrained" width="1280" height="1915" class="w-full h-full object-cover"> </picture>   </div> </div><div class="banner-image-mobile absolute inset-0 hidden"> <div class="object-cover h-full w-full overflow-hidden relative"> <div class="transition absolute inset-0 dark:bg-black/10 pointer-events-none"></div> <picture> <source srcset="/_astro/118358767.ETuVkFf6_1mwQe9.webp 640w, /_astro/118358767.ETuVkFf6_26fDdS.webp 750w, /_astro/118358767.ETuVkFf6_2bpSQm.webp 1080w" type="image/webp" sizes="100vw">  <img src="/_astro/118358767.ETuVkFf6_ZgI2VT.webp" srcset="/_astro/118358767.ETuVkFf6_1mwQe9.webp 640w, /_astro/118358767.ETuVkFf6_26fDdS.webp 750w, /_astro/118358767.ETuVkFf6_2bpSQm.webp 1080w" alt="Mobile background image of the blog" style="--fit: cover; --pos: center; object-position: 0% 20%" loading="lazy" fetchpriority="low" sizes="100vw" decoding="async" data-astro-image="constrained" width="1620" height="2880" class="w-full h-full object-cover"> </picture>   </div> </div> <!-- Desktop: 渲染所有桌面端图片 --> <div class="banner-image-desktop absolute inset-0 hidden lg:block"> <div id="banner" class="object-cover h-full overflow-hidden relative"> <div class="transition absolute inset-0 dark:bg-black/10 pointer-events-none"></div> <picture> <source srcset="/_astro/66e6bdb2d9c307b7e9a2a988.4VL6RDqx_NY0rQ.webp 1280w, /_astro/66e6bdb2d9c307b7e9a2a988.4VL6RDqx_nKANj.webp 1920w, /_astro/66e6bdb2d9c307b7e9a2a988.4VL6RDqx_nl3yX.webp 2560w" type="image/webp" sizes="100vw">  <img src="/_astro/66e6bdb2d9c307b7e9a2a988.4VL6RDqx_Z1AF336.webp" srcset="/_astro/66e6bdb2d9c307b7e9a2a988.4VL6RDqx_NY0rQ.webp 1280w, /_astro/66e6bdb2d9c307b7e9a2a988.4VL6RDqx_nKANj.webp 1920w, /_astro/66e6bdb2d9c307b7e9a2a988.4VL6RDqx_nl3yX.webp 2560w" alt="Desktop background image of the blog" style="--fit: cover; --pos: center; object-position: 0% 20%" loading="eager" fetchpriority="high" sizes="100vw" decoding="async" data-astro-image="constrained" width="3840" height="2160" class="w-full h-full object-cover"> </picture>   </div> </div><div class="banner-image-desktop absolute inset-0 hidden"> <div class="object-cover h-full overflow-hidden relative"> <div class="transition absolute inset-0 dark:bg-black/10 pointer-events-none"></div> <picture> <source srcset="/_astro/65c9e1289f345e8d03167448.B4vi4-dK_1HtYBv.webp 1280w, /_astro/65c9e1289f345e8d03167448.B4vi4-dK_ZqzheD.webp 1920w, /_astro/65c9e1289f345e8d03167448.B4vi4-dK_ieGhQ.webp 2552w" type="image/webp" sizes="100vw">  <img src="/_astro/65c9e1289f345e8d03167448.B4vi4-dK_ieGhQ.webp" srcset="/_astro/65c9e1289f345e8d03167448.B4vi4-dK_1HtYBv.webp 1280w, /_astro/65c9e1289f345e8d03167448.B4vi4-dK_ZqzheD.webp 1920w, /_astro/65c9e1289f345e8d03167448.B4vi4-dK_ieGhQ.webp 2552w" alt="Desktop background image of the blog" style="--fit: cover; --pos: center; object-position: 0% 20%" loading="lazy" fetchpriority="low" sizes="100vw" decoding="async" data-astro-image="constrained" width="2552" height="1586" class="w-full h-full object-cover"> </picture>   </div> </div><div class="banner-image-desktop absolute inset-0 hidden"> <div class="object-cover h-full overflow-hidden relative"> <div class="transition absolute inset-0 dark:bg-black/10 pointer-events-none"></div> <picture> <source srcset="/_astro/67f108bd0ba3d5a1d7edc049.BXcGEVlN_Qsk9d.webp 1280w, /_astro/67f108bd0ba3d5a1d7edc049.BXcGEVlN_qeUuF.webp 1920w, /_astro/67f108bd0ba3d5a1d7edc049.BXcGEVlN_pOngk.webp 2560w" type="image/webp" sizes="100vw">  <img src="/_astro/67f108bd0ba3d5a1d7edc049.BXcGEVlN_Z1ybIlJ.webp" srcset="/_astro/67f108bd0ba3d5a1d7edc049.BXcGEVlN_Qsk9d.webp 1280w, /_astro/67f108bd0ba3d5a1d7edc049.BXcGEVlN_qeUuF.webp 1920w, /_astro/67f108bd0ba3d5a1d7edc049.BXcGEVlN_pOngk.webp 2560w" alt="Desktop background image of the blog" style="--fit: cover; --pos: center; object-position: 0% 20%" loading="lazy" fetchpriority="low" sizes="100vw" decoding="async" data-astro-image="constrained" width="3840" height="2160" class="w-full h-full object-cover"> </picture>   </div> </div><div class="banner-image-desktop absolute inset-0 hidden"> <div class="object-cover h-full overflow-hidden relative"> <div class="transition absolute inset-0 dark:bg-black/10 pointer-events-none"></div> <picture> <source srcset="/_astro/66a76b76d9c307b7e91171ca.D17P61G__260to3.webp 1280w, /_astro/66a76b76d9c307b7e91171ca.D17P61G__5kRLT.webp 1920w, /_astro/66a76b76d9c307b7e91171ca.D17P61G__Z1uvQp3.webp 2560w" type="image/webp" sizes="100vw">  <img src="/_astro/66a76b76d9c307b7e91171ca.D17P61G__Z11NP12.webp" srcset="/_astro/66a76b76d9c307b7e91171ca.D17P61G__260to3.webp 1280w, /_astro/66a76b76d9c307b7e91171ca.D17P61G__5kRLT.webp 1920w, /_astro/66a76b76d9c307b7e91171ca.D17P61G__Z1uvQp3.webp 2560w" alt="Desktop background image of the blog" style="--fit: cover; --pos: center; object-position: 0% 20%" loading="lazy" fetchpriority="low" sizes="100vw" decoding="async" data-astro-image="constrained" width="4096" height="2308" class="w-full h-full object-cover"> </picture>   </div> </div><div class="banner-image-desktop absolute inset-0 hidden"> <div class="object-cover h-full overflow-hidden relative"> <div class="transition absolute inset-0 dark:bg-black/10 pointer-events-none"></div> <picture> <source srcset="/_astro/kv2x-42686179.Eap4DomH_ZQAOQb.webp 1280w, /_astro/kv2x-42686179.Eap4DomH_1pVEqj.webp 1920w, /_astro/kv2x-42686179.Eap4DomH_napYp.webp 2560w" type="image/webp" sizes="100vw">  <img src="/_astro/kv2x-42686179.Eap4DomH_12dA0F.webp" srcset="/_astro/kv2x-42686179.Eap4DomH_ZQAOQb.webp 1280w, /_astro/kv2x-42686179.Eap4DomH_1pVEqj.webp 1920w, /_astro/kv2x-42686179.Eap4DomH_napYp.webp 2560w" alt="Desktop background image of the blog" style="--fit: cover; --pos: center; object-position: 0% 20%" loading="lazy" fetchpriority="low" sizes="100vw" decoding="async" data-astro-image="constrained" width="3840" height="2160" class="w-full h-full object-cover"> </picture>   </div> </div><div class="banner-image-desktop absolute inset-0 hidden"> <div class="object-cover h-full overflow-hidden relative"> <div class="transition absolute inset-0 dark:bg-black/10 pointer-events-none"></div> <picture> <source srcset="/_astro/roxy.C_HfM5Sz_9mIVA.webp 1280w, /_astro/roxy.C_HfM5Sz_2iahA2.webp 1920w, /_astro/roxy.C_HfM5Sz_Z2oJhaL.webp 2048w" type="image/webp" sizes="100vw">  <img src="/_astro/roxy.C_HfM5Sz_Z2oJhaL.webp" srcset="/_astro/roxy.C_HfM5Sz_9mIVA.webp 1280w, /_astro/roxy.C_HfM5Sz_2iahA2.webp 1920w, /_astro/roxy.C_HfM5Sz_Z2oJhaL.webp 2048w" alt="Desktop background image of the blog" style="--fit: cover; --pos: center; object-position: 0% 20%" loading="lazy" fetchpriority="low" sizes="100vw" decoding="async" data-astro-image="constrained" width="2048" height="1152" class="w-full h-full object-cover"> </picture>   </div> </div><div class="banner-image-desktop absolute inset-0 hidden"> <div class="object-cover h-full overflow-hidden relative"> <div class="transition absolute inset-0 dark:bg-black/10 pointer-events-none"></div> <picture> <source srcset="/_astro/669f9ae5d9c307b7e90432f1.Dz-6MzxF_1SHE1f.webp 1280w, /_astro/669f9ae5d9c307b7e90432f1.Dz-6MzxF_1sufmH.webp 1920w, /_astro/669f9ae5d9c307b7e90432f1.Dz-6MzxF_1s4H8m.webp 2560w" type="image/webp" sizes="100vw">  <img src="/_astro/669f9ae5d9c307b7e90432f1.Dz-6MzxF_2eEFRW.webp" srcset="/_astro/669f9ae5d9c307b7e90432f1.Dz-6MzxF_1SHE1f.webp 1280w, /_astro/669f9ae5d9c307b7e90432f1.Dz-6MzxF_1sufmH.webp 1920w, /_astro/669f9ae5d9c307b7e90432f1.Dz-6MzxF_1s4H8m.webp 2560w" alt="Desktop background image of the blog" style="--fit: cover; --pos: center; object-position: 0% 20%" loading="lazy" fetchpriority="low" sizes="100vw" decoding="async" data-astro-image="constrained" width="5120" height="2880" class="w-full h-full object-cover"> </picture>   </div> </div><div class="banner-image-desktop absolute inset-0 hidden"> <div class="object-cover h-full overflow-hidden relative"> <div class="transition absolute inset-0 dark:bg-black/10 pointer-events-none"></div> <picture> <source srcset="/_astro/131998699_p0.Zw2ynkGI_1wObWx.webp 1280w, /_astro/131998699_p0.Zw2ynkGI_ZuoLqj.webp 1920w, /_astro/131998699_p0.Zw2ynkGI_ZAKG8D.webp 2560w" type="image/webp" sizes="100vw">  <img src="/_astro/131998699_p0.Zw2ynkGI_Z1ir1wk.webp" srcset="/_astro/131998699_p0.Zw2ynkGI_1wObWx.webp 1280w, /_astro/131998699_p0.Zw2ynkGI_ZuoLqj.webp 1920w, /_astro/131998699_p0.Zw2ynkGI_ZAKG8D.webp 2560w" alt="Desktop background image of the blog" style="--fit: cover; --pos: center; object-position: 0% 20%" loading="lazy" fetchpriority="low" sizes="100vw" decoding="async" data-astro-image="constrained" width="4608" height="2592" class="w-full h-full object-cover"> </picture>   </div> </div><div class="banner-image-desktop absolute inset-0 hidden"> <div class="object-cover h-full overflow-hidden relative"> <div class="transition absolute inset-0 dark:bg-black/10 pointer-events-none"></div> <picture> <source srcset="/_astro/67ac681ed0e0a243d4fe9a2b.BUnBjkK1_ZUTkAm.webp 1280w, /_astro/67ac681ed0e0a243d4fe9a2b.BUnBjkK1_djrHH.webp 1920w, /_astro/67ac681ed0e0a243d4fe9a2b.BUnBjkK1_2bt7uY.webp 2553w" type="image/webp" sizes="100vw">  <img src="/_astro/67ac681ed0e0a243d4fe9a2b.BUnBjkK1_2bt7uY.webp" srcset="/_astro/67ac681ed0e0a243d4fe9a2b.BUnBjkK1_ZUTkAm.webp 1280w, /_astro/67ac681ed0e0a243d4fe9a2b.BUnBjkK1_djrHH.webp 1920w, /_astro/67ac681ed0e0a243d4fe9a2b.BUnBjkK1_2bt7uY.webp 2553w" alt="Desktop background image of the blog" style="--fit: cover; --pos: center; object-position: 0% 20%" loading="lazy" fetchpriority="low" sizes="100vw" decoding="async" data-astro-image="constrained" width="2553" height="1429" class="w-full h-full object-cover"> </picture>   </div> </div><div class="banner-image-desktop absolute inset-0 hidden"> <div class="object-cover h-full overflow-hidden relative"> <div class="transition absolute inset-0 dark:bg-black/10 pointer-events-none"></div> <picture> <source srcset="/_astro/66e6bde8d9c307b7e9a2d572.BTMRLVFg_Zk3aif.webp 1280w, /_astro/66e6bde8d9c307b7e9a2d572.BTMRLVFg_ZKgyVM.webp 1920w, /_astro/66e6bde8d9c307b7e9a2d572.BTMRLVFg_ZKG7b8.webp 2560w" type="image/webp" sizes="100vw">  <img src="/_astro/66e6bde8d9c307b7e9a2d572.BTMRLVFg_2ktU0J.webp" srcset="/_astro/66e6bde8d9c307b7e9a2d572.BTMRLVFg_Zk3aif.webp 1280w, /_astro/66e6bde8d9c307b7e9a2d572.BTMRLVFg_ZKgyVM.webp 1920w, /_astro/66e6bde8d9c307b7e9a2d572.BTMRLVFg_ZKG7b8.webp 2560w" alt="Desktop background image of the blog" style="--fit: cover; --pos: center; object-position: 0% 20%" loading="lazy" fetchpriority="low" sizes="100vw" decoding="async" data-astro-image="constrained" width="3840" height="2160" class="w-full h-full object-cover"> </picture>   </div> </div><div class="banner-image-desktop absolute inset-0 hidden"> <div class="object-cover h-full overflow-hidden relative"> <div class="transition absolute inset-0 dark:bg-black/10 pointer-events-none"></div> <picture> <source srcset="/_astro/67256b2cd29ded1a8c25a9bb.DkMwkj8B_PgcJS.webp 1280w, /_astro/67256b2cd29ded1a8c25a9bb.DkMwkj8B_ZKtCt2.webp 1920w, /_astro/67256b2cd29ded1a8c25a9bb.DkMwkj8B_2bBgTt.webp 2560w" type="image/webp" sizes="100vw">  <img src="/_astro/67256b2cd29ded1a8c25a9bb.DkMwkj8B_aSiqn.webp" srcset="/_astro/67256b2cd29ded1a8c25a9bb.DkMwkj8B_PgcJS.webp 1280w, /_astro/67256b2cd29ded1a8c25a9bb.DkMwkj8B_ZKtCt2.webp 1920w, /_astro/67256b2cd29ded1a8c25a9bb.DkMwkj8B_2bBgTt.webp 2560w" alt="Desktop background image of the blog" style="--fit: cover; --pos: center; object-position: 0% 20%" loading="lazy" fetchpriority="low" sizes="100vw" decoding="async" data-astro-image="constrained" width="4896" height="3371" class="w-full h-full object-cover"> </picture>   </div> </div><div class="banner-image-desktop absolute inset-0 hidden"> <div class="object-cover h-full overflow-hidden relative"> <div class="transition absolute inset-0 dark:bg-black/10 pointer-events-none"></div> <picture> <source srcset="/_astro/chisaki133561429.zA2Wy-Z8_1iGO1a.webp 1280w, /_astro/chisaki133561429.zA2Wy-Z8_Z2fkzQQ.webp 1920w, /_astro/chisaki133561429.zA2Wy-Z8_ZV4vlx.webp 2560w" type="image/webp" sizes="100vw">  <img src="/_astro/chisaki133561429.zA2Wy-Z8_Zv7OTB.webp" srcset="/_astro/chisaki133561429.zA2Wy-Z8_1iGO1a.webp 1280w, /_astro/chisaki133561429.zA2Wy-Z8_Z2fkzQQ.webp 1920w, /_astro/chisaki133561429.zA2Wy-Z8_ZV4vlx.webp 2560w" alt="Desktop background image of the blog" style="--fit: cover; --pos: center; object-position: 0% 20%" loading="lazy" fetchpriority="low" sizes="100vw" decoding="async" data-astro-image="constrained" width="5130" height="3150" class="w-full h-full object-cover"> </picture>   </div> </div><div class="banner-image-desktop absolute inset-0 hidden"> <div class="object-cover h-full overflow-hidden relative"> <div class="transition absolute inset-0 dark:bg-black/10 pointer-events-none"></div> <picture> <source srcset="/_astro/117617037.D5pcGF0b_1lmBAn.webp 1280w, /_astro/117617037.D5pcGF0b_ZchjT6.webp 1920w, /_astro/117617037.D5pcGF0b_ZteYIx.webp 2560w" type="image/webp" sizes="100vw">  <img src="/_astro/117617037.D5pcGF0b_ZYz3PB.webp" srcset="/_astro/117617037.D5pcGF0b_1lmBAn.webp 1280w, /_astro/117617037.D5pcGF0b_ZchjT6.webp 1920w, /_astro/117617037.D5pcGF0b_ZteYIx.webp 2560w" alt="Desktop background image of the blog" style="--fit: cover; --pos: center; object-position: 0% 20%" loading="lazy" fetchpriority="low" sizes="100vw" decoding="async" data-astro-image="constrained" width="4000" height="2400" class="w-full h-full object-cover"> </picture>   </div> </div><div class="banner-image-desktop absolute inset-0 hidden"> <div class="object-cover h-full overflow-hidden relative"> <div class="transition absolute inset-0 dark:bg-black/10 pointer-events-none"></div> <picture> <source srcset="/_astro/667fc806d9c307b7e947104d.C9Ia6UWU_1vdmT.webp 1280w, /_astro/667fc806d9c307b7e947104d.C9Ia6UWU_B6jr2.webp 1920w, /_astro/667fc806d9c307b7e947104d.C9Ia6UWU_Z1oFpMs.webp 2560w" type="image/webp" sizes="100vw">  <img src="/_astro/667fc806d9c307b7e947104d.C9Ia6UWU_Zg1imT.webp" srcset="/_astro/667fc806d9c307b7e947104d.C9Ia6UWU_1vdmT.webp 1280w, /_astro/667fc806d9c307b7e947104d.C9Ia6UWU_B6jr2.webp 1920w, /_astro/667fc806d9c307b7e947104d.C9Ia6UWU_Z1oFpMs.webp 2560w" alt="Desktop background image of the blog" style="--fit: cover; --pos: center; object-position: 0% 20%" loading="lazy" fetchpriority="low" sizes="100vw" decoding="async" data-astro-image="constrained" width="2966" height="2266" class="w-full h-full object-cover"> </picture>   </div> </div><div class="banner-image-desktop absolute inset-0 hidden"> <div class="object-cover h-full overflow-hidden relative"> <div class="transition absolute inset-0 dark:bg-black/10 pointer-events-none"></div> <picture> <source srcset="/_astro/66a86012d9c307b7e9bdc16e.bSo9RSSl_Z19Q9tL.webp 1280w, /_astro/66a86012d9c307b7e9bdc16e.bSo9RSSl_1XIAa8.webp 1920w, /_astro/66a86012d9c307b7e9bdc16e.bSo9RSSl_12YP32.webp 2432w" type="image/webp" sizes="100vw">  <img src="/_astro/66a86012d9c307b7e9bdc16e.bSo9RSSl_12YP32.webp" srcset="/_astro/66a86012d9c307b7e9bdc16e.bSo9RSSl_Z19Q9tL.webp 1280w, /_astro/66a86012d9c307b7e9bdc16e.bSo9RSSl_1XIAa8.webp 1920w, /_astro/66a86012d9c307b7e9bdc16e.bSo9RSSl_12YP32.webp 2432w" alt="Desktop background image of the blog" style="--fit: cover; --pos: center; object-position: 0% 20%" loading="lazy" fetchpriority="low" sizes="100vw" decoding="async" data-astro-image="constrained" width="2432" height="1664" class="w-full h-full object-cover"> </picture>   </div> </div><div class="banner-image-desktop absolute inset-0 hidden"> <div class="object-cover h-full overflow-hidden relative"> <div class="transition absolute inset-0 dark:bg-black/10 pointer-events-none"></div> <picture> <source srcset="/_astro/661fa9270ea9cb14035f9810.v9Ss_Vzm_2dqAps.webp 1280w, /_astro/661fa9270ea9cb14035f9810.v9Ss_Vzm_Z1hwNE7.webp 1920w, /_astro/661fa9270ea9cb14035f9810.v9Ss_Vzm_ZQWpsa.webp 2560w" type="image/webp" sizes="100vw">  <img src="/_astro/661fa9270ea9cb14035f9810.v9Ss_Vzm_ZbB8NP.webp" srcset="/_astro/661fa9270ea9cb14035f9810.v9Ss_Vzm_2dqAps.webp 1280w, /_astro/661fa9270ea9cb14035f9810.v9Ss_Vzm_Z1hwNE7.webp 1920w, /_astro/661fa9270ea9cb14035f9810.v9Ss_Vzm_ZQWpsa.webp 2560w" alt="Desktop background image of the blog" style="--fit: cover; --pos: center; object-position: 0% 20%" loading="lazy" fetchpriority="low" sizes="100vw" decoding="async" data-astro-image="constrained" width="2944" height="1632" class="w-full h-full object-cover"> </picture>   </div> </div><div class="banner-image-desktop absolute inset-0 hidden"> <div class="object-cover h-full overflow-hidden relative"> <div class="transition absolute inset-0 dark:bg-black/10 pointer-events-none"></div> <picture> <source srcset="/_astro/6788cbf8d0e0a243d4f4d409.BLSQAS3h_17TCTI.webp 1280w, /_astro/6788cbf8d0e0a243d4f4d409.BLSQAS3h_Z1Nm476.webp 1888w" type="image/webp" sizes="100vw">  <img src="/_astro/6788cbf8d0e0a243d4f4d409.BLSQAS3h_Z1Nm476.webp" srcset="/_astro/6788cbf8d0e0a243d4f4d409.BLSQAS3h_17TCTI.webp 1280w, /_astro/6788cbf8d0e0a243d4f4d409.BLSQAS3h_Z1Nm476.webp 1888w" alt="Desktop background image of the blog" style="--fit: cover; --pos: center; object-position: 0% 20%" loading="lazy" fetchpriority="low" sizes="100vw" decoding="async" data-astro-image="constrained" width="1888" height="1038" class="w-full h-full object-cover"> </picture>   </div> </div><div class="banner-image-desktop absolute inset-0 hidden"> <div class="object-cover h-full overflow-hidden relative"> <div class="transition absolute inset-0 dark:bg-black/10 pointer-events-none"></div> <picture> <source srcset="/_astro/138383607.f1hyujBK_116QUW.webp 1280w, /_astro/138383607.f1hyujBK_Znbd5r.webp 1920w, /_astro/138383607.f1hyujBK_Z2wzfaj.webp 2560w" type="image/webp" sizes="100vw">  <img src="/_astro/138383607.f1hyujBK_1OifMf.webp" srcset="/_astro/138383607.f1hyujBK_116QUW.webp 1280w, /_astro/138383607.f1hyujBK_Znbd5r.webp 1920w, /_astro/138383607.f1hyujBK_Z2wzfaj.webp 2560w" alt="Desktop background image of the blog" style="--fit: cover; --pos: center; object-position: 0% 20%" loading="lazy" fetchpriority="low" sizes="100vw" decoding="async" data-astro-image="constrained" width="3850" height="2400" class="w-full h-full object-cover"> </picture>   </div> </div><div class="banner-image-desktop absolute inset-0 hidden"> <div class="object-cover h-full overflow-hidden relative"> <div class="transition absolute inset-0 dark:bg-black/10 pointer-events-none"></div> <picture> <source srcset="/_astro/127405397.C1Vet8hp_YfjTo.webp 1280w, /_astro/127405397.C1Vet8hp_Z1a9aWi.webp 1920w, /_astro/127405397.C1Vet8hp_ZRyIQ4.webp 2560w" type="image/webp" sizes="100vw">  <img src="/_astro/127405397.C1Vet8hp_Z1FNv7G.webp" srcset="/_astro/127405397.C1Vet8hp_YfjTo.webp 1280w, /_astro/127405397.C1Vet8hp_Z1a9aWi.webp 1920w, /_astro/127405397.C1Vet8hp_ZRyIQ4.webp 2560w" alt="Desktop background image of the blog" style="--fit: cover; --pos: center; object-position: 0% 20%" loading="lazy" fetchpriority="low" sizes="100vw" decoding="async" data-astro-image="constrained" width="6000" height="3375" class="w-full h-full object-cover"> </picture>   </div> </div><div class="banner-image-desktop absolute inset-0 hidden"> <div class="object-cover h-full overflow-hidden relative"> <div class="transition absolute inset-0 dark:bg-black/10 pointer-events-none"></div> <picture> <source srcset="/_astro/133242321_p0.DansPXNF_1SUo5r.webp 1280w, /_astro/133242321_p0.DansPXNF_2qPKeW.webp 1920w, /_astro/133242321_p0.DansPXNF_ZaxWIW.webp 2560w" type="image/webp" sizes="100vw">  <img src="/_astro/133242321_p0.DansPXNF_2ayipP.webp" srcset="/_astro/133242321_p0.DansPXNF_1SUo5r.webp 1280w, /_astro/133242321_p0.DansPXNF_2qPKeW.webp 1920w, /_astro/133242321_p0.DansPXNF_ZaxWIW.webp 2560w" alt="Desktop background image of the blog" style="--fit: cover; --pos: center; object-position: 0% 20%" loading="lazy" fetchpriority="low" sizes="100vw" decoding="async" data-astro-image="constrained" width="5353" height="3000" class="w-full h-full object-cover"> </picture>   </div> </div><div class="banner-image-desktop absolute inset-0 hidden"> <div class="object-cover h-full overflow-hidden relative"> <div class="transition absolute inset-0 dark:bg-black/10 pointer-events-none"></div> <picture> <source srcset="/_astro/661faf180ea9cb140394b7ad.CLziOVTA_25RLnS.webp 1280w, /_astro/661faf180ea9cb140394b7ad.CLziOVTA_Z2i9lwy.webp 1600w" type="image/webp" sizes="100vw">  <img src="/_astro/661faf180ea9cb140394b7ad.CLziOVTA_Z2i9lwy.webp" srcset="/_astro/661faf180ea9cb140394b7ad.CLziOVTA_25RLnS.webp 1280w, /_astro/661faf180ea9cb140394b7ad.CLziOVTA_Z2i9lwy.webp 1600w" alt="Desktop background image of the blog" style="--fit: cover; --pos: center; object-position: 0% 20%" loading="lazy" fetchpriority="low" sizes="100vw" decoding="async" data-astro-image="constrained" width="1600" height="1124" class="w-full h-full object-cover"> </picture>   </div> </div><div class="banner-image-desktop absolute inset-0 hidden"> <div class="object-cover h-full overflow-hidden relative"> <div class="transition absolute inset-0 dark:bg-black/10 pointer-events-none"></div> <picture> <source srcset="/_astro/6648a851d9c307b7e9dc3e75.xyNKPqT1_Z1iL4gw.webp 1280w, /_astro/6648a851d9c307b7e9dc3e75.xyNKPqT1_v5DQH.webp 1920w, /_astro/6648a851d9c307b7e9dc3e75.xyNKPqT1_Z1H8X3T.webp 2560w" type="image/webp" sizes="100vw">  <img src="/_astro/6648a851d9c307b7e9dc3e75.xyNKPqT1_ZMRGkY.webp" srcset="/_astro/6648a851d9c307b7e9dc3e75.xyNKPqT1_Z1iL4gw.webp 1280w, /_astro/6648a851d9c307b7e9dc3e75.xyNKPqT1_v5DQH.webp 1920w, /_astro/6648a851d9c307b7e9dc3e75.xyNKPqT1_Z1H8X3T.webp 2560w" alt="Desktop background image of the blog" style="--fit: cover; --pos: center; object-position: 0% 20%" loading="lazy" fetchpriority="low" sizes="100vw" decoding="async" data-astro-image="constrained" width="3072" height="2158" class="w-full h-full object-cover"> </picture>   </div> </div><div class="banner-image-desktop absolute inset-0 hidden"> <div class="object-cover h-full overflow-hidden relative"> <div class="transition absolute inset-0 dark:bg-black/10 pointer-events-none"></div> <picture> <source srcset="/_astro/67f0950f0ba3d5a1d7ed88e2.Ccd7-V53_ZakJ1h.webp 1280w, /_astro/67f0950f0ba3d5a1d7ed88e2.Ccd7-V53_10r84K.webp 1920w, /_astro/67f0950f0ba3d5a1d7ed88e2.Ccd7-V53_2ssiyt.webp 2560w" type="image/webp" sizes="100vw">  <img src="/_astro/67f0950f0ba3d5a1d7ed88e2.Ccd7-V53_Zg6vzf.webp" srcset="/_astro/67f0950f0ba3d5a1d7ed88e2.Ccd7-V53_ZakJ1h.webp 1280w, /_astro/67f0950f0ba3d5a1d7ed88e2.Ccd7-V53_10r84K.webp 1920w, /_astro/67f0950f0ba3d5a1d7ed88e2.Ccd7-V53_2ssiyt.webp 2560w" alt="Desktop background image of the blog" style="--fit: cover; --pos: center; object-position: 0% 20%" loading="lazy" fetchpriority="low" sizes="100vw" decoding="async" data-astro-image="constrained" width="4864" height="2625" class="w-full h-full object-cover"> </picture>   </div> </div><div class="banner-image-desktop absolute inset-0 hidden"> <div class="object-cover h-full overflow-hidden relative"> <div class="transition absolute inset-0 dark:bg-black/10 pointer-events-none"></div> <picture> <source srcset="/_astro/6607c8cc9f345e8d03c37157.Ci622IlR_1Czqeg.webp 1280w, /_astro/6607c8cc9f345e8d03c37157.Ci622IlR_13WlkI.webp 1920w, /_astro/6607c8cc9f345e8d03c37157.Ci622IlR_Z1lLI5y.webp 2557w" type="image/webp" sizes="100vw">  <img src="/_astro/6607c8cc9f345e8d03c37157.Ci622IlR_Z1lLI5y.webp" srcset="/_astro/6607c8cc9f345e8d03c37157.Ci622IlR_1Czqeg.webp 1280w, /_astro/6607c8cc9f345e8d03c37157.Ci622IlR_13WlkI.webp 1920w, /_astro/6607c8cc9f345e8d03c37157.Ci622IlR_Z1lLI5y.webp 2557w" alt="Desktop background image of the blog" style="--fit: cover; --pos: center; object-position: 0% 20%" loading="lazy" fetchpriority="low" sizes="100vw" decoding="async" data-astro-image="constrained" width="2557" height="1585" class="w-full h-full object-cover"> </picture>   </div> </div><div class="banner-image-desktop absolute inset-0 hidden"> <div class="object-cover h-full overflow-hidden relative"> <div class="transition absolute inset-0 dark:bg-black/10 pointer-events-none"></div> <picture> <source srcset="/_astro/ku9625_nahida.DypZO7MH_1ufLff.webp 1280w, /_astro/ku9625_nahida.DypZO7MH_2btORU.webp 1920w, /_astro/ku9625_nahida.DypZO7MH_Z2exvkw.webp 2480w" type="image/webp" sizes="100vw">  <img src="/_astro/ku9625_nahida.DypZO7MH_Z2exvkw.webp" srcset="/_astro/ku9625_nahida.DypZO7MH_1ufLff.webp 1280w, /_astro/ku9625_nahida.DypZO7MH_2btORU.webp 1920w, /_astro/ku9625_nahida.DypZO7MH_Z2exvkw.webp 2480w" alt="Desktop background image of the blog" style="--fit: cover; --pos: center; object-position: 0% 20%" loading="lazy" fetchpriority="low" sizes="100vw" decoding="async" data-astro-image="constrained" width="2480" height="1428" class="w-full h-full object-cover"> </picture>   </div> </div><div class="banner-image-desktop absolute inset-0 hidden"> <div class="object-cover h-full overflow-hidden relative"> <div class="transition absolute inset-0 dark:bg-black/10 pointer-events-none"></div> <picture> <source srcset="/_astro/66e56c92d9c307b7e904e723.qdUQa1Ji_Z1ydDle.webp 1280w, /_astro/66e56c92d9c307b7e904e723.qdUQa1Ji_fD4M0.webp 1920w, /_astro/66e56c92d9c307b7e904e723.qdUQa1Ji_Z1WAx8B.webp 2560w" type="image/webp" sizes="100vw">  <img src="/_astro/66e56c92d9c307b7e904e723.qdUQa1Ji_2aaWO.webp" srcset="/_astro/66e56c92d9c307b7e904e723.qdUQa1Ji_Z1ydDle.webp 1280w, /_astro/66e56c92d9c307b7e904e723.qdUQa1Ji_fD4M0.webp 1920w, /_astro/66e56c92d9c307b7e904e723.qdUQa1Ji_Z1WAx8B.webp 2560w" alt="Desktop background image of the blog" style="--fit: cover; --pos: center; object-position: 0% 20%" loading="lazy" fetchpriority="low" sizes="100vw" decoding="async" data-astro-image="constrained" width="3200" height="2248" class="w-full h-full object-cover"> </picture>   </div> </div><div class="banner-image-desktop absolute inset-0 hidden"> <div class="object-cover h-full overflow-hidden relative"> <div class="transition absolute inset-0 dark:bg-black/10 pointer-events-none"></div> <picture> <source srcset="/_astro/130954879.ClK2p4MA_Z1WlusO.webp 1280w, /_astro/130954879.ClK2p4MA_Xr8tq.webp 1920w, /_astro/130954879.ClK2p4MA_1g1zzE.webp 2560w" type="image/webp" sizes="100vw">  <img src="/_astro/130954879.ClK2p4MA_19aAz9.webp" srcset="/_astro/130954879.ClK2p4MA_Z1WlusO.webp 1280w, /_astro/130954879.ClK2p4MA_Xr8tq.webp 1920w, /_astro/130954879.ClK2p4MA_1g1zzE.webp 2560w" alt="Desktop background image of the blog" style="--fit: cover; --pos: center; object-position: 0% 20%" loading="lazy" fetchpriority="low" sizes="100vw" decoding="async" data-astro-image="constrained" width="4320" height="2430" class="w-full h-full object-cover"> </picture>   </div> </div><div class="banner-image-desktop absolute inset-0 hidden"> <div class="object-cover h-full overflow-hidden relative"> <div class="transition absolute inset-0 dark:bg-black/10 pointer-events-none"></div> <picture> <source srcset="/_astro/6698f45fd9c307b7e9ab0dc1.sjPi80pR_Z11I9xs.webp 1280w, /_astro/6698f45fd9c307b7e9ab0dc1.sjPi80pR_NdJCP.webp 1920w, /_astro/6698f45fd9c307b7e9ab0dc1.sjPi80pR_mNfXc.webp 2560w" type="image/webp" sizes="100vw">  <img src="/_astro/6698f45fd9c307b7e9ab0dc1.sjPi80pR_1WCpGi.webp" srcset="/_astro/6698f45fd9c307b7e9ab0dc1.sjPi80pR_Z11I9xs.webp 1280w, /_astro/6698f45fd9c307b7e9ab0dc1.sjPi80pR_NdJCP.webp 1920w, /_astro/6698f45fd9c307b7e9ab0dc1.sjPi80pR_mNfXc.webp 2560w" alt="Desktop background image of the blog" style="--fit: cover; --pos: center; object-position: 0% 20%" loading="lazy" fetchpriority="low" sizes="100vw" decoding="async" data-astro-image="constrained" width="3616" height="2064" class="w-full h-full object-cover"> </picture>   </div> </div><div class="banner-image-desktop absolute inset-0 hidden"> <div class="object-cover h-full overflow-hidden relative"> <div class="transition absolute inset-0 dark:bg-black/10 pointer-events-none"></div> <picture> <source srcset="/_astro/65c9e1cb9f345e8d031859ff.CCMDe0fv_ZFKgSg.webp 1280w, /_astro/65c9e1cb9f345e8d031859ff.CCMDe0fv_Z2eO5fG.webp 1648w" type="image/webp" sizes="100vw">  <img src="/_astro/65c9e1cb9f345e8d031859ff.CCMDe0fv_Z2eO5fG.webp" srcset="/_astro/65c9e1cb9f345e8d031859ff.CCMDe0fv_ZFKgSg.webp 1280w, /_astro/65c9e1cb9f345e8d031859ff.CCMDe0fv_Z2eO5fG.webp 1648w" alt="Desktop background image of the blog" style="--fit: cover; --pos: center; object-position: 0% 20%" loading="lazy" fetchpriority="low" sizes="100vw" decoding="async" data-astro-image="constrained" width="1648" height="1008" class="w-full h-full object-cover"> </picture>   </div> </div><div class="banner-image-desktop absolute inset-0 hidden"> <div class="object-cover h-full overflow-hidden relative"> <div class="transition absolute inset-0 dark:bg-black/10 pointer-events-none"></div> <picture> <source srcset="/_astro/138265433.OSqaKNGb_16ascB.webp 1280w, /_astro/138265433.OSqaKNGb_2N0ii.webp 1920w, /_astro/138265433.OSqaKNGb_Z21lzbT.webp 2414w" type="image/webp" sizes="100vw">  <img src="/_astro/138265433.OSqaKNGb_Z21lzbT.webp" srcset="/_astro/138265433.OSqaKNGb_16ascB.webp 1280w, /_astro/138265433.OSqaKNGb_2N0ii.webp 1920w, /_astro/138265433.OSqaKNGb_Z21lzbT.webp 2414w" alt="Desktop background image of the blog" style="--fit: cover; --pos: center; object-position: 0% 20%" loading="lazy" fetchpriority="low" sizes="100vw" decoding="async" data-astro-image="constrained" width="2414" height="1924" class="w-full h-full object-cover"> </picture>   </div> </div><div class="banner-image-desktop absolute inset-0 hidden"> <div class="object-cover h-full overflow-hidden relative"> <div class="transition absolute inset-0 dark:bg-black/10 pointer-events-none"></div> <picture> <source srcset="/_astro/rosmontis.CwWNc-kL_1bVS0x.webp 1280w, /_astro/rosmontis.CwWNc-kL_ZWrBQ9.webp 1920w, /_astro/rosmontis.CwWNc-kL_ZERaJU.webp 2560w" type="image/webp" sizes="100vw">  <img src="/_astro/rosmontis.CwWNc-kL_19AysK.webp" srcset="/_astro/rosmontis.CwWNc-kL_1bVS0x.webp 1280w, /_astro/rosmontis.CwWNc-kL_ZWrBQ9.webp 1920w, /_astro/rosmontis.CwWNc-kL_ZERaJU.webp 2560w" alt="Desktop background image of the blog" style="--fit: cover; --pos: center; object-position: 0% 20%" loading="lazy" fetchpriority="low" sizes="100vw" decoding="async" data-astro-image="constrained" width="4096" height="2304" class="w-full h-full object-cover"> </picture>   </div> </div><div class="banner-image-desktop absolute inset-0 hidden"> <div class="object-cover h-full overflow-hidden relative"> <div class="transition absolute inset-0 dark:bg-black/10 pointer-events-none"></div> <picture> <source srcset="/_astro/661fb46f0ea9cb1403c64433.mhP9ojNJ_QBHdK.webp 1280w, /_astro/661fb46f0ea9cb1403c64433.mhP9ojNJ_1xLI7f.webp 1600w" type="image/webp" sizes="100vw">  <img src="/_astro/661fb46f0ea9cb1403c64433.mhP9ojNJ_1xLI7f.webp" srcset="/_astro/661fb46f0ea9cb1403c64433.mhP9ojNJ_QBHdK.webp 1280w, /_astro/661fb46f0ea9cb1403c64433.mhP9ojNJ_1xLI7f.webp 1600w" alt="Desktop background image of the blog" style="--fit: cover; --pos: center; object-position: 0% 20%" loading="lazy" fetchpriority="low" sizes="100vw" decoding="async" data-astro-image="constrained" width="1600" height="1124" class="w-full h-full object-cover"> </picture>   </div> </div><div class="banner-image-desktop absolute inset-0 hidden"> <div class="object-cover h-full overflow-hidden relative"> <div class="transition absolute inset-0 dark:bg-black/10 pointer-events-none"></div> <picture> <source srcset="/_astro/122436164_p0.CbmIOcTL_OCtLd.webp 1280w, /_astro/122436164_p0.CbmIOcTL_Zczj0J.webp 1800w" type="image/webp" sizes="100vw">  <img src="/_astro/122436164_p0.CbmIOcTL_Zczj0J.webp" srcset="/_astro/122436164_p0.CbmIOcTL_OCtLd.webp 1280w, /_astro/122436164_p0.CbmIOcTL_Zczj0J.webp 1800w" alt="Desktop background image of the blog" style="--fit: cover; --pos: center; object-position: 0% 20%" loading="lazy" fetchpriority="low" sizes="100vw" decoding="async" data-astro-image="constrained" width="1800" height="1013" class="w-full h-full object-cover"> </picture>   </div> </div><div class="banner-image-desktop absolute inset-0 hidden"> <div class="object-cover h-full overflow-hidden relative"> <div class="transition absolute inset-0 dark:bg-black/10 pointer-events-none"></div> <picture> <source srcset="/_astro/67f108bc0ba3d5a1d7edc048.ByS24r7z_rvJhi.webp 1280w, /_astro/67f108bc0ba3d5a1d7edc048.ByS24r7z_1ikCK.webp 1920w, /_astro/67f108bc0ba3d5a1d7edc048.ByS24r7z_RMop.webp 2560w" type="image/webp" sizes="100vw">  <img src="/_astro/67f108bc0ba3d5a1d7edc048.ByS24r7z_Z1X8jdE.webp" srcset="/_astro/67f108bc0ba3d5a1d7edc048.ByS24r7z_rvJhi.webp 1280w, /_astro/67f108bc0ba3d5a1d7edc048.ByS24r7z_1ikCK.webp 1920w, /_astro/67f108bc0ba3d5a1d7edc048.ByS24r7z_RMop.webp 2560w" alt="Desktop background image of the blog" style="--fit: cover; --pos: center; object-position: 0% 20%" loading="lazy" fetchpriority="low" sizes="100vw" decoding="async" data-astro-image="constrained" width="3840" height="2160" class="w-full h-full object-cover"> </picture>   </div> </div><div class="banner-image-desktop absolute inset-0 hidden"> <div class="object-cover h-full overflow-hidden relative"> <div class="transition absolute inset-0 dark:bg-black/10 pointer-events-none"></div> <picture> <source srcset="/_astro/firefly119791514.Ck-toh21_ZmDpim.webp 1280w, /_astro/firefly119791514.Ck-toh21_Z1CCU88.webp 1920w, /_astro/firefly119791514.Ck-toh21_DUXtH.webp 2560w" type="image/webp" sizes="100vw">  <img src="/_astro/firefly119791514.Ck-toh21_Z16PwdF.webp" srcset="/_astro/firefly119791514.Ck-toh21_ZmDpim.webp 1280w, /_astro/firefly119791514.Ck-toh21_Z1CCU88.webp 1920w, /_astro/firefly119791514.Ck-toh21_DUXtH.webp 2560w" alt="Desktop background image of the blog" style="--fit: cover; --pos: center; object-position: 0% 20%" loading="lazy" fetchpriority="low" sizes="100vw" decoding="async" data-astro-image="constrained" width="4096" height="2304" class="w-full h-full object-cover"> </picture>   </div> </div><div class="banner-image-desktop absolute inset-0 hidden"> <div class="object-cover h-full overflow-hidden relative"> <div class="transition absolute inset-0 dark:bg-black/10 pointer-events-none"></div> <picture> <source srcset="/_astro/133788805.C5SVsk4I_Z2uIA9P.webp 1280w, /_astro/133788805.C5SVsk4I_ZfCtaN.webp 1920w, /_astro/133788805.C5SVsk4I_Z19stkY.webp 1952w" type="image/webp" sizes="100vw">  <img src="/_astro/133788805.C5SVsk4I_Z19stkY.webp" srcset="/_astro/133788805.C5SVsk4I_Z2uIA9P.webp 1280w, /_astro/133788805.C5SVsk4I_ZfCtaN.webp 1920w, /_astro/133788805.C5SVsk4I_Z19stkY.webp 1952w" alt="Desktop background image of the blog" style="--fit: cover; --pos: center; object-position: 0% 20%" loading="lazy" fetchpriority="low" sizes="100vw" decoding="async" data-astro-image="constrained" width="1952" height="1272" class="w-full h-full object-cover"> </picture>   </div> </div><div class="banner-image-desktop absolute inset-0 hidden"> <div class="object-cover h-full overflow-hidden relative"> <div class="transition absolute inset-0 dark:bg-black/10 pointer-events-none"></div> <picture> <source srcset="/_astro/6660636a5e6d1bfa05cbd819.DxP3saJC_1omi0V.webp 1200w" type="image/webp" sizes="100vw">  <img src="/_astro/6660636a5e6d1bfa05cbd819.DxP3saJC_1omi0V.webp" srcset="/_astro/6660636a5e6d1bfa05cbd819.DxP3saJC_1omi0V.webp 1200w" alt="Desktop background image of the blog" style="--fit: cover; --pos: center; object-position: 0% 20%" loading="lazy" fetchpriority="low" sizes="100vw" decoding="async" data-astro-image="constrained" width="1200" height="844" class="w-full h-full object-cover"> </picture>   </div> </div><div class="banner-image-desktop absolute inset-0 hidden"> <div class="object-cover h-full overflow-hidden relative"> <div class="transition absolute inset-0 dark:bg-black/10 pointer-events-none"></div> <picture> <source srcset="/_astro/ku9625_hoshino.BFv2qqUq_Z1X2LKF.webp 1280w, /_astro/ku9625_hoshino.BFv2qqUq_15j9Gx.webp 1920w, /_astro/ku9625_hoshino.BFv2qqUq_Z1Dq9VQ.webp 2560w" type="image/webp" sizes="100vw">  <img src="/_astro/ku9625_hoshino.BFv2qqUq_2ck72E.webp" srcset="/_astro/ku9625_hoshino.BFv2qqUq_Z1X2LKF.webp 1280w, /_astro/ku9625_hoshino.BFv2qqUq_15j9Gx.webp 1920w, /_astro/ku9625_hoshino.BFv2qqUq_Z1Dq9VQ.webp 2560w" alt="Desktop background image of the blog" style="--fit: cover; --pos: center; object-position: 0% 20%" loading="lazy" fetchpriority="low" sizes="100vw" decoding="async" data-astro-image="constrained" width="3369" height="2088" class="w-full h-full object-cover"> </picture>   </div> </div><div class="banner-image-desktop absolute inset-0 hidden"> <div class="object-cover h-full overflow-hidden relative"> <div class="transition absolute inset-0 dark:bg-black/10 pointer-events-none"></div> <picture> <source srcset="/_astro/129850582_p0.CSdMOItl_1J8w9W.webp 1280w, /_astro/129850582_p0.CSdMOItl_Z1bA36s.webp 1920w, /_astro/129850582_p0.CSdMOItl_Z1RCyWu.webp 2048w" type="image/webp" sizes="100vw">  <img src="/_astro/129850582_p0.CSdMOItl_Z1RCyWu.webp" srcset="/_astro/129850582_p0.CSdMOItl_1J8w9W.webp 1280w, /_astro/129850582_p0.CSdMOItl_Z1bA36s.webp 1920w, /_astro/129850582_p0.CSdMOItl_Z1RCyWu.webp 2048w" alt="Desktop background image of the blog" style="--fit: cover; --pos: center; object-position: 0% 20%" loading="lazy" fetchpriority="low" sizes="100vw" decoding="async" data-astro-image="constrained" width="2048" height="1020" class="w-full h-full object-cover"> </picture>   </div> </div><div class="banner-image-desktop absolute inset-0 hidden"> <div class="object-cover h-full overflow-hidden relative"> <div class="transition absolute inset-0 dark:bg-black/10 pointer-events-none"></div> <picture> <source srcset="/_astro/65f5a7c69f345e8d03960250.lkQJIWwW_1dqFzA.webp 1280w, /_astro/65f5a7c69f345e8d03960250.lkQJIWwW_ZUCAgy.webp 1920w, /_astro/65f5a7c69f345e8d03960250.lkQJIWwW_ZbNBJ4.webp 2552w" type="image/webp" sizes="100vw">  <img src="/_astro/65f5a7c69f345e8d03960250.lkQJIWwW_ZbNBJ4.webp" srcset="/_astro/65f5a7c69f345e8d03960250.lkQJIWwW_1dqFzA.webp 1280w, /_astro/65f5a7c69f345e8d03960250.lkQJIWwW_ZUCAgy.webp 1920w, /_astro/65f5a7c69f345e8d03960250.lkQJIWwW_ZbNBJ4.webp 2552w" alt="Desktop background image of the blog" style="--fit: cover; --pos: center; object-position: 0% 20%" loading="lazy" fetchpriority="low" sizes="100vw" decoding="async" data-astro-image="constrained" width="2552" height="1586" class="w-full h-full object-cover"> </picture>   </div> </div><div class="banner-image-desktop absolute inset-0 hidden"> <div class="object-cover h-full overflow-hidden relative"> <div class="transition absolute inset-0 dark:bg-black/10 pointer-events-none"></div> <picture> <source srcset="/_astro/6607b08a9f345e8d032c0e91.C6gJlS2O_ZDxaxs.webp 1280w, /_astro/6607b08a9f345e8d032c0e91.C6gJlS2O_H8urI.webp 1920w, /_astro/6607b08a9f345e8d032c0e91.C6gJlS2O_Z23UBfu.webp 2550w" type="image/webp" sizes="100vw">  <img src="/_astro/6607b08a9f345e8d032c0e91.C6gJlS2O_Z23UBfu.webp" srcset="/_astro/6607b08a9f345e8d032c0e91.C6gJlS2O_ZDxaxs.webp 1280w, /_astro/6607b08a9f345e8d032c0e91.C6gJlS2O_H8urI.webp 1920w, /_astro/6607b08a9f345e8d032c0e91.C6gJlS2O_Z23UBfu.webp 2550w" alt="Desktop background image of the blog" style="--fit: cover; --pos: center; object-position: 0% 20%" loading="lazy" fetchpriority="low" sizes="100vw" decoding="async" data-astro-image="constrained" width="2550" height="1588" class="w-full h-full object-cover"> </picture>   </div> </div><div class="banner-image-desktop absolute inset-0 hidden"> <div class="object-cover h-full overflow-hidden relative"> <div class="transition absolute inset-0 dark:bg-black/10 pointer-events-none"></div> <picture> <source srcset="/_astro/129339284.CWKMZQgm_ZVaV8L.webp 1280w, /_astro/129339284.CWKMZQgm_21kKzz.webp 1920w, /_astro/129339284.CWKMZQgm_11t7ln.webp 2560w" type="image/webp" sizes="100vw">  <img src="/_astro/129339284.CWKMZQgm_1lN90m.webp" srcset="/_astro/129339284.CWKMZQgm_ZVaV8L.webp 1280w, /_astro/129339284.CWKMZQgm_21kKzz.webp 1920w, /_astro/129339284.CWKMZQgm_11t7ln.webp 2560w" alt="Desktop background image of the blog" style="--fit: cover; --pos: center; object-position: 0% 20%" loading="lazy" fetchpriority="low" sizes="100vw" decoding="async" data-astro-image="constrained" width="7728" height="4752" class="w-full h-full object-cover"> </picture>   </div> </div><div class="banner-image-desktop absolute inset-0 hidden"> <div class="object-cover h-full overflow-hidden relative"> <div class="transition absolute inset-0 dark:bg-black/10 pointer-events-none"></div> <picture> <source srcset="/_astro/66e6bdb3d9c307b7e9a2aa2a.c85b4cky_Z10QeNi.webp 1280w, /_astro/66e6bdb3d9c307b7e9a2aa2a.c85b4cky_1HNJsn.webp 1920w, /_astro/66e6bdb3d9c307b7e9a2aa2a.c85b4cky_Z1MlJCi.webp 2560w" type="image/webp" sizes="100vw">  <img src="/_astro/66e6bdb3d9c307b7e9a2aa2a.c85b4cky_Z2gSaMm.webp" srcset="/_astro/66e6bdb3d9c307b7e9a2aa2a.c85b4cky_Z10QeNi.webp 1280w, /_astro/66e6bdb3d9c307b7e9a2aa2a.c85b4cky_1HNJsn.webp 1920w, /_astro/66e6bdb3d9c307b7e9a2aa2a.c85b4cky_Z1MlJCi.webp 2560w" alt="Desktop background image of the blog" style="--fit: cover; --pos: center; object-position: 0% 20%" loading="lazy" fetchpriority="low" sizes="100vw" decoding="async" data-astro-image="constrained" width="5167" height="2894" class="w-full h-full object-cover"> </picture>   </div> </div><div class="banner-image-desktop absolute inset-0 hidden"> <div class="object-cover h-full overflow-hidden relative"> <div class="transition absolute inset-0 dark:bg-black/10 pointer-events-none"></div> <picture> <source srcset="/_astro/130023460.Bl6ikGD7_1M9adn.webp 1280w, /_astro/130023460.Bl6ikGD7_ZkwgRd.webp 1920w, /_astro/130023460.Bl6ikGD7_Z12CXt8.webp 2560w" type="image/webp" sizes="100vw">  <img src="/_astro/130023460.Bl6ikGD7_2a33zK.webp" srcset="/_astro/130023460.Bl6ikGD7_1M9adn.webp 1280w, /_astro/130023460.Bl6ikGD7_ZkwgRd.webp 1920w, /_astro/130023460.Bl6ikGD7_Z12CXt8.webp 2560w" alt="Desktop background image of the blog" style="--fit: cover; --pos: center; object-position: 0% 20%" loading="lazy" fetchpriority="low" sizes="100vw" decoding="async" data-astro-image="constrained" width="3897" height="2400" class="w-full h-full object-cover"> </picture>   </div> </div><div class="banner-image-desktop absolute inset-0 hidden"> <div class="object-cover h-full overflow-hidden relative"> <div class="transition absolute inset-0 dark:bg-black/10 pointer-events-none"></div> <picture> <source srcset="/_astro/66e6bdb2d9c307b7e9a2a9c9.PPhTxXwJ_Z1X3oiG.webp 1280w, /_astro/66e6bdb2d9c307b7e9a2a9c9.PPhTxXwJ_2s4ga8.webp 1920w, /_astro/66e6bdb2d9c307b7e9a2a9c9.PPhTxXwJ_Z2e6yeO.webp 2560w" type="image/webp" sizes="100vw">  <img src="/_astro/66e6bdb2d9c307b7e9a2a9c9.PPhTxXwJ_Zl5CDr.webp" srcset="/_astro/66e6bdb2d9c307b7e9a2a9c9.PPhTxXwJ_Z1X3oiG.webp 1280w, /_astro/66e6bdb2d9c307b7e9a2a9c9.PPhTxXwJ_2s4ga8.webp 1920w, /_astro/66e6bdb2d9c307b7e9a2a9c9.PPhTxXwJ_Z2e6yeO.webp 2560w" alt="Desktop background image of the blog" style="--fit: cover; --pos: center; object-position: 0% 20%" loading="lazy" fetchpriority="low" sizes="100vw" decoding="async" data-astro-image="constrained" width="5200" height="3000" class="w-full h-full object-cover"> </picture>   </div> </div><div class="banner-image-desktop absolute inset-0 hidden"> <div class="object-cover h-full overflow-hidden relative"> <div class="transition absolute inset-0 dark:bg-black/10 pointer-events-none"></div> <picture> <source srcset="/_astro/65f64e899f345e8d03453850.UnPlFJqc_2wMFn4.webp 1280w, /_astro/65f64e899f345e8d03453850.UnPlFJqc_Z2qiqsb.webp 1920w, /_astro/65f64e899f345e8d03453850.UnPlFJqc_10JgL1.webp 2548w" type="image/webp" sizes="100vw">  <img src="/_astro/65f64e899f345e8d03453850.UnPlFJqc_10JgL1.webp" srcset="/_astro/65f64e899f345e8d03453850.UnPlFJqc_2wMFn4.webp 1280w, /_astro/65f64e899f345e8d03453850.UnPlFJqc_Z2qiqsb.webp 1920w, /_astro/65f64e899f345e8d03453850.UnPlFJqc_10JgL1.webp 2548w" alt="Desktop background image of the blog" style="--fit: cover; --pos: center; object-position: 0% 20%" loading="lazy" fetchpriority="low" sizes="100vw" decoding="async" data-astro-image="constrained" width="2548" height="1605" class="w-full h-full object-cover"> </picture>   </div> </div><div class="banner-image-desktop absolute inset-0 hidden"> <div class="object-cover h-full overflow-hidden relative"> <div class="transition absolute inset-0 dark:bg-black/10 pointer-events-none"></div> <picture> <source srcset="/_astro/662b8dff0ea9cb14033252a6.CvK9reSd_ZIw7fb.webp 1280w, /_astro/662b8dff0ea9cb14033252a6.CvK9reSd_ZJOKvu.webp 1920w, /_astro/662b8dff0ea9cb14033252a6.CvK9reSd_Z1itMYj.webp 2560w" type="image/webp" sizes="100vw">  <img src="/_astro/662b8dff0ea9cb14033252a6.CvK9reSd_w10v.webp" srcset="/_astro/662b8dff0ea9cb14033252a6.CvK9reSd_ZIw7fb.webp 1280w, /_astro/662b8dff0ea9cb14033252a6.CvK9reSd_ZJOKvu.webp 1920w, /_astro/662b8dff0ea9cb14033252a6.CvK9reSd_Z1itMYj.webp 2560w" alt="Desktop background image of the blog" style="--fit: cover; --pos: center; object-position: 0% 20%" loading="lazy" fetchpriority="low" sizes="100vw" decoding="async" data-astro-image="constrained" width="3148" height="2166" class="w-full h-full object-cover"> </picture>   </div> </div><div class="banner-image-desktop absolute inset-0 hidden"> <div class="object-cover h-full overflow-hidden relative"> <div class="transition absolute inset-0 dark:bg-black/10 pointer-events-none"></div> <picture> <source srcset="/_astro/65f5a7c59f345e8d0395ff6d.B8lAALDh_y1fTd.webp 1280w, /_astro/65f5a7c59f345e8d0395ff6d.B8lAALDh_7MQfF.webp 1920w, /_astro/65f5a7c59f345e8d0395ff6d.B8lAALDh_vj7vh.webp 2550w" type="image/webp" sizes="100vw">  <img src="/_astro/65f5a7c59f345e8d0395ff6d.B8lAALDh_vj7vh.webp" srcset="/_astro/65f5a7c59f345e8d0395ff6d.B8lAALDh_y1fTd.webp 1280w, /_astro/65f5a7c59f345e8d0395ff6d.B8lAALDh_7MQfF.webp 1920w, /_astro/65f5a7c59f345e8d0395ff6d.B8lAALDh_vj7vh.webp 2550w" alt="Desktop background image of the blog" style="--fit: cover; --pos: center; object-position: 0% 20%" loading="lazy" fetchpriority="low" sizes="100vw" decoding="async" data-astro-image="constrained" width="2550" height="1435" class="w-full h-full object-cover"> </picture>   </div> </div><div class="banner-image-desktop absolute inset-0 hidden"> <div class="object-cover h-full overflow-hidden relative"> <div class="transition absolute inset-0 dark:bg-black/10 pointer-events-none"></div> <picture> <source srcset="/_astro/135672846.BnrcYgGM_Z2lLK0X.webp 1280w, /_astro/135672846.BnrcYgGM_HSlJU.webp 1920w, /_astro/135672846.BnrcYgGM_19lgEM.webp 2560w" type="image/webp" sizes="100vw">  <img src="/_astro/135672846.BnrcYgGM_N95fh.webp" srcset="/_astro/135672846.BnrcYgGM_Z2lLK0X.webp 1280w, /_astro/135672846.BnrcYgGM_HSlJU.webp 1920w, /_astro/135672846.BnrcYgGM_19lgEM.webp 2560w" alt="Desktop background image of the blog" style="--fit: cover; --pos: center; object-position: 0% 20%" loading="lazy" fetchpriority="low" sizes="100vw" decoding="async" data-astro-image="constrained" width="4457" height="2514" class="w-full h-full object-cover"> </picture>   </div> </div><div class="banner-image-desktop absolute inset-0 hidden"> <div class="object-cover h-full overflow-hidden relative"> <div class="transition absolute inset-0 dark:bg-black/10 pointer-events-none"></div> <picture> <source srcset="/_astro/662b8dff0ea9cb1403325250.BQSIXjwC_1BvqXE.webp 1280w, /_astro/662b8dff0ea9cb1403325250.BQSIXjwC_Z1ymzft.webp 1920w, /_astro/662b8dff0ea9cb1403325250.BQSIXjwC_21b9fr.webp 2560w" type="image/webp" sizes="100vw">  <img src="/_astro/662b8dff0ea9cb1403325250.BQSIXjwC_1krgPh.webp" srcset="/_astro/662b8dff0ea9cb1403325250.BQSIXjwC_1BvqXE.webp 1280w, /_astro/662b8dff0ea9cb1403325250.BQSIXjwC_Z1ymzft.webp 1920w, /_astro/662b8dff0ea9cb1403325250.BQSIXjwC_21b9fr.webp 2560w" alt="Desktop background image of the blog" style="--fit: cover; --pos: center; object-position: 0% 20%" loading="lazy" fetchpriority="low" sizes="100vw" decoding="async" data-astro-image="constrained" width="3052" height="2274" class="w-full h-full object-cover"> </picture>   </div> </div><div class="banner-image-desktop absolute inset-0 hidden"> <div class="object-cover h-full overflow-hidden relative"> <div class="transition absolute inset-0 dark:bg-black/10 pointer-events-none"></div> <picture> <source srcset="/_astro/66a60443d9c307b7e99d4fd8.CkLsneoZ_1348Un.webp 1280w, /_astro/66a60443d9c307b7e99d4fd8.CkLsneoZ_BPJgP.webp 1920w, /_astro/66a60443d9c307b7e99d4fd8.CkLsneoZ_Bqc2u.webp 2560w" type="image/webp" sizes="100vw">  <img src="/_astro/66a60443d9c307b7e99d4fd8.CkLsneoZ_Bqc2u.webp" srcset="/_astro/66a60443d9c307b7e99d4fd8.CkLsneoZ_1348Un.webp 1280w, /_astro/66a60443d9c307b7e99d4fd8.CkLsneoZ_BPJgP.webp 1920w, /_astro/66a60443d9c307b7e99d4fd8.CkLsneoZ_Bqc2u.webp 2560w" alt="Desktop background image of the blog" style="--fit: cover; --pos: center; object-position: 0% 20%" loading="lazy" fetchpriority="low" sizes="100vw" decoding="async" data-astro-image="constrained" width="2560" height="1441" class="w-full h-full object-cover"> </picture>   </div> </div><div class="banner-image-desktop absolute inset-0 hidden"> <div class="object-cover h-full overflow-hidden relative"> <div class="transition absolute inset-0 dark:bg-black/10 pointer-events-none"></div> <picture> <source srcset="/_astro/67f108bc0ba3d5a1d7edc047.B9A3HlKv_1f5khO.webp 1280w, /_astro/67f108bc0ba3d5a1d7edc047.B9A3HlKv_NQUDh.webp 1920w, /_astro/67f108bc0ba3d5a1d7edc047.B9A3HlKv_NrnoV.webp 2560w" type="image/webp" sizes="100vw">  <img src="/_astro/67f108bc0ba3d5a1d7edc047.B9A3HlKv_Z1ayId8.webp" srcset="/_astro/67f108bc0ba3d5a1d7edc047.B9A3HlKv_1f5khO.webp 1280w, /_astro/67f108bc0ba3d5a1d7edc047.B9A3HlKv_NQUDh.webp 1920w, /_astro/67f108bc0ba3d5a1d7edc047.B9A3HlKv_NrnoV.webp 2560w" alt="Desktop background image of the blog" style="--fit: cover; --pos: center; object-position: 0% 20%" loading="lazy" fetchpriority="low" sizes="100vw" decoding="async" data-astro-image="constrained" width="3840" height="2160" class="w-full h-full object-cover"> </picture>   </div> </div><div class="banner-image-desktop absolute inset-0 hidden"> <div class="object-cover h-full overflow-hidden relative"> <div class="transition absolute inset-0 dark:bg-black/10 pointer-events-none"></div> <picture> <source srcset="/_astro/678a4727d0e0a243d4f5421a.U_GdW91z_B7Rta.webp 1280w, /_astro/678a4727d0e0a243d4f5421a.U_GdW91z_aTsOC.webp 1920w, /_astro/678a4727d0e0a243d4f5421a.U_GdW91z_atUAh.webp 2560w" type="image/webp" sizes="100vw">  <img src="/_astro/678a4727d0e0a243d4f5421a.U_GdW91z_Z1Nwb1M.webp" srcset="/_astro/678a4727d0e0a243d4f5421a.U_GdW91z_B7Rta.webp 1280w, /_astro/678a4727d0e0a243d4f5421a.U_GdW91z_aTsOC.webp 1920w, /_astro/678a4727d0e0a243d4f5421a.U_GdW91z_atUAh.webp 2560w" alt="Desktop background image of the blog" style="--fit: cover; --pos: center; object-position: 0% 20%" loading="lazy" fetchpriority="low" sizes="100vw" decoding="async" data-astro-image="constrained" width="3840" height="2160" class="w-full h-full object-cover"> </picture>   </div> </div><div class="banner-image-desktop absolute inset-0 hidden"> <div class="object-cover h-full overflow-hidden relative"> <div class="transition absolute inset-0 dark:bg-black/10 pointer-events-none"></div> <picture> <source srcset="/_astro/669f4bbad9c307b7e9b67314.CeAetWwX_1NCgy1.webp 1280w, /_astro/669f4bbad9c307b7e9b67314.CeAetWwX_Z1rH97G.webp 1920w, /_astro/669f4bbad9c307b7e9b67314.CeAetWwX_Z2ftM7l.webp 2273w" type="image/webp" sizes="100vw">  <img src="/_astro/669f4bbad9c307b7e9b67314.CeAetWwX_Z2ftM7l.webp" srcset="/_astro/669f4bbad9c307b7e9b67314.CeAetWwX_1NCgy1.webp 1280w, /_astro/669f4bbad9c307b7e9b67314.CeAetWwX_Z1rH97G.webp 1920w, /_astro/669f4bbad9c307b7e9b67314.CeAetWwX_Z2ftM7l.webp 2273w" alt="Desktop background image of the blog" style="--fit: cover; --pos: center; object-position: 0% 20%" loading="lazy" fetchpriority="low" sizes="100vw" decoding="async" data-astro-image="constrained" width="2273" height="1597" class="w-full h-full object-cover"> </picture>   </div> </div><div class="banner-image-desktop absolute inset-0 hidden"> <div class="object-cover h-full overflow-hidden relative"> <div class="transition absolute inset-0 dark:bg-black/10 pointer-events-none"></div> <picture> <source srcset="/_astro/6697b1f5d9c307b7e9659618.krzDjNof_2lMNnC.webp 1280w, /_astro/6697b1f5d9c307b7e9659618.krzDjNof_Z23XQOo.webp 1920w, /_astro/6697b1f5d9c307b7e9659618.krzDjNof_197nBJ.webp 2500w" type="image/webp" sizes="100vw">  <img src="/_astro/6697b1f5d9c307b7e9659618.krzDjNof_197nBJ.webp" srcset="/_astro/6697b1f5d9c307b7e9659618.krzDjNof_2lMNnC.webp 1280w, /_astro/6697b1f5d9c307b7e9659618.krzDjNof_Z23XQOo.webp 1920w, /_astro/6697b1f5d9c307b7e9659618.krzDjNof_197nBJ.webp 2500w" alt="Desktop background image of the blog" style="--fit: cover; --pos: center; object-position: 0% 20%" loading="lazy" fetchpriority="low" sizes="100vw" decoding="async" data-astro-image="constrained" width="2500" height="1741" class="w-full h-full object-cover"> </picture>   </div> </div><div class="banner-image-desktop absolute inset-0 hidden"> <div class="object-cover h-full overflow-hidden relative"> <div class="transition absolute inset-0 dark:bg-black/10 pointer-events-none"></div> <picture> <source srcset="/_astro/678a4727d0e0a243d4f5421b.1UlNp3gA_cM2Ie.webp 1280w, /_astro/678a4727d0e0a243d4f5421b.1UlNp3gA_ZdqlUj.webp 1920w, /_astro/678a4727d0e0a243d4f5421b.1UlNp3gA_ZdPT9E.webp 2560w" type="image/webp" sizes="100vw">  <img src="/_astro/678a4727d0e0a243d4f5421b.1UlNp3gA_Z2cR0LI.webp" srcset="/_astro/678a4727d0e0a243d4f5421b.1UlNp3gA_cM2Ie.webp 1280w, /_astro/678a4727d0e0a243d4f5421b.1UlNp3gA_ZdqlUj.webp 1920w, /_astro/678a4727d0e0a243d4f5421b.1UlNp3gA_ZdPT9E.webp 2560w" alt="Desktop background image of the blog" style="--fit: cover; --pos: center; object-position: 0% 20%" loading="lazy" fetchpriority="low" sizes="100vw" decoding="async" data-astro-image="constrained" width="3840" height="2160" class="w-full h-full object-cover"> </picture>   </div> </div><div class="banner-image-desktop absolute inset-0 hidden"> <div class="object-cover h-full overflow-hidden relative"> <div class="transition absolute inset-0 dark:bg-black/10 pointer-events-none"></div> <picture> <source srcset="/_astro/65f5acc59f345e8d03bdfcf6.BJY3qiYx_Z2lUYe5.webp 1280w, /_astro/65f5acc59f345e8d03bdfcf6.BJY3qiYx_2i2JVj.webp 1920w" type="image/webp" sizes="100vw">  <img src="/_astro/65f5acc59f345e8d03bdfcf6.BJY3qiYx_2i2JVj.webp" srcset="/_astro/65f5acc59f345e8d03bdfcf6.BJY3qiYx_Z2lUYe5.webp 1280w, /_astro/65f5acc59f345e8d03bdfcf6.BJY3qiYx_2i2JVj.webp 1920w" alt="Desktop background image of the blog" style="--fit: cover; --pos: center; object-position: 0% 20%" loading="lazy" fetchpriority="low" sizes="100vw" decoding="async" data-astro-image="constrained" width="1920" height="1080" class="w-full h-full object-cover"> </picture>   </div> </div><div class="banner-image-desktop absolute inset-0 hidden"> <div class="object-cover h-full overflow-hidden relative"> <div class="transition absolute inset-0 dark:bg-black/10 pointer-events-none"></div> <picture> <source srcset="/_astro/66406ca80ea9cb1403e3c8d7.CtE7MRrp_2njkrz.webp 1280w, /_astro/66406ca80ea9cb1403e3c8d7.CtE7MRrp_Z10kzq4.webp 1920w, /_astro/66406ca80ea9cb1403e3c8d7.CtE7MRrp_Z142O3c.webp 2548w" type="image/webp" sizes="100vw">  <img src="/_astro/66406ca80ea9cb1403e3c8d7.CtE7MRrp_Z142O3c.webp" srcset="/_astro/66406ca80ea9cb1403e3c8d7.CtE7MRrp_2njkrz.webp 1280w, /_astro/66406ca80ea9cb1403e3c8d7.CtE7MRrp_Z10kzq4.webp 1920w, /_astro/66406ca80ea9cb1403e3c8d7.CtE7MRrp_Z142O3c.webp 2548w" alt="Desktop background image of the blog" style="--fit: cover; --pos: center; object-position: 0% 20%" loading="lazy" fetchpriority="low" sizes="100vw" decoding="async" data-astro-image="constrained" width="2548" height="1601" class="w-full h-full object-cover"> </picture>   </div> </div><div class="banner-image-desktop absolute inset-0 hidden"> <div class="object-cover h-full overflow-hidden relative"> <div class="transition absolute inset-0 dark:bg-black/10 pointer-events-none"></div> <picture> <source srcset="/_astro/661fb4640ea9cb1403c5d0df.CXQcugDs_Z1Js8BI.webp 1280w, /_astro/661fb4640ea9cb1403c5d0df.CXQcugDs_Z13i7Ie.webp 1600w" type="image/webp" sizes="100vw">  <img src="/_astro/661fb4640ea9cb1403c5d0df.CXQcugDs_Z13i7Ie.webp" srcset="/_astro/661fb4640ea9cb1403c5d0df.CXQcugDs_Z1Js8BI.webp 1280w, /_astro/661fb4640ea9cb1403c5d0df.CXQcugDs_Z13i7Ie.webp 1600w" alt="Desktop background image of the blog" style="--fit: cover; --pos: center; object-position: 0% 20%" loading="lazy" fetchpriority="low" sizes="100vw" decoding="async" data-astro-image="constrained" width="1600" height="1124" class="w-full h-full object-cover"> </picture>   </div> </div><div class="banner-image-desktop absolute inset-0 hidden"> <div class="object-cover h-full overflow-hidden relative"> <div class="transition absolute inset-0 dark:bg-black/10 pointer-events-none"></div> <picture> <source srcset="/_astro/67e7570b0ba3d5a1d7e5d5ea.D75FSjas_Z1TIDef.webp 1280w, /_astro/67e7570b0ba3d5a1d7e5d5ea.D75FSjas_1L8QJk.webp 1920w, /_astro/67e7570b0ba3d5a1d7e5d5ea.D75FSjas_Z5hdF3.webp 2560w" type="image/webp" sizes="100vw">  <img src="/_astro/67e7570b0ba3d5a1d7e5d5ea.D75FSjas_7cUyo.webp" srcset="/_astro/67e7570b0ba3d5a1d7e5d5ea.D75FSjas_Z1TIDef.webp 1280w, /_astro/67e7570b0ba3d5a1d7e5d5ea.D75FSjas_1L8QJk.webp 1920w, /_astro/67e7570b0ba3d5a1d7e5d5ea.D75FSjas_Z5hdF3.webp 2560w" alt="Desktop background image of the blog" style="--fit: cover; --pos: center; object-position: 0% 20%" loading="lazy" fetchpriority="low" sizes="100vw" decoding="async" data-astro-image="constrained" width="6614" height="3108" class="w-full h-full object-cover"> </picture>   </div> </div><div class="banner-image-desktop absolute inset-0 hidden"> <div class="object-cover h-full overflow-hidden relative"> <div class="transition absolute inset-0 dark:bg-black/10 pointer-events-none"></div> <picture> <source srcset="/_astro/ku9625_oc.Cxbe9ubE_Z2nbgi8.webp 1280w, /_astro/ku9625_oc.Cxbe9ubE_1tMHJA.webp 1920w, /_astro/ku9625_oc.Cxbe9ubE_Z1RE10n.webp 2500w" type="image/webp" sizes="100vw">  <img src="/_astro/ku9625_oc.Cxbe9ubE_Z1RE10n.webp" srcset="/_astro/ku9625_oc.Cxbe9ubE_Z2nbgi8.webp 1280w, /_astro/ku9625_oc.Cxbe9ubE_1tMHJA.webp 1920w, /_astro/ku9625_oc.Cxbe9ubE_Z1RE10n.webp 2500w" alt="Desktop background image of the blog" style="--fit: cover; --pos: center; object-position: 0% 20%" loading="lazy" fetchpriority="low" sizes="100vw" decoding="async" data-astro-image="constrained" width="2500" height="1750" class="w-full h-full object-cover"> </picture>   </div> </div><div class="banner-image-desktop absolute inset-0 hidden"> <div class="object-cover h-full overflow-hidden relative"> <div class="transition absolute inset-0 dark:bg-black/10 pointer-events-none"></div> <picture> <source srcset="/_astro/662b8dff0ea9cb1403325348.Bm5Himwf_Z15xwLq.webp 1280w, /_astro/662b8dff0ea9cb1403325348.Bm5Himwf_Z1bYywU.webp 1920w, /_astro/662b8dff0ea9cb1403325348.Bm5Himwf_Z1OLYuU.webp 2560w" type="image/webp" sizes="100vw">  <img src="/_astro/662b8dff0ea9cb1403325348.Bm5Himwf_2oiOc2.webp" srcset="/_astro/662b8dff0ea9cb1403325348.Bm5Himwf_Z15xwLq.webp 1280w, /_astro/662b8dff0ea9cb1403325348.Bm5Himwf_Z1bYywU.webp 1920w, /_astro/662b8dff0ea9cb1403325348.Bm5Himwf_Z1OLYuU.webp 2560w" alt="Desktop background image of the blog" style="--fit: cover; --pos: center; object-position: 0% 20%" loading="lazy" fetchpriority="low" sizes="100vw" decoding="async" data-astro-image="constrained" width="3418" height="2392" class="w-full h-full object-cover"> </picture>   </div> </div><div class="banner-image-desktop absolute inset-0 hidden"> <div class="object-cover h-full overflow-hidden relative"> <div class="transition absolute inset-0 dark:bg-black/10 pointer-events-none"></div> <picture> <source srcset="/_astro/680790b7ed61a.CXms82I5_Tb6gU.webp 1280w, /_astro/680790b7ed61a.CXms82I5_Z1FV185.webp 1920w, /_astro/680790b7ed61a.CXms82I5_ZIoqC3.webp 2560w" type="image/webp" sizes="100vw">  <img src="/_astro/680790b7ed61a.CXms82I5_ZzToiP.webp" srcset="/_astro/680790b7ed61a.CXms82I5_Tb6gU.webp 1280w, /_astro/680790b7ed61a.CXms82I5_Z1FV185.webp 1920w, /_astro/680790b7ed61a.CXms82I5_ZIoqC3.webp 2560w" alt="Desktop background image of the blog" style="--fit: cover; --pos: center; object-position: 0% 20%" loading="lazy" fetchpriority="low" sizes="100vw" decoding="async" data-astro-image="constrained" width="4864" height="2621" class="w-full h-full object-cover"> </picture>   </div> </div><div class="banner-image-desktop absolute inset-0 hidden"> <div class="object-cover h-full overflow-hidden relative"> <div class="transition absolute inset-0 dark:bg-black/10 pointer-events-none"></div> <picture> <source srcset="/_astro/129569932.ClfAjIy__Zyt1FE.webp 1280w, /_astro/129569932.ClfAjIy__Z2wMBia.webp 1920w, /_astro/129569932.ClfAjIy__Zb109d.webp 2560w" type="image/webp" sizes="100vw">  <img src="/_astro/129569932.ClfAjIy__Z1Ce5gD.webp" srcset="/_astro/129569932.ClfAjIy__Zyt1FE.webp 1280w, /_astro/129569932.ClfAjIy__Z2wMBia.webp 1920w, /_astro/129569932.ClfAjIy__Zb109d.webp 2560w" alt="Desktop background image of the blog" style="--fit: cover; --pos: center; object-position: 0% 20%" loading="lazy" fetchpriority="low" sizes="100vw" decoding="async" data-astro-image="constrained" width="8742" height="5585" class="w-full h-full object-cover"> </picture>   </div> </div><div class="banner-image-desktop absolute inset-0 hidden"> <div class="object-cover h-full overflow-hidden relative"> <div class="transition absolute inset-0 dark:bg-black/10 pointer-events-none"></div> <picture> <source srcset="/_astro/67fa01a088c538a9b5cbc84f.ArF3xsw3_ZrqY0q.webp 1280w, /_astro/67fa01a088c538a9b5cbc84f.ArF3xsw3_Z2o3nas.webp 1920w, /_astro/67fa01a088c538a9b5cbc84f.ArF3xsw3_daXgV.webp 2560w" type="image/webp" sizes="100vw">  <img src="/_astro/67fa01a088c538a9b5cbc84f.ArF3xsw3_Z1yjYpQ.webp" srcset="/_astro/67fa01a088c538a9b5cbc84f.ArF3xsw3_ZrqY0q.webp 1280w, /_astro/67fa01a088c538a9b5cbc84f.ArF3xsw3_Z2o3nas.webp 1920w, /_astro/67fa01a088c538a9b5cbc84f.ArF3xsw3_daXgV.webp 2560w" alt="Desktop background image of the blog" style="--fit: cover; --pos: center; object-position: 0% 20%" loading="lazy" fetchpriority="low" sizes="100vw" decoding="async" data-astro-image="constrained" width="4864" height="3328" class="w-full h-full object-cover"> </picture>   </div> </div><div class="banner-image-desktop absolute inset-0 hidden"> <div class="object-cover h-full overflow-hidden relative"> <div class="transition absolute inset-0 dark:bg-black/10 pointer-events-none"></div> <picture> <source srcset="/_astro/66d50e4ed9c307b7e957adf2.DkuHprYr_18J3qI.webp 1280w, /_astro/66d50e4ed9c307b7e957adf2.DkuHprYr_ZmDjIn.webp 1920w, /_astro/66d50e4ed9c307b7e957adf2.DkuHprYr_gM9a9.webp 2560w" type="image/webp" sizes="100vw">  <img src="/_astro/66d50e4ed9c307b7e957adf2.DkuHprYr_Z17tF04.webp" srcset="/_astro/66d50e4ed9c307b7e957adf2.DkuHprYr_18J3qI.webp 1280w, /_astro/66d50e4ed9c307b7e957adf2.DkuHprYr_ZmDjIn.webp 1920w, /_astro/66d50e4ed9c307b7e957adf2.DkuHprYr_gM9a9.webp 2560w" alt="Desktop background image of the blog" style="--fit: cover; --pos: center; object-position: 0% 20%" loading="lazy" fetchpriority="low" sizes="100vw" decoding="async" data-astro-image="constrained" width="3000" height="1616" class="w-full h-full object-cover"> </picture>   </div> </div><div class="banner-image-desktop absolute inset-0 hidden"> <div class="object-cover h-full overflow-hidden relative"> <div class="transition absolute inset-0 dark:bg-black/10 pointer-events-none"></div> <picture> <source srcset="/_astro/662b8e430ea9cb140332e110.DBD6p_Dl_Z1bsY8W.webp 1280w, /_astro/662b8e430ea9cb140332e110.DBD6p_Dl_1tGCNg.webp 1920w, /_astro/662b8e430ea9cb140332e110.DBD6p_Dl_Z17EONh.webp 2560w" type="image/webp" sizes="100vw">  <img src="/_astro/662b8e430ea9cb140332e110.DBD6p_Dl_qKsYT.webp" srcset="/_astro/662b8e430ea9cb140332e110.DBD6p_Dl_Z1bsY8W.webp 1280w, /_astro/662b8e430ea9cb140332e110.DBD6p_Dl_1tGCNg.webp 1920w, /_astro/662b8e430ea9cb140332e110.DBD6p_Dl_Z17EONh.webp 2560w" alt="Desktop background image of the blog" style="--fit: cover; --pos: center; object-position: 0% 20%" loading="lazy" fetchpriority="low" sizes="100vw" decoding="async" data-astro-image="constrained" width="3072" height="2280" class="w-full h-full object-cover"> </picture>   </div> </div><div class="banner-image-desktop absolute inset-0 hidden"> <div class="object-cover h-full overflow-hidden relative"> <div class="transition absolute inset-0 dark:bg-black/10 pointer-events-none"></div> <picture> <source srcset="/_astro/6698f45fd9c307b7e9ab0dfb.B6Yr0NiB_1mmNVW.webp 1280w, /_astro/6698f45fd9c307b7e9ab0dfb.B6Yr0NiB_1LibFz.webp 1920w, /_astro/6698f45fd9c307b7e9ab0dfb.B6Yr0NiB_ZJ9Il7.webp 2560w" type="image/webp" sizes="100vw">  <img src="/_astro/6698f45fd9c307b7e9ab0dfb.B6Yr0NiB_12jKS4.webp" srcset="/_astro/6698f45fd9c307b7e9ab0dfb.B6Yr0NiB_1mmNVW.webp 1280w, /_astro/6698f45fd9c307b7e9ab0dfb.B6Yr0NiB_1LibFz.webp 1920w, /_astro/6698f45fd9c307b7e9ab0dfb.B6Yr0NiB_ZJ9Il7.webp 2560w" alt="Desktop background image of the blog" style="--fit: cover; --pos: center; object-position: 0% 20%" loading="lazy" fetchpriority="low" sizes="100vw" decoding="async" data-astro-image="constrained" width="2948" height="1600" class="w-full h-full object-cover"> </picture>   </div> </div><div class="banner-image-desktop absolute inset-0 hidden"> <div class="object-cover h-full overflow-hidden relative"> <div class="transition absolute inset-0 dark:bg-black/10 pointer-events-none"></div> <picture> <source srcset="/_astro/667fc806d9c307b7e9470fff.fw1_FThv_1q4iV1.webp 1280w, /_astro/667fc806d9c307b7e9470fff.fw1_FThv_Z25Fgee.webp 1920w, /_astro/667fc806d9c307b7e9470fff.fw1_FThv_1CA9t5.webp 2560w" type="image/webp" sizes="100vw">  <img src="/_astro/667fc806d9c307b7e9470fff.fw1_FThv_Z2u0nCw.webp" srcset="/_astro/667fc806d9c307b7e9470fff.fw1_FThv_1q4iV1.webp 1280w, /_astro/667fc806d9c307b7e9470fff.fw1_FThv_Z25Fgee.webp 1920w, /_astro/667fc806d9c307b7e9470fff.fw1_FThv_1CA9t5.webp 2560w" alt="Desktop background image of the blog" style="--fit: cover; --pos: center; object-position: 0% 20%" loading="lazy" fetchpriority="low" sizes="100vw" decoding="async" data-astro-image="constrained" width="3424" height="2534" class="w-full h-full object-cover"> </picture>   </div> </div><div class="banner-image-desktop absolute inset-0 hidden"> <div class="object-cover h-full overflow-hidden relative"> <div class="transition absolute inset-0 dark:bg-black/10 pointer-events-none"></div> <picture> <source srcset="/_astro/662b8dfe0ea9cb14033250b5.FQR8e9eN_ZAvcY9.webp 1280w, /_astro/662b8dfe0ea9cb14033250b5.FQR8e9eN_ZDmV2q.webp 1920w, /_astro/662b8dfe0ea9cb14033250b5.FQR8e9eN_Z151ugH.webp 2560w" type="image/webp" sizes="100vw">  <img src="/_astro/662b8dfe0ea9cb14033250b5.FQR8e9eN_Z1iB6rF.webp" srcset="/_astro/662b8dfe0ea9cb14033250b5.FQR8e9eN_ZAvcY9.webp 1280w, /_astro/662b8dfe0ea9cb14033250b5.FQR8e9eN_ZDmV2q.webp 1920w, /_astro/662b8dfe0ea9cb14033250b5.FQR8e9eN_Z151ugH.webp 2560w" alt="Desktop background image of the blog" style="--fit: cover; --pos: center; object-position: 0% 20%" loading="lazy" fetchpriority="low" sizes="100vw" decoding="async" data-astro-image="constrained" width="3426" height="2428" class="w-full h-full object-cover"> </picture>   </div> </div><div class="banner-image-desktop absolute inset-0 hidden"> <div class="object-cover h-full overflow-hidden relative"> <div class="transition absolute inset-0 dark:bg-black/10 pointer-events-none"></div> <picture> <source srcset="/_astro/135867929.oaG4Op83_Z2k2UqF.webp 1280w, /_astro/135867929.oaG4Op83_2gVl2D.webp 1920w, /_astro/135867929.oaG4Op83_ZuDR79.webp 2560w" type="image/webp" sizes="100vw">  <img src="/_astro/135867929.oaG4Op83_10b8H8.webp" srcset="/_astro/135867929.oaG4Op83_Z2k2UqF.webp 1280w, /_astro/135867929.oaG4Op83_2gVl2D.webp 1920w, /_astro/135867929.oaG4Op83_ZuDR79.webp 2560w" alt="Desktop background image of the blog" style="--fit: cover; --pos: center; object-position: 0% 20%" loading="lazy" fetchpriority="low" sizes="100vw" decoding="async" data-astro-image="constrained" width="4608" height="2160" class="w-full h-full object-cover"> </picture>   </div> </div><div class="banner-image-desktop absolute inset-0 hidden"> <div class="object-cover h-full overflow-hidden relative"> <div class="transition absolute inset-0 dark:bg-black/10 pointer-events-none"></div> <picture> <source srcset="/_astro/6610c34568eb93571349895c.-xATqJ2J_JqwnR.webp 1280w, /_astro/6610c34568eb93571349895c.-xATqJ2J_I7S7y.webp 1920w, /_astro/6610c34568eb93571349895c.-xATqJ2J_asPDJ.webp 2560w" type="image/webp" sizes="100vw">  <img src="/_astro/6610c34568eb93571349895c.-xATqJ2J_Z2f75Yb.webp" srcset="/_astro/6610c34568eb93571349895c.-xATqJ2J_JqwnR.webp 1280w, /_astro/6610c34568eb93571349895c.-xATqJ2J_I7S7y.webp 1920w, /_astro/6610c34568eb93571349895c.-xATqJ2J_asPDJ.webp 2560w" alt="Desktop background image of the blog" style="--fit: cover; --pos: center; object-position: 0% 20%" loading="lazy" fetchpriority="low" sizes="100vw" decoding="async" data-astro-image="constrained" width="2898" height="1992" class="w-full h-full object-cover"> </picture>   </div> </div><div class="banner-image-desktop absolute inset-0 hidden"> <div class="object-cover h-full overflow-hidden relative"> <div class="transition absolute inset-0 dark:bg-black/10 pointer-events-none"></div> <picture> <source srcset="/_astro/137681021.Lf_01jzj_Z2mMTMa.webp 1280w, /_astro/137681021.Lf_01jzj_Z6MXDX.webp 1920w, /_astro/137681021.Lf_01jzj_Z2jQ4S5.webp 2560w" type="image/webp" sizes="100vw">  <img src="/_astro/137681021.Lf_01jzj_Z1Gd8mJ.webp" srcset="/_astro/137681021.Lf_01jzj_Z2mMTMa.webp 1280w, /_astro/137681021.Lf_01jzj_Z6MXDX.webp 1920w, /_astro/137681021.Lf_01jzj_Z2jQ4S5.webp 2560w" alt="Desktop background image of the blog" style="--fit: cover; --pos: center; object-position: 0% 20%" loading="lazy" fetchpriority="low" sizes="100vw" decoding="async" data-astro-image="constrained" width="4141" height="1787" class="w-full h-full object-cover"> </picture>   </div> </div><div class="banner-image-desktop absolute inset-0 hidden"> <div class="object-cover h-full overflow-hidden relative"> <div class="transition absolute inset-0 dark:bg-black/10 pointer-events-none"></div> <picture> <source srcset="/_astro/669f4b7cd9c307b7e9b63430.BCd2WPoA_Z1rN3w4.webp 1280w, /_astro/669f4b7cd9c307b7e9b63430.BCd2WPoA_Z1S1saB.webp 1920w, /_astro/669f4b7cd9c307b7e9b63430.BCd2WPoA_Z1Sr0oW.webp 2560w" type="image/webp" sizes="100vw">  <img src="/_astro/669f4b7cd9c307b7e9b63430.BCd2WPoA_Z16Q1Em.webp" srcset="/_astro/669f4b7cd9c307b7e9b63430.BCd2WPoA_Z1rN3w4.webp 1280w, /_astro/669f4b7cd9c307b7e9b63430.BCd2WPoA_Z1S1saB.webp 1920w, /_astro/669f4b7cd9c307b7e9b63430.BCd2WPoA_Z1Sr0oW.webp 2560w" alt="Desktop background image of the blog" style="--fit: cover; --pos: center; object-position: 0% 20%" loading="lazy" fetchpriority="low" sizes="100vw" decoding="async" data-astro-image="constrained" width="5120" height="2880" class="w-full h-full object-cover"> </picture>   </div> </div><div class="banner-image-desktop absolute inset-0 hidden"> <div class="object-cover h-full overflow-hidden relative"> <div class="transition absolute inset-0 dark:bg-black/10 pointer-events-none"></div> <picture> <source srcset="/_astro/66698e02d9c307b7e9ff3241.BlvPQpZO_W3273.webp 1280w, /_astro/66698e02d9c307b7e9ff3241.BlvPQpZO_vOCsv.webp 1920w, /_astro/66698e02d9c307b7e9ff3241.BlvPQpZO_vp5ea.webp 2560w" type="image/webp" sizes="100vw">  <img src="/_astro/66698e02d9c307b7e9ff3241.BlvPQpZO_vp5ea.webp" srcset="/_astro/66698e02d9c307b7e9ff3241.BlvPQpZO_W3273.webp 1280w, /_astro/66698e02d9c307b7e9ff3241.BlvPQpZO_vOCsv.webp 1920w, /_astro/66698e02d9c307b7e9ff3241.BlvPQpZO_vp5ea.webp 2560w" alt="Desktop background image of the blog" style="--fit: cover; --pos: center; object-position: 0% 20%" loading="lazy" fetchpriority="low" sizes="100vw" decoding="async" data-astro-image="constrained" width="2560" height="1440" class="w-full h-full object-cover"> </picture>   </div> </div><div class="banner-image-desktop absolute inset-0 hidden"> <div class="object-cover h-full overflow-hidden relative"> <div class="transition absolute inset-0 dark:bg-black/10 pointer-events-none"></div> <picture> <source srcset="/_astro/130271925.DJxdbeKa_ZAYDx8.webp 1280w, /_astro/130271925.DJxdbeKa_2jMYp7.webp 1920w, /_astro/130271925.DJxdbeKa_Z2sNHiA.webp 2560w" type="image/webp" sizes="100vw">  <img src="/_astro/130271925.DJxdbeKa_ZXYGl7.webp" srcset="/_astro/130271925.DJxdbeKa_ZAYDx8.webp 1280w, /_astro/130271925.DJxdbeKa_2jMYp7.webp 1920w, /_astro/130271925.DJxdbeKa_Z2sNHiA.webp 2560w" alt="Desktop background image of the blog" style="--fit: cover; --pos: center; object-position: 0% 20%" loading="lazy" fetchpriority="low" sizes="100vw" decoding="async" data-astro-image="constrained" width="9686" height="5449" class="w-full h-full object-cover"> </picture>   </div> </div><div class="banner-image-desktop absolute inset-0 hidden"> <div class="object-cover h-full overflow-hidden relative"> <div class="transition absolute inset-0 dark:bg-black/10 pointer-events-none"></div> <picture> <source srcset="/_astro/102017273_p0.Db0qlAN3_1LvDcd.webp 1280w, /_astro/102017273_p0.Db0qlAN3_ZfHkbD.webp 1920w, /_astro/102017273_p0.Db0qlAN3_Zm4eSX.webp 2560w" type="image/webp" sizes="100vw">  <img src="/_astro/102017273_p0.Db0qlAN3_222BPL.webp" srcset="/_astro/102017273_p0.Db0qlAN3_1LvDcd.webp 1280w, /_astro/102017273_p0.Db0qlAN3_ZfHkbD.webp 1920w, /_astro/102017273_p0.Db0qlAN3_Zm4eSX.webp 2560w" alt="Desktop background image of the blog" style="--fit: cover; --pos: center; object-position: 0% 20%" loading="lazy" fetchpriority="low" sizes="100vw" decoding="async" data-astro-image="constrained" width="3840" height="2160" class="w-full h-full object-cover"> </picture>   </div> </div><div class="banner-image-desktop absolute inset-0 hidden"> <div class="object-cover h-full overflow-hidden relative"> <div class="transition absolute inset-0 dark:bg-black/10 pointer-events-none"></div> <picture> <source srcset="/_astro/138016349.DAceg95__2feV3U.webp 1280w, /_astro/138016349.DAceg95__2r6Ek7.webp 1920w, /_astro/138016349.DAceg95__Z8TMbF.webp 2560w" type="image/webp" sizes="100vw">  <img src="/_astro/138016349.DAceg95__1yQdAS.webp" srcset="/_astro/138016349.DAceg95__2feV3U.webp 1280w, /_astro/138016349.DAceg95__2r6Ek7.webp 1920w, /_astro/138016349.DAceg95__Z8TMbF.webp 2560w" alt="Desktop background image of the blog" style="--fit: cover; --pos: center; object-position: 0% 20%" loading="lazy" fetchpriority="low" sizes="100vw" decoding="async" data-astro-image="constrained" width="3453" height="2138" class="w-full h-full object-cover"> </picture>   </div> </div><div class="banner-image-desktop absolute inset-0 hidden"> <div class="object-cover h-full overflow-hidden relative"> <div class="transition absolute inset-0 dark:bg-black/10 pointer-events-none"></div> <picture> <source srcset="/_astro/680c289739d6b.YO0wZ-Ir_24vD2U.webp 1280w, /_astro/680c289739d6b.YO0wZ-Ir_AH1Lo.webp 1920w, /_astro/680c289739d6b.YO0wZ-Ir_ZTd9fg.webp 2560w" type="image/webp" sizes="100vw">  <img src="/_astro/680c289739d6b.YO0wZ-Ir_iHzrp.webp" srcset="/_astro/680c289739d6b.YO0wZ-Ir_24vD2U.webp 1280w, /_astro/680c289739d6b.YO0wZ-Ir_AH1Lo.webp 1920w, /_astro/680c289739d6b.YO0wZ-Ir_ZTd9fg.webp 2560w" alt="Desktop background image of the blog" style="--fit: cover; --pos: center; object-position: 0% 20%" loading="lazy" fetchpriority="low" sizes="100vw" decoding="async" data-astro-image="constrained" width="4864" height="3328" class="w-full h-full object-cover"> </picture>   </div> </div><div class="banner-image-desktop absolute inset-0 hidden"> <div class="object-cover h-full overflow-hidden relative"> <div class="transition absolute inset-0 dark:bg-black/10 pointer-events-none"></div> <picture> <source srcset="/_astro/662b8dfe0ea9cb140332519d.Ci7tJKCw_oOaoJ.webp 1280w, /_astro/662b8dfe0ea9cb140332519d.Ci7tJKCw_ZwKCIU.webp 1920w, /_astro/662b8dfe0ea9cb140332519d.Ci7tJKCw_vSBue.webp 2560w" type="image/webp" sizes="100vw">  <img src="/_astro/662b8dfe0ea9cb140332519d.Ci7tJKCw_d2tqH.webp" srcset="/_astro/662b8dfe0ea9cb140332519d.Ci7tJKCw_oOaoJ.webp 1280w, /_astro/662b8dfe0ea9cb140332519d.Ci7tJKCw_ZwKCIU.webp 1920w, /_astro/662b8dfe0ea9cb140332519d.Ci7tJKCw_vSBue.webp 2560w" alt="Desktop background image of the blog" style="--fit: cover; --pos: center; object-position: 0% 20%" loading="lazy" fetchpriority="low" sizes="100vw" decoding="async" data-astro-image="constrained" width="3424" height="2464" class="w-full h-full object-cover"> </picture>   </div> </div> </div> <!-- 客户端随机选择图片脚本 --> <script>
        (function randomizeBannerImage() {
            function selectRandomImage() {
                const container = document.getElementById('banner-images-container');
                if (!container) return;

                const mobileCount = parseInt(container.dataset.mobileCount || '0', 10);
                const desktopCount = parseInt(container.dataset.desktopCount || '0', 10);
                const isMobile = window.innerWidth < 1024;

                // 检查是否已经选择过（F5刷新会重置全局变量，Swup切换不会）
                if (typeof window.__bannerRandomIndex === 'undefined') {
                    window.__bannerRandomIndex = {
                        mobile: mobileCount > 1 ? Math.floor(Math.random() * mobileCount) : 0,
                        desktop: desktopCount > 1 ? Math.floor(Math.random() * desktopCount) : 0
                    };
                }

                const randomMobileIndex = window.__bannerRandomIndex.mobile;
                const randomDesktopIndex = window.__bannerRandomIndex.desktop;

                // 应用移动端图片选择
                if (mobileCount > 0) {
                    const mobileImages = container.querySelectorAll('.banner-image-mobile');
                    mobileImages.forEach((img, i) => {
                        if (i === randomMobileIndex) {
                            img.style.display = isMobile ? 'block' : 'none';
                        } else {
                            img.style.display = 'none';
                        }
                    });
                }

                // 应用桌面端图片选择
                if (desktopCount > 0) {
                    const desktopImages = container.querySelectorAll('.banner-image-desktop');
                    desktopImages.forEach((img, i) => {
                        if (i === randomDesktopIndex) {
                            img.style.display = isMobile ? 'none' : 'block';
                        } else {
                            img.style.display = 'none';
                        }
                    });
                }
            }

            // 立即执行
            selectRandomImage();
        })();
    </script> <!-- Home page text overlay - 始终渲染以便切换模式时控制显示 --> <div class="banner-text-overlay absolute inset-0 z-20 flex items-center justify-center hidden"> <div class="w-4/5 lg:w-3/4 text-center mb-0"> <div class="flex flex-col"> <h1 class="banner-title font-bold text-white mb-2 lg:mb-4 leading-tight" style="font-size:3.8rem"> JustPure<b><span style="color:#0080c0">H</span><sub style="color:#ff9800">2</sub><span style="color:#0080c0">O</span></b> </h1> <h2 id="banner-subtitle" class="banner-subtitle text-white/90 leading-snug" style="font-size:1.5rem" data-subtitles="[&#34;穷方圆平直之情，尽规矩准绳之用&#34;]"> 穷方圆平直之情，尽规矩准绳之用 </h2> </div> </div> </div> <script>
        function setRandomSubtitle() {
            const subtitleElement = document.getElementById('banner-subtitle');
            if (!subtitleElement) return;
            
            const subtitlesData = subtitleElement.dataset.subtitles;
            if (!subtitlesData) return;
            
            try {
                const subtitles = JSON.parse(subtitlesData);
                // Only randomize if it's an array and typewriter is NOT enabled (check for typewriter class)
                if (Array.isArray(subtitles) && subtitles.length > 0 && !subtitleElement.querySelector('.typewriter')) {
                    // Use a global variable to persist the subtitle across Swup navigations
                    // This variable will be reset on full page reload (F5), meeting the requirement
                    if (!window.fireflyCachedSubtitle) {
                        const randomIndex = Math.floor(Math.random() * subtitles.length);
                        window.fireflyCachedSubtitle = subtitles[randomIndex];
                    }
                    subtitleElement.textContent = window.fireflyCachedSubtitle;
                }
            } catch (e) {
                console.error("Failed to parse subtitles", e);
            }
        }

        // Run on initial load
        setRandomSubtitle();
    </script> <!-- Water waves effect - 如果允许切换或任一设备启用则渲染 -->  </div> <div class="absolute w-full z-30 pointer-events-none mobile-main-no-banner  " style="top: calc(35vh - 3.5rem)"> <!-- The pointer-events-none here prevent blocking the click event of the TOC --> <div class="relative max-w-(--page-width) mx-auto pointer-events-auto"> <div id="main-grid" class="transition duration-700 w-full left-0 right-0 grid grid-cols-1 md:grid-cols-[17.5rem_1fr] xl:grid-cols-[17.5rem_1fr_17.5rem] grid-rows-[auto_1fr_auto] lg:grid-rows-[auto] mx-auto gap-4 px-2 md:px-4 mobile-no-sidebar" data-sidebar-position="both" data-show-right-sidebar-on-post="true"> <!-- Background image credit - Desktop --> <a href="#" id="banner-credit-desktop" target="_self" rel aria-label="Visit image source" class="group onload-animation transition-all absolute justify-center items-center rounded-full px-3 right-4 -top-13 bg-black/60 hover:bg-black/70 h-9 hidden md:flex"> <svg width="1em" height="1em" class="text-white/75 text-[1.25rem] mr-1" data-icon="material-symbols:copyright-outline-rounded">   <symbol id="ai:material-symbols:copyright-outline-rounded" viewBox="0 0 24 24"><path fill="currentColor" d="M12 22q-2.075 0-3.9-.788t-3.175-2.137T2.788 15.9T2 12t.788-3.9t2.137-3.175T8.1 2.788T12 2t3.9.788t3.175 2.137T21.213 8.1T22 12t-.788 3.9t-2.137 3.175t-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12t-2.325-5.675T12 4T6.325 6.325T4 12t2.325 5.675T12 20m-2-4h4q.425 0 .713-.288T15 15v-1q0-.425-.288-.712T14 13t-.712.288T13 14h-2v-4h2q0 .425.288.713T14 11t.713-.288T15 10V9q0-.425-.288-.712T14 8h-4q-.425 0-.712.288T9 9v6q0 .425.288.713T10 16"/></symbol><use href="#ai:material-symbols:copyright-outline-rounded"></use>  </svg> <div class="text-white/75 text-xs">桌面端 Banners</div>  </a> <!-- Background image credit - Mobile --> <a href="#" id="banner-credit-mobile" target="_self" rel aria-label="Visit image source" class="group onload-animation transition-all absolute justify-center items-center rounded-full px-3 right-4 -top-13 bg-black/60 hover:bg-black/70 h-9 flex md:hidden"> <svg width="1em" height="1em" viewBox="0 0 24 24" class="text-white/75 text-[1.25rem] mr-1" data-icon="material-symbols:copyright-outline-rounded">   <use href="#ai:material-symbols:copyright-outline-rounded"></use>  </svg> <div class="text-white/75 text-xs">移动端 Banners</div>  </a>  <div id="left-sidebar-wrapper" class="contents" style="contain: layout style paint;"> <div id="left-sidebar" class="mb-4 hidden md:block md:col-span-1 md:max-w-70 md:row-start-1 md:row-end-2 md:col-start-1 onload-animation  flex flex-col w-full pt-0"><script type="module">class e extends HTMLElement{constructor(){if(super(),"true"!==this.dataset.isCollapsed)return;const e=this.dataset.id,t=this.querySelector(".expand-btn"),s=this.querySelector(`#${e}`);t.addEventListener("click",()=>{s.classList.remove("collapsed"),t.classList.add("hidden")})}}customElements.get("widget-layout")||customElements.define("widget-layout",e);</script><script type="module">window.closeAnnouncement=function(){const n=document.querySelector('widget-layout[data-id="announcement"]');n&&(n.style.display="none")};</script><div class="flex flex-col w-full gap-4 mb-4"><div class="card-base p-3"> <a aria-label="Go to About Page" href="/about/" class="group block relative mx-auto mt-1 lg:mx-0 lg:mt-0 mb-3
       max-w-48 lg:max-w-none overflow-hidden rounded-xl active:scale-95"> <div class="absolute transition pointer-events-none group-hover:bg-black/30 group-active:bg-black/50
        w-full h-full z-50 flex items-center justify-center"> <svg width="1em" height="1em" class="transition opacity-0 scale-90 group-hover:scale-100 group-hover:opacity-100 text-white text-5xl" data-icon="fa7-regular:address-card">   <symbol id="ai:fa7-regular:address-card" viewBox="0 0 640 640"><path fill="currentColor" d="M544 144c8.8 0 16 7.2 16 16v320c0 8.8-7.2 16-16 16H96c-8.8 0-16-7.2-16-16V160c0-8.8 7.2-16 16-16zM96 96c-35.3 0-64 28.7-64 64v320c0 35.3 28.7 64 64 64h448c35.3 0 64-28.7 64-64V160c0-35.3-28.7-64-64-64zm144 216c30.9 0 56-25.1 56-56s-25.1-56-56-56s-56 25.1-56 56s25.1 56 56 56m-32 40c-44.2 0-80 35.8-80 80c0 8.8 7.2 16 16 16h192c8.8 0 16-7.2 16-16c0-44.2-35.8-80-80-80zm200-144c-13.3 0-24 10.7-24 24s10.7 24 24 24h80c13.3 0 24-10.7 24-24s-10.7-24-24-24zm0 96c-13.3 0-24 10.7-24 24s10.7 24 24 24h80c13.3 0 24-10.7 24-24s-10.7-24-24-24z"/></symbol><use href="#ai:fa7-regular:address-card"></use>  </svg> </div> <div class="mx-auto lg:w-full h-full lg:mt-0 overflow-hidden relative"> <div class="transition absolute inset-0 dark:bg-black/10 pointer-events-none"></div> <picture> <source srcset="/_astro/avatar.CoDEkAKE_1xljaq.webp 350w" type="image/webp" sizes="350px">  <img src="/_astro/avatar.CoDEkAKE_17E0N3.webp" srcset="/_astro/avatar.CoDEkAKE_1xljaq.webp 350w" alt="Profile Image of the Author" style="--fit: cover; --pos: center; object-position: center" loading="eager" fetchpriority="high" sizes="350px" decoding="async" data-astro-image="constrained" width="940" height="940" class="w-full h-full object-cover"> </picture>   </div> </a> <div class="px-2"> <div class="font-bold text-xl text-center mb-1 dark:text-neutral-50 transition"> <span style="font-family:'Logo','system-ui';font-size:1.75rem;">JustPure<b><span style="color:#0080c0">H</span><sub style="color:#ff9800">2</sub><span style="color:#0080c0">O</span></b></span> </div> <div class="h-1 w-5 bg-(--primary) mx-auto rounded-full mb-2 transition"></div> <div class="text-center text-neutral-400 mb-2.5 transition"> 穷方圆平直之情，尽规矩准绳之用 </div> <div class="flex flex-wrap gap-2 justify-center mb-1"> <a rel="me" aria-label="GitHub" href="https://github.com/JustPureH2O" target="_blank" class="btn-regular rounded-lg h-10 w-10 active:scale-90"> <svg width="1em" height="1em" class="text-[1.5rem]" data-icon="fa7-brands:github">   <symbol id="ai:fa7-brands:github" viewBox="0 0 640 640"><path fill="currentColor" d="M237.9 461.4c0 2-2.3 3.6-5.2 3.6c-3.3.3-5.6-1.3-5.6-3.6c0-2 2.3-3.6 5.2-3.6c3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9c2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9c.3 2 2.9 3.3 5.9 2.6c2.9-.7 4.9-2.6 4.6-4.6c-.3-1.9-3-3.2-5.9-2.9M316.8 72C178.1 72 72 177.3 72 316c0 110.9 69.8 205.8 169.5 239.2c12.8 2.3 17.3-5.6 17.3-12.1c0-6.2-.3-40.4-.3-61.4c0 0-70 15-84.7-29.8c0 0-11.4-29.1-27.8-36.6c0 0-22.9-15.7 1.6-15.4c0 0 24.9 2 38.6 25.8c21.9 38.6 58.6 27.5 72.9 20.9c2.3-16 8.8-27.1 16-33.7c-55.9-6.2-112.3-14.3-112.3-110.5c0-27.5 7.6-41.3 23.6-58.9c-2.6-6.5-11.1-33.3 2.6-67.9c20.9-6.5 69 27 69 27c20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27c13.7 34.7 5.2 61.4 2.6 67.9c16 17.7 25.8 31.5 25.8 58.9c0 96.5-58.9 104.2-114.8 110.5c9.2 7.9 17 22.9 17 46.4c0 33.7-.3 75.4-.3 83.6c0 6.5 4.6 14.4 17.3 12.1C500.2 521.8 568 426.9 568 316c0-138.7-112.5-244-251.2-244M169.2 416.9c-1.3 1-1 3.3.7 5.2c1.6 1.6 3.9 2.3 5.2 1c1.3-1 1-3.3-.7-5.2c-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9c1.6 1 3.6.7 4.3-.7c.7-1.3-.3-2.9-2.3-3.9c-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2c2.3 2.3 5.2 2.6 6.5 1c1.3-1.3.7-4.3-1.3-6.2c-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2c-1.4-2.3-4-3.3-5.6-2"/></symbol><use href="#ai:fa7-brands:github"></use>  </svg>  </a><a rel="me" aria-label="Email" href="#" data-encoded-email="anVzdHB1cmVoMm9Ab3V0bG9vay5jb20=" onclick="(function() { const encodedEmail = this.getAttribute('data-encoded-email'); const decodedEmail = atob(encodedEmail); this.href = 'mailto:' + decodedEmail; this.removeAttribute('data-encoded-email'); this.removeAttribute('onclick'); this.click(); return false; }).call(this);" , class="btn-regular rounded-lg h-10 w-10 active:scale-90"> <svg width="1em" height="1em" class="text-[1.5rem]" data-icon="fa7-solid:envelope">   <symbol id="ai:fa7-solid:envelope" viewBox="0 0 640 640"><path fill="currentColor" d="M112 128c-26.5 0-48 21.5-48 48c0 15.1 7.1 29.3 19.2 38.4l208 156a48 48 0 0 0 57.6 0l208-156c12.1-9.1 19.2-23.3 19.2-38.4c0-26.5-21.5-48-48-48zM64 260v188c0 35.3 28.7 64 64 64h384c35.3 0 64-28.7 64-64V260L377.6 408.8c-34.1 25.6-81.1 25.6-115.2 0z"/></symbol><use href="#ai:fa7-solid:envelope"></use>  </svg>  </a><a rel="me" aria-label="RSS" href="/rss/" target="_blank" class="btn-regular rounded-lg h-10 w-10 active:scale-90"> <svg width="1em" height="1em" class="text-[1.5rem]" data-icon="fa7-solid:rss">   <symbol id="ai:fa7-solid:rss" viewBox="0 0 640 640"><path fill="currentColor" d="M96 128c0-17.7 14.3-32 32-32c229.8 0 416 186.2 416 416c0 17.7-14.3 32-32 32s-32-14.3-32-32c0-194.4-157.6-352-352-352c-17.7 0-32-14.3-32-32m0 352c0-35.3 28.7-64 64-64s64 28.7 64 64s-28.7 64-64 64s-64-28.7-64-64m32-256c159.1 0 288 128.9 288 288c0 17.7-14.3 32-32 32s-32-14.3-32-32c0-123.7-100.3-224-224-224c-17.7 0-32-14.3-32-32s14.3-32 32-32"/></symbol><use href="#ai:fa7-solid:rss"></use>  </svg>  </a>  </div> </div> </div><!-- 组件显示现在由sidebarLayoutConfig统一控制，无需检查config.enable --><widget-layout data-id="announcement" data-is-collapsed="undefined" class="pb-4 card-base onload-animation" style="animation-delay: 50ms; " data-astro-cid-wbzkcah3="true"> <div class="widget-title font-bold transition text-lg text-neutral-900 dark:text-neutral-100 relative ml-8 mt-4 mb-2
            before:w-1 before:h-4 before:rounded-md before:bg-(--primary)
            before:absolute before:left-[-16px] before:top-[5.5px] flex items-center justify-between" data-astro-cid-wbzkcah3 style=""> <span class="widget-name" data-astro-cid-wbzkcah3 style="">公告</span>  </div> <div id="announcement" class="collapse-wrapper px-4 overflow-hidden" data-astro-cid-wbzkcah3 style="">  <div> <!-- 公告栏内容 --> <div class="text-neutral-600 dark:text-neutral-300 leading-relaxed mb-3"> JustPureH2O 的博客现已正式迁移至 Astro！原 Hexo 网站将移至 https://hexo.justpureh2o.cn/ </div> <!-- 可选链接和关闭按钮 --> <div class="flex items-center justify-between gap-3"> <div>  </div> <button class="btn-regular rounded-lg h-8 w-8 text-sm hover:bg-red-100 dark:hover:bg-red-900/30 transition-colors" onclick="closeAnnouncement()" aria-label="关闭"> <svg width="1em" height="1em" class="text-sm" data-icon="fa7-solid:xmark">   <symbol id="ai:fa7-solid:xmark" viewBox="0 0 640 640"><path fill="currentColor" d="M183.1 137.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L275.2 320L137.9 457.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0l137.3-137.4l137.4 137.3c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L365.8 320l137.3-137.4c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L320.5 274.7z"/></symbol><use href="#ai:fa7-solid:xmark"></use>  </svg> </button> </div> </div>  </div>  </widget-layout>   </div><div id="left-sidebar-sticky" class="transition-all duration-700 flex flex-col w-full mt-0 sticky top-4 gap-4"><widget-layout data-id="music-widget-atsuity-layout" data-is-collapsed="undefined" class="pb-4 card-base onload-animation" style="animation-delay: 100ms; " data-astro-cid-wbzkcah3="true"> <div class="widget-title font-bold transition text-lg text-neutral-900 dark:text-neutral-100 relative ml-8 mt-4 mb-2
            before:w-1 before:h-4 before:rounded-md before:bg-(--primary)
            before:absolute before:left-[-16px] before:top-[5.5px] flex items-center justify-between" data-astro-cid-wbzkcah3 style=""> <span class="widget-name" data-astro-cid-wbzkcah3 style="">音乐</span>  </div> <div id="music-widget-atsuity-layout" class="collapse-wrapper px-4 overflow-hidden" data-astro-cid-wbzkcah3 style="">  <div id="music-widget-atsuity" class="music-player-widget w-full relative transition-all duration-300" role="region" aria-label="音乐" data-astro-cid-reypjcyh> <!-- Top Row: Cover & Info --> <div class="flex items-center gap-2 mb-2 px-1" data-astro-cid-reypjcyh> <!-- Circular Cover --> <div class="relative shrink-0 w-14 h-14 group" data-astro-cid-reypjcyh> <div class="w-full h-full rounded-full overflow-hidden shadow-lg border-2 border-white dark:border-neutral-700 relative z-10 bg-[var(--primary)]/10 flex items-center justify-center" data-astro-cid-reypjcyh> <svg width="1em" height="1em" class="text-2xl text-[var(--primary)] opacity-40 absolute" aria-hidden="true" data-astro-cid-reypjcyh="true" data-icon="material-symbols:music-note-rounded">   <symbol id="ai:material-symbols:music-note-rounded" viewBox="0 0 24 24"><path fill="currentColor" d="M10 21q-1.65 0-2.825-1.175T6 17t1.175-2.825T10 13q.575 0 1.063.138t.937.412V4q0-.425.288-.712T13 3h4q.425 0 .713.288T18 4v2q0 .425-.288.713T17 7h-3v10q0 1.65-1.175 2.825T10 21"/></symbol><use href="#ai:material-symbols:music-note-rounded"></use>  </svg> <img class="music-cover w-full h-full object-cover animate-spin-slow relative z-10 opacity-0 transition-opacity duration-300" src="" alt="封面" style="animation-play-state: paused;" data-astro-cid-reypjcyh> </div> </div> <!-- Info Section --> <div class="flex-1 min-w-0 flex flex-col overflow-hidden" data-astro-cid-reypjcyh> <div class="flex items-center justify-between overflow-hidden gap-2" data-astro-cid-reypjcyh> <div class="flex-1 min-w-0 overflow-hidden relative" data-astro-cid-reypjcyh> <h3 class="music-title font-bold text-base text-neutral-800 dark:text-neutral-100 leading-tight truncate" data-astro-cid-reypjcyh> 音乐 </h3> </div> <!-- Top Right: Lyric Toggle --> <button class="btn-lrc-toggle hover:text-[var(--primary)] transition-all duration-300 p-0.5 pr-2 transform active:scale-95 text-neutral-400 shrink-0 " title="歌词" aria-label="歌词" data-astro-cid-reypjcyh> <svg width="1em" height="1em" class="icon-lrc-off text-xl" aria-hidden="true" data-astro-cid-reypjcyh="true" data-icon="material-symbols:subtitles-off-outline-rounded">   <symbol id="ai:material-symbols:subtitles-off-outline-rounded" viewBox="0 0 24 24"><path fill="currentColor" d="M4 20q-.825 0-1.412-.587T2 18V6q0-.825.588-1.412T4 4l2 2H4v12h11.15l-2-2H7q-.425 0-.712-.288T6 15t.288-.712T7 14h4.15l-9.8-9.85q-.275-.275-.288-.687t.288-.713q.275-.275.7-.275t.7.275l18.5 18.5q.275.275.288.688t-.288.712q-.275.275-.7.275t-.7-.275L17.15 20zM22 6v10.75q0 .5-.312.75t-.688.25q-.425 0-.712-.3T20 16.725V6H9.275q-.5 0-.75-.312T8.275 5q0-.425.288-.712T9.275 4H20q.825 0 1.413.588T22 6m-5 6h-1.725q-.5 0-.75-.312t-.25-.688t.25-.687t.75-.313H17q.425 0 .713.288T18 11t-.288.713T17 12M7 12q-.425 0-.712-.288T6 11t.288-.712T7 10t.713.288T8 11t-.288.713T7 12"/></symbol><use href="#ai:material-symbols:subtitles-off-outline-rounded"></use>  </svg> <svg width="1em" height="1em" class="icon-lrc-on text-xl hidden" aria-hidden="true" data-astro-cid-reypjcyh="true" data-icon="material-symbols:subtitles-outline-rounded">   <symbol id="ai:material-symbols:subtitles-outline-rounded" viewBox="0 0 24 24"><path fill="currentColor" d="M4 20q-.825 0-1.412-.587T2 18V6q0-.825.588-1.412T4 4h16q.825 0 1.413.588T22 6v12q0 .825-.587 1.413T20 20zm0-2h16V6H4zm0 0V6zm3-2h6q.425 0 .713-.288T14 15t-.288-.712T13 14H7q-.425 0-.712.288T6 15t.288.713T7 16m4-4h6q.425 0 .713-.288T18 11t-.288-.712T17 10h-6q-.425 0-.712.288T10 11t.288.713T11 12m-4 0q.425 0 .713-.288T8 11t-.288-.712T7 10t-.712.288T6 11t.288.713T7 12m10 4q.425 0 .713-.288T18 15t-.288-.712T17 14t-.712.288T16 15t.288.713T17 16"/></symbol><use href="#ai:material-symbols:subtitles-outline-rounded"></use>  </svg> </button> </div> <div class="min-w-0 overflow-hidden" data-astro-cid-reypjcyh> <p class="music-artist text-xs font-medium text-neutral-500 dark:text-neutral-400 truncate" data-astro-cid-reypjcyh> 暂未播放 </p> </div> <!-- Time Display & Volume --> <div class="flex items-center gap-3 text-neutral-400 h-5" data-astro-cid-reypjcyh> <div class="text-[10px] font-mono flex items-center gap-1 shrink-0 h-full" aria-live="polite" data-astro-cid-reypjcyh> <span class="current-time" data-astro-cid-reypjcyh>0:00</span> <span class="opacity-50" aria-hidden="true" data-astro-cid-reypjcyh>/</span> <span class="total-time" data-astro-cid-reypjcyh>0:00</span> </div> <!-- Volume (Always visible) --> <div class="flex items-center gap-1 bg-transparent h-full" data-astro-cid-reypjcyh> <button class="btn-mute hover:text-[var(--primary)] transition-colors p-0.5 rounded-md flex items-center" title="音量" aria-label="音量" data-astro-cid-reypjcyh> <svg width="1em" height="1em" class=" icon-vol-high text-lg" aria-hidden="true" data-astro-cid-reypjcyh="true" data-icon="material-symbols:volume-up-rounded">   <symbol id="ai:material-symbols:volume-up-rounded" viewBox="0 0 24 24"><path fill="currentColor" d="M19 11.975q0-2.075-1.1-3.787t-2.95-2.563q-.375-.175-.55-.537t-.05-.738q.15-.4.538-.575t.787 0Q18.1 4.85 19.55 7.063T21 11.974t-1.45 4.913t-3.875 3.287q-.4.175-.788 0t-.537-.575q-.125-.375.05-.737t.55-.538q1.85-.85 2.95-2.562t1.1-3.788M7 15H4q-.425 0-.712-.288T3 14v-4q0-.425.288-.712T4 9h3l3.3-3.3q.475-.475 1.088-.213t.612.938v11.15q0 .675-.612.938T10.3 18.3zm9.5-3q0 1.05-.475 1.988t-1.25 1.537q-.25.15-.513.013T14 15.1V8.85q0-.3.263-.437t.512.012q.775.625 1.25 1.575t.475 2"/></symbol><use href="#ai:material-symbols:volume-up-rounded"></use>  </svg> <svg width="1em" height="1em" class="icon-vol-mute text-lg hidden" aria-hidden="true" data-astro-cid-reypjcyh="true" data-icon="material-symbols:volume-off-rounded">   <symbol id="ai:material-symbols:volume-off-rounded" viewBox="0 0 24 24"><path fill="currentColor" d="M16.775 19.575q-.275.175-.55.325t-.575.275q-.375.175-.762 0t-.538-.575q-.15-.375.038-.737t.562-.538q.1-.05.188-.1t.187-.1L12 14.8v2.775q0 .675-.612.938T10.3 18.3L7 15H4q-.425 0-.712-.288T3 14v-4q0-.425.288-.712T4 9h2.2L2.1 4.9q-.275-.275-.275-.7t.275-.7t.7-.275t.7.275l17 17q.275.275.275.7t-.275.7t-.7.275t-.7-.275zm2.225-7.6q0-2.075-1.1-3.787t-2.95-2.563q-.375-.175-.55-.537t-.05-.738q.15-.4.538-.575t.787 0Q18.1 4.85 19.55 7.05T21 11.975q0 .825-.15 1.638t-.425 1.562q-.2.55-.612.688t-.763.012t-.562-.45t-.013-.75q.275-.65.4-1.312T19 11.975m-4.225-3.55Q15.6 8.95 16.05 10t.45 2v.25q0 .125-.025.25q-.05.325-.35.425t-.55-.15L14.3 11.5q-.15-.15-.225-.337T14 10.775V8.85q0-.3.263-.437t.512.012M9.75 6.95Q9.6 6.8 9.6 6.6t.15-.35l.55-.55q.475-.475 1.087-.213t.613.938V8q0 .35-.3.475t-.55-.125z"/></symbol><use href="#ai:material-symbols:volume-off-rounded"></use>  </svg> </button> <div class="w-16 transition-all duration-300 ease-out flex items-center" data-astro-cid-reypjcyh> <div class="vol-container h-1 w-16 bg-neutral-200 dark:bg-neutral-600 rounded-full cursor-pointer relative ml-1" role="slider" aria-label="音量" aria-valuemin="0" aria-valuemax="100" aria-valuenow="70" data-astro-cid-reypjcyh> <div class="vol-bar absolute left-0 top-0 h-full bg-[var(--primary)] rounded-full w-[70%]" data-astro-cid-reypjcyh></div> </div> </div> </div> </div> </div> </div> <!-- Progress Bar (Slim) --> <div class="progress-container relative w-full h-1 bg-neutral-100 dark:bg-neutral-700/50 rounded-full cursor-pointer touch-none mb-2 group mt-2" role="slider" aria-label="播放进度" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0" data-astro-cid-reypjcyh> <div class="progress-bar absolute left-0 top-0 h-full bg-[var(--primary)] rounded-full w-0 transition-[width] duration-100" data-astro-cid-reypjcyh></div> <!-- Hover Thumb --> <div class="progress-thumb absolute top-1/2 -mt-1.5 -ml-1.5 w-3 h-3 bg-[var(--primary)] ring-2 ring-white dark:ring-neutral-800 rounded-full shadow-sm scale-0 group-hover:scale-100 transition-transform duration-200" data-astro-cid-reypjcyh></div> </div> <!-- Controls Row --> <div class="flex items-center justify-between px-1 select-none" data-astro-cid-reypjcyh> <!-- Repeat Mode --> <button class="btn-repeat text-neutral-300 dark:text-neutral-600 hover:text-[var(--primary)] transition-colors p-2 active:scale-95" title="切换播放模式" aria-label="切换播放模式" data-astro-cid-reypjcyh> <svg width="1em" height="1em" class="icon-repeat text-xl" aria-hidden="true" data-astro-cid-reypjcyh="true" data-icon="material-symbols:repeat-rounded">   <symbol id="ai:material-symbols:repeat-rounded" viewBox="0 0 24 24"><path fill="currentColor" d="m6.85 19l.85.85q.3.3.288.7t-.288.7q-.3.3-.712.313t-.713-.288L3.7 18.7q-.15-.15-.213-.325T3.426 18t.063-.375t.212-.325l2.575-2.575q.3-.3.713-.287t.712.312q.275.3.288.7t-.288.7l-.85.85H17v-3q0-.425.288-.712T18 13t.713.288T19 14v3q0 .825-.587 1.413T17 19zm10.3-12H7v3q0 .425-.288.713T6 11t-.712-.288T5 10V7q0-.825.588-1.412T7 5h10.15l-.85-.85q-.3-.3-.288-.7t.288-.7q.3-.3.712-.312t.713.287L20.3 5.3q.15.15.213.325t.062.375t-.062.375t-.213.325l-2.575 2.575q-.3.3-.712.288T16.3 9.25q-.275-.3-.288-.7t.288-.7z"/></symbol><use href="#ai:material-symbols:repeat-rounded"></use>  </svg> <svg width="1em" height="1em" class="icon-repeat-one text-xl hidden" aria-hidden="true" data-astro-cid-reypjcyh="true" data-icon="material-symbols:repeat-one-rounded">   <symbol id="ai:material-symbols:repeat-one-rounded" viewBox="0 0 24 24"><path fill="currentColor" d="M11.5 10.5h-.75q-.325 0-.537-.213T10 9.75t.213-.537T10.75 9H12q.425 0 .713.288T13 10v4.25q0 .325-.213.538T12.25 15t-.537-.213t-.213-.537zM6.85 19l.85.85q.3.3.288.7t-.288.7q-.3.3-.712.313t-.713-.288L3.7 18.7q-.15-.15-.213-.325T3.426 18t.063-.375t.212-.325l2.575-2.575q.3-.3.713-.287t.712.312q.275.3.288.7t-.288.7l-.85.85H17v-3q0-.425.288-.712T18 13t.713.288T19 14v3q0 .825-.587 1.413T17 19zm10.3-12H7v3q0 .425-.288.713T6 11t-.712-.288T5 10V7q0-.825.588-1.412T7 5h10.15l-.85-.85q-.3-.3-.288-.7t.288-.7q.3-.3.712-.312t.713.287L20.3 5.3q.15.15.213.325t.062.375t-.062.375t-.213.325l-2.575 2.575q-.3.3-.712.288T16.3 9.25q-.275-.3-.288-.7t.288-.7z"/></symbol><use href="#ai:material-symbols:repeat-one-rounded"></use>  </svg> <svg width="1em" height="1em" class="icon-shuffle text-xl hidden" aria-hidden="true" data-astro-cid-reypjcyh="true" data-icon="material-symbols:shuffle-rounded">   <symbol id="ai:material-symbols:shuffle-rounded" viewBox="0 0 24 24"><path fill="currentColor" d="M15 20q-.425 0-.712-.288T14 19t.288-.712T15 18h1.6l-2.475-2.475q-.3-.3-.287-.712t.312-.713t.713-.3t.712.3L18 16.55V15q0-.425.288-.712T19 14t.713.288T20 15v4q0 .425-.288.713T19 20zm-10.7-.3q-.275-.275-.275-.7t.275-.7L16.6 6H15q-.425 0-.712-.288T14 5t.288-.712T15 4h4q.425 0 .713.288T20 5v4q0 .425-.288.713T19 10t-.712-.288T18 9V7.4L5.7 19.7q-.275.275-.7.275t-.7-.275m-.025-14Q4 5.425 4 5t.275-.7t.687-.275t.713.275l4.2 4.175q.275.275.288.688t-.288.712q-.275.275-.7.275t-.7-.275z"/></symbol><use href="#ai:material-symbols:shuffle-rounded"></use>  </svg> </button> <!-- Prev --> <button class="btn-prev text-neutral-600 dark:text-neutral-300 hover:text-[var(--primary)] transition-colors p-2 active:scale-95" title="上一首" aria-label="上一首" data-astro-cid-reypjcyh> <svg width="1em" height="1em" class="text-3xl" aria-hidden="true" data-astro-cid-reypjcyh="true" data-icon="material-symbols:skip-previous-rounded">   <symbol id="ai:material-symbols:skip-previous-rounded" viewBox="0 0 24 24"><path fill="currentColor" d="M5.5 17V7q0-.425.288-.712T6.5 6t.713.288T7.5 7v10q0 .425-.288.713T6.5 18t-.712-.288T5.5 17m11.45-.025l-6.2-4.15q-.225-.15-.337-.362T10.3 12t.113-.462t.337-.363l6.2-4.15q.125-.1.275-.125t.275-.025q.4 0 .7.275t.3.725v8.25q0 .45-.3.725t-.7.275q-.125 0-.275-.025t-.275-.125"/></symbol><use href="#ai:material-symbols:skip-previous-rounded"></use>  </svg> </button> <!-- Play/Pause (Feature) --> <button class="btn-play w-12 h-12 bg-[var(--btn-regular-bg)] hover:bg-[var(--btn-regular-bg-hover)] active:bg-[var(--btn-regular-bg-active)] text-[var(--primary)] rounded-full flex items-center justify-center transition-all duration-300" title="播放" aria-label="播放" data-astro-cid-reypjcyh> <svg width="1em" height="1em" class="icon-play text-3xl ml-0.5" aria-hidden="true" data-astro-cid-reypjcyh="true" data-icon="material-symbols:play-arrow-rounded">   <symbol id="ai:material-symbols:play-arrow-rounded" viewBox="0 0 24 24"><path fill="currentColor" d="M8 17.175V6.825q0-.425.3-.713t.7-.287q.125 0 .263.037t.262.113l8.15 5.175q.225.15.338.375t.112.475t-.112.475t-.338.375l-8.15 5.175q-.125.075-.262.113T9 18.175q-.4 0-.7-.288t-.3-.712"/></symbol><use href="#ai:material-symbols:play-arrow-rounded"></use>  </svg> <svg width="1em" height="1em" class="icon-pause text-3xl hidden" aria-hidden="true" data-astro-cid-reypjcyh="true" data-icon="material-symbols:pause-rounded">   <symbol id="ai:material-symbols:pause-rounded" viewBox="0 0 24 24"><path fill="currentColor" d="M16 19q-.825 0-1.412-.587T14 17V7q0-.825.588-1.412T16 5t1.413.588T18 7v10q0 .825-.587 1.413T16 19m-8 0q-.825 0-1.412-.587T6 17V7q0-.825.588-1.412T8 5t1.413.588T10 7v10q0 .825-.587 1.413T8 19"/></symbol><use href="#ai:material-symbols:pause-rounded"></use>  </svg> </button> <!-- Next --> <button class="btn-next text-neutral-600 dark:text-neutral-300 hover:text-[var(--primary)] transition-colors p-2 active:scale-95" title="下一首" aria-label="下一首" data-astro-cid-reypjcyh> <svg width="1em" height="1em" class="text-3xl" aria-hidden="true" data-astro-cid-reypjcyh="true" data-icon="material-symbols:skip-next-rounded">   <symbol id="ai:material-symbols:skip-next-rounded" viewBox="0 0 24 24"><path fill="currentColor" d="M16.5 17V7q0-.425.288-.712T17.5 6t.713.288T18.5 7v10q0 .425-.288.713T17.5 18t-.712-.288T16.5 17m-11-.875v-8.25q0-.45.3-.725t.7-.275q.125 0 .275.025t.275.125l6.2 4.15q.225.15.338.363T13.7 12t-.112.463t-.338.362l-6.2 4.15q-.125.1-.275.125t-.275.025q-.4 0-.7-.275t-.3-.725"/></symbol><use href="#ai:material-symbols:skip-next-rounded"></use>  </svg> </button> <!-- Playlist Toggle Arrow --> <button class="btn-drawer-toggle text-neutral-400 hover:text-[var(--primary)] transition-all duration-300 p-2 transform active:scale-95" title="列表" aria-label="列表" data-astro-cid-reypjcyh> <svg width="1em" height="1em" class="text-xl" aria-hidden="true" data-astro-cid-reypjcyh="true" data-icon="mdi:playlist-music">   <symbol id="ai:mdi:playlist-music" viewBox="0 0 24 24"><path fill="currentColor" d="M15 6H3v2h12zm0 4H3v2h12zM3 16h8v-2H3zM17 6v8.18c-.31-.11-.65-.18-1-.18a3 3 0 0 0-3 3a3 3 0 0 0 3 3a3 3 0 0 0 3-3V8h3V6z"/></symbol><use href="#ai:mdi:playlist-music"></use>  </svg> </button> </div> <!-- Lyrics Drawer --> <div class="lrc-drawer grid transition-all duration-300 ease-[cubic-bezier(0.4,0,0.2,1)] grid-rows-[0fr] opacity-0" data-astro-cid-reypjcyh> <div class="overflow-hidden min-h-0" data-astro-cid-reypjcyh> <div class="mt-2 pt-2 border-t border-neutral-100 dark:border-white/5 mx-1" data-astro-cid-reypjcyh> <div class="lrc-container h-48 overflow-y-auto custom-scrollbar flex flex-col items-center gap-2 p-4 py-24 text-center relative scroll-smooth" role="listbox" aria-label="歌词" data-astro-cid-reypjcyh> <div class="text-neutral-400 text-sm py-10" role="option" data-astro-cid-reypjcyh>暂无歌词</div> </div> </div> </div> </div> <!-- Playlist Drawer (Accordion) --> <div class="playlist-drawer grid transition-all duration-300 ease-[cubic-bezier(0.4,0,0.2,1)] grid-rows-[0fr] opacity-0" data-astro-cid-reypjcyh> <div class="overflow-hidden min-h-0" data-astro-cid-reypjcyh> <div class="mt-2 pt-2 border-t border-neutral-100 dark:border-white/5 mx-1" data-astro-cid-reypjcyh> <div class="playlist-container max-h-48 overflow-y-auto custom-scrollbar pr-1 pb-1 flex flex-col gap-1" role="listbox" aria-label="列表" data-astro-cid-reypjcyh> <!-- Items --> </div> </div> </div> </div> <!-- Hidden Audio --> <audio class="audio-player hidden" crossorigin="anonymous" title="音频播放器" data-astro-cid-reypjcyh></audio> <!-- Loading Overlay --> <div class="music-loading absolute inset-0 z-20 flex flex-col items-center justify-center bg-white/60 dark:bg-[#1e1e1e]/60 backdrop-blur-[2px] transition-opacity duration-300 opacity-0 pointer-events-none rounded-xl" aria-busy="true" aria-hidden="true" data-astro-cid-reypjcyh> <div class="w-8 h-8 text-[var(--primary)] animate-spin" data-astro-cid-reypjcyh> <svg width="1em" height="1em" class="text-3xl" aria-hidden="true" data-astro-cid-reypjcyh="true" data-icon="material-symbols:sync-rounded">   <symbol id="ai:material-symbols:sync-rounded" viewBox="0 0 24 24"><path fill="currentColor" d="M6 12.05q0 1.125.425 2.188T7.75 16.2l.25.25V15q0-.425.288-.712T9 14t.713.288T10 15v4q0 .425-.288.713T9 20H5q-.425 0-.712-.288T4 19t.288-.712T5 18h1.75l-.4-.35q-1.3-1.15-1.825-2.625T4 12.05Q4 9.7 5.2 7.787T8.425 4.85q.35-.2.738-.025t.512.575q.125.375-.012.75t-.488.575q-1.45.8-2.312 2.213T6 12.05m12-.1q0-1.125-.425-2.187T16.25 7.8L16 7.55V9q0 .425-.288.713T15 10t-.712-.288T14 9V5q0-.425.288-.712T15 4h4q.425 0 .713.288T20 5t-.288.713T19 6h-1.75l.4.35q1.225 1.225 1.788 2.663T20 11.95q0 2.35-1.2 4.263t-3.225 2.937q-.35.2-.737.025t-.513-.575q-.125-.375.013-.75t.487-.575q1.45-.8 2.313-2.212T18 11.95"/></symbol><use href="#ai:material-symbols:sync-rounded"></use>  </svg> </div> </div> </div> <template id="playlist-item-template-music-widget-atsuity" data-astro-cid-reypjcyh> <div class="playlist-item flex items-center gap-3 p-2 rounded-lg cursor-pointer hover:bg-neutral-50 dark:hover:bg-white/5 transition-colors group" data-astro-cid-reypjcyh> <div class="w-8 h-8 rounded-md overflow-hidden shrink-0 relative bg-neutral-200 dark:bg-neutral-700" data-astro-cid-reypjcyh> <img src="" class="item-cover w-full h-full object-cover" loading="lazy" alt="" data-astro-cid-reypjcyh> <!-- Active Indicator overlay --> <div class="item-active-overlay absolute inset-0 bg-[var(--primary)]/20 hidden items-center justify-center" data-astro-cid-reypjcyh> <svg width="1em" height="1em" class="text-[var(--primary)] text-sm" data-astro-cid-reypjcyh="true" data-icon="material-symbols:graphic-eq-rounded">   <symbol id="ai:material-symbols:graphic-eq-rounded" viewBox="0 0 24 24"><path fill="currentColor" d="M7 17V7q0-.425.288-.712T8 6t.713.288T9 7v10q0 .425-.288.713T8 18t-.712-.288T7 17m4 4V3q0-.425.288-.712T12 2t.713.288T13 3v18q0 .425-.288.713T12 22t-.712-.288T11 21m-8-8v-2q0-.425.288-.712T4 10t.713.288T5 11v2q0 .425-.288.713T4 14t-.712-.288T3 13m12 4V7q0-.425.288-.712T16 6t.713.288T17 7v10q0 .425-.288.713T16 18t-.712-.288T15 17m4-4v-2q0-.425.288-.712T20 10t.713.288T21 11v2q0 .425-.288.713T20 14t-.712-.288T19 13"/></symbol><use href="#ai:material-symbols:graphic-eq-rounded"></use>  </svg> </div> </div> <div class="flex-1 min-w-0" data-astro-cid-reypjcyh> <div class="item-title text-xs font-bold text-neutral-700 dark:text-neutral-200 truncate group-hover:text-[var(--primary)] transition-colors" data-astro-cid-reypjcyh></div> <div class="item-artist text-[10px] text-neutral-400 truncate" data-astro-cid-reypjcyh></div> </div> </div> </template> <script>(function(){const playerConfigStr = "{\"mode\":\"meting\",\"meting\":{\"api\":\"https://api.i-meto.com/meting/api?server=:server&type=:type&id=:id&r=:r\",\"server\":\"netease\",\"type\":\"playlist\",\"id\":\"12830312100\",\"auth\":\"\",\"fallbackApis\":[\"https://api.injahow.cn/meting/?server=:server&type=:type&id=:id\",\"https://api.moeyao.cn/meting/?server=:server&type=:type&id=:id\"]},\"localPlaylist\":[],\"volume\":0.7,\"playMode\":\"list\",\"showLyrics\":true,\"i18n\":{\"noPlaying\":\"暂未播放\",\"lyrics\":\"歌词\",\"volume\":\"音量\",\"playMode\":\"切换播放模式\",\"prev\":\"上一首\",\"next\":\"下一首\",\"playlist\":\"列表\",\"noLyrics\":\"暂无歌词\",\"loadingLyrics\":\"正在加载歌词...\",\"failedLyrics\":\"歌词加载失败\",\"noSongs\":\"暂无歌曲\",\"error\":\"播放器错误\",\"play\":\"播放\",\"pause\":\"暂停\",\"progress\":\"播放进度\",\"noCover\":\"暂无封面\"}}";
const widgetId = "music-widget-atsuity";

(function () {
    const config = JSON.parse(playerConfigStr);
    const widget = document.getElementById(widgetId);
    
    // If widget not found (e.g. removed), stop
    if (!widget) return;

    const ui = {
        widget: widget,
        loading: widget.querySelector('.music-loading'),
        cover: widget.querySelector('.music-cover'),
        title: widget.querySelector('.music-title'),
        artist: widget.querySelector('.music-artist'),
        progressBar: widget.querySelector('.progress-bar'),
        progressThumb: widget.querySelector('.progress-thumb'),
        progressContainer: widget.querySelector('.progress-container'),
        currentTime: widget.querySelector('.current-time'),
        totalTime: widget.querySelector('.total-time'),
        btnPlay: widget.querySelector('.btn-play'),
        iconPlay: widget.querySelector('.icon-play'),
        iconPause: widget.querySelector('.icon-pause'),
        btnPrev: widget.querySelector('.btn-prev'),
        btnNext: widget.querySelector('.btn-next'),
        btnRepeat: widget.querySelector('.btn-repeat'),
        iconRepeat: widget.querySelector('.icon-repeat'),
        iconRepeatOne: widget.querySelector('.icon-repeat-one'),
        iconShuffle: widget.querySelector('.icon-shuffle'),
        btnMute: widget.querySelector('.btn-mute'),
        iconVolHigh: widget.querySelector('.icon-vol-high'),
        iconVolMute: widget.querySelector('.icon-vol-mute'),
        volContainer: widget.querySelector('.vol-container'),
        volBar: widget.querySelector('.vol-bar'),
        btnLrc: widget.querySelector('.btn-lrc-toggle'),
        iconLrcOn: widget.querySelector('.icon-lrc-on'),
        iconLrcOff: widget.querySelector('.icon-lrc-off'),
        lrcDrawer: widget.querySelector('.lrc-drawer'),
        lrcContainer: widget.querySelector('.lrc-container'),
        btnDrawer: widget.querySelector('.btn-drawer-toggle'),
        playlistDrawer: widget.querySelector('.playlist-drawer'),
        playlistContainer: widget.querySelector('.playlist-container'),
        audio: widget.querySelector('.audio-player'),
        itemTemplate: document.getElementById(`playlist-item-template-${widgetId}`)
    };

    // Verify all critical UI elements exist (may be null during Swup page transitions)
    const _critical = [ui.btnPlay, ui.audio, ui.btnRepeat, ui.btnMute, ui.volContainer,
        ui.btnDrawer, ui.btnLrc, ui.lrcDrawer, ui.lrcContainer,
        ui.progressContainer, ui.btnNext, ui.btnPrev, ui.loading,
        ui.cover, ui.title, ui.artist, ui.playlistContainer, ui.itemTemplate];
    if (_critical.some(function(el) { return !el; })) return;

    const state = {
        playlist: [],
        currentIndex: 0,
        isPlaying: false,
        isLoading: false,
        playMode: 0, // 0: List, 1: One, 2: Rand
        lastVolume: localStorage.getItem('music-player-volume') !== null 
            ? parseFloat(localStorage.getItem('music-player-volume')) 
            : (config.volume ?? 0.7),
        isMuted: false,
        lyrics: [], // Parsed lyrics: {time: seconds, text: string}
        currentLrcIndex: -1,
        isUserScrolling: false,
        scrollTimeout: null
    };

    // Initialize state from config
    if (config.playMode === 'random') {
            state.playMode = 2; // Rand
    } else if (config.playMode === 'one') {
            state.playMode = 1; // One
    } else {
            state.playMode = 0; // List (default)
    }

    // UI Helpers
    function setLoading(bool) {
        state.isLoading = bool;
        if (bool) {
            ui.loading.classList.remove('opacity-0', 'pointer-events-none');
        } else {
            ui.loading.classList.add('opacity-0', 'pointer-events-none');
        }
    }

    function formatTime(seconds) {
        if (!seconds || isNaN(seconds)) return "0:00";
        const min = Math.floor(seconds / 60);
        const sec = Math.floor(seconds % 60);
        return `${min}:${sec.toString().padStart(2, '0')}`;
    }

    function parseLRC(lrc) {
        if (!lrc) return [];
        const lines = lrc.split('\n');
        const result = [];
        const timeReg = /\[(\d{2}):(\d{2})\.(\d{2,3})\]/g;
        
        lines.forEach(line => {
            const matches = Array.from(line.matchAll(timeReg));
            if (matches.length > 0) {
                const text = line.replace(timeReg, '').trim();
                if (text) {
                    matches.forEach(match => {
                        const m = parseInt(match[1]);
                        const s = parseInt(match[2]);
                        const ms = parseInt(match[3]);
                        const time = m * 60 + s + ms / (match[3].length === 3 ? 1000 : 100);
                        result.push({ time, text });
                    });
                }
            }
        });
        return result.sort((a, b) => a.time - b.time);
    }

    function renderLyrics(lrcText) {
        state.lyrics = parseLRC(lrcText);
        ui.lrcContainer.innerHTML = '';
        
        if (state.lyrics.length === 0) {
            ui.lrcContainer.innerHTML = `<div class="text-neutral-400 text-sm py-10" role="option">${config.i18n.noLyrics}</div>`;
            return;
        }

        state.lyrics.forEach((line, index) => {
            const lineEl = document.createElement('div');
            lineEl.className = 'lrc-line transition-all duration-300 text-sm text-neutral-400 py-1 cursor-pointer hover:text-[var(--primary)]';
            lineEl.innerText = line.text;
            lineEl.dataset.index = index;
            lineEl.setAttribute('role', 'option');
            lineEl.setAttribute('aria-label', line.text);
            lineEl.onclick = () => {
                ui.audio.currentTime = line.time;
            };
            ui.lrcContainer.appendChild(lineEl);
        });
    }

    function updateLyricSync(currentTime, forceScroll = false) {
        if (!state.lyrics || state.lyrics.length === 0) return;

        let index = -1;
        for (let i = 0; i < state.lyrics.length; i++) {
            if (currentTime >= state.lyrics[i].time) {
                index = i;
            } else {
                break;
            }
        }

        // Always update UI classes when index changes
        if (index !== state.currentLrcIndex) {
                const lines = ui.lrcContainer.querySelectorAll('.lrc-line');
                lines.forEach((line, i) => {
                    if (i === index) {
                        line.classList.add('text-[var(--primary)]', 'font-bold', 'text-base');
                        line.classList.remove('text-neutral-400', 'text-sm');
                    } else {
                        line.classList.remove('text-[var(--primary)]', 'font-bold', 'text-base');
                        line.classList.add('text-neutral-400', 'text-sm');
                    }
                });
                state.currentLrcIndex = index;
        }

        // Handle scrolling separately so it can be forced even if index hasn't changed
        if (index !== -1 && (!state.isUserScrolling || forceScroll)) {
            const line = ui.lrcContainer.querySelector(`.lrc-line[data-index="${index}"]`);
            if (line) {
                const containerHeight = ui.lrcContainer.clientHeight;
                // Use line.offsetTop relative to its offsetParent (the container with relative)
                const lineOffset = line.offsetTop;
                const lineHeight = line.offsetHeight;
                
                const targetScroll = lineOffset - (containerHeight / 2) + (lineHeight / 2);
                
                ui.lrcContainer.scrollTo({
                    top: targetScroll,
                    behavior: forceScroll ? 'auto' : 'smooth'
                });
            }
        }
    }

    // Core Init
    async function init() {
        setLoading(true);
        try {
            if (config.mode === 'meting' && config.meting) {
                await fetchMetingData();
            } else if (config.mode === 'local') {
                state.playlist = config.localPlaylist || [];
            }

            if (state.playlist.length > 0) {
                renderPlaylist();
                // If random mode is initial setting, shuffle start
                let startIndex = 0;
                if (state.playMode === 2) {
                    startIndex = Math.floor(Math.random() * state.playlist.length);
                }
                
                loadTrack(startIndex, false);
                initVolume();
                updateModeUI(); // Reflect initial mode in UI
            } else {
                ui.title.innerText = config.i18n.noSongs;
            }
        } catch (e) {
            console.error("Music Init Error", e);
            ui.title.innerText = config.i18n.error;
        } finally {
            setLoading(false);
        }
    }

    async function fetchMetingData() {
        if (!config.meting) return;
        const { api, server, type, id, auth, fallbackApis } = config.meting;
        
        const apis = [api, ...(fallbackApis || [])];
        
        for (const baseApi of apis) {
            if (!baseApi) continue;
            try {
                let fetchUrl = baseApi.replace(':server', server).replace(':type', type).replace(':id', id).replace(':r', Math.random());
                if (auth) fetchUrl += `&auth=${auth}`;

                const res = await fetch(fetchUrl);
                if (!res.ok) throw new Error(`HTTP error! status: ${res.status}`);
                const data = await res.json();
                
                if (Array.isArray(data) && data.length > 0) {
                    state.playlist = data.map(item => ({
                        name: item.title || item.name || 'Unknown',
                        artist: item.author || item.artist || 'Unknown',
                        url: item.url,
                        pic: item.pic || item.cover || '',
                        lrc: item.lrc
                    }));
                    return; // Found data, exit loop
                }
            } catch (e) {
                console.warn(`Meting API fetch failed for ${baseApi}`, e);
            }
        }
        throw new Error("All Meting APIs failed");
    }

    function renderPlaylist() {
        ui.playlistContainer.innerHTML = '';
        state.playlist.forEach((track, idx) => {
            const clone = ui.itemTemplate.content.cloneNode(true);
            const itemEl = clone.querySelector('.playlist-item');
            const img = clone.querySelector('.item-cover');
            const title = clone.querySelector('.item-title');
            const artist = clone.querySelector('.item-artist');
            
            img.src = track.pic || '';
            img.alt = `${track.name} - ${track.artist}`;
            title.innerText = track.name;
            artist.innerText = track.artist;
            
            // Active State logic handled in updatePlaylistUI
            itemEl.dataset.index = idx;
            itemEl.setAttribute('role', 'option');
            itemEl.setAttribute('aria-label', `${track.name} - ${track.artist}`);
            itemEl.onclick = () => {
                if (state.currentIndex === idx && !ui.audio.paused) {
                    togglePlay();
                } else {
                    loadTrack(idx, true);
                }
            };
            ui.playlistContainer.appendChild(clone);
        });
    }

    function loadTrack(index, autoPlay = false) {
        if (index < 0 || index >= state.playlist.length) return;
        state.currentIndex = index;
        const track = state.playlist[index];

        ui.title.innerText = track.name;
        ui.title.title = track.name;
        ui.artist.innerText = track.artist;
        ui.artist.title = track.artist;
        
        if (track.pic) {
            ui.cover.classList.add('opacity-0');
            ui.cover.src = track.pic;
            ui.cover.alt = `${track.name} - ${track.artist}`;
        } else {
            ui.cover.src = '';
            ui.cover.classList.add('opacity-0');
            ui.cover.alt = config.i18n.noCover;
        }
        
        ui.audio.src = track.url;
        
        // Reset cover rotation
        ui.cover.classList.remove('animate-spin-slow');
        void ui.cover.offsetWidth;
        ui.cover.classList.add('animate-spin-slow');
        ui.cover.style.animationPlayState = 'paused';
        
        // Reset Progress
        ui.progressBar.style.width = '0%';
        ui.progressContainer.setAttribute('aria-valuenow', '0');
        ui.currentTime.innerText = '0:00';
        ui.totalTime.innerText = '0:00';

        // Reset Lyrics
        state.lyrics = [];
        state.currentLrcIndex = -1;
        ui.lrcContainer.innerHTML = `<div class="text-neutral-400 text-sm py-10">${config.i18n.loadingLyrics}</div>`;
        
        if (track.lrc) {
            const isLrcUrl = /^(https?:)?\/\//.test(track.lrc)
                || track.lrc.startsWith('/')
                || /\.(lrc|txt)(\?|#|$)/i.test(track.lrc);

            if (isLrcUrl) {
                fetch(track.lrc)
                    .then(res => res.text())
                    .then(text => renderLyrics(text))
                    .catch(() => ui.lrcContainer.innerHTML = `<div class="text-neutral-400 text-sm py-10">${config.i18n.failedLyrics}</div>`);
            } else {
                renderLyrics(track.lrc);
            }
        } else {
            ui.lrcContainer.innerHTML = `<div class="text-neutral-400 text-sm py-10">${config.i18n.noLyrics}</div>`;
        }

        updatePlaylistUI();

        if (autoPlay) {
            ui.audio.play().then(() => {
                updatePlayState(true);
            }).catch(e => console.warn(e));
        } else {
            updatePlayState(false);
        }
    }

    function updatePlayState(isPlaying) {
        state.isPlaying = isPlaying;
        if (isPlaying) {
            ui.btnPlay.classList.add('bg-[var(--primary)]', 'text-white', 'hover:brightness-110');
            ui.btnPlay.classList.remove('bg-[var(--btn-regular-bg)]', 'hover:bg-[var(--btn-regular-bg-hover)]', 'active:bg-[var(--btn-regular-bg-active)]', 'text-[var(--primary)]');
            ui.iconPlay.classList.add('hidden');
            ui.iconPause.classList.remove('hidden');
            ui.cover.style.animationPlayState = 'running';
            ui.btnPlay.setAttribute('aria-label', config.i18n.pause);
            ui.btnPlay.title = config.i18n.pause;
        } else {
            ui.btnPlay.classList.remove('bg-[var(--primary)]', 'text-white', 'hover:brightness-110');
            ui.btnPlay.classList.add('bg-[var(--btn-regular-bg)]', 'hover:bg-[var(--btn-regular-bg-hover)]', 'active:bg-[var(--btn-regular-bg-active)]', 'text-[var(--primary)]');
            ui.iconPlay.classList.remove('hidden');
            ui.iconPause.classList.add('hidden');
            ui.cover.style.animationPlayState = 'paused';
            ui.btnPlay.setAttribute('aria-label', config.i18n.play);
            ui.btnPlay.title = config.i18n.play;
        }
    }

    function togglePlay() {
        if (ui.audio.paused) {
            ui.audio.play().then(() => updatePlayState(true));
        } else {
            ui.audio.pause();
            updatePlayState(false);
        }
    }

    function playNext(auto = false) {
        let nextIndex;
        if (state.playMode === 1 && auto) { 
            // Single Loop
            ui.audio.currentTime = 0;
            ui.audio.play(); 
            return;
        } else if (state.playMode === 2) { 
            // Random
            nextIndex = Math.floor(Math.random() * state.playlist.length);
        } else {
            // List Loop
            nextIndex = (state.currentIndex + 1) % state.playlist.length;
        }
        loadTrack(nextIndex, true);
    }

    function playPrev() {
        let prevIndex = (state.currentIndex - 1 + state.playlist.length) % state.playlist.length;
        if (state.playMode === 2) {
                prevIndex = Math.floor(Math.random() * state.playlist.length);
        }
        loadTrack(prevIndex, true);
    }

    function updatePlaylistUI() {
            const items = ui.playlistContainer.querySelectorAll('.playlist-item');
            items.forEach(el => {
                const idx = parseInt(el.dataset.index);
                const overlay = el.querySelector('.item-active-overlay');
                const title = el.querySelector('.item-title');
                if (idx === state.currentIndex) {
                    el.classList.add('bg-neutral-100', 'dark:bg-white/10');
                    el.setAttribute('aria-current', 'true');
                    overlay.classList.remove('hidden');
                    overlay.classList.add('flex');
                    title.classList.add('text-[var(--primary)]');
                } else {
                    el.classList.remove('bg-neutral-100', 'dark:bg-white/10');
                    el.removeAttribute('aria-current');
                    overlay.classList.add('hidden');
                    overlay.classList.remove('flex');
                    title.classList.remove('text-[var(--primary)]');
                }
            });
    }

    // Mode Logic
    // Mode 0: List (Def), Mode 1: One, Mode 2: Rand
    // Button Repeat: Cycle 0 -> 1 -> 2 -> 0
    
    function updateModeUI() {
        const primaryColor = 'text-[var(--primary)]';

        // Always primary color if we want to indicate it's interactable, or conditionally
        // Usually Loop List is 'inactive' (grey) or 'active' (primary). 
        // Let's make: List=Grey (default), One=Primary, Rand=Primary
        
        if (state.playMode === 0) {
                ui.btnRepeat.className = `p-2 active:scale-95 transition-colors text-neutral-300 dark:text-neutral-600 hover:text-[var(--primary)]`;
                ui.iconRepeat.classList.remove('hidden');
                ui.iconRepeatOne.classList.add('hidden');
                ui.iconShuffle.classList.add('hidden');
        } else if (state.playMode === 1) {
                ui.btnRepeat.className = `p-2 active:scale-95 transition-colors ${primaryColor}`;
                ui.iconRepeat.classList.add('hidden');
                ui.iconRepeatOne.classList.remove('hidden');
                ui.iconShuffle.classList.add('hidden');
        } else {
                ui.btnRepeat.className = `p-2 active:scale-95 transition-colors ${primaryColor}`;
                ui.iconRepeat.classList.add('hidden');
                ui.iconRepeatOne.classList.add('hidden');
                ui.iconShuffle.classList.remove('hidden');
        }
    }

    ui.btnRepeat.addEventListener('click', () => {
            // Cycle: 0 -> 1 -> 2 -> 0
            state.playMode = (state.playMode + 1) % 3;
            updateModeUI();
    });

    // Volume Logic
    function initVolume() {
        ui.audio.volume = state.lastVolume;
        updateVolumeUI();
    }

    function updateVolumeUI() {
        const pct = state.isMuted ? 0 : state.lastVolume * 100;
        ui.volBar.style.width = `${pct}%`;
        ui.volContainer.setAttribute('aria-valuenow', Math.round(pct).toString());
        
        if (state.isMuted || state.lastVolume === 0) {
            ui.iconVolHigh.classList.add('hidden');
            ui.iconVolMute.classList.remove('hidden');
        } else {
            ui.iconVolHigh.classList.remove('hidden');
            ui.iconVolMute.classList.add('hidden');
        }
    }

    ui.btnMute.addEventListener('click', () => {
        state.isMuted = !state.isMuted;
        ui.audio.muted = state.isMuted;
        updateVolumeUI();
    });

    ui.volContainer.addEventListener('click', (e) => {
            const rect = ui.volContainer.getBoundingClientRect();
            const x = e.clientX - rect.left;
            let val = x / rect.width;
            val = Math.max(0, Math.min(1, val));
            
            state.lastVolume = val;
            state.isMuted = false;
            ui.audio.muted = false;
            ui.audio.volume = val;
            localStorage.setItem('music-player-volume', val.toString());
            updateVolumeUI();
    });

    // Drawer Logic
    ui.btnLrc.addEventListener('click', () => {
            const isOpen = ui.lrcDrawer.style.gridTemplateRows === '1fr';
            if (isOpen) {
                ui.lrcDrawer.style.gridTemplateRows = '0fr';
                ui.lrcDrawer.classList.remove('opacity-100');
                ui.lrcDrawer.classList.add('opacity-0');
                ui.btnLrc.classList.remove('text-[var(--primary)]');
                ui.btnLrc.classList.add('text-neutral-400');
                ui.iconLrcOn.classList.add('hidden');
                ui.iconLrcOff.classList.remove('hidden');
            } else {
                // Close playlist if open
                ui.playlistDrawer.style.gridTemplateRows = '0fr';
                ui.playlistDrawer.classList.remove('opacity-100');
                ui.playlistDrawer.classList.add('opacity-0');
                ui.btnDrawer.classList.remove('text-[var(--primary)]');
                ui.btnDrawer.classList.add('text-neutral-400');

                ui.lrcDrawer.style.gridTemplateRows = '1fr';
                ui.lrcDrawer.classList.add('opacity-100');
                ui.lrcDrawer.classList.remove('opacity-0');
                ui.btnLrc.classList.add('text-[var(--primary)]');
                ui.btnLrc.classList.remove('text-neutral-400');
                ui.iconLrcOn.classList.remove('hidden');
                ui.iconLrcOff.classList.add('hidden');
            }
    });

    ui.btnDrawer.addEventListener('click', () => {
            const isOpen = ui.playlistDrawer.style.gridTemplateRows === '1fr';
            if (isOpen) {
                ui.playlistDrawer.style.gridTemplateRows = '0fr';
                ui.playlistDrawer.classList.remove('opacity-100');
                ui.playlistDrawer.classList.add('opacity-0');
                
                ui.btnDrawer.classList.add('text-neutral-400');
                ui.btnDrawer.classList.remove('text-[var(--primary)]');
            } else {
                // Close lyrics if open
                ui.lrcDrawer.style.gridTemplateRows = '0fr';
                ui.lrcDrawer.classList.remove('opacity-100');
                ui.lrcDrawer.classList.add('opacity-0');
                ui.btnLrc.classList.remove('text-[var(--primary)]');
                ui.btnLrc.classList.add('text-neutral-400');

                ui.playlistDrawer.style.gridTemplateRows = '1fr';
                ui.playlistDrawer.classList.add('opacity-100');
                ui.playlistDrawer.classList.remove('opacity-0');
                
                ui.btnDrawer.classList.remove('text-neutral-400');
                ui.btnDrawer.classList.add('text-[var(--primary)]');
            }
    });

    // Core Events
    ui.btnPlay.addEventListener('click', togglePlay);
    ui.btnNext.addEventListener('click', () => playNext(false));
    ui.btnPrev.addEventListener('click', playPrev);

    ui.lrcContainer.addEventListener('wheel', () => {
            state.isUserScrolling = true;
            resetScrollTimeout();
    });
    ui.lrcContainer.addEventListener('touchstart', () => {
            state.isUserScrolling = true;
            resetScrollTimeout();
    });

    function resetScrollTimeout() {
        clearTimeout(state.scrollTimeout);
        state.scrollTimeout = setTimeout(() => {
            state.isUserScrolling = false;
            updateLyricSync(ui.audio.currentTime, true); // Snap back immediately
        }, 3000); // Wait for 3 seconds of no activity
    }

    ui.cover.addEventListener('load', () => {
            ui.cover.classList.remove('opacity-0');
    });
    ui.cover.addEventListener('error', () => {
            ui.cover.classList.add('opacity-0');
    });
    
    ui.audio.addEventListener('timeupdate', () => {
            if (isNaN(ui.audio.duration)) return;
            const currentTime = ui.audio.currentTime;
            const duration = ui.audio.duration;
            const progress = (currentTime / duration) * 100;
            
            ui.progressBar.style.width = `${progress}%`;
            ui.progressThumb.style.left = `${progress}%`;
            ui.progressContainer.setAttribute('aria-valuenow', Math.round(progress).toString());
            
            ui.currentTime.innerText = formatTime(currentTime);
            ui.totalTime.innerText = formatTime(duration);

            updateLyricSync(currentTime);
    });

    ui.audio.addEventListener('ended', () => playNext(true));
    ui.audio.addEventListener('error', () => { /* Handle error */ });
    
    // Global Mutual Exclusion
    window.addEventListener('firefly-music-play', (e) => {
        if (e.detail.id !== widgetId && !ui.audio.paused) {
            ui.audio.pause();
            updatePlayState(false);
        }
    });

    ui.audio.addEventListener('play', () => {
        window.dispatchEvent(new CustomEvent('firefly-music-play', { detail: { id: widgetId } }));
    });
    
    // Seek
    ui.progressContainer.addEventListener('click', (e) => {
        if (!ui.audio.duration) return;
        const rect = ui.progressContainer.getBoundingClientRect();
        const clickX = e.clientX - rect.left;
        const percent = Math.min(Math.max(clickX / rect.width, 0), 1);
        ui.audio.currentTime = percent * ui.audio.duration;
    });

    init();
})();
})();</script>   </div>  </widget-layout>  <widget-layout data-id="categories" data-is-collapsed="true" class="pb-4 card-base onload-animation" style="animation-delay: 150ms; --collapsedHeight: 7.5rem;" data-astro-cid-wbzkcah3="true"> <div class="widget-title font-bold transition text-lg text-neutral-900 dark:text-neutral-100 relative ml-8 mt-4 mb-2
            before:w-1 before:h-4 before:rounded-md before:bg-(--primary)
            before:absolute before:left-[-16px] before:top-[5.5px] flex items-center justify-between" data-astro-cid-wbzkcah3 style="--collapsedHeight: 7.5rem;"> <span class="widget-name" data-astro-cid-wbzkcah3 style="--collapsedHeight: 7.5rem;">分类</span>  </div> <div id="categories" class="collapse-wrapper px-4 overflow-hidden collapsed" data-astro-cid-wbzkcah3 style="--collapsedHeight: 7.5rem;"> <a href="/archive/?category=API" aria-label="View all posts in the API category"> <button class="
            w-full
            h-10
            rounded-lg
            bg-none
            hover:bg-(--btn-plain-bg-hover)
            active:bg-(--btn-plain-bg-active)
            transition-all
            pl-2
            hover:pl-3
            
            text-neutral-700
            hover:text-(--primary)
            dark:text-neutral-300
            dark:hover:text-(--primary)
        "> <div class="flex items-center justify-between relative mr-2"> <div class="overflow-hidden text-left whitespace-nowrap text-ellipsis  "> API </div> <div class="transition px-2 h-7 ml-4 min-w-8 rounded-lg text-sm font-bold
                    text-(--btn-content) dark:text-(--deep-text)
                    bg-[oklch(0.95_0.025_var(--hue))] dark:bg-(--primary)
                    flex items-center justify-center"> 1 </div> </div> </button> </a><a href="/archive/?category=oi%E7%AE%97%E6%B3%95" aria-label="View all posts in the oi算法 category"> <button class="
            w-full
            h-10
            rounded-lg
            bg-none
            hover:bg-(--btn-plain-bg-hover)
            active:bg-(--btn-plain-bg-active)
            transition-all
            pl-2
            hover:pl-3
            
            text-neutral-700
            hover:text-(--primary)
            dark:text-neutral-300
            dark:hover:text-(--primary)
        "> <div class="flex items-center justify-between relative mr-2"> <div class="overflow-hidden text-left whitespace-nowrap text-ellipsis  "> oi算法 </div> <div class="transition px-2 h-7 ml-4 min-w-8 rounded-lg text-sm font-bold
                    text-(--btn-content) dark:text-(--deep-text)
                    bg-[oklch(0.95_0.025_var(--hue))] dark:bg-(--primary)
                    flex items-center justify-center"> 37 </div> </div> </button> </a><a href="/archive/?category=%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA" aria-label="View all posts in the 博客搭建 category"> <button class="
            w-full
            h-10
            rounded-lg
            bg-none
            hover:bg-(--btn-plain-bg-hover)
            active:bg-(--btn-plain-bg-active)
            transition-all
            pl-2
            hover:pl-3
            
            text-neutral-700
            hover:text-(--primary)
            dark:text-neutral-300
            dark:hover:text-(--primary)
        "> <div class="flex items-center justify-between relative mr-2"> <div class="overflow-hidden text-left whitespace-nowrap text-ellipsis  "> 博客搭建 </div> <div class="transition px-2 h-7 ml-4 min-w-8 rounded-lg text-sm font-bold
                    text-(--btn-content) dark:text-(--deep-text)
                    bg-[oklch(0.95_0.025_var(--hue))] dark:bg-(--primary)
                    flex items-center justify-center"> 1 </div> </div> </button> </a><a href="/archive/?category=%E5%A5%87%E6%8A%80%E6%B7%AB%E5%B7%A7" aria-label="View all posts in the 奇技淫巧 category"> <button class="
            w-full
            h-10
            rounded-lg
            bg-none
            hover:bg-(--btn-plain-bg-hover)
            active:bg-(--btn-plain-bg-active)
            transition-all
            pl-2
            hover:pl-3
            
            text-neutral-700
            hover:text-(--primary)
            dark:text-neutral-300
            dark:hover:text-(--primary)
        "> <div class="flex items-center justify-between relative mr-2"> <div class="overflow-hidden text-left whitespace-nowrap text-ellipsis  "> 奇技淫巧 </div> <div class="transition px-2 h-7 ml-4 min-w-8 rounded-lg text-sm font-bold
                    text-(--btn-content) dark:text-(--deep-text)
                    bg-[oklch(0.95_0.025_var(--hue))] dark:bg-(--primary)
                    flex items-center justify-center"> 5 </div> </div> </button> </a><a href="/archive/?category=%E5%BC%80%E5%8F%91%E8%AE%B0%E5%BD%95" aria-label="View all posts in the 开发记录 category"> <button class="
            w-full
            h-10
            rounded-lg
            bg-none
            hover:bg-(--btn-plain-bg-hover)
            active:bg-(--btn-plain-bg-active)
            transition-all
            pl-2
            hover:pl-3
            
            text-neutral-700
            hover:text-(--primary)
            dark:text-neutral-300
            dark:hover:text-(--primary)
        "> <div class="flex items-center justify-between relative mr-2"> <div class="overflow-hidden text-left whitespace-nowrap text-ellipsis  "> 开发记录 </div> <div class="transition px-2 h-7 ml-4 min-w-8 rounded-lg text-sm font-bold
                    text-(--btn-content) dark:text-(--deep-text)
                    bg-[oklch(0.95_0.025_var(--hue))] dark:bg-(--primary)
                    flex items-center justify-center"> 1 </div> </div> </button> </a><a href="/archive/?category=%E6%96%87%E5%8C%96%E8%AF%BE" aria-label="View all posts in the 文化课 category"> <button class="
            w-full
            h-10
            rounded-lg
            bg-none
            hover:bg-(--btn-plain-bg-hover)
            active:bg-(--btn-plain-bg-active)
            transition-all
            pl-2
            hover:pl-3
            
            text-neutral-700
            hover:text-(--primary)
            dark:text-neutral-300
            dark:hover:text-(--primary)
        "> <div class="flex items-center justify-between relative mr-2"> <div class="overflow-hidden text-left whitespace-nowrap text-ellipsis  "> 文化课 </div> <div class="transition px-2 h-7 ml-4 min-w-8 rounded-lg text-sm font-bold
                    text-(--btn-content) dark:text-(--deep-text)
                    bg-[oklch(0.95_0.025_var(--hue))] dark:bg-(--primary)
                    flex items-center justify-center"> 5 </div> </div> </button> </a><a href="/archive/?category=%E6%98%A5%E6%99%9A" aria-label="View all posts in the 春晚 category"> <button class="
            w-full
            h-10
            rounded-lg
            bg-none
            hover:bg-(--btn-plain-bg-hover)
            active:bg-(--btn-plain-bg-active)
            transition-all
            pl-2
            hover:pl-3
            
            text-neutral-700
            hover:text-(--primary)
            dark:text-neutral-300
            dark:hover:text-(--primary)
        "> <div class="flex items-center justify-between relative mr-2"> <div class="overflow-hidden text-left whitespace-nowrap text-ellipsis  "> 春晚 </div> <div class="transition px-2 h-7 ml-4 min-w-8 rounded-lg text-sm font-bold
                    text-(--btn-content) dark:text-(--deep-text)
                    bg-[oklch(0.95_0.025_var(--hue))] dark:bg-(--primary)
                    flex items-center justify-center"> 2 </div> </div> </button> </a><a href="/archive/?uncategorized=true" aria-label="View all posts in the 未分类 category"> <button class="
            w-full
            h-10
            rounded-lg
            bg-none
            hover:bg-(--btn-plain-bg-hover)
            active:bg-(--btn-plain-bg-active)
            transition-all
            pl-2
            hover:pl-3
            
            text-neutral-700
            hover:text-(--primary)
            dark:text-neutral-300
            dark:hover:text-(--primary)
        "> <div class="flex items-center justify-between relative mr-2"> <div class="overflow-hidden text-left whitespace-nowrap text-ellipsis  "> 未分类 </div> <div class="transition px-2 h-7 ml-4 min-w-8 rounded-lg text-sm font-bold
                    text-(--btn-content) dark:text-(--deep-text)
                    bg-[oklch(0.95_0.025_var(--hue))] dark:bg-(--primary)
                    flex items-center justify-center"> 7 </div> </div> </button> </a><a href="/archive/?category=%E8%BD%AC%E8%BD%BD" aria-label="View all posts in the 转载 category"> <button class="
            w-full
            h-10
            rounded-lg
            bg-none
            hover:bg-(--btn-plain-bg-hover)
            active:bg-(--btn-plain-bg-active)
            transition-all
            pl-2
            hover:pl-3
            
            text-neutral-700
            hover:text-(--primary)
            dark:text-neutral-300
            dark:hover:text-(--primary)
        "> <div class="flex items-center justify-between relative mr-2"> <div class="overflow-hidden text-left whitespace-nowrap text-ellipsis  "> 转载 </div> <div class="transition px-2 h-7 ml-4 min-w-8 rounded-lg text-sm font-bold
                    text-(--btn-content) dark:text-(--deep-text)
                    bg-[oklch(0.95_0.025_var(--hue))] dark:bg-(--primary)
                    flex items-center justify-center"> 3 </div> </div> </button> </a><a href="/archive/?category=%E9%A2%98%E8%A7%A3" aria-label="View all posts in the 题解 category"> <button class="
            w-full
            h-10
            rounded-lg
            bg-none
            hover:bg-(--btn-plain-bg-hover)
            active:bg-(--btn-plain-bg-active)
            transition-all
            pl-2
            hover:pl-3
            
            text-neutral-700
            hover:text-(--primary)
            dark:text-neutral-300
            dark:hover:text-(--primary)
        "> <div class="flex items-center justify-between relative mr-2"> <div class="overflow-hidden text-left whitespace-nowrap text-ellipsis  "> 题解 </div> <div class="transition px-2 h-7 ml-4 min-w-8 rounded-lg text-sm font-bold
                    text-(--btn-content) dark:text-(--deep-text)
                    bg-[oklch(0.95_0.025_var(--hue))] dark:bg-(--primary)
                    flex items-center justify-center"> 1 </div> </div> </button> </a><a href="/archive/?category=%E9%B2%9C%E8%8A%B1" aria-label="View all posts in the 鲜花 category"> <button class="
            w-full
            h-10
            rounded-lg
            bg-none
            hover:bg-(--btn-plain-bg-hover)
            active:bg-(--btn-plain-bg-active)
            transition-all
            pl-2
            hover:pl-3
            
            text-neutral-700
            hover:text-(--primary)
            dark:text-neutral-300
            dark:hover:text-(--primary)
        "> <div class="flex items-center justify-between relative mr-2"> <div class="overflow-hidden text-left whitespace-nowrap text-ellipsis  "> 鲜花 </div> <div class="transition px-2 h-7 ml-4 min-w-8 rounded-lg text-sm font-bold
                    text-(--btn-content) dark:text-(--deep-text)
                    bg-[oklch(0.95_0.025_var(--hue))] dark:bg-(--primary)
                    flex items-center justify-center"> 3 </div> </div> </button> </a> </div> <div class="expand-btn px-4 -mb-2" data-astro-cid-wbzkcah3 style="--collapsedHeight: 7.5rem;"> <button class="btn-plain rounded-lg w-full h-9" title="更多" aria-label="更多" data-astro-cid-wbzkcah3 style="--collapsedHeight: 7.5rem;"> <div class="text-(--primary) flex items-center justify-center gap-2 -translate-x-2" data-astro-cid-wbzkcah3 style="--collapsedHeight: 7.5rem;"> <svg width="1em" height="1em" class="text-[1.75rem]" aria-hidden="true" data-astro-cid-wbzkcah3="true" data-icon="material-symbols:more-horiz">   <symbol id="ai:material-symbols:more-horiz" viewBox="0 0 24 24"><path fill="currentColor" d="M6 14q-.825 0-1.412-.587T4 12t.588-1.412T6 10t1.413.588T8 12t-.587 1.413T6 14m6 0q-.825 0-1.412-.587T10 12t.588-1.412T12 10t1.413.588T14 12t-.587 1.413T12 14m6 0q-.825 0-1.412-.587T16 12t.588-1.412T18 10t1.413.588T20 12t-.587 1.413T18 14"/></symbol><use href="#ai:material-symbols:more-horiz"></use>  </svg> 更多 </div> </button> </div> </widget-layout>  <widget-layout data-id="tags" data-is-collapsed="true" class="pb-4 card-base onload-animation" style="animation-delay: 200ms; --collapsedHeight: 7.5rem;" data-astro-cid-wbzkcah3="true"> <div class="widget-title font-bold transition text-lg text-neutral-900 dark:text-neutral-100 relative ml-8 mt-4 mb-2
            before:w-1 before:h-4 before:rounded-md before:bg-(--primary)
            before:absolute before:left-[-16px] before:top-[5.5px] flex items-center justify-between" data-astro-cid-wbzkcah3 style="--collapsedHeight: 7.5rem;"> <span class="widget-name" data-astro-cid-wbzkcah3 style="--collapsedHeight: 7.5rem;">标签</span>  </div> <div id="tags" class="collapse-wrapper px-4 overflow-hidden collapsed" data-astro-cid-wbzkcah3 style="--collapsedHeight: 7.5rem;">  <div class="flex gap-2 flex-wrap"> <a href="/archive/?tag=API" aria-label="View all posts with the API tag" class="btn-regular h-8 text-sm px-3 rounded-lg">  API </a><a href="/archive/?tag=BA" aria-label="View all posts with the BA tag" class="btn-regular h-8 text-sm px-3 rounded-lg">  BA </a><a href="/archive/?tag=CSP-J" aria-label="View all posts with the CSP-J tag" class="btn-regular h-8 text-sm px-3 rounded-lg">  CSP-J </a><a href="/archive/?tag=csp-s" aria-label="View all posts with the csp-s tag" class="btn-regular h-8 text-sm px-3 rounded-lg">  csp-s </a><a href="/archive/?tag=latex" aria-label="View all posts with the latex tag" class="btn-regular h-8 text-sm px-3 rounded-lg">  latex </a><a href="/archive/?tag=oi" aria-label="View all posts with the oi tag" class="btn-regular h-8 text-sm px-3 rounded-lg">  oi </a><a href="/archive/?tag=oi%E7%AE%97%E6%B3%95" aria-label="View all posts with the oi算法 tag" class="btn-regular h-8 text-sm px-3 rounded-lg">  oi算法 </a><a href="/archive/?tag=spine" aria-label="View all posts with the spine tag" class="btn-regular h-8 text-sm px-3 rounded-lg">  spine </a><a href="/archive/?tag=%E6%9C%80%E7%9F%AD%E8%B7%AF%E7%AE%97%E6%B3%95" aria-label="View all posts with the 最短路算法 tag" class="btn-regular h-8 text-sm px-3 rounded-lg">  最短路算法 </a><a href="/archive/?tag=%E5%88%86%E6%95%B0%E8%A7%84%E5%88%92" aria-label="View all posts with the 分数规划 tag" class="btn-regular h-8 text-sm px-3 rounded-lg">  分数规划 </a><a href="/archive/?tag=%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92" aria-label="View all posts with the 动态规划 tag" class="btn-regular h-8 text-sm px-3 rounded-lg">  动态规划 </a><a href="/archive/?tag=%E5%8D%9A%E5%AE%A2" aria-label="View all posts with the 博客 tag" class="btn-regular h-8 text-sm px-3 rounded-lg">  博客 </a><a href="/archive/?tag=%E5%8D%9A%E5%BC%88%E8%AE%BA" aria-label="View all posts with the 博弈论 tag" class="btn-regular h-8 text-sm px-3 rounded-lg">  博弈论 </a><a href="/archive/?tag=%E5%8E%86%E5%8F%B2%E8%B5%84%E6%96%99" aria-label="View all posts with the 历史资料 tag" class="btn-regular h-8 text-sm px-3 rounded-lg">  历史资料 </a><a href="/archive/?tag=%E5%8E%9F%E7%A5%9E" aria-label="View all posts with the 原神 tag" class="btn-regular h-8 text-sm px-3 rounded-lg">  原神 </a><a href="/archive/?tag=%E5%9B%BE%E8%AE%BA" aria-label="View all posts with the 图论 tag" class="btn-regular h-8 text-sm px-3 rounded-lg">  图论 </a><a href="/archive/?tag=%E5%A5%87%E6%8A%80%E6%B7%AB%E5%B7%A7" aria-label="View all posts with the 奇技淫巧 tag" class="btn-regular h-8 text-sm px-3 rounded-lg">  奇技淫巧 </a><a href="/archive/?tag=%E5%AD%A6%E6%9C%AF" aria-label="View all posts with the 学术 tag" class="btn-regular h-8 text-sm px-3 rounded-lg">  学术 </a><a href="/archive/?tag=%E5%AF%BC%E6%95%B0" aria-label="View all posts with the 导数 tag" class="btn-regular h-8 text-sm px-3 rounded-lg">  导数 </a><a href="/archive/?tag=%E5%B7%AE%E5%88%86%E7%BA%A6%E6%9D%9F" aria-label="View all posts with the 差分约束 tag" class="btn-regular h-8 text-sm px-3 rounded-lg">  差分约束 </a><a href="/archive/?tag=%E5%BC%80%E5%8F%91%E8%AE%B0%E5%BD%95" aria-label="View all posts with the 开发记录 tag" class="btn-regular h-8 text-sm px-3 rounded-lg">  开发记录 </a><a href="/archive/?tag=%E6%88%90%E9%83%BD%E4%B8%9C%E8%BE%B0" aria-label="View all posts with the 成都东辰 tag" class="btn-regular h-8 text-sm px-3 rounded-lg">  成都东辰 </a><a href="/archive/?tag=%E6%90%9C%E7%B4%A2%E7%AE%97%E6%B3%95" aria-label="View all posts with the 搜索算法 tag" class="btn-regular h-8 text-sm px-3 rounded-lg">  搜索算法 </a><a href="/archive/?tag=%E6%95%99%E7%A8%8B" aria-label="View all posts with the 教程 tag" class="btn-regular h-8 text-sm px-3 rounded-lg">  教程 </a><a href="/archive/?tag=%E6%95%B0%E5%AD%A6" aria-label="View all posts with the 数学 tag" class="btn-regular h-8 text-sm px-3 rounded-lg">  数学 </a><a href="/archive/?tag=%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84" aria-label="View all posts with the 数据结构 tag" class="btn-regular h-8 text-sm px-3 rounded-lg">  数据结构 </a><a href="/archive/?tag=%E6%95%B0%E8%AE%BA" aria-label="View all posts with the 数论 tag" class="btn-regular h-8 text-sm px-3 rounded-lg">  数论 </a><a href="/archive/?tag=%E6%95%B4%E6%B4%BB" aria-label="View all posts with the 整活 tag" class="btn-regular h-8 text-sm px-3 rounded-lg">  整活 </a><a href="/archive/?tag=%E6%96%87%E5%8C%96%E8%AF%BE" aria-label="View all posts with the 文化课 tag" class="btn-regular h-8 text-sm px-3 rounded-lg">  文化课 </a><a href="/archive/?tag=%E6%98%A5%E6%99%9A" aria-label="View all posts with the 春晚 tag" class="btn-regular h-8 text-sm px-3 rounded-lg">  春晚 </a><a href="/archive/?tag=%E6%9E%AB%E4%B8%B9" aria-label="View all posts with the 枫丹 tag" class="btn-regular h-8 text-sm px-3 rounded-lg">  枫丹 </a><a href="/archive/?tag=%E6%B8%B8%E8%AE%B0" aria-label="View all posts with the 游记 tag" class="btn-regular h-8 text-sm px-3 rounded-lg">  游记 </a><a href="/archive/?tag=%E7%94%9F%E6%88%90%E6%A0%91" aria-label="View all posts with the 生成树 tag" class="btn-regular h-8 text-sm px-3 rounded-lg">  生成树 </a><a href="/archive/?tag=%E7%AE%97%E6%B3%95" aria-label="View all posts with the 算法 tag" class="btn-regular h-8 text-sm px-3 rounded-lg">  算法 </a><a href="/archive/?tag=%E7%BA%BF%E6%80%A7%E4%BB%A3%E6%95%B0" aria-label="View all posts with the 线性代数 tag" class="btn-regular h-8 text-sm px-3 rounded-lg">  线性代数 </a><a href="/archive/?tag=%E8%AE%A1%E7%AE%97%E5%87%A0%E4%BD%95" aria-label="View all posts with the 计算几何 tag" class="btn-regular h-8 text-sm px-3 rounded-lg">  计算几何 </a><a href="/archive/?tag=%E8%B5%9B%E5%90%8E%E6%80%BB%E7%BB%93" aria-label="View all posts with the 赛后总结 tag" class="btn-regular h-8 text-sm px-3 rounded-lg">  赛后总结 </a><a href="/archive/?tag=%E8%BD%AC%E8%BD%BD" aria-label="View all posts with the 转载 tag" class="btn-regular h-8 text-sm px-3 rounded-lg">  转载 </a><a href="/archive/?tag=%E9%81%97%E4%BC%A0%E5%AD%A6" aria-label="View all posts with the 遗传学 tag" class="btn-regular h-8 text-sm px-3 rounded-lg">  遗传学 </a><a href="/archive/?tag=%E9%97%B2%E8%AF%9D%E6%9D%82%E8%B0%88" aria-label="View all posts with the 闲话杂谈 tag" class="btn-regular h-8 text-sm px-3 rounded-lg">  闲话杂谈 </a><a href="/archive/?tag=%E9%9A%8F%E6%9C%BA%E5%8C%96" aria-label="View all posts with the 随机化 tag" class="btn-regular h-8 text-sm px-3 rounded-lg">  随机化 </a><a href="/archive/?tag=%E9%A2%98%E8%A7%A3" aria-label="View all posts with the 题解 tag" class="btn-regular h-8 text-sm px-3 rounded-lg">  题解 </a><a href="/archive/?tag=%E9%AB%98%E4%B8%AD%E6%95%B0%E5%AD%A6" aria-label="View all posts with the 高中数学 tag" class="btn-regular h-8 text-sm px-3 rounded-lg">  高中数学 </a><a href="/archive/?tag=%E9%AB%98%E4%B8%AD%E7%94%9F%E7%89%A9" aria-label="View all posts with the 高中生物 tag" class="btn-regular h-8 text-sm px-3 rounded-lg">  高中生物 </a><a href="/archive/?tag=%E9%AB%98%E4%B8%AD%E8%AF%AD%E6%96%87" aria-label="View all posts with the 高中语文 tag" class="btn-regular h-8 text-sm px-3 rounded-lg">  高中语文 </a><a href="/archive/?tag=%E9%B2%9C%E8%8A%B1" aria-label="View all posts with the 鲜花 tag" class="btn-regular h-8 text-sm px-3 rounded-lg">  鲜花 </a> </div>  </div> <div class="expand-btn px-4 -mb-2" data-astro-cid-wbzkcah3 style="--collapsedHeight: 7.5rem;"> <button class="btn-plain rounded-lg w-full h-9" title="更多" aria-label="更多" data-astro-cid-wbzkcah3 style="--collapsedHeight: 7.5rem;"> <div class="text-(--primary) flex items-center justify-center gap-2 -translate-x-2" data-astro-cid-wbzkcah3 style="--collapsedHeight: 7.5rem;"> <svg width="1em" height="1em" viewBox="0 0 24 24" class="text-[1.75rem]" aria-hidden="true" data-astro-cid-wbzkcah3="true" data-icon="material-symbols:more-horiz">   <use href="#ai:material-symbols:more-horiz"></use>  </svg> 更多 </div> </button> </div> </widget-layout>  </div></div> </div>  <main id="swup-container" class="transition-main col-span-1 md:col-span-1 md:col-start-2 xl:col-span-1 xl:col-start-2 xl:col-end-3 min-w-0 overflow-hidden transition-main">  <div id="grid-class-carrier" data-grid-class="grid-cols-1 md:grid-cols-[17.5rem_1fr] xl:grid-cols-[17.5rem_1fr_17.5rem]" class="hidden"></div>   <div id="content-wrapper" class="onload-animation transition-leaving">     <div class="flex w-full rounded-(--radius-large) overflow-hidden relative mb-4"> <div id="post-container" class="card-base z-10 px-6 md:px-9 pt-6 pb-4 relative w-full "> <!-- word count and reading time --> <div class="flex flex-row text-black/30 dark:text-white/30 gap-5 mb-3 transition onload-animation"> <div class="flex flex-row items-center"> <div class="transition h-6 w-6 rounded-md bg-black/5 dark:bg-white/10 text-black/50 dark:text-white/50 flex items-center justify-center mr-2"> <svg width="1em" height="1em" data-icon="material-symbols:notes-rounded">   <symbol id="ai:material-symbols:notes-rounded" viewBox="0 0 24 24"><path fill="currentColor" d="M4 18q-.425 0-.712-.288T3 17t.288-.712T4 16h10q.425 0 .713.288T15 17t-.288.713T14 18zm0-5q-.425 0-.712-.288T3 12t.288-.712T4 11h16q.425 0 .713.288T21 12t-.288.713T20 13zm0-5q-.425 0-.712-.288T3 7t.288-.712T4 6h16q.425 0 .713.288T21 7t-.288.713T20 8z"/></symbol><use href="#ai:material-symbols:notes-rounded"></use>  </svg> </div> <div class="text-sm"> 16462  字 </div> </div> <div class="flex flex-row items-center"> <div class="transition h-6 w-6 rounded-md bg-black/5 dark:bg-white/10 text-black/50 dark:text-white/50 flex items-center justify-center mr-2"> <svg width="1em" height="1em" data-icon="material-symbols:schedule-outline-rounded">   <symbol id="ai:material-symbols:schedule-outline-rounded" viewBox="0 0 24 24"><path fill="currentColor" d="M13 11.6V8q0-.425-.288-.712T12 7t-.712.288T11 8v3.975q0 .2.075.388t.225.337l3.3 3.3q.275.275.7.275T16 16t.275-.7t-.275-.7zM12 22q-2.075 0-3.9-.788t-3.175-2.137T2.788 15.9T2 12t.788-3.9t2.137-3.175T8.1 2.788T12 2t3.9.788t3.175 2.137T21.213 8.1T22 12t-.788 3.9t-2.137 3.175t-3.175 2.138T12 22m0-2q3.325 0 5.663-2.337T20 12t-2.337-5.663T12 4T6.337 6.338T4 12t2.338 5.663T12 20"/></symbol><use href="#ai:material-symbols:schedule-outline-rounded"></use>  </svg> </div> <div class="text-sm"> 82  分钟 </div> </div> </div> <!-- title --> <div class="relative onload-animation"> <h1 data-pagefind-body data-pagefind-weight="10" data-pagefind-meta="title" class="transition w-full block font-bold mb-3
                    text-3xl md:text-[2.25rem]/[2.75rem]
                    text-black/90 dark:text-white/90
                    md:before:w-1 before:h-5 before:rounded-md before:bg-(--primary)
                    before:absolute before:top-3 before:-left-4.5"> 基础数据结构 线段树 </h1> </div> <!-- metadata --> <div class="onload-animation"> <div class="flex flex-wrap text-neutral-500 dark:text-neutral-400 items-center gap-4 gap-x-4 gap-y-2 mb-5"> <!-- pinned -->  <!-- publish date --> <div class="flex items-center"> <div class="meta-icon"> <svg width="1em" height="1em" class="text-xl" data-icon="material-symbols:calendar-today-outline-rounded">   <symbol id="ai:material-symbols:calendar-today-outline-rounded" viewBox="0 0 24 24"><path fill="currentColor" d="M5 22q-.825 0-1.412-.587T3 20V6q0-.825.588-1.412T5 4h1V3q0-.425.288-.712T7 2t.713.288T8 3v1h8V3q0-.425.288-.712T17 2t.713.288T18 3v1h1q.825 0 1.413.588T21 6v14q0 .825-.587 1.413T19 22zm0-2h14V10H5zM5 8h14V6H5zm0 0V6z"/></symbol><use href="#ai:material-symbols:calendar-today-outline-rounded"></use>  </svg> </div> <span class="text-50 text-sm font-medium">2024-08-08</span> </div> <!-- update date --> <div class="flex items-center"> <div class="meta-icon"> <svg width="1em" height="1em" class="text-xl" data-icon="material-symbols:edit-calendar-outline-rounded">   <symbol id="ai:material-symbols:edit-calendar-outline-rounded" viewBox="0 0 24 24"><path fill="currentColor" d="M5 22q-.825 0-1.412-.587T3 20V6q0-.825.588-1.412T5 4h1V3q0-.425.288-.712T7 2t.713.288T8 3v1h8V3q0-.425.288-.712T17 2t.713.288T18 3v1h1q.825 0 1.413.588T21 6v4.025q0 .425-.288.713t-.712.287t-.712-.288t-.288-.712V10H5v10h6q.425 0 .713.288T12 21t-.288.713T11 22zM5 8h14V6H5zm0 0V6zm9 13v-1.65q0-.2.075-.387t.225-.338l5.225-5.2q.225-.225.5-.325t.55-.1q.3 0 .575.113t.5.337l.925.925q.2.225.313.5t.112.55t-.1.563t-.325.512l-5.2 5.2q-.15.15-.337.225T16.65 22H15q-.425 0-.712-.287T14 21m7.5-5.575l-.925-.925zm-6 5.075h.95l3.025-3.05l-.45-.475l-.475-.45l-3.05 3.025zm3.525-3.525l-.475-.45l.925.925z"/></symbol><use href="#ai:material-symbols:edit-calendar-outline-rounded"></use>  </svg> </div> <span class="text-50 text-sm font-medium"> 2024-11-27 </span> </div> <!-- categories --> <div class="flex items-center"> <div class="meta-icon"> <svg width="1em" height="1em" class="text-xl" data-icon="material-symbols:book-2-outline-rounded">   <symbol id="ai:material-symbols:book-2-outline-rounded" viewBox="0 0 24 24"><path fill="currentColor" d="M6 15.325q.35-.175.725-.25T7.5 15H8V4h-.5q-.625 0-1.062.438T6 5.5zM10 15h8V4h-8zm-4 .325V4zM7.5 22q-1.45 0-2.475-1.025T4 18.5v-13q0-1.45 1.025-2.475T7.5 2H18q.825 0 1.413.587T20 4v12.525q0 .2-.162.363t-.588.362q-.35.175-.55.5t-.2.75t.2.763t.55.487t.55.413t.2.562v.25q0 .425-.288.725T19 22zm0-2h9.325q-.15-.35-.237-.712T16.5 18.5q0-.4.075-.775t.25-.725H7.5q-.65 0-1.075.438T6 18.5q0 .65.425 1.075T7.5 20"/></symbol><use href="#ai:material-symbols:book-2-outline-rounded"></use>  </svg> </div> <div class="flex flex-row flex-nowrap items-center"> <a href="/archive/?category=oi%E7%AE%97%E6%B3%95" aria-label="View all posts in the oi算法 category" class="link-lg transition text-50 text-sm font-medium
                            hover:text-(--primary) dark:hover:text-(--primary) whitespace-nowrap"> oi算法 </a> </div> </div> <!-- word count and read time (only for post list) -->  <!-- tags (only for post detail page) --> <div class="items-center flex"> <div class="meta-icon"> <svg width="1em" height="1em" class="text-xl" data-icon="material-symbols:tag-rounded">   <symbol id="ai:material-symbols:tag-rounded" viewBox="0 0 24 24"><path fill="currentColor" d="m9 16l-.825 3.275q-.075.325-.325.525t-.6.2q-.475 0-.775-.375T6.3 18.8L7 16H4.275q-.5 0-.8-.387T3.3 14.75q.075-.35.35-.55t.625-.2H7.5l1-4H5.775q-.5 0-.8-.387T4.8 8.75q.075-.35.35-.55t.625-.2H9l.825-3.275Q9.9 4.4 10.15 4.2t.6-.2q.475 0 .775.375t.175.825L11 8h4l.825-3.275q.075-.325.325-.525t.6-.2q.475 0 .775.375t.175.825L17 8h2.725q.5 0 .8.387t.175.863q-.075.35-.35.55t-.625.2H16.5l-1 4h2.725q.5 0 .8.388t.175.862q-.075.35-.35.55t-.625.2H15l-.825 3.275q-.075.325-.325.525t-.6.2q-.475 0-.775-.375T12.3 18.8L13 16zm.5-2h4l1-4h-4z"/></symbol><use href="#ai:material-symbols:tag-rounded"></use>  </svg> </div> <div class="flex flex-row flex-nowrap items-center"> <div class="hidden mx-1.5 text-(--meta-divider) text-sm">/</div>
             <a href="/archive/?tag=oi" aria-label="View all posts with the oi tag" class="link-lg transition text-50 text-sm font-medium
                             hover:text-(--primary) dark:hover:text-(--primary) whitespace-nowrap"> oi </a><div class="mx-1.5 text-(--meta-divider) text-sm">/</div>
             <a href="/archive/?tag=%E7%AE%97%E6%B3%95" aria-label="View all posts with the 算法 tag" class="link-lg transition text-50 text-sm font-medium
                             hover:text-(--primary) dark:hover:text-(--primary) whitespace-nowrap"> 算法 </a><div class="mx-1.5 text-(--meta-divider) text-sm">/</div>
             <a href="/archive/?tag=%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84" aria-label="View all posts with the 数据结构 tag" class="link-lg transition text-50 text-sm font-medium
                             hover:text-(--primary) dark:hover:text-(--primary) whitespace-nowrap"> 数据结构 </a>  </div> </div> <!-- Twikoo访问量统计（首页不显示，且文章访问量统计启用时显示） --> <div class="flex items-center"> <div class="meta-icon"> <svg width="1em" height="1em" class="text-xl" data-icon="material-symbols:visibility-outline-rounded">   <symbol id="ai:material-symbols:visibility-outline-rounded" viewBox="0 0 24 24"><path fill="currentColor" d="M12 16q1.875 0 3.188-1.312T16.5 11.5t-1.312-3.187T12 7T8.813 8.313T7.5 11.5t1.313 3.188T12 16m0-1.8q-1.125 0-1.912-.788T9.3 11.5t.788-1.912T12 8.8t1.913.788t.787 1.912t-.787 1.913T12 14.2m0 4.8q-3.35 0-6.113-1.8t-4.362-4.75q-.125-.225-.187-.462t-.063-.488t.063-.488t.187-.462q1.6-2.95 4.363-4.75T12 4t6.113 1.8t4.362 4.75q.125.225.188.463t.062.487t-.062.488t-.188.462q-1.6 2.95-4.362 4.75T12 19m0-2q2.825 0 5.188-1.487T20.8 11.5q-1.25-2.525-3.613-4.012T12 6T6.813 7.488T3.2 11.5q1.25 2.525 3.613 4.013T12 17"/></symbol><use href="#ai:material-symbols:visibility-outline-rounded"></use>  </svg> </div> <span class="text-50 text-sm font-medium mr-1"> 浏览量 </span> <span class="text-50 text-sm font-medium" id="twikoo_visitors"> 加载中... </span> </div> <!-- Waline访问量统计（首页不显示、仅type为waline时显示） -->  <!-- artalk访问量统计（首页不显示、仅type为artalk时显示） -->  </div>  </div> <!-- always show cover as long as it has one --> <div style="margin-top:1rem;"> <div id="post-cover" class="mb-8 rounded-xl banner-container onload-animation cover-image-container overflow-hidden relative" data-loading="false" data-astro-cid-koeuhgqn> <!-- 加载动画 -->  <!-- 错误提示（覆盖在回退图片上） --> <div class="error-message absolute inset-0 flex items-center justify-center z-20 hidden pointer-events-none" data-astro-cid-koeuhgqn> <span class="text-white text-sm px-3 py-1 rounded bg-black/50" data-astro-cid-koeuhgqn>Image API Error</span> </div> <!-- 回退图片（错误时显示） -->  <!-- 本地图片 -->  <!-- 远程图片 --> <img src="https://cdn.luogu.com.cn/upload/image_hosting/qvw4aoyc.png" alt class="w-full h-full object-cover" style="object-position: center;" loading="lazy" decoding="async" data-cover-img data-remote="true" data-astro-cid-koeuhgqn> </div>  <script type="module">function t(){document.querySelectorAll(".cover-image-container").forEach(t=>{if(t.hasAttribute("data-initialized"))return;t.setAttribute("data-initialized","true");const e=t.querySelector("img[data-cover-img]");if(!e)return;const a=()=>{t.setAttribute("data-loading","false")},r=()=>{t.setAttribute("data-loading","false"),t.setAttribute("data-error","true")};e.complete?e.naturalWidth>0?a():"true"===e.dataset.remote&&r():(e.addEventListener("load",a,{once:!0}),e.addEventListener("error",()=>{"true"===e.dataset.remote&&r()},{once:!0}))})}t(),document.addEventListener("astro:page-load",t);</script> </div> <div data-pagefind-body class="prose dark:prose-invert prose-base max-w-none! custom-md mb-6 markdown-content onload-animation">  <div class="callout" data-callout="warning" data-collapsible="false"><div class="callout-title"><div class="callout-title-icon" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg></div><div class="callout-title-text">Warning</div></div><div class="callout-content"><p>旧专栏由于年久失修，目前已被标记为<strong>过时</strong>。本文是对旧博客的重写及内容补充。</p></div></div>
<p>线段树的思想就是把一段区间拆分成两个子区间，运用递归的方式，线段树能在不大规模改动原数组的情况下实现区间信息的维护。有了这一点，区间信息维护的时间复杂度就从朴素暴力算法的 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="script">O</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\mathcal O(n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathcal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span> 优化到了 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="script">O</mi><mo stretchy="false">(</mo><mi>log</mi><mo>⁡</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\mathcal O(\log n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathcal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span>。</p>
<section><h2 id="前言">前言<a class="anchor" href="#前言"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h2><p>本文所使用的宏定义及含义如下：</p>





























<table><thead><tr><th>宏名</th><th>定义</th><th>作用</th></tr></thead><tbody><tr><td><code>le(x)</code></td><td><code>(x * 2)</code></td><td>获取左子树的下标</td></tr><tr><td><code>ri(x)</code></td><td><code>(x * 2 + 1)</code></td><td>获取右子树的下标</td></tr><tr><td><code>leftSubtree(idx)</code></td><td><code>tree[le(idx)]</code></td><td>获取左子树对象</td></tr><tr><td><code>rightSubtree(idx)</code></td><td><code>tree[ri(idx)]</code></td><td>获取右子树对象</td></tr></tbody></table></section>
<section><h2 id="线段树的建树">线段树的建树<a class="anchor" href="#线段树的建树"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h2><p>根据前文所说，线段树将一段长区间分为两段，并设为它自身的子树，不断递归直到区间长度为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">{1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord"><span class="mord">1</span></span></span></span></span>。如下图：</p><p><img src="https://cdn.luogu.com.cn/upload/image_hosting/ciovkrww.png" alt=""></p><p>可见线段树是一棵满二叉树，它有 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mi>h</mi></msup><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">{2^h}-1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9324em;vertical-align:-0.0833em;"></span><span class="mord"><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8491em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">h</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span> 个节点（<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi></mrow><annotation encoding="application/x-tex">h</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">h</span></span></span></span> 为树的高度/层数，上图中 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi><mo>=</mo><mn>4</mn></mrow><annotation encoding="application/x-tex">h=4</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">h</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">4</span></span></span></span>）；此外还可以发现，对于下标为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span></span></span></span> 的节点，如果它存在子树，那么它的左子树的下标就是 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn><mi>p</mi></mrow><annotation encoding="application/x-tex">{2p}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8389em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord">2</span><span class="mord mathnormal">p</span></span></span></span></span>、右子树为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn><mi>p</mi><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">{2p+1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8389em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord">2</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span></span></span></span></span>。我们平常使用线段树，则需要开四倍的空间（<code>pushdown</code> 位置的不同、删去某些特判可能会让这一上限最多变为八倍空间，后文将阐述其原因）。</p><p>在建树时，我们需要处理出当前区间的中点，并分别递归左右子树继续建树、顺带维护区间左右端点的信息（区间大小、初始化懒标记等）。根据前文，递归终点是区间长度降落为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">{1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord"><span class="mord">1</span></span></span></span></span>，此时将原序列中的信息搬过去即可。</p><div class="expressive-code"><link rel="stylesheet" href="/_astro/ec.0ts9d.css"><script type="module" src="/_astro/ec.xb3ii.js"></script><figure class="frame"><figcaption class="header"></figcaption><pre data-language="C++"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">void</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">build</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">l</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">r</span><span style="--0:#ABB2BF">) {</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> l, </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> r;</span><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic"> // 维护区间左右端点</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">==</span><span style="--0:#ABB2BF;--1:#383A42"> r) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">max</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">a</span><span style="--0:#ABB2BF;--1:#383A42">[l];</span><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic"> // 维护区间最大值</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> mid </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> r) </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">build</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, mid);</span><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic"> // 递归左子树</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">build</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--0:#ABB2BF;--1:#383A42">(idx), mid </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, r);</span><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic"> // 递归右子树</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">pushup</span><span style="--0:#ABB2BF;--1:#383A42">(idx);</span><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic"> // 更新父节点</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="void build(int idx, int l, int r) {    tree[idx].l = l, tree[idx].r = r; // 维护区间左右端点    if (l == r) {        tree[idx].max = a[l]; // 维护区间最大值        return;    }    int mid = (l + r) >> 1;    build(le(idx), l, mid); // 递归左子树    build(ri(idx), mid + 1, r); // 递归右子树    pushup(idx); // 更新父节点}"><div></div></button></div></figure></div></section>
<section><h2 id="线段树的节点更新">线段树的节点更新<a class="anchor" href="#线段树的节点更新"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h2><p>基本分两种，已知子节点更新父节点和已知父节点更新子节点。</p><p>第一种操作一般被称作 <code>pushup</code> 上传操作。在子节点更新完毕回溯时进行，起到更新父节点的作用；第二种操作被称作 <code>pushdown</code> 下传操作。在带有懒标记的线段树中向子节点递归查找信息时进行，能够将先前积累起来的操作下放到子节点。</p><p>一般在编写上传操作时，要考虑到所维护信息的结合性质。例如维护区间和，父节点记录的值显然应该是左右子树记录的值之和；再比如维护区间最大值，显然应该是左右区间分别记录的最大值中更大的那一个。</p><div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="C++"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">void</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">pushup</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">) {</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">max</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">max</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">max</span><span style="--0:#ABB2BF;--1:#383A42">, </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">max</span><span style="--0:#ABB2BF;--1:#383A42">);</span><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic"> // 区间最大值</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42">;</span><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic">     // 区间和</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span class="indent"><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic">    </span></span><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic">// ...</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="void pushup(int idx) {    tree[idx].max = max(leftSubtree(idx).max, rightSubtree(idx).max); // 区间最大值    tree[idx].sum = leftSubtree(idx).sum + rightSubtree(idx).sum;     // 区间和    // ...}"><div></div></button></div></figure></div><p>在写标记下传时，需要特别考虑标记之间的优先级关系。例如当前有两个操作——区间推平（赋成统一的值）和区间加。当该区间需要下传一个推平标记时，可以直接把区间加标记给清空，因为推平后就不会存在区间加；反过来就不成立，因为区间可以在推平后继续进行加法。因此我们需要先判断推平标记的情况，后面再来处理区间加标记。</p><div class="expressive-code"><div class="ec-collapse ec-collapse--collapsed" id="collapse-k8th1hhsl" data-collapse-preview-lines="8" data-expanded-announcement="代码块已展开" data-collapsed-announcement="代码块已折叠"><div class="ec-collapse__content"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="C++"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">void</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">pushdown</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">) {</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">que</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">!=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">-</span><span style="--0:#ABB2BF;--1:#383A42">LLONG_MAX) {</span><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic"> // 区间推平优先处理</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">max</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">que</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">que</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">que</span><span style="--0:#ABB2BF;--1:#383A42">;</span><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic"> // 继承推平标记</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">add</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">;</span><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic"> // 清空加法标记</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">max</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">que</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">que</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">que</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">add</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">;</span><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic"> // 清空加法标记</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">que</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">-</span><span style="--0:#ABB2BF;--1:#383A42">LLONG_MAX;</span><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic"> // 清空推平标记</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">add</span><span style="--0:#ABB2BF;--1:#383A42">) {</span><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic"> // 区间加法后处理</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">max</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">add</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">13</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">add</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">add</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">14</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">max</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">add</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">15</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">add</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">add</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">16</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">17</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">add</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">18</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">19</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="void pushdown(int idx) {    if (tree[idx].que != -LLONG_MAX) { // 区间推平优先处理        leftSubtree(idx).max = tree[idx].que;        leftSubtree(idx).que = tree[idx].que; // 继承推平标记        leftSubtree(idx).add = 0; // 清空加法标记        rightSubtree(idx).max = tree[idx].que;        rightSubtree(idx).que = tree[idx].que;        rightSubtree(idx).add = 0; // 清空加法标记        tree[idx].que = -LLONG_MAX; // 清空推平标记    }    if (tree[idx].add) { // 区间加法后处理        leftSubtree(idx).max += tree[idx].add;        leftSubtree(idx).add += tree[idx].add;        rightSubtree(idx).max += tree[idx].add;        rightSubtree(idx).add += tree[idx].add;        tree[idx].add = 0;    }}"><div></div></button></div></figure><div class="ec-collapse__gradient" aria-hidden="true"></div></div><button class="ec-collapse__toggle" type="button" aria-expanded="false" aria-controls="collapse-k8th1hhsl"><span class="ec-collapse__text-expand">显示更多</span><span class="ec-collapse__text-collapse">显示更少</span><svg class="ec-collapse__icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" aria-hidden="true"><path fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="M6 9l6 6 6-6"></path></svg></button></div></div></section>
<section><h2 id="线段树的查询操作">线段树的查询操作<a class="anchor" href="#线段树的查询操作"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h2><p>线段树既可以查询单点信息，也可以查询整个区间的信息，前者可以看作是区间长度为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">{1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord"><span class="mord">1</span></span></span></span></span> 的区间查询，是区间查询的一类特殊情况。</p><section><h3 id="简单查询">简单查询<a class="anchor" href="#简单查询"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h3><p><img src="https://cdn.luogu.com.cn/upload/image_hosting/vysl8vf8.png" alt=""></p><p>在这个例子中，我们假设查询区间 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mn>3</mn><mo separator="true">,</mo><mn>5</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[3,5]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">3</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">5</span><span class="mclose">]</span></span></span></span> 的某些信息，首先我们就需要找到这个区间：递归查找、缩小范围，发现当递归到下标 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>5</mn></mrow><annotation encoding="application/x-tex">{5}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord"><span class="mord">5</span></span></span></span></span> 时，区间 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mn>3</mn><mo separator="true">,</mo><mn>3</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[3,3]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">3</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">3</span><span class="mclose">]</span></span></span></span> 就被包含了，于是直接返回；当查询至下标 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>6</mn></mrow><annotation encoding="application/x-tex">{6}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord"><span class="mord">6</span></span></span></span></span>，区间 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mn>4</mn><mo separator="true">,</mo><mn>5</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[4,5]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">4</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">5</span><span class="mclose">]</span></span></span></span> 被包含进去，此时我们就可以不用花费大力气继续向下递归了，因为线段树的父节点就存储了子节点的信息。以查询区间最大值为例：</p><div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="C++"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">queryMax</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">l</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">r</span><span style="--0:#ABB2BF">) {</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#56B6C2;--1:#A626A4">&#x26;&#x26;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> r) </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">max</span><span style="--0:#ABB2BF;--1:#383A42">;</span><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic"> // 完全包含，直接返回</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">pushdown</span><span style="--0:#ABB2BF;--1:#383A42">(idx);</span><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic">   // 子节点可能存在积累的操作</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> mid </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42">) </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> res </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">-</span><span style="--0:#ABB2BF;--1:#383A42">INF;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> mid) res </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">max</span><span style="--0:#ABB2BF;--1:#383A42">(res, </span><span style="--0:#61AFEF;--1:#3360C1">queryMax</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, r));</span><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic"> // 递归左侧</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (r </span><span style="--0:#CD89E1;--1:#A626A4">></span><span style="--0:#ABB2BF;--1:#383A42"> mid) res </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">max</span><span style="--0:#ABB2BF;--1:#383A42">(res, </span><span style="--0:#61AFEF;--1:#3360C1">queryMax</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, r));</span><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic">   // 递归右侧</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42"> res;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="int queryMax(int idx, int l, int r) {    if (l <= tree[idx].l &#x26;&#x26; tree[idx].r <= r) return tree[idx].max; // 完全包含，直接返回    pushdown(idx);   // 子节点可能存在积累的操作    int mid = (tree[idx].l + tree[idx].r) >> 1;    int res = -INF;    if (l <= mid) res = max(res, queryMax(le(idx), l, r)); // 递归左侧    if (r > mid) res = max(res, queryMax(ri(idx), l, r));   // 递归右侧    return res;}"><div></div></button></div></figure></div><p>由于查询的值是独立的，不依赖于其他变量。如果碰到较为复杂的、多重依赖的变量，那么这种方法可能就会变得不那么适用了。接下来介绍第二种高级的查询操作，也可以说是码量较大但是更为万能的查询方法。</p></section><section><h3 id="复杂查询">复杂查询<a class="anchor" href="#复杂查询"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h3><p>以查询区间最大子段和为例。我们维护了区间最大前缀、最大后缀以及最大子段和，最大子段和应是左子树最大前缀、右子树最大后缀以及左子树最大后缀加右子树最大前缀三者的最大值。如果依然沿用上面的简单查询，那么实现将会极其复杂，此时我们不再让函数返回线段树节点的某一权值，而是改成返回线段树节点本身。这样一来我们就可以通过左右子节点的值来推断返回值，从而达到查询的目的。查询逻辑和简单查询有不同：</p><div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="C++"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#E5C07B;--1:#885D01">SegmentTree</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">query</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">l</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">r</span><span style="--0:#ABB2BF">) {</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#56B6C2;--1:#A626A4">&#x26;&#x26;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> r) </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx];</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> mid </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42">) </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">></span><span style="--0:#ABB2BF;--1:#383A42"> mid) </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">query</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, r);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (r </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> mid) </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">query</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, r);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">SegmentTree res{};</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">SegmentTree L </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">query</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, r);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">SegmentTree R </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">query</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, r);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">res</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">max</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">max</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">max</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#E5C07B;--1:#AF4238">L</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">max</span><span style="--0:#ABB2BF;--1:#383A42">, </span><span style="--0:#E5C07B;--1:#AF4238">R</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">max</span><span style="--0:#ABB2BF;--1:#383A42">), </span><span style="--0:#E5C07B;--1:#AF4238">L</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">rmax</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">R</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">lmax</span><span style="--0:#ABB2BF;--1:#383A42">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">res</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">lmax</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">max</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#E5C07B;--1:#AF4238">L</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">lmax</span><span style="--0:#ABB2BF;--1:#383A42">, </span><span style="--0:#E5C07B;--1:#AF4238">L</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">R</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">lmax</span><span style="--0:#ABB2BF;--1:#383A42">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">res</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">rmax</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">max</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#E5C07B;--1:#AF4238">R</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">rmax</span><span style="--0:#ABB2BF;--1:#383A42">, </span><span style="--0:#E5C07B;--1:#AF4238">R</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">L</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">rmax</span><span style="--0:#ABB2BF;--1:#383A42">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">res</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">L</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">R</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">13</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42"> res;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">14</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="SegmentTree query(int idx, int l, int r) {    if (l <= tree[idx].l &#x26;&#x26; tree[idx].r <= r) return tree[idx];    int mid = (tree[idx].l + tree[idx].r) >> 1;    if (l > mid) return query(ri(idx), l, r);    if (r <= mid) return query(le(idx), l, r);    SegmentTree res{};    SegmentTree L = query(le(idx), l, r);    SegmentTree R = query(ri(idx), l, r);    res.max = max(max(L.max, R.max), L.rmax + R.lmax);    res.lmax = max(L.lmax, L.sum + R.lmax);    res.rmax = max(R.rmax, R.sum + L.rmax);    res.sum = L.sum + R.sum;    return res;}"><div></div></button></div></figure></div><p>首先，我们依然判断当前区间是否已被完全包含，若是则直接返回当前节点。接下来是不同之处：如果查询区间完全在中点右侧，那么返回右侧查询的结果，反之亦然，查询左侧。</p><p>如果区间不完全在中点一侧，那么左右分别查询，获得左右子节点的信息。接下来就可以按照正常的维护方法维护返回值节点的相关信息了。</p></section></section>
<section><h2 id="线段树的修改操作">线段树的修改操作<a class="anchor" href="#线段树的修改操作"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h2><p>同样分为单点修改和区间修改，前者同样是后者的特殊情况。基本思路相同，先找到被完全包含的区间。但是此时可以有一个优化——不用每一次都递归到区间的叶子节点再进行修改，可以直接将修改信息记录在一个大区间内，当查询需要用到子节点的值时再一次性下放积累的操作。线段树中记录这些操作的标记便被称作懒标记。</p><p>对于某个区间，需要先把当前区间的相关信息修改之后再返回，否则相当于没有修改（只是打个标记，当前节点并未更新）。以区间加为例：</p><div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="C++"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">void</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">modify</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">l</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">r</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">x</span><span style="--0:#ABB2BF">) {</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">pushdown</span><span style="--0:#ABB2BF;--1:#383A42">(idx);</span><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic"> // 可能还有积累的操作</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#56B6C2;--1:#A626A4">&#x26;&#x26;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> r) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">max</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+=</span><span style="--0:#ABB2BF;--1:#383A42"> x;</span><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic"> // 更新当前区间的最大值</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">add</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+=</span><span style="--0:#ABB2BF;--1:#383A42"> x;</span><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic"> // 打标记</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> mid </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42">) </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> mid) </span><span style="--0:#61AFEF;--1:#3360C1">modify</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, r, x, type);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (r </span><span style="--0:#CD89E1;--1:#A626A4">></span><span style="--0:#ABB2BF;--1:#383A42"> mid) </span><span style="--0:#61AFEF;--1:#3360C1">modify</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, r, x, type);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">pushup</span><span style="--0:#ABB2BF;--1:#383A42">(idx);</span><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic"> // 由于更新了当前节点，需要向上更新其他节点</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="void modify(int idx, int l, int r, int x) {    pushdown(idx); // 可能还有积累的操作    if (l <= tree[idx].l &#x26;&#x26; tree[idx].r <= r) {        tree[idx].max += x; // 更新当前区间的最大值        tree[idx].add += x; // 打标记        return;    }    int mid = (tree[idx].l + tree[idx].r) >> 1;    if (l <= mid) modify(le(idx), l, r, x, type);    if (r > mid) modify(ri(idx), l, r, x, type);    pushup(idx); // 由于更新了当前节点，需要向上更新其他节点}"><div></div></button></div></figure></div></section>
<section><h2 id="一些细节">一些细节<a class="anchor" href="#一些细节"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h2><section><h3 id="一句话让评测结果从-re-到-ac">一句话，让评测结果从 RE 到 AC<a class="anchor" href="#一句话让评测结果从-re-到-ac"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h3><p>有时你会发现——明明题目中说了 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mo>≤</mo><msup><mn>10</mn><mn>5</mn></msup></mrow><annotation encoding="application/x-tex">N\leq10^5</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8193em;vertical-align:-0.136em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8141em;"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">5</span></span></span></span></span></span></span></span></span></span></span>，我也开了四倍空间，为什么还是会 RE？事实上，这可能是因为错误的 <code>pushdown</code> 位置和特判的缺乏。</p><p>比如下面这段区间修改的代码（来源 <a href="https://www.luogu.com.cn/problem/P2574">P2574 XOR的艺术</a>）：</p><div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="C++"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">void</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">modify</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">l</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">r</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">x</span><span style="--0:#ABB2BF">) {</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">pushdown</span><span style="--0:#ABB2BF;--1:#383A42">(idx);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#56B6C2;--1:#A626A4">&#x26;&#x26;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> r) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> x </span><span style="--0:#CD89E1;--1:#A626A4">*</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">size</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">que</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> x;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">lmax</span><span style="--0:#ABB2BF;--1:#383A42">[x] </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">rmax</span><span style="--0:#ABB2BF;--1:#383A42">[x] </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">max</span><span style="--0:#ABB2BF;--1:#383A42">[x] </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">size</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">lmax</span><span style="--0:#ABB2BF;--1:#383A42">[x </span><span style="--0:#56B6C2;--1:#A626A4">^</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">] </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">rmax</span><span style="--0:#ABB2BF;--1:#383A42">[x </span><span style="--0:#56B6C2;--1:#A626A4">^</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">] </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">max</span><span style="--0:#ABB2BF;--1:#383A42">[x </span><span style="--0:#56B6C2;--1:#A626A4">^</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">] </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> mid </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42">) </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> mid) </span><span style="--0:#61AFEF;--1:#3360C1">modify</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, r, x);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (r </span><span style="--0:#CD89E1;--1:#A626A4">></span><span style="--0:#ABB2BF;--1:#383A42"> mid) </span><span style="--0:#61AFEF;--1:#3360C1">modify</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, r, x);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">13</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">pushup</span><span style="--0:#ABB2BF;--1:#383A42">(idx);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">14</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="void modify(int idx, int l, int r, int x) {    pushdown(idx);    if (l <= tree[idx].l &#x26;&#x26; tree[idx].r <= r) {        tree[idx].sum = x * tree[idx].size;        tree[idx].que = x;        tree[idx].lmax[x] = tree[idx].rmax[x] = tree[idx].max[x] = tree[idx].size;        tree[idx].lmax[x ^ 1] = tree[idx].rmax[x ^ 1] = tree[idx].max[x ^ 1] = 0;        return;    }    int mid = (tree[idx].l + tree[idx].r) >> 1;    if (l <= mid) modify(le(idx), l, r, x);    if (r > mid) modify(ri(idx), l, r, x);    pushup(idx);}"><div></div></button></div></figure></div><p>其中 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mo>≤</mo><mn>2</mn><mo>×</mo><msup><mn>10</mn><mn>5</mn></msup></mrow><annotation encoding="application/x-tex">N\leq2\times10^5 </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8193em;vertical-align:-0.136em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8141em;"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">5</span></span></span></span></span></span></span></span></span></span></span>，代码中也是如此，但是最后有两个点 RE。这是因为 <code>pushdown</code> 放在了错误的位置上，在递归到单点前，会执行一次 <code>pushdown</code> 操作，此时就会在叶子节点的左右子树上检测懒标记（事实上没必要），在极端情况下，会访问到最后一个叶子节点的右子树（最坏 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>5</mn><mo>×</mo><msup><mn>10</mn><mn>5</mn></msup></mrow><annotation encoding="application/x-tex">5\times10^5</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">5</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8141em;"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">5</span></span></span></span></span></span></span></span></span></span></span>），是肯定会 RE 的。把下传操作放在 <code>l == r</code> 的判断之后即可。</p></section><section><h3 id="标记置零问题">标记置零问题<a class="anchor" href="#标记置零问题"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h3><p>有时，在下传操作中，在处理完当前标记之后是不能直接把标记置零的，例如（来源 <a href="https://www.luogu.com.cn/problem/P1253">P1253 扶苏的问题</a>）：</p><div class="expressive-code"><div class="ec-collapse ec-collapse--collapsed" id="collapse-j97fsclx1" data-collapse-preview-lines="8" data-expanded-announcement="代码块已展开" data-collapsed-announcement="代码块已折叠"><div class="ec-collapse__content"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="C++"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">void</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">pushdown</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">) {</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">que</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">!=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">-</span><span style="--0:#ABB2BF;--1:#383A42">LLONG_MAX) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">max</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">que</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">que</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">que</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">add</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">max</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">que</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">que</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">que</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">add</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">que</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">-</span><span style="--0:#ABB2BF;--1:#383A42">LLONG_MAX;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">add</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">13</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">add</span><span style="--0:#ABB2BF;--1:#383A42">) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">14</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">max</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">add</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">15</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">add</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">add</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">16</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">max</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">add</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">17</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">add</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">add</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">18</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">19</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">add</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">20</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">21</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="void pushdown(int idx) {    if (tree[idx].que != -LLONG_MAX) {        leftSubtree(idx).max = tree[idx].que;        leftSubtree(idx).que = tree[idx].que;        leftSubtree(idx).add = 0;        rightSubtree(idx).max = tree[idx].que;        rightSubtree(idx).que = tree[idx].que;        rightSubtree(idx).add = 0;        tree[idx].que = -LLONG_MAX;        tree[idx].add = 0;    }    if (tree[idx].add) {        leftSubtree(idx).max += tree[idx].add;        leftSubtree(idx).add += tree[idx].add;        rightSubtree(idx).max += tree[idx].add;        rightSubtree(idx).add += tree[idx].add;        tree[idx].add = 0;    }}"><div></div></button></div></figure><div class="ec-collapse__gradient" aria-hidden="true"></div></div><button class="ec-collapse__toggle" type="button" aria-expanded="false" aria-controls="collapse-j97fsclx1"><span class="ec-collapse__text-expand">显示更多</span><span class="ec-collapse__text-collapse">显示更少</span><svg class="ec-collapse__icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" aria-hidden="true"><path fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="M6 9l6 6 6-6"></path></svg></button></div></div><p>乍一看没什么问题，但是推平标记里 <code>tree[idx].add = 0</code> 却是造成 WA 的元凶。清空加运算标记，其实也就意味着把整段区间的区间加标记清空。然而在递归时是有可能向该区间的某个子区间递归的，于是当前区间就会有一头一尾的部分位置不需要被处理，但是你却把它们的区间加标记清空了，显然错误。正确做法是删去这一行。</p></section></section>
<section><h2 id="简单应用">简单应用<a class="anchor" href="#简单应用"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h2><p>这些是线段树的基础维护问题，用来夯实线段树基础，为拓展线段树的高级思维做铺垫。</p><section><h3 id="单调性判断">单调性判断<a class="anchor" href="#单调性判断"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h3><p>例题：<a href="https://www.luogu.com.cn/problem/P6812">P6812 「MCOI-02」Ancestor 先辈</a></p><p>难度：<span data-luogu="" data-green="">普及+/提高</span></p><p>维护变量：区间左右端点值、区间单调性标记</p><p>题目中的区间加因为比较板子故在此省去，我们只探讨区间单调性的维护方法。</p><p>对于叶子节点，必定满足单调性，我们只需考虑向上合并时的策略。注意到如果左右子树都满足单调性，那么能够决定整体区间单调性的就只有左子树的右端点和右子树的左端点的相对大小关系。故我们只需多维护当前区间的左右端点并在上传时维护单调性标记即可，维护方法见上面的分析。因为单调性标记的维护涉及到多个变量，查询时需要用到前面讲过的复杂查询。</p><div class="expressive-code"><div class="ec-collapse ec-collapse--collapsed" id="collapse-gdtpgd3oo" data-collapse-preview-lines="8" data-expanded-announcement="代码块已展开" data-collapsed-announcement="代码块已折叠"><div class="ec-collapse__content"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="C++"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#include</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#98C379;--1:#387138">&#x3C;bits/stdc++.h></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#define</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">N</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1500010</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">using</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">namespace</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E5C07B">std</span><span style="--0:#ABB2BF">;</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">typedef</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">long</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">long</span><span style="--0:#ABB2BF;--1:#383A42"> ll;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">struct</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#885D01">SegmentTree</span><span style="--0:#ABB2BF;--1:#383A42"> {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#define</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--1:#383A42"><span style="--0:#ABB2BF">(</span><span style="--0:#E6888F;--0fs:italic">x</span><span style="--0:#ABB2BF">) (x </span></span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#define</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--1:#383A42"><span style="--0:#ABB2BF">(</span><span style="--0:#E6888F;--0fs:italic">x</span><span style="--0:#ABB2BF">) (x </span></span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#56B6C2;--1:#A626A4">|</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#define</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--1:#383A42"><span style="--0:#ABB2BF">(</span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">) (</span></span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--0:#ABB2BF;--1:#383A42">(idx)])</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#define</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--1:#383A42"><span style="--0:#ABB2BF">(</span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">) (</span></span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--0:#ABB2BF;--1:#383A42">(idx)])</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> l, r, size;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">13</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">ll lazy;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">14</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">ll </span><span style="--0:#E5C07B;--1:#AF4238">ends</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">2</span><span style="--0:#ABB2BF;--1:#383A42">];</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">15</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">bool</span><span style="--0:#ABB2BF;--1:#383A42"> flag;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">16</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">} </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[N </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">2</span><span style="--0:#ABB2BF;--1:#383A42">];</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">17</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">ll </span><span style="--0:#E5C07B;--1:#AF4238">a</span><span style="--0:#ABB2BF;--1:#383A42">[N];</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">18</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">19</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">void</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">pushup</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">) {</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">20</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">flag</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">flag</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#56B6C2;--1:#A626A4">&#x26;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">flag</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#56B6C2;--1:#A626A4">&#x26;</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">ends</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">] </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">ends</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">]));</span><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic"> // 单调递增序列需满足左子树的右端点小于等于右子树的左端点</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">21</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">ends</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">] </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">ends</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">];</span><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic"> // 大区间的左端点就是左子树的左端点</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">22</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">ends</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">] </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">ends</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">];</span><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic"> // 大区间的右端点就是右子树的右端点</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">23</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">24</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">25</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">void</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">build</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">l</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">r</span><span style="--0:#ABB2BF">) {</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">26</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> l, </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> r;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">27</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">size</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> r </span><span style="--0:#CD89E1;--1:#A626A4">-</span><span style="--0:#ABB2BF;--1:#383A42"> l </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">28</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">==</span><span style="--0:#ABB2BF;--1:#383A42"> r) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">29</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">flag</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">true</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">30</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">ends</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">] </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">ends</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">] </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">a</span><span style="--0:#ABB2BF;--1:#383A42">[l];</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">31</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">32</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">33</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> mid </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> l </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> r </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">34</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">build</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, mid);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">35</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">build</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--0:#ABB2BF;--1:#383A42">(idx), mid </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, r);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">36</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">pushup</span><span style="--0:#ABB2BF;--1:#383A42">(idx);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">37</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">38</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">39</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">void</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">pushdown</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">) {</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">40</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">lazy</span><span style="--0:#ABB2BF;--1:#383A42">) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">41</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">lazy</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">lazy</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">42</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">ends</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">] </span><span style="--0:#CD89E1;--1:#A626A4">+=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">lazy</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">43</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">ends</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">] </span><span style="--0:#CD89E1;--1:#A626A4">+=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">lazy</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">44</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">lazy</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">lazy</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">45</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">ends</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">] </span><span style="--0:#CD89E1;--1:#A626A4">+=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">lazy</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">46</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">ends</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">] </span><span style="--0:#CD89E1;--1:#A626A4">+=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">lazy</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">47</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">48</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">lazy</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">49</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">50</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">51</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">52</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">void</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">modify</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">l</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">r</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#E5C07B;--1:#885D01">ll</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">x</span><span style="--0:#ABB2BF">) {</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">53</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#56B6C2;--1:#A626A4">&#x26;&#x26;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> r) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">54</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">lazy</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+=</span><span style="--0:#ABB2BF;--1:#383A42"> x;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">55</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">ends</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">] </span><span style="--0:#CD89E1;--1:#A626A4">+=</span><span style="--0:#ABB2BF;--1:#383A42"> x;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">56</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">ends</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">] </span><span style="--0:#CD89E1;--1:#A626A4">+=</span><span style="--0:#ABB2BF;--1:#383A42"> x;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">57</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">58</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">59</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">pushdown</span><span style="--0:#ABB2BF;--1:#383A42">(idx);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">60</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> mid </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">61</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> mid) </span><span style="--0:#61AFEF;--1:#3360C1">modify</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, r, x);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">62</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (r </span><span style="--0:#CD89E1;--1:#A626A4">></span><span style="--0:#ABB2BF;--1:#383A42"> mid) </span><span style="--0:#61AFEF;--1:#3360C1">modify</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, r, x);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">63</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">pushup</span><span style="--0:#ABB2BF;--1:#383A42">(idx);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">64</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">65</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">66</div></div><div class="code"><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic">// 复杂查询处理标记</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">67</div></div><div class="code"><span style="--0:#E5C07B;--1:#885D01">SegmentTree</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">query</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">l</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">r</span><span style="--0:#ABB2BF">) {</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">68</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#56B6C2;--1:#A626A4">&#x26;&#x26;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> r) </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx];</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">69</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">pushdown</span><span style="--0:#ABB2BF;--1:#383A42">(idx);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">70</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> mid </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">71</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">></span><span style="--0:#ABB2BF;--1:#383A42"> mid) </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">query</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, r);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">72</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (r </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> mid) </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">query</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, r);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">73</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">SegmentTree L </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">query</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, r);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">74</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">SegmentTree R </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">query</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, r);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">75</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42"> {</span><span style="--0:#E5C07B;--1:#AF4238">L</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42">, </span><span style="--0:#E5C07B;--1:#AF4238">R</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42">, </span><span style="--0:#E5C07B;--1:#AF4238">L</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">size</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">R</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">size</span><span style="--0:#ABB2BF;--1:#383A42">, </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">, {</span><span style="--0:#E5C07B;--1:#AF4238">L</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">ends</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">], </span><span style="--0:#E5C07B;--1:#AF4238">R</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">ends</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">]}, </span><span style="--1:#A626A4"><span style="--0:#ABB2BF">static_cast</span><span style="--0:#CD89E1">&#x3C;bool></span></span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#E5C07B;--1:#AF4238">L</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">flag</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#56B6C2;--1:#A626A4">&#x26;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">R</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">flag</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#56B6C2;--1:#A626A4">&#x26;</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#E5C07B;--1:#AF4238">L</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">ends</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">] </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">R</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">ends</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">]))};</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">76</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">77</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">78</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">main</span><span style="--0:#ABB2BF;--1:#383A42">() {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">79</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">ios::</span><span style="--0:#61AFEF;--1:#3360C1">sync_with_stdio</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">false</span><span style="--0:#ABB2BF;--1:#383A42">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">80</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">cin</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#61AFEF;--1:#3360C1">tie</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">nullptr</span><span style="--0:#ABB2BF;--1:#383A42">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">81</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">cout</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#61AFEF;--1:#3360C1">tie</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">nullptr</span><span style="--0:#ABB2BF;--1:#383A42">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">82</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">83</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> n, k;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">84</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">cin </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> n </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> k;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">85</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">for</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> i </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">; i </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> n; i</span><span style="--0:#CD89E1;--1:#A626A4">++</span><span style="--0:#ABB2BF;--1:#383A42">) cin </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">a</span><span style="--0:#ABB2BF;--1:#383A42">[i];</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">86</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">build</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, n);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">87</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">while</span><span style="--0:#ABB2BF;--1:#383A42"> (k</span><span style="--0:#CD89E1;--1:#A626A4">--</span><span style="--0:#ABB2BF;--1:#383A42">) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">88</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> opt, l, r;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">89</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">        </span></span><span style="--0:#ABB2BF;--1:#383A42">cin </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> opt </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> l </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> r;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">90</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (opt </span><span style="--0:#CD89E1;--1:#A626A4">==</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">91</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">            </span></span><span style="--0:#ABB2BF;--1:#383A42">ll x;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">92</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">            </span></span><span style="--0:#ABB2BF;--1:#383A42">cin </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> x;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">93</div></div><div class="code"><span class="indent">            </span><span style="--0:#61AFEF;--1:#3360C1">modify</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, l, r, x);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">94</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">        </span></span><span style="--0:#ABB2BF;--1:#383A42">} </span><span style="--0:#CD89E1;--1:#A626A4">else</span><span style="--0:#ABB2BF;--1:#383A42"> cout </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#61AFEF;--1:#3360C1">query</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, l, r).</span><span style="--0:#E6888F;--1:#AF4238">flag</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">?</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#98C379;--1:#387138">"Yes"</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">:</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#98C379;--1:#387138">"No"</span><span style="--0:#ABB2BF;--1:#383A42">) </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#98C379;--1:#387138">'</span><span style="--0:#56B6C2;--1:#016C9A">\n</span><span style="--0:#98C379;--1:#387138">'</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">95</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">96</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">97</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">98</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="#include <bits/stdc++.h>#define N 1500010using namespace std;typedef long long ll;struct SegmentTree {#define le(x) (x << 1)#define ri(x) (x << 1 | 1)#define leftSubtree(idx) (tree[le(idx)])#define rightSubtree(idx) (tree[ri(idx)])    int l, r, size;    ll lazy;    ll ends[2];    bool flag;} tree[N << 2];ll a[N];void pushup(int idx) {    tree[idx].flag = (leftSubtree(idx).flag &#x26; rightSubtree(idx).flag &#x26; (leftSubtree(idx).ends[1] <= rightSubtree(idx).ends[0])); // 单调递增序列需满足左子树的右端点小于等于右子树的左端点    tree[idx].ends[0] = leftSubtree(idx).ends[0]; // 大区间的左端点就是左子树的左端点    tree[idx].ends[1] = rightSubtree(idx).ends[1]; // 大区间的右端点就是右子树的右端点}void build(int idx, int l, int r) {    tree[idx].l = l, tree[idx].r = r;    tree[idx].size = r - l + 1;    if (l == r) {        tree[idx].flag = true;        tree[idx].ends[0] = tree[idx].ends[1] = a[l];        return;    }    int mid = l + r >> 1;    build(le(idx), l, mid);    build(ri(idx), mid + 1, r);    pushup(idx);}void pushdown(int idx) {    if (tree[idx].lazy) {        leftSubtree(idx).lazy += tree[idx].lazy;        leftSubtree(idx).ends[0] += tree[idx].lazy;        leftSubtree(idx).ends[1] += tree[idx].lazy;        rightSubtree(idx).lazy += tree[idx].lazy;        rightSubtree(idx).ends[0] += tree[idx].lazy;        rightSubtree(idx).ends[1] += tree[idx].lazy;        tree[idx].lazy = 0;    }}void modify(int idx, int l, int r, ll x) {    if (l <= tree[idx].l &#x26;&#x26; tree[idx].r <= r) {        tree[idx].lazy += x;        tree[idx].ends[0] += x;        tree[idx].ends[1] += x;        return;    }    pushdown(idx);    int mid = tree[idx].l + tree[idx].r >> 1;    if (l <= mid) modify(le(idx), l, r, x);    if (r > mid) modify(ri(idx), l, r, x);    pushup(idx);}// 复杂查询处理标记SegmentTree query(int idx, int l, int r) {    if (l <= tree[idx].l &#x26;&#x26; tree[idx].r <= r) return tree[idx];    pushdown(idx);    int mid = tree[idx].l + tree[idx].r >> 1;    if (l > mid) return query(ri(idx), l, r);    if (r <= mid) return query(le(idx), l, r);    SegmentTree L = query(le(idx), l, r);    SegmentTree R = query(ri(idx), l, r);    return {L.l, R.r, L.size + R.size, 0, {L.ends[0], R.ends[1]}, static_cast<bool>(L.flag &#x26; R.flag &#x26; (L.ends[1] <= R.ends[0]))};}int main() {    ios::sync_with_stdio(false);    cin.tie(nullptr);    cout.tie(nullptr);    int n, k;    cin >> n >> k;    for (int i = 1; i <= n; i++) cin >> a[i];    build(1, 1, n);    while (k--) {        int opt, l, r;        cin >> opt >> l >> r;        if (opt == 1) {            ll x;            cin >> x;            modify(1, l, r, x);        } else cout << (query(1, l, r).flag ? &#x22;Yes&#x22; : &#x22;No&#x22;) << &#x27;\n&#x27;;    }    return 0;}"><div></div></button></div></figure><div class="ec-collapse__gradient" aria-hidden="true"></div></div><button class="ec-collapse__toggle" type="button" aria-expanded="false" aria-controls="collapse-gdtpgd3oo"><span class="ec-collapse__text-expand">显示更多</span><span class="ec-collapse__text-collapse">显示更少</span><svg class="ec-collapse__icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" aria-hidden="true"><path fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="M6 9l6 6 6-6"></path></svg></button></div></div></section><section><h3 id="单点修改区间乘积正负性">单点修改+区间乘积正负性<a class="anchor" href="#单点修改区间乘积正负性"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h3><p>例题：<a href="https://www.luogu.com.cn/problem/UVA12532">UVA12532 Interval Product</a></p><p>难度：<span data-luogu="" data-green="">普及+/提高</span></p><p>维护变量：正负性标记</p><p>我们都知道，异号相乘得负、同号相乘得正。对于叶子节点，正负性是可以确定的。那么考虑上传操作，发现我们只需得知左右子树的正负性就可以得到当前区间的正负性。因此用一个正负性标记，取值 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">{</mo><mo>−</mo><mn>1</mn><mo separator="true">,</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">\{-1,0,1\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span class="mord">−</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">1</span><span class="mclose">}</span></span></span></span>，那么上传时就可以用左右子树的标记乘积来更新当前区间的正负性标记。单点修改非常模板此处不再赘述。</p><div class="expressive-code"><div class="ec-collapse ec-collapse--collapsed" id="collapse-5wo3159z3" data-collapse-preview-lines="8" data-expanded-announcement="代码块已展开" data-collapsed-announcement="代码块已折叠"><div class="ec-collapse__content"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="C++"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#include</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#98C379;--1:#387138">&#x3C;bits/stdc++.h></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#define</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">N</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">100010</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">using</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">namespace</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E5C07B">std</span><span style="--0:#ABB2BF">;</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">struct</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#885D01">SegmentTree</span><span style="--0:#ABB2BF;--1:#383A42"> {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#define</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--1:#383A42"><span style="--0:#ABB2BF">(</span><span style="--0:#E6888F;--0fs:italic">x</span><span style="--0:#ABB2BF">) (x </span></span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#define</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--1:#383A42"><span style="--0:#ABB2BF">(</span><span style="--0:#E6888F;--0fs:italic">x</span><span style="--0:#ABB2BF">) (x </span></span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#56B6C2;--1:#A626A4">|</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#define</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--1:#383A42"><span style="--0:#ABB2BF">(</span><span style="--0:#E6888F;--0fs:italic">x</span><span style="--0:#ABB2BF">) (</span></span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--0:#ABB2BF;--1:#383A42">(x)])</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#define</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--1:#383A42"><span style="--0:#ABB2BF">(</span><span style="--0:#E6888F;--0fs:italic">x</span><span style="--0:#ABB2BF">) (</span></span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--0:#ABB2BF;--1:#383A42">(x)])</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> l, r, size;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> flag;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">} </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[N </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">2</span><span style="--0:#ABB2BF;--1:#383A42">];</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">13</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">a</span><span style="--0:#ABB2BF;--1:#383A42">[N];</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">14</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">15</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">void</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">pushup</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">) {</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">16</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">flag</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">flag</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">*</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">flag</span><span style="--0:#ABB2BF;--1:#383A42">;</span><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic"> // 更新标记为左右子树的标记之积</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">17</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">18</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">19</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">void</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">build</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">l</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">r</span><span style="--0:#ABB2BF">) {</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">20</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> l, </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> r;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">21</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">size</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> r </span><span style="--0:#CD89E1;--1:#A626A4">-</span><span style="--0:#ABB2BF;--1:#383A42"> l </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">22</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">==</span><span style="--0:#ABB2BF;--1:#383A42"> r) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">23</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#E5C07B;--1:#AF4238">a</span><span style="--0:#ABB2BF;--1:#383A42">[l] </span><span style="--0:#CD89E1;--1:#A626A4">==</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">) </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">flag</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">24</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#E5C07B;--1:#AF4238">a</span><span style="--0:#ABB2BF;--1:#383A42">[l] </span><span style="--0:#CD89E1;--1:#A626A4">></span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">) </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">flag</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">25</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#E5C07B;--1:#AF4238">a</span><span style="--0:#ABB2BF;--1:#383A42">[l] </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">) </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">flag</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">-</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">26</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">27</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">28</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> mid </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> r) </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">29</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">build</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, mid);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">30</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">build</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--0:#ABB2BF;--1:#383A42">(idx), mid </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, r);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">31</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">pushup</span><span style="--0:#ABB2BF;--1:#383A42">(idx);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">32</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">33</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">34</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">void</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">modify</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">uid</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">x</span><span style="--0:#ABB2BF">) {</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">35</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">size</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">==</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#56B6C2;--1:#A626A4">&#x26;&#x26;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">==</span><span style="--0:#ABB2BF;--1:#383A42"> uid) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">36</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (x </span><span style="--0:#CD89E1;--1:#A626A4">==</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">) </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">flag</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">37</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (x </span><span style="--0:#CD89E1;--1:#A626A4">></span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">) </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">flag</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">38</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (x </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">) </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">flag</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">-</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">39</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">40</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">41</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> mid </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42">) </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">42</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (uid </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> mid) </span><span style="--0:#61AFEF;--1:#3360C1">modify</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--0:#ABB2BF;--1:#383A42">(idx), uid, x);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">43</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (uid </span><span style="--0:#CD89E1;--1:#A626A4">></span><span style="--0:#ABB2BF;--1:#383A42"> mid) </span><span style="--0:#61AFEF;--1:#3360C1">modify</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--0:#ABB2BF;--1:#383A42">(idx), uid, x);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">44</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">pushup</span><span style="--0:#ABB2BF;--1:#383A42">(idx);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">45</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">46</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">47</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">query</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">l</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">r</span><span style="--0:#ABB2BF">) {</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">48</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#56B6C2;--1:#A626A4">&#x26;&#x26;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> r) </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">flag</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">49</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> flag </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">50</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> mid </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42">) </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">51</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> mid) flag </span><span style="--0:#CD89E1;--1:#A626A4">*=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">query</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, r);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">52</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (r </span><span style="--0:#CD89E1;--1:#A626A4">></span><span style="--0:#ABB2BF;--1:#383A42"> mid) flag </span><span style="--0:#CD89E1;--1:#A626A4">*=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">query</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, r);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">53</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42"> flag;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">54</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">55</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">56</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">main</span><span style="--0:#ABB2BF;--1:#383A42">() {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">57</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">ios::</span><span style="--0:#61AFEF;--1:#3360C1">sync_with_stdio</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">false</span><span style="--0:#ABB2BF;--1:#383A42">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">58</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">cin</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#61AFEF;--1:#3360C1">tie</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">nullptr</span><span style="--0:#ABB2BF;--1:#383A42">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">59</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">cout</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#61AFEF;--1:#3360C1">tie</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">nullptr</span><span style="--0:#ABB2BF;--1:#383A42">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">60</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">61</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> n, k;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">62</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">while</span><span style="--0:#ABB2BF;--1:#383A42"> (cin </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> n </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> k) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">63</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">for</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> i </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">; i </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> n; i</span><span style="--0:#CD89E1;--1:#A626A4">++</span><span style="--0:#ABB2BF;--1:#383A42">) cin </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">a</span><span style="--0:#ABB2BF;--1:#383A42">[i];</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">64</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">build</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, n);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">65</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">while</span><span style="--0:#ABB2BF;--1:#383A42"> (k</span><span style="--0:#CD89E1;--1:#A626A4">--</span><span style="--0:#ABB2BF;--1:#383A42">) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">66</div></div><div class="code"><span class="indent">            </span><span style="--0:#CD89E1;--1:#A626A4">char</span><span style="--0:#ABB2BF;--1:#383A42"> op;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">67</div></div><div class="code"><span class="indent">            </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> l, r;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">68</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">            </span></span><span style="--0:#ABB2BF;--1:#383A42">cin </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> op </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> l </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> r;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">69</div></div><div class="code"><span class="indent">            </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (op </span><span style="--0:#CD89E1;--1:#A626A4">==</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#98C379;--1:#387138">'C'</span><span style="--0:#ABB2BF;--1:#383A42">) </span><span style="--0:#61AFEF;--1:#3360C1">modify</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, l, r);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">70</div></div><div class="code"><span class="indent">            </span><span style="--0:#CD89E1;--1:#A626A4">else</span><span style="--0:#ABB2BF;--1:#383A42"> {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">71</div></div><div class="code"><span class="indent">                </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> res </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">query</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, l, r);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">72</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">                </span></span><span style="--0:#ABB2BF;--1:#383A42">cout </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> (res </span><span style="--0:#CD89E1;--1:#A626A4">==</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">?</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#98C379;--1:#387138">'0'</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">:</span><span style="--0:#ABB2BF;--1:#383A42"> res </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">?</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#98C379;--1:#387138">'-'</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">:</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#98C379;--1:#387138">'+'</span><span style="--0:#ABB2BF;--1:#383A42">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">73</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">            </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">74</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">        </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">75</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">        </span></span><span style="--0:#ABB2BF;--1:#383A42">cout </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> endl;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">76</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">77</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">78</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">79</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="#include <bits/stdc++.h>#define N 100010using namespace std;struct SegmentTree {#define le(x) (x << 1)#define ri(x) (x << 1 | 1)#define leftSubtree(x) (tree[le(x)])#define rightSubtree(x) (tree[ri(x)])    int l, r, size;    int flag;} tree[N << 2];int a[N];void pushup(int idx) {    tree[idx].flag = leftSubtree(idx).flag * rightSubtree(idx).flag; // 更新标记为左右子树的标记之积}void build(int idx, int l, int r) {    tree[idx].l = l, tree[idx].r = r;    tree[idx].size = r - l + 1;    if (l == r) {        if (a[l] == 0) tree[idx].flag = 0;        if (a[l] > 0) tree[idx].flag = 1;        if (a[l] < 0) tree[idx].flag = -1;        return;    }    int mid = (l + r) >> 1;    build(le(idx), l, mid);    build(ri(idx), mid + 1, r);    pushup(idx);}void modify(int idx, int uid, int x) {    if (tree[idx].size == 1 &#x26;&#x26; tree[idx].l == uid) {        if (x == 0) tree[idx].flag = 0;        if (x > 0) tree[idx].flag = 1;        if (x < 0) tree[idx].flag = -1;        return;    }    int mid = (tree[idx].l + tree[idx].r) >> 1;    if (uid <= mid) modify(le(idx), uid, x);    if (uid > mid) modify(ri(idx), uid, x);    pushup(idx);}int query(int idx, int l, int r) {    if (l <= tree[idx].l &#x26;&#x26; tree[idx].r <= r) return tree[idx].flag;    int flag = 1;    int mid = (tree[idx].l + tree[idx].r) >> 1;    if (l <= mid) flag *= query(le(idx), l, r);    if (r > mid) flag *= query(ri(idx), l, r);    return flag;}int main() {    ios::sync_with_stdio(false);    cin.tie(nullptr);    cout.tie(nullptr);    int n, k;    while (cin >> n >> k) {        for (int i = 1; i <= n; i++) cin >> a[i];        build(1, 1, n);        while (k--) {            char op;            int l, r;            cin >> op >> l >> r;            if (op == &#x27;C&#x27;) modify(1, l, r);            else {                int res = query(1, l, r);                cout << (res == 0 ? &#x27;0&#x27; : res < 0 ? &#x27;-&#x27; : &#x27;+&#x27;);            }        }        cout << endl;    }    return 0;}"><div></div></button></div></figure><div class="ec-collapse__gradient" aria-hidden="true"></div></div><button class="ec-collapse__toggle" type="button" aria-expanded="false" aria-controls="collapse-5wo3159z3"><span class="ec-collapse__text-expand">显示更多</span><span class="ec-collapse__text-collapse">显示更少</span><svg class="ec-collapse__icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" aria-hidden="true"><path fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="M6 9l6 6 6-6"></path></svg></button></div></div></section></section>
<section><h2 id="维护差分">维护差分<a class="anchor" href="#维护差分"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h2><p>线段树维护原序列的差分数组也是比较挑战思维的题型。通过维护原序列的差分序列，我们有时可以把一段区间的操作转化成对应区间端点或其邻点的单点操作。</p><section><h3 id="种类数">种类数<a class="anchor" href="#种类数"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h3><p>例题：<a href="https://www.luogu.com.cn/problem/P2184">P2184 贪婪大陆</a></p><p>难度：<span data-luogu="" data-green="">普及+/提高</span></p><p>维护变量：区间和</p><p>像这种每次往某个区间加入一种不同种类的值，然后询问区间覆盖了几种不同的值，可以借助差分的思想。</p><p>将每个插入操作的区间看作有左右两个端点（起点、终点）的线段，因为每次插入的是不同种类的数，因此无需过多操作。对于每个 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mi>l</mi><mo separator="true">,</mo><mi>r</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[l,r]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mclose">]</span></span></span></span> 的询问，答案即为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mn>1</mn><mo separator="true">,</mo><mi>r</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[1,r]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mclose">]</span></span></span></span> 内的起点数减去 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mn>1</mn><mo separator="true">,</mo><mi>l</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">[1,l)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mclose">)</span></span></span></span> 内的终点数。也就是说 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mn>1</mn><mo separator="true">,</mo><mi>r</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[1,r]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mclose">]</span></span></span></span> 内有若干颜色段覆盖了一些区域，而 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mn>1</mn><mo separator="true">,</mo><mi>l</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">[1,l)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mclose">)</span></span></span></span> 内又有一些颜色段没有覆盖到 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi></mrow><annotation encoding="application/x-tex">l</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span></span></span></span> 及之后的区域，二者相减就是答案。</p><p>因此插入时暴力地增加两个端点的计数，输出时统计相减即可。</p><div class="expressive-code"><div class="ec-collapse ec-collapse--collapsed" id="collapse-gv310vp65" data-collapse-preview-lines="8" data-expanded-announcement="代码块已展开" data-collapsed-announcement="代码块已折叠"><div class="ec-collapse__content"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="C++"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#include</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#98C379;--1:#387138">&#x3C;bits/stdc++.h></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#define</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">N</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">100010</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">using</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">namespace</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E5C07B">std</span><span style="--0:#ABB2BF">;</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">struct</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#885D01">SegmentTree</span><span style="--0:#ABB2BF;--1:#383A42"> {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#define</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--1:#383A42"><span style="--0:#ABB2BF">(</span><span style="--0:#E6888F;--0fs:italic">x</span><span style="--0:#ABB2BF">) (x </span></span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#define</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--1:#383A42"><span style="--0:#ABB2BF">(</span><span style="--0:#E6888F;--0fs:italic">x</span><span style="--0:#ABB2BF">) (x </span></span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#56B6C2;--1:#A626A4">|</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#define</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--1:#383A42"><span style="--0:#ABB2BF">(</span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">) (</span></span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--0:#ABB2BF;--1:#383A42">(idx)])</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#define</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--1:#383A42"><span style="--0:#ABB2BF">(</span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">) (</span></span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--0:#ABB2BF;--1:#383A42">(idx)])</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> l, r, size;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">2</span><span style="--0:#ABB2BF;--1:#383A42">];</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">13</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">} </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[N </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">2</span><span style="--0:#ABB2BF;--1:#383A42">];</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">14</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">15</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">void</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">pushup</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">) {</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">16</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">] </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">] </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">];</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">17</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">] </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">] </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">];</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">18</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">19</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">20</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">void</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">build</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">l</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">r</span><span style="--0:#ABB2BF">) {</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">21</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> l, </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> r;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">22</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">size</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> r </span><span style="--0:#CD89E1;--1:#A626A4">-</span><span style="--0:#ABB2BF;--1:#383A42"> l </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">23</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">==</span><span style="--0:#ABB2BF;--1:#383A42"> r) </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">24</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> mid </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> r) </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">25</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">build</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, mid);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">26</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">build</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--0:#ABB2BF;--1:#383A42">(idx), mid </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, r);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">27</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">pushup</span><span style="--0:#ABB2BF;--1:#383A42">(idx);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">28</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">29</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">30</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">void</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">modifySt</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">uid</span><span style="--0:#ABB2BF">) {</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">31</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">size</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">==</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#56B6C2;--1:#A626A4">&#x26;&#x26;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">==</span><span style="--0:#ABB2BF;--1:#383A42"> uid) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">32</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">]</span><span style="--0:#CD89E1;--1:#A626A4">++</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">33</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">34</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">35</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> mid </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42">) </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">36</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (uid </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> mid) </span><span style="--0:#61AFEF;--1:#3360C1">modifySt</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--0:#ABB2BF;--1:#383A42">(idx), uid);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">37</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (uid </span><span style="--0:#CD89E1;--1:#A626A4">></span><span style="--0:#ABB2BF;--1:#383A42"> mid) </span><span style="--0:#61AFEF;--1:#3360C1">modifySt</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--0:#ABB2BF;--1:#383A42">(idx), uid);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">38</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">pushup</span><span style="--0:#ABB2BF;--1:#383A42">(idx);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">39</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">40</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">41</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">void</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">modifyEd</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">uid</span><span style="--0:#ABB2BF">) {</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">42</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">size</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">==</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#56B6C2;--1:#A626A4">&#x26;&#x26;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">==</span><span style="--0:#ABB2BF;--1:#383A42"> uid) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">43</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">]</span><span style="--0:#CD89E1;--1:#A626A4">++</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">44</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">45</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">46</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> mid </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42">) </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">47</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (uid </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> mid) </span><span style="--0:#61AFEF;--1:#3360C1">modifyEd</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--0:#ABB2BF;--1:#383A42">(idx), uid);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">48</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (uid </span><span style="--0:#CD89E1;--1:#A626A4">></span><span style="--0:#ABB2BF;--1:#383A42"> mid) </span><span style="--0:#61AFEF;--1:#3360C1">modifyEd</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--0:#ABB2BF;--1:#383A42">(idx), uid);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">49</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">pushup</span><span style="--0:#ABB2BF;--1:#383A42">(idx);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">50</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">51</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">52</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">querySt</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">l</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">r</span><span style="--0:#ABB2BF">) {</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">53</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#56B6C2;--1:#A626A4">&#x26;&#x26;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> r) </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">];</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">54</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> mid </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42">) </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">55</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> ret </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">56</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> mid) ret </span><span style="--0:#CD89E1;--1:#A626A4">+=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">querySt</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, r);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">57</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (r </span><span style="--0:#CD89E1;--1:#A626A4">></span><span style="--0:#ABB2BF;--1:#383A42"> mid) ret </span><span style="--0:#CD89E1;--1:#A626A4">+=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">querySt</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, r);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">58</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42"> ret;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">59</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">60</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">61</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">queryEd</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">l</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">r</span><span style="--0:#ABB2BF">) {</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">62</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#56B6C2;--1:#A626A4">&#x26;&#x26;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> r) </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">];</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">63</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> mid </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42">) </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">64</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> ret </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">65</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> mid) ret </span><span style="--0:#CD89E1;--1:#A626A4">+=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">queryEd</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, r);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">66</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (r </span><span style="--0:#CD89E1;--1:#A626A4">></span><span style="--0:#ABB2BF;--1:#383A42"> mid) ret </span><span style="--0:#CD89E1;--1:#A626A4">+=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">queryEd</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, r);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">67</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42"> ret;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">68</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">69</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">70</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">main</span><span style="--0:#ABB2BF;--1:#383A42">() {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">71</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">ios::</span><span style="--0:#61AFEF;--1:#3360C1">sync_with_stdio</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">false</span><span style="--0:#ABB2BF;--1:#383A42">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">72</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">cin</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#61AFEF;--1:#3360C1">tie</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">nullptr</span><span style="--0:#ABB2BF;--1:#383A42">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">73</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">cout</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#61AFEF;--1:#3360C1">tie</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">nullptr</span><span style="--0:#ABB2BF;--1:#383A42">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">74</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">75</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> n, m;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">76</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">cin </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> n </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> m;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">77</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">build</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, n);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">78</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">while</span><span style="--0:#ABB2BF;--1:#383A42"> (m</span><span style="--0:#CD89E1;--1:#A626A4">--</span><span style="--0:#ABB2BF;--1:#383A42">) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">79</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> q, l, r;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">80</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">        </span></span><span style="--0:#ABB2BF;--1:#383A42">cin </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> q </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> l </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> r;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">81</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (q </span><span style="--0:#CD89E1;--1:#A626A4">==</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">) </span><span style="--0:#61AFEF;--1:#3360C1">modifySt</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, l), </span><span style="--0:#61AFEF;--1:#3360C1">modifyEd</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, r);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">82</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">else</span><span style="--0:#ABB2BF;--1:#383A42"> cout </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">querySt</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, r) </span><span style="--0:#CD89E1;--1:#A626A4">-</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">queryEd</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, l </span><span style="--0:#CD89E1;--1:#A626A4">-</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">) </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> endl;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">83</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">84</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">85</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="#include <bits/stdc++.h>#define N 100010using namespace std;struct SegmentTree {#define le(x) (x << 1)#define ri(x) (x << 1 | 1)#define leftSubtree(idx) (tree[le(idx)])#define rightSubtree(idx) (tree[ri(idx)])    int l, r, size;    int sum[2];} tree[N << 2];void pushup(int idx) {    tree[idx].sum[0] = leftSubtree(idx).sum[0] + rightSubtree(idx).sum[0];    tree[idx].sum[1] = leftSubtree(idx).sum[1] + rightSubtree(idx).sum[1];}void build(int idx, int l, int r) {    tree[idx].l = l, tree[idx].r = r;    tree[idx].size = r - l + 1;    if (l == r) return;    int mid = (l + r) >> 1;    build(le(idx), l, mid);    build(ri(idx), mid + 1, r);    pushup(idx);}void modifySt(int idx, int uid) {    if (tree[idx].size == 1 &#x26;&#x26; tree[idx].l == uid) {        tree[idx].sum[0]++;        return;    }    int mid = (tree[idx].l + tree[idx].r) >> 1;    if (uid <= mid) modifySt(le(idx), uid);    if (uid > mid) modifySt(ri(idx), uid);    pushup(idx);}void modifyEd(int idx, int uid) {    if (tree[idx].size == 1 &#x26;&#x26; tree[idx].l == uid) {        tree[idx].sum[1]++;        return;    }    int mid = (tree[idx].l + tree[idx].r) >> 1;    if (uid <= mid) modifyEd(le(idx), uid);    if (uid > mid) modifyEd(ri(idx), uid);    pushup(idx);}int querySt(int idx, int l, int r) {    if (l <= tree[idx].l &#x26;&#x26; tree[idx].r <= r) return tree[idx].sum[0];    int mid = (tree[idx].l + tree[idx].r) >> 1;    int ret = 0;    if (l <= mid) ret += querySt(le(idx), l, r);    if (r > mid) ret += querySt(ri(idx), l, r);    return ret;}int queryEd(int idx, int l, int r) {    if (l <= tree[idx].l &#x26;&#x26; tree[idx].r <= r) return tree[idx].sum[1];    int mid = (tree[idx].l + tree[idx].r) >> 1;    int ret = 0;    if (l <= mid) ret += queryEd(le(idx), l, r);    if (r > mid) ret += queryEd(ri(idx), l, r);    return ret;}int main() {    ios::sync_with_stdio(false);    cin.tie(nullptr);    cout.tie(nullptr);    int n, m;    cin >> n >> m;    build(1, 1, n);    while (m--) {        int q, l, r;        cin >> q >> l >> r;        if (q == 1) modifySt(1, l), modifyEd(1, r);        else cout << querySt(1, 1, r) - queryEd(1, 1, l - 1) << endl;    }    return 0;}"><div></div></button></div></figure><div class="ec-collapse__gradient" aria-hidden="true"></div></div><button class="ec-collapse__toggle" type="button" aria-expanded="false" aria-controls="collapse-gv310vp65"><span class="ec-collapse__text-expand">显示更多</span><span class="ec-collapse__text-collapse">显示更少</span><svg class="ec-collapse__icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" aria-hidden="true"><path fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="M6 9l6 6 6-6"></path></svg></button></div></div></section><section><h3 id="区间加等差数列单点询问">区间加等差数列、单点询问<a class="anchor" href="#区间加等差数列单点询问"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h3><p>例题：<a href="https://www.luogu.com.cn/problem/P1438">P1438 无聊的数列</a></p><p>难度：<span data-luogu="" data-green="">普及+/提高</span></p><p>维护变量：差分数组、区间和、区间和标记</p><p>注意到等差数列差分数组中的元素除左端点外都是其公差，因此我们维护原序列的差分数组。对原数组对位加等差数列就相当于让差分数组的左端点加上首项、中间点加上公差、右端点右侧第一个点减去末项。那么进行两次单点修改和一次区间修改即可。注意到差分的前缀和是对应的点权，所以统计前缀和即可回答单点询问。注意判断等差数列的长度！</p><div class="expressive-code"><div class="ec-collapse ec-collapse--collapsed" id="collapse-payxrzlqe" data-collapse-preview-lines="8" data-expanded-announcement="代码块已展开" data-collapsed-announcement="代码块已折叠"><div class="ec-collapse__content"><figure class="frame" style="--lnWidth:3ch"><figcaption class="header"></figcaption><pre data-language="C++"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#include</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#98C379;--1:#387138">&#x3C;bits/stdc++.h></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#define</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">N</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">100100</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">using</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">namespace</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E5C07B">std</span><span style="--0:#ABB2BF">;</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">typedef</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">long</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">long</span><span style="--0:#ABB2BF;--1:#383A42"> ll;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">struct</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#885D01">SegmentTree</span><span style="--0:#ABB2BF;--1:#383A42"> {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#define</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--1:#383A42"><span style="--0:#ABB2BF">(</span><span style="--0:#E6888F;--0fs:italic">x</span><span style="--0:#ABB2BF">) (x </span></span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#define</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--1:#383A42"><span style="--0:#ABB2BF">(</span><span style="--0:#E6888F;--0fs:italic">x</span><span style="--0:#ABB2BF">) (x </span></span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#56B6C2;--1:#A626A4">|</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#define</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--1:#383A42"><span style="--0:#ABB2BF">(</span><span style="--0:#E6888F;--0fs:italic">x</span><span style="--0:#ABB2BF">) (</span></span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--0:#ABB2BF;--1:#383A42">(x)])</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#define</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--1:#383A42"><span style="--0:#ABB2BF">(</span><span style="--0:#E6888F;--0fs:italic">x</span><span style="--0:#ABB2BF">) (</span></span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--0:#ABB2BF;--1:#383A42">(x)])</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">13</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> l, r, size;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">14</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">ll lazy, sum;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">15</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">} </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[N </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">2</span><span style="--0:#ABB2BF;--1:#383A42">];</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">16</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">a</span><span style="--0:#ABB2BF;--1:#383A42">[N];</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">17</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">18</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">void</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">pushup</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">) {</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">19</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">20</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">21</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">22</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">void</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">pushdown</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">) {</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">23</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">lazy</span><span style="--0:#ABB2BF;--1:#383A42">) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">24</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">lazy</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">*</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">size</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">25</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">lazy</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">lazy</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">26</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">lazy</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">*</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">size</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">27</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">lazy</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">lazy</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">28</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">29</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">lazy</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">30</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">31</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">32</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">33</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">void</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">build</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">l</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">r</span><span style="--0:#ABB2BF">) {</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">34</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> l, </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> r;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">35</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">size</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> r </span><span style="--0:#CD89E1;--1:#A626A4">-</span><span style="--0:#ABB2BF;--1:#383A42"> l </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">36</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">==</span><span style="--0:#ABB2BF;--1:#383A42"> r) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">37</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">a</span><span style="--0:#ABB2BF;--1:#383A42">[l] </span><span style="--0:#CD89E1;--1:#A626A4">-</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">a</span><span style="--0:#ABB2BF;--1:#383A42">[l </span><span style="--0:#CD89E1;--1:#A626A4">-</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">];</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">38</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">39</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">40</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> mid </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> r) </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">41</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">build</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, mid);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">42</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">build</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--0:#ABB2BF;--1:#383A42">(idx), mid </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, r);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">43</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">pushup</span><span style="--0:#ABB2BF;--1:#383A42">(idx);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">44</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">45</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">46</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">void</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">modify</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">l</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">r</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">x</span><span style="--0:#ABB2BF">) {</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">47</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#56B6C2;--1:#A626A4">&#x26;&#x26;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> r) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">48</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">lazy</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+=</span><span style="--0:#ABB2BF;--1:#383A42"> x;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">49</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+=</span><span style="--0:#ABB2BF;--1:#383A42"> x </span><span style="--0:#CD89E1;--1:#A626A4">*</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">size</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">50</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">51</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">52</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">pushdown</span><span style="--0:#ABB2BF;--1:#383A42">(idx);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">53</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> mid </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42">) </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">54</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> mid) </span><span style="--0:#61AFEF;--1:#3360C1">modify</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, r, x);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">55</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (r </span><span style="--0:#CD89E1;--1:#A626A4">></span><span style="--0:#ABB2BF;--1:#383A42"> mid) </span><span style="--0:#61AFEF;--1:#3360C1">modify</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, r, x);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">56</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">pushup</span><span style="--0:#ABB2BF;--1:#383A42">(idx);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">57</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">58</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">59</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">void</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">modify</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">uid</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">x</span><span style="--0:#ABB2BF">) {</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">60</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">size</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">==</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#56B6C2;--1:#A626A4">&#x26;&#x26;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">==</span><span style="--0:#ABB2BF;--1:#383A42"> uid) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">61</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+=</span><span style="--0:#ABB2BF;--1:#383A42"> x;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">62</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">63</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">64</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">pushdown</span><span style="--0:#ABB2BF;--1:#383A42">(idx);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">65</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> mid </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42">) </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">66</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (uid </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> mid) </span><span style="--0:#61AFEF;--1:#3360C1">modify</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--0:#ABB2BF;--1:#383A42">(idx), uid, x);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">67</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (uid </span><span style="--0:#CD89E1;--1:#A626A4">></span><span style="--0:#ABB2BF;--1:#383A42"> mid) </span><span style="--0:#61AFEF;--1:#3360C1">modify</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--0:#ABB2BF;--1:#383A42">(idx), uid, x);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">68</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">pushup</span><span style="--0:#ABB2BF;--1:#383A42">(idx);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">69</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">70</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">71</div></div><div class="code"><span style="--0:#E5C07B;--1:#885D01">ll</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">query</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">uid</span><span style="--0:#ABB2BF">) {</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">72</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> uid) </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">73</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">pushdown</span><span style="--0:#ABB2BF;--1:#383A42">(idx);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">74</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">ll ret </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">75</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> mid </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42">) </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">76</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">ret </span><span style="--0:#CD89E1;--1:#A626A4">+=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">query</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--0:#ABB2BF;--1:#383A42">(idx), uid);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">77</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (uid </span><span style="--0:#CD89E1;--1:#A626A4">></span><span style="--0:#ABB2BF;--1:#383A42"> mid) ret </span><span style="--0:#CD89E1;--1:#A626A4">+=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">query</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--0:#ABB2BF;--1:#383A42">(idx), uid);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">78</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42"> ret;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">79</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">80</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">81</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">main</span><span style="--0:#ABB2BF;--1:#383A42">() {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">82</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">ios::</span><span style="--0:#61AFEF;--1:#3360C1">sync_with_stdio</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">false</span><span style="--0:#ABB2BF;--1:#383A42">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">83</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">cin</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#61AFEF;--1:#3360C1">tie</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">nullptr</span><span style="--0:#ABB2BF;--1:#383A42">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">84</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">cout</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#61AFEF;--1:#3360C1">tie</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">nullptr</span><span style="--0:#ABB2BF;--1:#383A42">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">85</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">86</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> n, m;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">87</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">cin </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> n </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> m;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">88</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">for</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> i </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">; i </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> n; i</span><span style="--0:#CD89E1;--1:#A626A4">++</span><span style="--0:#ABB2BF;--1:#383A42">) cin </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">a</span><span style="--0:#ABB2BF;--1:#383A42">[i];</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">89</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">build</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, n);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">90</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">while</span><span style="--0:#ABB2BF;--1:#383A42"> (m</span><span style="--0:#CD89E1;--1:#A626A4">--</span><span style="--0:#ABB2BF;--1:#383A42">) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">91</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> opt, l, r, k, d;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">92</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">        </span></span><span style="--0:#ABB2BF;--1:#383A42">cin </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> opt </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> l;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">93</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (opt </span><span style="--0:#CD89E1;--1:#A626A4">==</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">94</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">            </span></span><span style="--0:#ABB2BF;--1:#383A42">cin </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> r </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> k </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> d;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">95</div></div><div class="code"><span class="indent">            </span><span style="--0:#61AFEF;--1:#3360C1">modify</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, l, k);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">96</div></div><div class="code"><span class="indent">            </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> r) </span><span style="--0:#61AFEF;--1:#3360C1">modify</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, l </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, r, d);</span><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic"> // 数列长度为 1，仅单点修改</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">97</div></div><div class="code"><span class="indent">            </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (r </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> n) </span><span style="--0:#61AFEF;--1:#3360C1">modify</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, r </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, (l </span><span style="--0:#CD89E1;--1:#A626A4">-</span><span style="--0:#ABB2BF;--1:#383A42"> r) </span><span style="--0:#CD89E1;--1:#A626A4">*</span><span style="--0:#ABB2BF;--1:#383A42"> d </span><span style="--0:#CD89E1;--1:#A626A4">-</span><span style="--0:#ABB2BF;--1:#383A42"> k);</span><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic"> // 右端点在最右侧，无需更改右端点右侧的差分</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">98</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">        </span></span><span style="--0:#ABB2BF;--1:#383A42">} </span><span style="--0:#CD89E1;--1:#A626A4">else</span><span style="--0:#ABB2BF;--1:#383A42"> cout </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">query</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, l) </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> endl;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">99</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">100</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">101</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">102</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="#include <bits/stdc++.h>#define N 100100using namespace std;typedef long long ll;struct SegmentTree {#define le(x) (x << 1)#define ri(x) (x << 1 | 1)#define leftSubtree(x) (tree[le(x)])#define rightSubtree(x) (tree[ri(x)])    int l, r, size;    ll lazy, sum;} tree[N << 2];int a[N];void pushup(int idx) {    tree[idx].sum = leftSubtree(idx).sum + rightSubtree(idx).sum;}void pushdown(int idx) {    if (tree[idx].lazy) {        leftSubtree(idx).sum += tree[idx].lazy * leftSubtree(idx).size;        leftSubtree(idx).lazy += tree[idx].lazy;        rightSubtree(idx).sum += tree[idx].lazy * rightSubtree(idx).size;        rightSubtree(idx).lazy += tree[idx].lazy;        tree[idx].lazy = 0;    }}void build(int idx, int l, int r) {    tree[idx].l = l, tree[idx].r = r;    tree[idx].size = r - l + 1;    if (l == r) {        tree[idx].sum = a[l] - a[l - 1];        return;    }    int mid = (l + r) >> 1;    build(le(idx), l, mid);    build(ri(idx), mid + 1, r);    pushup(idx);}void modify(int idx, int l, int r, int x) {    if (l <= tree[idx].l &#x26;&#x26; tree[idx].r <= r) {        tree[idx].lazy += x;        tree[idx].sum += x * tree[idx].size;        return;    }    pushdown(idx);    int mid = (tree[idx].l + tree[idx].r) >> 1;    if (l <= mid) modify(le(idx), l, r, x);    if (r > mid) modify(ri(idx), l, r, x);    pushup(idx);}void modify(int idx, int uid, int x) {    if (tree[idx].size == 1 &#x26;&#x26; tree[idx].l == uid) {        tree[idx].sum += x;        return;    }    pushdown(idx);    int mid = (tree[idx].l + tree[idx].r) >> 1;    if (uid <= mid) modify(le(idx), uid, x);    if (uid > mid) modify(ri(idx), uid, x);    pushup(idx);}ll query(int idx, int uid) {    if (tree[idx].r <= uid) return tree[idx].sum;    pushdown(idx);    ll ret = 0;    int mid = (tree[idx].l + tree[idx].r) >> 1;    ret += query(le(idx), uid);    if (uid > mid) ret += query(ri(idx), uid);    return ret;}int main() {    ios::sync_with_stdio(false);    cin.tie(nullptr);    cout.tie(nullptr);    int n, m;    cin >> n >> m;    for (int i = 1; i <= n; i++) cin >> a[i];    build(1, 1, n);    while (m--) {        int opt, l, r, k, d;        cin >> opt >> l;        if (opt == 1) {            cin >> r >> k >> d;            modify(1, l, k);            if (l < r) modify(1, l + 1, r, d); // 数列长度为 1，仅单点修改            if (r < n) modify(1, r + 1, (l - r) * d - k); // 右端点在最右侧，无需更改右端点右侧的差分        } else cout << query(1, l) << endl;    }    return 0;}"><div></div></button></div></figure><div class="ec-collapse__gradient" aria-hidden="true"></div></div><button class="ec-collapse__toggle" type="button" aria-expanded="false" aria-controls="collapse-payxrzlqe"><span class="ec-collapse__text-expand">显示更多</span><span class="ec-collapse__text-collapse">显示更少</span><svg class="ec-collapse__icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" aria-hidden="true"><path fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="M6 9l6 6 6-6"></path></svg></button></div></div></section><section><h3 id="区间加区间最大公约数">区间加+区间最大公约数<a class="anchor" href="#区间加区间最大公约数"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h3><p>例题：<a href="https://www.luogu.com.cn/problem/P10463">P10463 Interval GCD</a></p><p>难度：<span data-luogu="" data-blue="">提高+/省选-</span></p><p>维护变量：差分数组</p><p><del>属于是回归老祖宗的智慧了</del></p><p>OI 所学的最大公约数计算一般是欧几里得提出的辗转相除法，然而《九章算术》中提出的辗转相减法（更相减损术）却总是被人忽略。根据辗转相减法，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>gcd</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>a</mi><mo separator="true">,</mo><mi>b</mi><mo stretchy="false">)</mo><mo>=</mo><mi>gcd</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>a</mi><mo>−</mo><mi>b</mi><mo separator="true">,</mo><mi>b</mi><mo stretchy="false">)</mo><mo separator="true">,</mo><mi>a</mi><mo>></mo><mi>b</mi></mrow><annotation encoding="application/x-tex">\gcd(a,b)=\gcd(a-b,b),a>b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop"><span style="margin-right:0.01389em;">g</span>cd</span><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">b</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop"><span style="margin-right:0.01389em;">g</span>cd</span><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">b</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">b</span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">></span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">b</span></span></span></span>，这个式子可以一直递归下去直到出现 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>gcd</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\gcd(x,x)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop"><span style="margin-right:0.01389em;">g</span>cd</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span> 的形式，答案就是 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span>。这启发我们维护原序列的差分数组来操作，我们可以发现，区间加操作就转化为了差分数组两端点的修改。</p><p>除此之外，最大公约数还满足以下性质：</p><ol>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>gcd</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>a</mi><mo separator="true">,</mo><mi>b</mi><mo separator="true">,</mo><mi>c</mi><mo stretchy="false">)</mo><mo>=</mo><mi>gcd</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>gcd</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>a</mi><mo separator="true">,</mo><mi>b</mi><mo stretchy="false">)</mo><mo separator="true">,</mo><mi>c</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\gcd(a,b,c)=\gcd(\gcd(a,b),c)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop"><span style="margin-right:0.01389em;">g</span>cd</span><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">b</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">c</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop"><span style="margin-right:0.01389em;">g</span>cd</span><span class="mopen">(</span><span class="mop"><span style="margin-right:0.01389em;">g</span>cd</span><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">b</span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">c</span><span class="mclose">)</span></span></span></span>。</li>
</ol><p>也就是说上传操作时当前区间的最大公约数就应该是左右子树二者的最大公约数的最大公约数，叶子节点的最大公约数应是它自身的值。同样的，多个数求最大公约数也可以转化为两两求解最大公约数。</p><p>总结：对于一个数列 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">a</span></span></span></span>，它的差分数组为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi><mo>=</mo><mo stretchy="false">{</mo><msub><mi>a</mi><mn>2</mn></msub><mo>−</mo><msub><mi>a</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>a</mi><mn>3</mn></msub><mo>−</mo><msub><mi>a</mi><mn>2</mn></msub><mo separator="true">,</mo><mo>…</mo><mo separator="true">,</mo><msub><mi>a</mi><mi>n</mi></msub><mo>−</mo><msub><mi>a</mi><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow></msub><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">b=\{a_2-a_1,a_3-a_2,\dots,a_n-a_{n-1}\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">b</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner">…</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mclose">}</span></span></span></span>，那么数列 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">a</span></span></span></span> 所有元素的最大公约数应是 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>gcd</mi><mo>⁡</mo><mo stretchy="false">(</mo><msub><mi>a</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>b</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>b</mi><mn>2</mn></msub><mo separator="true">,</mo><mo>…</mo><mo separator="true">,</mo><msub><mi>b</mi><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\gcd(a_1,b_1,b_2,\dots,b_{n-1})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop"><span style="margin-right:0.01389em;">g</span>cd</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner">…</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>。因此需要额外知道查询区间的左端点值，差分数组的前缀和即为单点值，于是再维护一个区间和即可完成。同上面那道题一样，修改左右端点时需注意边界。</p><div class="expressive-code"><div class="ec-collapse ec-collapse--collapsed" id="collapse-gggwrnkve" data-collapse-preview-lines="8" data-expanded-announcement="代码块已展开" data-collapsed-announcement="代码块已折叠"><div class="ec-collapse__content"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="C++"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#include</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#98C379;--1:#387138">&#x3C;bits/stdc++.h></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#define</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">N</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">500010</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">using</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">namespace</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E5C07B">std</span><span style="--0:#ABB2BF">;</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">typedef</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">long</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">long</span><span style="--0:#ABB2BF;--1:#383A42"> ll;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">struct</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#885D01">SegmentTree</span><span style="--0:#ABB2BF;--1:#383A42"> {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#define</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--1:#383A42"><span style="--0:#ABB2BF">(</span><span style="--0:#E6888F;--0fs:italic">x</span><span style="--0:#ABB2BF">) (x </span></span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#define</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--1:#383A42"><span style="--0:#ABB2BF">(</span><span style="--0:#E6888F;--0fs:italic">x</span><span style="--0:#ABB2BF">) (x </span></span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#56B6C2;--1:#A626A4">|</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#define</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--1:#383A42"><span style="--0:#ABB2BF">(</span><span style="--0:#E6888F;--0fs:italic">x</span><span style="--0:#ABB2BF">) (</span></span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--0:#ABB2BF;--1:#383A42">(x)])</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#define</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--1:#383A42"><span style="--0:#ABB2BF">(</span><span style="--0:#E6888F;--0fs:italic">x</span><span style="--0:#ABB2BF">) (</span></span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--0:#ABB2BF;--1:#383A42">(x)])</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> l, r, size;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">13</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">ll sum, gcd;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">14</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">} </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[N </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">2</span><span style="--0:#ABB2BF;--1:#383A42">];</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">15</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">ll </span><span style="--0:#E5C07B;--1:#AF4238">a</span><span style="--0:#ABB2BF;--1:#383A42">[N];</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">16</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">17</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">void</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">pushup</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">) {</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">18</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">19</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">gcd</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">gcd</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">gcd</span><span style="--0:#ABB2BF;--1:#383A42">, </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">gcd</span><span style="--0:#ABB2BF;--1:#383A42">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">20</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">21</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">22</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">void</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">build</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">l</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">r</span><span style="--0:#ABB2BF">) {</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">23</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> l, </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> r;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">24</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">size</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> r </span><span style="--0:#CD89E1;--1:#A626A4">-</span><span style="--0:#ABB2BF;--1:#383A42"> l </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">25</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">==</span><span style="--0:#ABB2BF;--1:#383A42"> r) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">26</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">gcd</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">a</span><span style="--0:#ABB2BF;--1:#383A42">[l] </span><span style="--0:#CD89E1;--1:#A626A4">-</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">a</span><span style="--0:#ABB2BF;--1:#383A42">[l </span><span style="--0:#CD89E1;--1:#A626A4">-</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">];</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">27</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">28</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">29</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> mid </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> r) </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">30</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">build</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, mid);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">31</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">build</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--0:#ABB2BF;--1:#383A42">(idx), mid </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, r);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">32</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">pushup</span><span style="--0:#ABB2BF;--1:#383A42">(idx);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">33</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">34</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">35</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">void</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">modify</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">uid</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#E5C07B;--1:#885D01">ll</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">x</span><span style="--0:#ABB2BF">) {</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">36</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">size</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">==</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#56B6C2;--1:#A626A4">&#x26;&#x26;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">==</span><span style="--0:#ABB2BF;--1:#383A42"> uid) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">37</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+=</span><span style="--0:#ABB2BF;--1:#383A42"> x;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">38</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">gcd</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+=</span><span style="--0:#ABB2BF;--1:#383A42"> x;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">39</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">40</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">41</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> mid </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42">) </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">42</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (uid </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> mid) </span><span style="--0:#61AFEF;--1:#3360C1">modify</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--0:#ABB2BF;--1:#383A42">(idx), uid, x);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">43</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (uid </span><span style="--0:#CD89E1;--1:#A626A4">></span><span style="--0:#ABB2BF;--1:#383A42"> mid) </span><span style="--0:#61AFEF;--1:#3360C1">modify</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--0:#ABB2BF;--1:#383A42">(idx), uid, x);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">44</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">pushup</span><span style="--0:#ABB2BF;--1:#383A42">(idx);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">45</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">46</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">47</div></div><div class="code"><span style="--0:#E5C07B;--1:#885D01">ll</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">querySum</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">r</span><span style="--0:#ABB2BF">) {</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">48</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> r) </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">49</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> mid </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42">) </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">50</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">ll ret </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">51</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">ret </span><span style="--0:#CD89E1;--1:#A626A4">+=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">querySum</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--0:#ABB2BF;--1:#383A42">(idx), r);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">52</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (r </span><span style="--0:#CD89E1;--1:#A626A4">></span><span style="--0:#ABB2BF;--1:#383A42"> mid) ret </span><span style="--0:#CD89E1;--1:#A626A4">+=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">querySum</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--0:#ABB2BF;--1:#383A42">(idx), r);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">53</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42"> ret;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">54</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">55</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">56</div></div><div class="code"><span style="--0:#E5C07B;--1:#885D01">ll</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">queryGcd</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">l</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">r</span><span style="--0:#ABB2BF">) {</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">57</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#56B6C2;--1:#A626A4">&#x26;&#x26;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> r) </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">gcd</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">58</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> mid </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42">) </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">59</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">ll ret </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">60</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> mid) ret </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">gcd</span><span style="--0:#ABB2BF;--1:#383A42">(ret, </span><span style="--0:#61AFEF;--1:#3360C1">queryGcd</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, r));</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">61</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (r </span><span style="--0:#CD89E1;--1:#A626A4">></span><span style="--0:#ABB2BF;--1:#383A42"> mid) ret </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">gcd</span><span style="--0:#ABB2BF;--1:#383A42">(ret, </span><span style="--0:#61AFEF;--1:#3360C1">queryGcd</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, r));</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">62</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42"> ret;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">63</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">64</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">65</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">main</span><span style="--0:#ABB2BF;--1:#383A42">() {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">66</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">ios::</span><span style="--0:#61AFEF;--1:#3360C1">sync_with_stdio</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">false</span><span style="--0:#ABB2BF;--1:#383A42">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">67</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">cin</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#61AFEF;--1:#3360C1">tie</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">nullptr</span><span style="--0:#ABB2BF;--1:#383A42">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">68</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">cout</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#61AFEF;--1:#3360C1">tie</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">nullptr</span><span style="--0:#ABB2BF;--1:#383A42">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">69</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">70</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> n, m;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">71</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">cin </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> n </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> m;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">72</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">for</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> i </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">; i </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> n; i</span><span style="--0:#CD89E1;--1:#A626A4">++</span><span style="--0:#ABB2BF;--1:#383A42">) cin </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">a</span><span style="--0:#ABB2BF;--1:#383A42">[i];</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">73</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">build</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, n);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">74</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">while</span><span style="--0:#ABB2BF;--1:#383A42"> (m</span><span style="--0:#CD89E1;--1:#A626A4">--</span><span style="--0:#ABB2BF;--1:#383A42">) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">75</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">char</span><span style="--0:#ABB2BF;--1:#383A42"> op;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">76</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> l, r;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">77</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">        </span></span><span style="--0:#ABB2BF;--1:#383A42">cin </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> op </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> l </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> r;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">78</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (op </span><span style="--0:#CD89E1;--1:#A626A4">==</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#98C379;--1:#387138">'C'</span><span style="--0:#ABB2BF;--1:#383A42">) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">79</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">            </span></span><span style="--0:#ABB2BF;--1:#383A42">ll x;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">80</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">            </span></span><span style="--0:#ABB2BF;--1:#383A42">cin </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> x;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">81</div></div><div class="code"><span class="indent">            </span><span style="--0:#61AFEF;--1:#3360C1">modify</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, l, x);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">82</div></div><div class="code"><span class="indent">            </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (r </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> n) </span><span style="--0:#61AFEF;--1:#3360C1">modify</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, r </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, </span><span style="--0:#CD89E1;--1:#A626A4">-</span><span style="--0:#ABB2BF;--1:#383A42">x);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">83</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">        </span></span><span style="--0:#ABB2BF;--1:#383A42">} </span><span style="--0:#CD89E1;--1:#A626A4">else</span><span style="--0:#ABB2BF;--1:#383A42"> cout </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">abs</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">gcd</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">querySum</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, l), </span><span style="--0:#61AFEF;--1:#3360C1">queryGcd</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, l </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, r))) </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> endl;</span><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic"> // 注意取绝对值</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">84</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">85</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">86</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">87</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="#include <bits/stdc++.h>#define N 500010using namespace std;typedef long long ll;struct SegmentTree {#define le(x) (x << 1)#define ri(x) (x << 1 | 1)#define leftSubtree(x) (tree[le(x)])#define rightSubtree(x) (tree[ri(x)])    int l, r, size;    ll sum, gcd;} tree[N << 2];ll a[N];void pushup(int idx) {    tree[idx].sum = leftSubtree(idx).sum + rightSubtree(idx).sum;    tree[idx].gcd = gcd(leftSubtree(idx).gcd, rightSubtree(idx).gcd);}void build(int idx, int l, int r) {    tree[idx].l = l, tree[idx].r = r;    tree[idx].size = r - l + 1;    if (l == r) {        tree[idx].sum = tree[idx].gcd = a[l] - a[l - 1];        return;    }    int mid = (l + r) >> 1;    build(le(idx), l, mid);    build(ri(idx), mid + 1, r);    pushup(idx);}void modify(int idx, int uid, ll x) {    if (tree[idx].size == 1 &#x26;&#x26; tree[idx].l == uid) {        tree[idx].sum += x;        tree[idx].gcd += x;        return;    }    int mid = (tree[idx].l + tree[idx].r) >> 1;    if (uid <= mid) modify(le(idx), uid, x);    if (uid > mid) modify(ri(idx), uid, x);    pushup(idx);}ll querySum(int idx, int r) {    if (tree[idx].r <= r) return tree[idx].sum;    int mid = (tree[idx].l + tree[idx].r) >> 1;    ll ret = 0;    ret += querySum(le(idx), r);    if (r > mid) ret += querySum(ri(idx), r);    return ret;}ll queryGcd(int idx, int l, int r) {    if (l <= tree[idx].l &#x26;&#x26; tree[idx].r <= r) return tree[idx].gcd;    int mid = (tree[idx].l + tree[idx].r) >> 1;    ll ret = 0;    if (l <= mid) ret = gcd(ret, queryGcd(le(idx), l, r));    if (r > mid) ret = gcd(ret, queryGcd(ri(idx), l, r));    return ret;}int main() {    ios::sync_with_stdio(false);    cin.tie(nullptr);    cout.tie(nullptr);    int n, m;    cin >> n >> m;    for (int i = 1; i <= n; i++) cin >> a[i];    build(1, 1, n);    while (m--) {        char op;        int l, r;        cin >> op >> l >> r;        if (op == &#x27;C&#x27;) {            ll x;            cin >> x;            modify(1, l, x);            if (r < n) modify(1, r + 1, -x);        } else cout << abs(gcd(querySum(1, l), queryGcd(1, l + 1, r))) << endl; // 注意取绝对值    }    return 0;}"><div></div></button></div></figure><div class="ec-collapse__gradient" aria-hidden="true"></div></div><button class="ec-collapse__toggle" type="button" aria-expanded="false" aria-controls="collapse-gggwrnkve"><span class="ec-collapse__text-expand">显示更多</span><span class="ec-collapse__text-collapse">显示更少</span><svg class="ec-collapse__icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" aria-hidden="true"><path fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="M6 9l6 6 6-6"></path></svg></button></div></div></section></section>
<section><h2 id="较复杂的序列操作">较复杂的序列操作<a class="anchor" href="#较复杂的序列操作"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h2><p>数据结构维护序列也是常考的一个点，维护二进制序列的各种操作又从中脱颖而出。由于操作的复杂性，它们有时还会涉及到多重懒标记的下传优先级和清空问题。本节重点在讲解一些序列上的经典操作的维护。</p><section><h3 id="非空最大子段和">非空最大子段和<a class="anchor" href="#非空最大子段和"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h3><p>例题：<a href="https://www.luogu.com.cn/problem/SP1043">GSS1 - Can you answer these queries I</a>（单点带修请见 <a href="https://www.luogu.com.cn/problem/SP1716">GSS3</a>，维护思路完全相同）</p><p>难度：<span data-luogu="" data-blue="">提高+/省选-</span></p><p>维护变量：最大前缀、最大后缀、最大子段和、区间和。</p><p>维护最大子段和考虑三种情况：</p><ol>
<li>最大子段和为左侧的最大子段和</li>
<li>最大子段和为右侧的最大子段和</li>
<li>最大子段和跨区间，为左区间的最大后缀加右区间的最大前缀</li>
</ol><p>最大子段和就是上述三种情况的最大值。</p><p>维护最大前缀考虑两种情况（最大后缀同理）：</p><ol>
<li>最大前缀为左区间的最大前缀</li>
<li>最大前缀跨区间，为整个左区间和右区间的最大前缀之和</li>
</ol><p>最大前/后缀就是上述两种情况的最大值。</p><p>注意选取的子段中<strong>必须包含至少一个元素</strong>（即非空最大子段和），否则不可用这种方式做。</p><div class="expressive-code"><div class="ec-collapse ec-collapse--collapsed" id="collapse-2lklxyxh6" data-collapse-preview-lines="8" data-expanded-announcement="代码块已展开" data-collapsed-announcement="代码块已折叠"><div class="ec-collapse__content"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="C++"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#include</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#98C379;--1:#387138">&#x3C;bits/stdc++.h></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#define</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">N</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">50010</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">using</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">namespace</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E5C07B">std</span><span style="--0:#ABB2BF">;</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">struct</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#885D01">SegmentTree</span><span style="--0:#ABB2BF;--1:#383A42"> {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#define</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--1:#383A42"><span style="--0:#ABB2BF">(</span><span style="--0:#E6888F;--0fs:italic">x</span><span style="--0:#ABB2BF">) (x </span></span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#define</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--1:#383A42"><span style="--0:#ABB2BF">(</span><span style="--0:#E6888F;--0fs:italic">x</span><span style="--0:#ABB2BF">) (x </span></span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#56B6C2;--1:#A626A4">|</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#define</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--1:#383A42"><span style="--0:#ABB2BF">(</span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">) (</span></span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--0:#ABB2BF;--1:#383A42">(idx)])</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#define</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--1:#383A42"><span style="--0:#ABB2BF">(</span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">) (</span></span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--0:#ABB2BF;--1:#383A42">(idx)])</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> l, r;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> max, lmax, rmax;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> sum;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">13</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">} </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[N </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">2</span><span style="--0:#ABB2BF;--1:#383A42">];</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">14</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">15</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">a</span><span style="--0:#ABB2BF;--1:#383A42">[N];</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">16</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">17</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">void</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">pushup</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">) {</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">18</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">max</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">max</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">max</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">max</span><span style="--0:#ABB2BF;--1:#383A42">, </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">max</span><span style="--0:#ABB2BF;--1:#383A42">), </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">rmax</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">lmax</span><span style="--0:#ABB2BF;--1:#383A42">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">19</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">lmax</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">max</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">lmax</span><span style="--0:#ABB2BF;--1:#383A42">, </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">lmax</span><span style="--0:#ABB2BF;--1:#383A42">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">20</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">rmax</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">max</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">rmax</span><span style="--0:#ABB2BF;--1:#383A42">, </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">rmax</span><span style="--0:#ABB2BF;--1:#383A42">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">21</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">22</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">23</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">24</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">void</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">build</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">l</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">r</span><span style="--0:#ABB2BF">) {</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">25</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> l, </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> r;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">26</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">==</span><span style="--0:#ABB2BF;--1:#383A42"> r) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">27</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">max</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">a</span><span style="--0:#ABB2BF;--1:#383A42">[l];</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">28</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">lmax</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">a</span><span style="--0:#ABB2BF;--1:#383A42">[l];</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">29</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">rmax</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">a</span><span style="--0:#ABB2BF;--1:#383A42">[l];</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">30</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">a</span><span style="--0:#ABB2BF;--1:#383A42">[l];</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">31</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">32</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">33</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> mid </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> r) </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">34</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">build</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, mid);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">35</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">build</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--0:#ABB2BF;--1:#383A42">(idx), mid </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, r);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">36</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">pushup</span><span style="--0:#ABB2BF;--1:#383A42">(idx);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">37</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">38</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">39</div></div><div class="code"><span style="--0:#E5C07B;--1:#885D01">SegmentTree</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">query</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">l</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">r</span><span style="--0:#ABB2BF">) {</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">40</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#56B6C2;--1:#A626A4">&#x26;&#x26;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> r) </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx];</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">41</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> mid </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42">) </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">42</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">></span><span style="--0:#ABB2BF;--1:#383A42"> mid) </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">query</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, r);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">43</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (r </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> mid) </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">query</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, r);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">44</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">SegmentTree L{}, R{}, res{};</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">45</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">L </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">query</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, r);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">46</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">R </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">query</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, r);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">47</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">res</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">max</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">max</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">max</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#E5C07B;--1:#AF4238">L</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">max</span><span style="--0:#ABB2BF;--1:#383A42">, </span><span style="--0:#E5C07B;--1:#AF4238">R</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">max</span><span style="--0:#ABB2BF;--1:#383A42">), </span><span style="--0:#E5C07B;--1:#AF4238">L</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">rmax</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">R</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">lmax</span><span style="--0:#ABB2BF;--1:#383A42">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">48</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">res</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">lmax</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">max</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#E5C07B;--1:#AF4238">L</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">lmax</span><span style="--0:#ABB2BF;--1:#383A42">, </span><span style="--0:#E5C07B;--1:#AF4238">L</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">R</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">lmax</span><span style="--0:#ABB2BF;--1:#383A42">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">49</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">res</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">rmax</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">max</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#E5C07B;--1:#AF4238">R</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">rmax</span><span style="--0:#ABB2BF;--1:#383A42">, </span><span style="--0:#E5C07B;--1:#AF4238">R</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">L</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">rmax</span><span style="--0:#ABB2BF;--1:#383A42">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">50</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">res</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">L</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">R</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">51</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42"> res;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">52</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">53</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">54</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">main</span><span style="--0:#ABB2BF;--1:#383A42">() {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">55</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">ios::</span><span style="--0:#61AFEF;--1:#3360C1">sync_with_stdio</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">false</span><span style="--0:#ABB2BF;--1:#383A42">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">56</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">cin</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#61AFEF;--1:#3360C1">tie</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">nullptr</span><span style="--0:#ABB2BF;--1:#383A42">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">57</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">cout</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#61AFEF;--1:#3360C1">tie</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">nullptr</span><span style="--0:#ABB2BF;--1:#383A42">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">58</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">59</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> n, m;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">60</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">cin </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> n;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">61</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">for</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> i </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">; i </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> n; i</span><span style="--0:#CD89E1;--1:#A626A4">++</span><span style="--0:#ABB2BF;--1:#383A42">) cin </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">a</span><span style="--0:#ABB2BF;--1:#383A42">[i];</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">62</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">build</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, n);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">63</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">cin </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> m;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">64</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">while</span><span style="--0:#ABB2BF;--1:#383A42"> (m</span><span style="--0:#CD89E1;--1:#A626A4">--</span><span style="--0:#ABB2BF;--1:#383A42">) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">65</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> l, r;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">66</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">        </span></span><span style="--0:#ABB2BF;--1:#383A42">cin </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> l </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> r;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">67</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">        </span></span><span style="--0:#ABB2BF;--1:#383A42">cout </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">query</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, l, r).</span><span style="--0:#E6888F;--1:#AF4238">max</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> endl;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">68</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">69</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">70</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="#include <bits/stdc++.h>#define N 50010using namespace std;struct SegmentTree {#define le(x) (x << 1)#define ri(x) (x << 1 | 1)#define leftSubtree(idx) (tree[le(idx)])#define rightSubtree(idx) (tree[ri(idx)])    int l, r;    int max, lmax, rmax;    int sum;} tree[N << 2];int a[N];void pushup(int idx) {    tree[idx].max = max(max(leftSubtree(idx).max, rightSubtree(idx).max), leftSubtree(idx).rmax + rightSubtree(idx).lmax);    tree[idx].lmax = max(leftSubtree(idx).lmax, leftSubtree(idx).sum + rightSubtree(idx).lmax);    tree[idx].rmax = max(rightSubtree(idx).rmax, rightSubtree(idx).sum + leftSubtree(idx).rmax);    tree[idx].sum = leftSubtree(idx).sum + rightSubtree(idx).sum;}void build(int idx, int l, int r) {    tree[idx].l = l, tree[idx].r = r;    if (l == r) {        tree[idx].max = a[l];        tree[idx].lmax = a[l];        tree[idx].rmax = a[l];        tree[idx].sum = a[l];        return;    }    int mid = (l + r) >> 1;    build(le(idx), l, mid);    build(ri(idx), mid + 1, r);    pushup(idx);}SegmentTree query(int idx, int l, int r) {    if (l <= tree[idx].l &#x26;&#x26; tree[idx].r <= r) return tree[idx];    int mid = (tree[idx].l + tree[idx].r) >> 1;    if (l > mid) return query(ri(idx), l, r);    if (r <= mid) return query(le(idx), l, r);    SegmentTree L{}, R{}, res{};    L = query(le(idx), l, r);    R = query(ri(idx), l, r);    res.max = max(max(L.max, R.max), L.rmax + R.lmax);    res.lmax = max(L.lmax, L.sum + R.lmax);    res.rmax = max(R.rmax, R.sum + L.rmax);    res.sum = L.sum + R.sum;    return res;}int main() {    ios::sync_with_stdio(false);    cin.tie(nullptr);    cout.tie(nullptr);    int n, m;    cin >> n;    for (int i = 1; i <= n; i++) cin >> a[i];    build(1, 1, n);    cin >> m;    while (m--) {        int l, r;        cin >> l >> r;        cout << query(1, l, r).max << endl;    }    return 0;}"><div></div></button></div></figure><div class="ec-collapse__gradient" aria-hidden="true"></div></div><button class="ec-collapse__toggle" type="button" aria-expanded="false" aria-controls="collapse-2lklxyxh6"><span class="ec-collapse__text-expand">显示更多</span><span class="ec-collapse__text-collapse">显示更少</span><svg class="ec-collapse__icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" aria-hidden="true"><path fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="M6 9l6 6 6-6"></path></svg></button></div></div></section><section><h3 id="有端点限制的最大子段和">有端点限制的最大子段和<a class="anchor" href="#有端点限制的最大子段和"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h3><p>例题：<a href="https://www.luogu.com.cn/problem/SP2916">GSS5 - Can you answer these queries V</a></p><p>难度：<span data-luogu="" data-purple="">省选/NOI-</span></p><p><del>只要解决了端点问题它就变成 GSS1 了！——这不废话吗？</del></p><p>对于左右端点所在区间的位置情况进行讨论。</p><p>第一种，两端点区间无交集。那么两区间中间的区域是一定要选的，我们加上这一段的总和，然后合并左端点区间的最大后缀、右端点区间的最大前缀即可。</p><p>第二种，两区间有交集。它又可以分三类讨论，如下图：</p><p><img src="https://cdn.luogu.com.cn/upload/image_hosting/zynax8vf.png" alt=""></p><p>发现三种位置关系可以用一个方法得到答案，讨论答案区间左右端点的分布：左右端点可能的分布是 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><msub><mi>L</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>L</mi><mn>2</mn></msub><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[L_1,L_2]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord"><span class="mord mathnormal">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">]</span></span></span></span>、<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><msub><mi>L</mi><mn>2</mn></msub><mo separator="true">,</mo><msub><mi>R</mi><mn>2</mn></msub><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[L_2,R_2]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord"><span class="mord mathnormal">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0077em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">]</span></span></span></span>，此时答案是前者最大后缀与后者最大前缀的和；或者是同属于 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><msub><mi>L</mi><mn>2</mn></msub><mo separator="true">,</mo><msub><mi>R</mi><mn>1</mn></msub><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[L_2,R_1]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord"><span class="mord mathnormal">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0077em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">]</span></span></span></span>，答案是这个区间的最大子段和（简化为 GSS1）；也可能是 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><msub><mi>L</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>R</mi><mn>1</mn></msub><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[L_1,R_1]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord"><span class="mord mathnormal">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0077em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">]</span></span></span></span>、<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><msub><mi>R</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>R</mi><mn>2</mn></msub><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[R_1,R_2]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0077em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0077em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">]</span></span></span></span>，答案是前者最大后缀与后者最大前缀的和。最终就是三种情况取最大值。</p><p>为了减少特判，我们规定当查询的左边界大于右边界时即返回 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">{0}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord"><span class="mord">0</span></span></span></span></span>；为了避免区间求值出现端点重合而重复计算的情况，我们在最后减去重合端点的单点值（毕竟不带修）即可。</p><div class="expressive-code"><div class="ec-collapse ec-collapse--collapsed" id="collapse-jthl3z5nb" data-collapse-preview-lines="8" data-expanded-announcement="代码块已展开" data-collapsed-announcement="代码块已折叠"><div class="ec-collapse__content"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="C++"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#include</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#98C379;--1:#387138">&#x3C;bits/stdc++.h></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#define</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">N</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">100010</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">using</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">namespace</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E5C07B">std</span><span style="--0:#ABB2BF">;</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">typedef</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">long</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">long</span><span style="--0:#ABB2BF;--1:#383A42"> ll;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">struct</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#885D01">SegmentTree</span><span style="--0:#ABB2BF;--1:#383A42"> {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#define</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--1:#383A42"><span style="--0:#ABB2BF">(</span><span style="--0:#E6888F;--0fs:italic">x</span><span style="--0:#ABB2BF">) (x </span></span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#define</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--1:#383A42"><span style="--0:#ABB2BF">(</span><span style="--0:#E6888F;--0fs:italic">x</span><span style="--0:#ABB2BF">) (x </span></span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#56B6C2;--1:#A626A4">|</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#define</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--1:#383A42"><span style="--0:#ABB2BF">(</span><span style="--0:#E6888F;--0fs:italic">x</span><span style="--0:#ABB2BF">) (</span></span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--0:#ABB2BF;--1:#383A42">(x)])</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#define</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--1:#383A42"><span style="--0:#ABB2BF">(</span><span style="--0:#E6888F;--0fs:italic">x</span><span style="--0:#ABB2BF">) (</span></span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--0:#ABB2BF;--1:#383A42">(x)])</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">13</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> l, r, size;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">14</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">ll sum;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">15</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">ll </span><span style="--0:#E5C07B;--1:#AF4238">max</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">3</span><span style="--0:#ABB2BF;--1:#383A42">];</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">16</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">} </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[N </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">2</span><span style="--0:#ABB2BF;--1:#383A42">];</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">17</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">a</span><span style="--0:#ABB2BF;--1:#383A42">[N];</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">18</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">19</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">void</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">pushup</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">) {</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">20</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">21</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">max</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">] </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">max</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">max</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">], </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">max</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">]);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">22</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">max</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">] </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">max</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">max</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">], </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">max</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">]);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">23</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">max</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">2</span><span style="--0:#ABB2BF;--1:#383A42">] </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">max</span><span style="--0:#ABB2BF;--1:#383A42">(</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">24</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">            </span></span><span style="--0:#ABB2BF;--1:#383A42">{</span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">max</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">2</span><span style="--0:#ABB2BF;--1:#383A42">], </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">max</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">2</span><span style="--0:#ABB2BF;--1:#383A42">], </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">max</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">] </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">max</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">]});</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">25</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">26</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">27</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">void</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">build</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">l</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">r</span><span style="--0:#ABB2BF">) {</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">28</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> l, </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> r;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">29</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">size</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> r </span><span style="--0:#CD89E1;--1:#A626A4">-</span><span style="--0:#ABB2BF;--1:#383A42"> l </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">30</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">==</span><span style="--0:#ABB2BF;--1:#383A42"> r) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">31</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">a</span><span style="--0:#ABB2BF;--1:#383A42">[l];</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">32</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">max</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">] </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">max</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">] </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">max</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">2</span><span style="--0:#ABB2BF;--1:#383A42">] </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">a</span><span style="--0:#ABB2BF;--1:#383A42">[l];</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">33</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">34</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">35</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> mid </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> r) </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">36</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">build</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, mid);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">37</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">build</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--0:#ABB2BF;--1:#383A42">(idx), mid </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, r);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">38</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">pushup</span><span style="--0:#ABB2BF;--1:#383A42">(idx);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">39</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">40</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">41</div></div><div class="code"><span style="--0:#E5C07B;--1:#885D01">ll</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">querySum</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">l</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">r</span><span style="--0:#ABB2BF">) {</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">42</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">></span><span style="--0:#ABB2BF;--1:#383A42"> r) </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">43</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#56B6C2;--1:#A626A4">&#x26;&#x26;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> r) </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">44</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> mid </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42">) </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">45</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">ll ret </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">46</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> mid) ret </span><span style="--0:#CD89E1;--1:#A626A4">+=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">querySum</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, r);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">47</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (r </span><span style="--0:#CD89E1;--1:#A626A4">></span><span style="--0:#ABB2BF;--1:#383A42"> mid) ret </span><span style="--0:#CD89E1;--1:#A626A4">+=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">querySum</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, r);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">48</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42"> ret;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">49</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">50</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">51</div></div><div class="code"><span style="--0:#E5C07B;--1:#885D01">SegmentTree</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">query</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">l</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">r</span><span style="--0:#ABB2BF">) {</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">52</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">></span><span style="--0:#ABB2BF;--1:#383A42"> r) </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42"> {</span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">, </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">, </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">, </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">, </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">, </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">, </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">};</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">53</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#56B6C2;--1:#A626A4">&#x26;&#x26;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> r) </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx];</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">54</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> mid </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42">) </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">55</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">></span><span style="--0:#ABB2BF;--1:#383A42"> mid) </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">query</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, r);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">56</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (r </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> mid) </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">query</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, r);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">57</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">SegmentTree L </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">query</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, r);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">58</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">SegmentTree R </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">query</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, r);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">59</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">SegmentTree res{};</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">60</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">res</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">L</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">R</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">61</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">res</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">max</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">] </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">max</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#E5C07B;--1:#AF4238">L</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">max</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">], </span><span style="--0:#E5C07B;--1:#AF4238">L</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">R</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">max</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">]);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">62</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">res</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">max</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">] </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">max</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#E5C07B;--1:#AF4238">R</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">max</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">], </span><span style="--0:#E5C07B;--1:#AF4238">R</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">L</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">max</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">]);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">63</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">res</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">max</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">2</span><span style="--0:#ABB2BF;--1:#383A42">] </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">max</span><span style="--0:#ABB2BF;--1:#383A42">({</span><span style="--0:#E5C07B;--1:#AF4238">L</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">max</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">2</span><span style="--0:#ABB2BF;--1:#383A42">], </span><span style="--0:#E5C07B;--1:#AF4238">R</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">max</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">2</span><span style="--0:#ABB2BF;--1:#383A42">], </span><span style="--0:#E5C07B;--1:#AF4238">L</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">max</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">] </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">R</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">max</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">]});</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">64</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42"> res;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">65</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">66</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">67</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">main</span><span style="--0:#ABB2BF;--1:#383A42">() {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">68</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">ios::</span><span style="--0:#61AFEF;--1:#3360C1">sync_with_stdio</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">false</span><span style="--0:#ABB2BF;--1:#383A42">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">69</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">cin</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#61AFEF;--1:#3360C1">tie</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">nullptr</span><span style="--0:#ABB2BF;--1:#383A42">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">70</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">cout</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#61AFEF;--1:#3360C1">tie</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">nullptr</span><span style="--0:#ABB2BF;--1:#383A42">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">71</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">72</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> t;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">73</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">cin </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> t;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">74</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">while</span><span style="--0:#ABB2BF;--1:#383A42"> (t</span><span style="--0:#CD89E1;--1:#A626A4">--</span><span style="--0:#ABB2BF;--1:#383A42">) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">75</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> n, m;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">76</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">        </span></span><span style="--0:#ABB2BF;--1:#383A42">cin </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> n;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">77</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">for</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> i </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">; i </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> n; i</span><span style="--0:#CD89E1;--1:#A626A4">++</span><span style="--0:#ABB2BF;--1:#383A42">) cin </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">a</span><span style="--0:#ABB2BF;--1:#383A42">[i];</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">78</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">build</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, n);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">79</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">        </span></span><span style="--0:#ABB2BF;--1:#383A42">cin </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> m;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">80</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">while</span><span style="--0:#ABB2BF;--1:#383A42"> (m</span><span style="--0:#CD89E1;--1:#A626A4">--</span><span style="--0:#ABB2BF;--1:#383A42">) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">81</div></div><div class="code"><span class="indent">            </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> l1, r1, l2, r2;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">82</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">            </span></span><span style="--0:#ABB2BF;--1:#383A42">cin </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> l1 </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> r1 </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> l2 </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> r2;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">83</div></div><div class="code"><span class="indent">            </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (r1 </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> l2)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">84</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">                </span></span><span style="--0:#ABB2BF;--1:#383A42">cout </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">query</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, l1, r1).</span><span style="--0:#E6888F;--1:#AF4238">max</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">] </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">querySum</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, r1, l2) </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">query</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, l2, r2).</span><span style="--0:#E6888F;--1:#AF4238">max</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">] </span><span style="--0:#CD89E1;--1:#A626A4">-</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">a</span><span style="--0:#ABB2BF;--1:#383A42">[r1] </span><span style="--0:#CD89E1;--1:#A626A4">-</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">a</span><span style="--0:#ABB2BF;--1:#383A42">[l2] </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> endl;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">85</div></div><div class="code"><span class="indent">            </span><span style="--0:#CD89E1;--1:#A626A4">else</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">86</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">                </span></span><span style="--0:#ABB2BF;--1:#383A42">cout </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">max</span><span style="--0:#ABB2BF;--1:#383A42">({</span><span style="--0:#61AFEF;--1:#3360C1">query</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, l2, r1).</span><span style="--0:#E6888F;--1:#AF4238">max</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">2</span><span style="--0:#ABB2BF;--1:#383A42">], </span><span style="--0:#61AFEF;--1:#3360C1">query</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, l1, r1).</span><span style="--0:#E6888F;--1:#AF4238">max</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">] </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">query</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, r1, r2).</span><span style="--0:#E6888F;--1:#AF4238">max</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">] </span><span style="--0:#CD89E1;--1:#A626A4">-</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">a</span><span style="--0:#ABB2BF;--1:#383A42">[r1],</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">87</div></div><div class="code"><span class="indent">                             </span><span style="--0:#61AFEF;--1:#3360C1">query</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, l1, l2).</span><span style="--0:#E6888F;--1:#AF4238">max</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">] </span><span style="--0:#CD89E1;--1:#A626A4">+</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">88</div></div><div class="code"><span class="indent">                             </span><span style="--0:#61AFEF;--1:#3360C1">query</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, l2, r2).</span><span style="--0:#E6888F;--1:#AF4238">max</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">] </span><span style="--0:#CD89E1;--1:#A626A4">-</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">a</span><span style="--0:#ABB2BF;--1:#383A42">[l2]}) </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> endl;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">89</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">        </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">90</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">91</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">92</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">93</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="#include <bits/stdc++.h>#define N 100010using namespace std;typedef long long ll;struct SegmentTree {#define le(x) (x << 1)#define ri(x) (x << 1 | 1)#define leftSubtree(x) (tree[le(x)])#define rightSubtree(x) (tree[ri(x)])    int l, r, size;    ll sum;    ll max[3];} tree[N << 2];int a[N];void pushup(int idx) {    tree[idx].sum = leftSubtree(idx).sum + rightSubtree(idx).sum;    tree[idx].max[0] = max(leftSubtree(idx).max[0], leftSubtree(idx).sum + rightSubtree(idx).max[0]);    tree[idx].max[1] = max(rightSubtree(idx).max[1], rightSubtree(idx).sum + leftSubtree(idx).max[1]);    tree[idx].max[2] = max(            {leftSubtree(idx).max[2], rightSubtree(idx).max[2], leftSubtree(idx).max[1] + rightSubtree(idx).max[0]});}void build(int idx, int l, int r) {    tree[idx].l = l, tree[idx].r = r;    tree[idx].size = r - l + 1;    if (l == r) {        tree[idx].sum = a[l];        tree[idx].max[0] = tree[idx].max[1] = tree[idx].max[2] = a[l];        return;    }    int mid = (l + r) >> 1;    build(le(idx), l, mid);    build(ri(idx), mid + 1, r);    pushup(idx);}ll querySum(int idx, int l, int r) {    if (l > r) return 0;    if (l <= tree[idx].l &#x26;&#x26; tree[idx].r <= r) return tree[idx].sum;    int mid = (tree[idx].l + tree[idx].r) >> 1;    ll ret = 0;    if (l <= mid) ret += querySum(le(idx), l, r);    if (r > mid) ret += querySum(ri(idx), l, r);    return ret;}SegmentTree query(int idx, int l, int r) {    if (l > r) return {0, 0, 0, 0, 0, 0, 0};    if (l <= tree[idx].l &#x26;&#x26; tree[idx].r <= r) return tree[idx];    int mid = (tree[idx].l + tree[idx].r) >> 1;    if (l > mid) return query(ri(idx), l, r);    if (r <= mid) return query(le(idx), l, r);    SegmentTree L = query(le(idx), l, r);    SegmentTree R = query(ri(idx), l, r);    SegmentTree res{};    res.sum = L.sum + R.sum;    res.max[0] = max(L.max[0], L.sum + R.max[0]);    res.max[1] = max(R.max[1], R.sum + L.max[1]);    res.max[2] = max({L.max[2], R.max[2], L.max[1] + R.max[0]});    return res;}int main() {    ios::sync_with_stdio(false);    cin.tie(nullptr);    cout.tie(nullptr);    int t;    cin >> t;    while (t--) {        int n, m;        cin >> n;        for (int i = 1; i <= n; i++) cin >> a[i];        build(1, 1, n);        cin >> m;        while (m--) {            int l1, r1, l2, r2;            cin >> l1 >> r1 >> l2 >> r2;            if (r1 < l2)                cout << query(1, l1, r1).max[1] + querySum(1, r1, l2) + query(1, l2, r2).max[0] - a[r1] - a[l2] << endl;            else                cout << max({query(1, l2, r1).max[2], query(1, l1, r1).max[1] + query(1, r1, r2).max[0] - a[r1],                             query(1, l1, l2).max[1] +                             query(1, l2, r2).max[0] - a[l2]}) << endl;        }    }    return 0;}"><div></div></button></div></figure><div class="ec-collapse__gradient" aria-hidden="true"></div></div><button class="ec-collapse__toggle" type="button" aria-expanded="false" aria-controls="collapse-jthl3z5nb"><span class="ec-collapse__text-expand">显示更多</span><span class="ec-collapse__text-collapse">显示更少</span><svg class="ec-collapse__icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" aria-hidden="true"><path fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="M6 9l6 6 6-6"></path></svg></button></div></div></section><section><h3 id="实数域上整数端点的集合运算">实数域上整数端点的集合运算<a class="anchor" href="#实数域上整数端点的集合运算"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h3><p>例题：<a href="https://www.luogu.com.cn/problem/P5568">P5568 [SDOI2008] 校门外的区间</a></p><p>难度：<span data-luogu="" data-blue="">提高+/省选-</span></p><p>来源：<span data-luogu="" data-region="">山东</span>  <span data-luogu="" data-date="">2008</span></p><p>维护变量：区间和、0/1推平标记、异或标记</p><p>考虑维护一个 0/1 串，记录集合中是否有对应位置的数。对于求并操作，相当于把读入的目标区间和集合的对应位置进行按位或运算，又因为读入的区间必定是全为 1 的表示，因此可以看作区间内推平为 1；对于求交操作，则是相当于按位与运算，且目标区间外需均推平为 0，而这对集合的对应区间无影响，综合来说就是区间外推平为 0。</p><p>然后再来考虑两种减法操作。对于原集合和目标区间的相对差集（操作 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>D</mi></mrow><annotation encoding="application/x-tex">D</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span></span></span></span>），相当于原集合减去二者的交集，那么就是目标区间内推平为 0；而对于目标区间和原集合的相对差集（操作 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi></mrow><annotation encoding="application/x-tex">C</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span></span></span></span>）就稍微复杂一些了，原理如下图：</p><p><img src="https://cdn.luogu.com.cn/upload/image_hosting/c27ywtt7.png?x-oss-process=image/resize,m_lfit,h_170,w_225" alt=""></p><p>相当于用目标区间减去二者交集。可以发现我们只要目标区间有但是集合里没有的元素，那么目标区间外可以推平为 0。此时再让集合中有的数变没，再让没有的数出现，不难想到异或（按位 0/1 翻转）。综上，需要区间外推平为 0，再区间内异或；对于最后一个求对称差的操作，<del>从符号可知</del> 仔细研究规则即可发现就是区间内异或。</p><p>维护两种标记时要额外注意优先级问题。比较优先级时常用假设当前区间存在其他标记的方法来推理。当推平操作下发到一个已有异或标记的区间时，无论异或结果如何都不会改变推平的事实，可知推平标记优先级大于异或标记。当然这不代表要在区间推平下传结束后一并清空区间异或标记，详见前文提到的“标记置零问题”。</p><p>最后是处理输入输出的开闭区间。可以把原始下标都翻倍，闭区间端点的下标是偶数，开区间就是奇数。输出时可以暴力统计前缀和，然后处理出连续区间，根据下标奇偶性即可推知答案区间的开闭，再减半取整输出。</p><div class="expressive-code"><div class="ec-collapse ec-collapse--collapsed" id="collapse-9cmw1jelu" data-collapse-preview-lines="8" data-expanded-announcement="代码块已展开" data-collapsed-announcement="代码块已折叠"><div class="ec-collapse__content"><figure class="frame" style="--lnWidth:3ch"><figcaption class="header"></figcaption><pre data-language="C++"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#include</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#98C379;--1:#387138">&#x3C;bits/stdc++.h></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#define</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">N</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">140000</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#define</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">UNION</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#define</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">INTERSECT</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">2</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#define</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">XOR</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">3</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">using</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">namespace</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E5C07B">std</span><span style="--0:#ABB2BF">;</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">struct</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#885D01">SegmentTree</span><span style="--0:#ABB2BF;--1:#383A42"> {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#define</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--1:#383A42"><span style="--0:#ABB2BF">(</span><span style="--0:#E6888F;--0fs:italic">x</span><span style="--0:#ABB2BF">) (x </span></span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#define</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--1:#383A42"><span style="--0:#ABB2BF">(</span><span style="--0:#E6888F;--0fs:italic">x</span><span style="--0:#ABB2BF">) (x </span></span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#56B6C2;--1:#A626A4">|</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#define</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--1:#383A42"><span style="--0:#ABB2BF">(</span><span style="--0:#E6888F;--0fs:italic">x</span><span style="--0:#ABB2BF">) (</span></span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--0:#ABB2BF;--1:#383A42">(x)])</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#define</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--1:#383A42"><span style="--0:#ABB2BF">(</span><span style="--0:#E6888F;--0fs:italic">x</span><span style="--0:#ABB2BF">) (</span></span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--0:#ABB2BF;--1:#383A42">(x)])</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">13</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> l, r, size;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">14</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> sum </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">15</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">bool</span><span style="--0:#ABB2BF;--1:#383A42"> flagXor;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">16</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> flagRev;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">17</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">} </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[N </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">2</span><span style="--0:#ABB2BF;--1:#383A42">];</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">18</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tmp</span><span style="--0:#ABB2BF;--1:#383A42">[N];</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">19</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">20</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">void</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">pushup</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">) {</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">21</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">22</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">23</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">24</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">void</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">pushdown</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">) {</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">25</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">flagRev</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">!=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">-</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">26</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">flagXor</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">false</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">27</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">flagRev</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">flagRev</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">28</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">size</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">*</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">flagRev</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">29</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">flagXor</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">false</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">30</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">flagRev</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">flagRev</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">31</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">size</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">*</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">flagRev</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">32</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">flagRev</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">-</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">33</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">34</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">flagXor</span><span style="--0:#ABB2BF;--1:#383A42">) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">35</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">flagXor</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">^=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">true</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">36</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">size</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">-</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">37</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">flagXor</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">^=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">true</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">38</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">size</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">-</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">39</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">flagXor</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">false</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">40</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">41</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">42</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">43</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">void</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">build</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">l</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">r</span><span style="--0:#ABB2BF">) {</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">44</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> l, </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> r;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">45</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">size</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> r </span><span style="--0:#CD89E1;--1:#A626A4">-</span><span style="--0:#ABB2BF;--1:#383A42"> l </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">46</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">flagRev</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">-</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">47</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">==</span><span style="--0:#ABB2BF;--1:#383A42"> r) </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">48</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> mid </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> r) </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">49</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">build</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, mid);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">50</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">build</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--0:#ABB2BF;--1:#383A42">(idx), mid </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, r);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">51</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">pushup</span><span style="--0:#ABB2BF;--1:#383A42">(idx);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">52</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">53</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">54</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">void</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">modify</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">l</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">r</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">type</span><span style="--0:#ABB2BF">) {</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">55</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#56B6C2;--1:#A626A4">&#x26;&#x26;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> r) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">56</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (type </span><span style="--0:#CD89E1;--1:#A626A4">==</span><span style="--0:#ABB2BF;--1:#383A42"> UNION) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">57</div></div><div class="code"><span class="indent"><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic">            </span></span><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic">// 区间推平成1</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">58</div></div><div class="code"><span class="indent">            </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">flagRev</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">59</div></div><div class="code"><span class="indent">            </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">flagXor</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">false</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">60</div></div><div class="code"><span class="indent">            </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">size</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">61</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">        </span></span><span style="--0:#ABB2BF;--1:#383A42">} </span><span style="--0:#CD89E1;--1:#A626A4">else</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (type </span><span style="--0:#CD89E1;--1:#A626A4">==</span><span style="--0:#ABB2BF;--1:#383A42"> XOR) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">62</div></div><div class="code"><span class="indent"><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic">            </span></span><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic">// 异或</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">63</div></div><div class="code"><span class="indent">            </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">flagXor</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">^=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">true</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">64</div></div><div class="code"><span class="indent">            </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">size</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">-</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">65</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">        </span></span><span style="--0:#ABB2BF;--1:#383A42">} </span><span style="--0:#CD89E1;--1:#A626A4">else</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (type </span><span style="--0:#CD89E1;--1:#A626A4">==</span><span style="--0:#ABB2BF;--1:#383A42"> INTERSECT) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">66</div></div><div class="code"><span class="indent"><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic">            </span></span><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic">// 区间推平为0</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">67</div></div><div class="code"><span class="indent">            </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">flagRev</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">68</div></div><div class="code"><span class="indent">            </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">flagXor</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">false</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">69</div></div><div class="code"><span class="indent">            </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">70</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">        </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">71</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">72</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">73</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">pushdown</span><span style="--0:#ABB2BF;--1:#383A42">(idx);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">74</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> mid </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42">) </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">75</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> mid) </span><span style="--0:#61AFEF;--1:#3360C1">modify</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, r, type);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">76</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (r </span><span style="--0:#CD89E1;--1:#A626A4">></span><span style="--0:#ABB2BF;--1:#383A42"> mid) </span><span style="--0:#61AFEF;--1:#3360C1">modify</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, r, type);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">77</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">pushup</span><span style="--0:#ABB2BF;--1:#383A42">(idx);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">78</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">79</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">80</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">query</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">l</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">r</span><span style="--0:#ABB2BF">) {</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">81</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#56B6C2;--1:#A626A4">&#x26;&#x26;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> r) </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">82</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">pushdown</span><span style="--0:#ABB2BF;--1:#383A42">(idx);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">83</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> mid </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42">) </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">84</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> ret </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">85</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> mid) ret </span><span style="--0:#CD89E1;--1:#A626A4">+=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">query</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, r);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">86</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (r </span><span style="--0:#CD89E1;--1:#A626A4">></span><span style="--0:#ABB2BF;--1:#383A42"> mid) ret </span><span style="--0:#CD89E1;--1:#A626A4">+=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">query</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, r);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">87</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42"> ret;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">88</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">89</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">90</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">main</span><span style="--0:#ABB2BF;--1:#383A42">() {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">91</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">ios::</span><span style="--0:#61AFEF;--1:#3360C1">sync_with_stdio</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">false</span><span style="--0:#ABB2BF;--1:#383A42">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">92</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">cin</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#61AFEF;--1:#3360C1">tie</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">nullptr</span><span style="--0:#ABB2BF;--1:#383A42">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">93</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">cout</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#61AFEF;--1:#3360C1">tie</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">nullptr</span><span style="--0:#ABB2BF;--1:#383A42">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">94</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">95</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">char</span><span style="--0:#ABB2BF;--1:#383A42"> op, lpath, comma, rpath;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">96</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> a, b, R </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">97</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">build</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">, </span><span style="--0:#D19A66;--1:#875D01">65535</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">98</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">while</span><span style="--0:#ABB2BF;--1:#383A42"> (cin </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> op) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">99</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">        </span></span><span style="--0:#ABB2BF;--1:#383A42">cin </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> lpath </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> a </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> comma </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> b </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> rpath;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">100</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">        </span></span><span style="--0:#ABB2BF;--1:#383A42">a </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, b </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">101</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (lpath </span><span style="--0:#CD89E1;--1:#A626A4">==</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#98C379;--1:#387138">'('</span><span style="--0:#ABB2BF;--1:#383A42">) a</span><span style="--0:#CD89E1;--1:#A626A4">++</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">102</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (rpath </span><span style="--0:#CD89E1;--1:#A626A4">==</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#98C379;--1:#387138">')'</span><span style="--0:#ABB2BF;--1:#383A42">) b</span><span style="--0:#CD89E1;--1:#A626A4">--</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">103</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (b </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> a) </span><span style="--0:#CD89E1;--1:#A626A4">continue</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">104</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">        </span></span><span style="--0:#ABB2BF;--1:#383A42">R </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">max</span><span style="--0:#ABB2BF;--1:#383A42">(R, b);</span><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic"> // 记录最大右端点</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">105</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">switch</span><span style="--0:#ABB2BF;--1:#383A42"> (op) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">106</div></div><div class="code"><span class="indent">            </span><span style="--0:#CD89E1;--1:#A626A4">case</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#98C379;--1:#387138">'U'</span><span style="--0:#ABB2BF;--1:#383A42">:</span><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic"> // 并集 目标区间内推平为1</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">107</div></div><div class="code"><span class="indent">                </span><span style="--0:#61AFEF;--1:#3360C1">modify</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, a, b, UNION);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">108</div></div><div class="code"><span class="indent">                </span><span style="--0:#CD89E1;--1:#A626A4">break</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">109</div></div><div class="code"><span class="indent">            </span><span style="--0:#CD89E1;--1:#A626A4">case</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#98C379;--1:#387138">'D'</span><span style="--0:#ABB2BF;--1:#383A42">:</span><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic"> // 相对差集 目标区间内推平为0</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">110</div></div><div class="code"><span class="indent">                </span><span style="--0:#61AFEF;--1:#3360C1">modify</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, a, b, INTERSECT);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">111</div></div><div class="code"><span class="indent">                </span><span style="--0:#CD89E1;--1:#A626A4">break</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">112</div></div><div class="code"><span class="indent">            </span><span style="--0:#CD89E1;--1:#A626A4">case</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#98C379;--1:#387138">'I'</span><span style="--0:#ABB2BF;--1:#383A42">:</span><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic"> // 交集 目标区间外推平为0</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">113</div></div><div class="code"><span class="indent">                </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (a) </span><span style="--0:#61AFEF;--1:#3360C1">modify</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">, a </span><span style="--0:#CD89E1;--1:#A626A4">-</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, INTERSECT);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">114</div></div><div class="code"><span class="indent">                </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (b </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">65535</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">) </span><span style="--0:#61AFEF;--1:#3360C1">modify</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, b </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, </span><span style="--0:#D19A66;--1:#875D01">65535</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, INTERSECT);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">115</div></div><div class="code"><span class="indent">                </span><span style="--0:#CD89E1;--1:#A626A4">break</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">116</div></div><div class="code"><span class="indent">            </span><span style="--0:#CD89E1;--1:#A626A4">case</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#98C379;--1:#387138">'C'</span><span style="--0:#ABB2BF;--1:#383A42">:</span><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic"> // 逆相对差集 目标区间内异或，且区间外推平为0</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">117</div></div><div class="code"><span class="indent">                </span><span style="--0:#61AFEF;--1:#3360C1">modify</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, a, b, XOR);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">118</div></div><div class="code"><span class="indent">                </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (a) </span><span style="--0:#61AFEF;--1:#3360C1">modify</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">, a </span><span style="--0:#CD89E1;--1:#A626A4">-</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, INTERSECT);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">119</div></div><div class="code"><span class="indent">                </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (b </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">65535</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">) </span><span style="--0:#61AFEF;--1:#3360C1">modify</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, b </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, </span><span style="--0:#D19A66;--1:#875D01">65535</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, INTERSECT);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">120</div></div><div class="code"><span class="indent">                </span><span style="--0:#CD89E1;--1:#A626A4">break</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">121</div></div><div class="code"><span class="indent">            </span><span style="--0:#CD89E1;--1:#A626A4">case</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#98C379;--1:#387138">'S'</span><span style="--0:#ABB2BF;--1:#383A42">:</span><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic"> // 对称差 目标区间内异或</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">122</div></div><div class="code"><span class="indent">            </span><span style="--0:#CD89E1;--1:#A626A4">default</span><span style="--0:#ABB2BF;--1:#383A42">:</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">123</div></div><div class="code"><span class="indent">                </span><span style="--0:#61AFEF;--1:#3360C1">modify</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, a, b, XOR);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">124</div></div><div class="code"><span class="indent">                </span><span style="--0:#CD89E1;--1:#A626A4">break</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">125</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">        </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">126</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">127</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> t </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">query</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">, R);</span><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic"> // 检查前缀和，为 0 则为空集</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">128</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#56B6C2;--1:#A626A4">!</span><span style="--0:#ABB2BF;--1:#383A42">t) cout </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#98C379;--1:#387138">"empty set"</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> endl;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">129</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">else</span><span style="--0:#ABB2BF;--1:#383A42"> {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">130</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">for</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> i </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">; i </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> R </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">2</span><span style="--0:#ABB2BF;--1:#383A42">; i</span><span style="--0:#CD89E1;--1:#A626A4">++</span><span style="--0:#ABB2BF;--1:#383A42">) </span><span style="--0:#E5C07B;--1:#AF4238">tmp</span><span style="--0:#ABB2BF;--1:#383A42">[i] </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">query</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">, i);</span><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic"> // 前缀和</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">131</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> last </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">, lastI </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">-</span><span style="--0:#D19A66;--1:#875D01">2</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">132</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">for</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> i </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">; i </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> R; i</span><span style="--0:#CD89E1;--1:#A626A4">++</span><span style="--0:#ABB2BF;--1:#383A42">) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">133</div></div><div class="code"><span class="indent">            </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#E5C07B;--1:#AF4238">tmp</span><span style="--0:#ABB2BF;--1:#383A42">[i] </span><span style="--0:#CD89E1;--1:#A626A4">-</span><span style="--0:#ABB2BF;--1:#383A42"> last) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">134</div></div><div class="code"><span class="indent">                </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (i </span><span style="--0:#CD89E1;--1:#A626A4">-</span><span style="--0:#ABB2BF;--1:#383A42"> lastI </span><span style="--0:#CD89E1;--1:#A626A4">></span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">) cout </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> (i </span><span style="--0:#56B6C2;--1:#A626A4">&#x26;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">?</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#98C379;--1:#387138">'('</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">:</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#98C379;--1:#387138">'['</span><span style="--0:#ABB2BF;--1:#383A42">) </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> (i </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">) </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#98C379;--1:#387138">','</span><span style="--0:#ABB2BF;--1:#383A42">;</span><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic"> // 根据奇偶性判断括号</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">135</div></div><div class="code"><span class="indent">                </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#E5C07B;--1:#AF4238">tmp</span><span style="--0:#ABB2BF;--1:#383A42">[i </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">] </span><span style="--0:#CD89E1;--1:#A626A4">==</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tmp</span><span style="--0:#ABB2BF;--1:#383A42">[i]) cout </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> (i </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">) </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> (i </span><span style="--0:#56B6C2;--1:#A626A4">&#x26;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">?</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#98C379;--1:#387138">')'</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">:</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#98C379;--1:#387138">']'</span><span style="--0:#ABB2BF;--1:#383A42">) </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#98C379;--1:#387138">' '</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">136</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">                </span></span><span style="--0:#ABB2BF;--1:#383A42">last </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tmp</span><span style="--0:#ABB2BF;--1:#383A42">[i];</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">137</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">                </span></span><span style="--0:#ABB2BF;--1:#383A42">lastI </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> i;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">138</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">            </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">139</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">        </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">140</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">141</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">142</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">143</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="#include <bits/stdc++.h>#define N 140000#define UNION 1#define INTERSECT 2#define XOR 3using namespace std;struct SegmentTree {#define le(x) (x << 1)#define ri(x) (x << 1 | 1)#define leftSubtree(x) (tree[le(x)])#define rightSubtree(x) (tree[ri(x)])    int l, r, size;    int sum = 0;    bool flagXor;    int flagRev;} tree[N << 2];int tmp[N];void pushup(int idx) {    tree[idx].sum = leftSubtree(idx).sum + rightSubtree(idx).sum;}void pushdown(int idx) {    if (tree[idx].flagRev != -1) {        leftSubtree(idx).flagXor = false;        leftSubtree(idx).flagRev = tree[idx].flagRev;        leftSubtree(idx).sum = leftSubtree(idx).size * tree[idx].flagRev;        rightSubtree(idx).flagXor = false;        rightSubtree(idx).flagRev = tree[idx].flagRev;        rightSubtree(idx).sum = rightSubtree(idx).size * tree[idx].flagRev;        tree[idx].flagRev = -1;    }    if (tree[idx].flagXor) {        leftSubtree(idx).flagXor ^= true;        leftSubtree(idx).sum = leftSubtree(idx).size - leftSubtree(idx).sum;        rightSubtree(idx).flagXor ^= true;        rightSubtree(idx).sum = rightSubtree(idx).size - rightSubtree(idx).sum;        tree[idx].flagXor = false;    }}void build(int idx, int l, int r) {    tree[idx].l = l, tree[idx].r = r;    tree[idx].size = r - l + 1;    tree[idx].flagRev = -1;    if (l == r) return;    int mid = (l + r) >> 1;    build(le(idx), l, mid);    build(ri(idx), mid + 1, r);    pushup(idx);}void modify(int idx, int l, int r, int type) {    if (l <= tree[idx].l &#x26;&#x26; tree[idx].r <= r) {        if (type == UNION) {            // 区间推平成1            tree[idx].flagRev = 1;            tree[idx].flagXor = false;            tree[idx].sum = tree[idx].size;        } else if (type == XOR) {            // 异或            tree[idx].flagXor ^= true;            tree[idx].sum = tree[idx].size - tree[idx].sum;        } else if (type == INTERSECT) {            // 区间推平为0            tree[idx].flagRev = 0;            tree[idx].flagXor = false;            tree[idx].sum = 0;        }        return;    }    pushdown(idx);    int mid = (tree[idx].l + tree[idx].r) >> 1;    if (l <= mid) modify(le(idx), l, r, type);    if (r > mid) modify(ri(idx), l, r, type);    pushup(idx);}int query(int idx, int l, int r) {    if (l <= tree[idx].l &#x26;&#x26; tree[idx].r <= r) return tree[idx].sum;    pushdown(idx);    int mid = (tree[idx].l + tree[idx].r) >> 1;    int ret = 0;    if (l <= mid) ret += query(le(idx), l, r);    if (r > mid) ret += query(ri(idx), l, r);    return ret;}int main() {    ios::sync_with_stdio(false);    cin.tie(nullptr);    cout.tie(nullptr);    char op, lpath, comma, rpath;    int a, b, R = 0;    build(1, 0, 65535 << 1);    while (cin >> op) {        cin >> lpath >> a >> comma >> b >> rpath;        a <<= 1, b <<= 1;        if (lpath == &#x27;(&#x27;) a++;        if (rpath == &#x27;)&#x27;) b--;        if (b < a) continue;        R = max(R, b); // 记录最大右端点        switch (op) {            case &#x27;U&#x27;: // 并集 目标区间内推平为1                modify(1, a, b, UNION);                break;            case &#x27;D&#x27;: // 相对差集 目标区间内推平为0                modify(1, a, b, INTERSECT);                break;            case &#x27;I&#x27;: // 交集 目标区间外推平为0                if (a) modify(1, 0, a - 1, INTERSECT);                if (b < 65535 << 1) modify(1, b + 1, 65535 << 1, INTERSECT);                break;            case &#x27;C&#x27;: // 逆相对差集 目标区间内异或，且区间外推平为0                modify(1, a, b, XOR);                if (a) modify(1, 0, a - 1, INTERSECT);                if (b < 65535 << 1) modify(1, b + 1, 65535 << 1, INTERSECT);                break;            case &#x27;S&#x27;: // 对称差 目标区间内异或            default:                modify(1, a, b, XOR);                break;        }    }    int t = query(1, 0, R); // 检查前缀和，为 0 则为空集    if (!t) cout << &#x22;empty set&#x22; << endl;    else {        for (int i = 0; i <= R + 2; i++) tmp[i] = query(1, 0, i); // 前缀和        int last = 0, lastI = -2;        for (int i = 0; i <= R; i++) {            if (tmp[i] - last) {                if (i - lastI > 1) cout << (i &#x26; 1 ? &#x27;(&#x27; : &#x27;[&#x27;) << (i >> 1) << &#x27;,&#x27;; // 根据奇偶性判断括号                if (tmp[i + 1] == tmp[i]) cout << (i + 1 >> 1) << (i &#x26; 1 ? &#x27;)&#x27; : &#x27;]&#x27;) << &#x27; &#x27;;                last = tmp[i];                lastI = i;            }        }    }    return 0;}"><div></div></button></div></figure><div class="ec-collapse__gradient" aria-hidden="true"></div></div><button class="ec-collapse__toggle" type="button" aria-expanded="false" aria-controls="collapse-9cmw1jelu"><span class="ec-collapse__text-expand">显示更多</span><span class="ec-collapse__text-collapse">显示更少</span><svg class="ec-collapse__icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" aria-hidden="true"><path fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="M6 9l6 6 6-6"></path></svg></button></div></div></section><section><h3 id="区间推平区间翻转最大连续数01串">区间推平+区间翻转+最大连续数（01串）<a class="anchor" href="#区间推平区间翻转最大连续数01串"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h3><p>例题：<a href="https://www.luogu.com.cn/problem/P2572">P2572 序列操作</a></p><p>题目难度：<span data-luogu="" data-blue="">提高+/省选-</span></p><p>题目来源：<span data-luogu="" data-region="">四川</span>  <span data-luogu="" data-date="">2010</span>  <span data-luogu="" data-source="">各省省选</span></p><p>维护变量：区间左端最大连续数、区间右端最大连续数、区间最大连续数、区间大小、区间和</p><p>最大连续数考虑三种情况：</p><ol>
<li>左区间最大连续数</li>
<li>右区间最大连续数</li>
<li>跨区间，左区间右端最大连续数与右区间左端最大连续数</li>
</ol><p>最大左端连续数（右端同理）考虑两种情况：</p><ol>
<li>不可跨区间，为左区间最大左端连续数</li>
<li>可以跨区间（左区间均为同一个数），那么为左区间最大左端连续数与右区间最大左端连续数之和</li>
</ol><p>标记优先级推平大于翻转。注意当前区间如果已经存在一个推平标记，那么下传翻转标记时就需要把推平标记取反。推平后相应数字的最大连续数均设置成区间长度、另一个数字的最大连续数设为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">{0}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord"><span class="mord">0</span></span></span></span></span>，此时的区间的和就是该区间的长度减去先前记录的区间和。</p><div class="expressive-code"><div class="ec-collapse ec-collapse--collapsed" id="collapse-yr4rv014s" data-collapse-preview-lines="8" data-expanded-announcement="代码块已展开" data-collapsed-announcement="代码块已折叠"><div class="ec-collapse__content"><figure class="frame" style="--lnWidth:3ch"><figcaption class="header"></figcaption><pre data-language="C++"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#include</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#98C379;--1:#387138">&#x3C;bits/stdc++.h></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#define</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">N</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">100010</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">using</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">namespace</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E5C07B">std</span><span style="--0:#ABB2BF">;</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">struct</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#885D01">SegmentTree</span><span style="--0:#ABB2BF;--1:#383A42"> {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#define</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--1:#383A42"><span style="--0:#ABB2BF">(</span><span style="--0:#E6888F;--0fs:italic">x</span><span style="--0:#ABB2BF">) (x </span></span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#define</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--1:#383A42"><span style="--0:#ABB2BF">(</span><span style="--0:#E6888F;--0fs:italic">x</span><span style="--0:#ABB2BF">) (x </span></span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#56B6C2;--1:#A626A4">|</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#define</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--1:#383A42"><span style="--0:#ABB2BF">(</span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">) (</span></span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--0:#ABB2BF;--1:#383A42">(idx)])</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#define</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--1:#383A42"><span style="--0:#ABB2BF">(</span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">) (</span></span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--0:#ABB2BF;--1:#383A42">(idx)])</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> l, r;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> que, rev;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">lmax</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">2</span><span style="--0:#ABB2BF;--1:#383A42">], </span><span style="--0:#E5C07B;--1:#AF4238">rmax</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">2</span><span style="--0:#ABB2BF;--1:#383A42">], </span><span style="--0:#E5C07B;--1:#AF4238">max</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">2</span><span style="--0:#ABB2BF;--1:#383A42">];</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">13</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> sum, size;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">14</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">} </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[N </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">2</span><span style="--0:#ABB2BF;--1:#383A42">];</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">15</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">16</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">a</span><span style="--0:#ABB2BF;--1:#383A42">[N];</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">17</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">18</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">void</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">pushup</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">) {</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">19</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">20</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">for</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> i </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">; i </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">; i</span><span style="--0:#CD89E1;--1:#A626A4">++</span><span style="--0:#ABB2BF;--1:#383A42">) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">21</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">max</span><span style="--0:#ABB2BF;--1:#383A42">[i] </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">max</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">max</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">max</span><span style="--0:#ABB2BF;--1:#383A42">[i], </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">max</span><span style="--0:#ABB2BF;--1:#383A42">[i]), </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">rmax</span><span style="--0:#ABB2BF;--1:#383A42">[i] </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">lmax</span><span style="--0:#ABB2BF;--1:#383A42">[i]);</span><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic"> // 最大连续数的三种情况</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">22</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">lmax</span><span style="--0:#ABB2BF;--1:#383A42">[i] </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">lmax</span><span style="--0:#ABB2BF;--1:#383A42">[i];</span><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic"> // 左端最大连续为左子树的左端最大连续</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">23</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">==</span><span style="--0:#ABB2BF;--1:#383A42"> i </span><span style="--0:#CD89E1;--1:#A626A4">*</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">size</span><span style="--0:#ABB2BF;--1:#383A42">) </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">lmax</span><span style="--0:#ABB2BF;--1:#383A42">[i] </span><span style="--0:#CD89E1;--1:#A626A4">+=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">lmax</span><span style="--0:#ABB2BF;--1:#383A42">[i];</span><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic"> // 可以跨区间，加入右子树的左端最大连续</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">24</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">rmax</span><span style="--0:#ABB2BF;--1:#383A42">[i] </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">rmax</span><span style="--0:#ABB2BF;--1:#383A42">[i];</span><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic"> // 右端最大连续为右子树的右端最大连续</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">25</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">==</span><span style="--0:#ABB2BF;--1:#383A42"> i </span><span style="--0:#CD89E1;--1:#A626A4">*</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">size</span><span style="--0:#ABB2BF;--1:#383A42">) </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">rmax</span><span style="--0:#ABB2BF;--1:#383A42">[i] </span><span style="--0:#CD89E1;--1:#A626A4">+=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">rmax</span><span style="--0:#ABB2BF;--1:#383A42">[i];</span><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic"> // 可以跨区间，加入左子树的右端最大连续</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">26</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">27</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">28</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">29</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">void</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">pushdown</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">) {</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">30</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">que</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">>=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">31</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> tag </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">que</span><span style="--0:#ABB2BF;--1:#383A42">;</span><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic"> // 下传推平标记</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">32</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">lmax</span><span style="--0:#ABB2BF;--1:#383A42">[tag] </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">rmax</span><span style="--0:#ABB2BF;--1:#383A42">[tag] </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">max</span><span style="--0:#ABB2BF;--1:#383A42">[tag] </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">size</span><span style="--0:#ABB2BF;--1:#383A42">;</span><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic"> // 推平的那个数的最大连续均变为子树大小</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">33</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">lmax</span><span style="--0:#ABB2BF;--1:#383A42">[tag] </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">rmax</span><span style="--0:#ABB2BF;--1:#383A42">[tag] </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">max</span><span style="--0:#ABB2BF;--1:#383A42">[tag] </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">size</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">34</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">lmax</span><span style="--0:#ABB2BF;--1:#383A42">[tag </span><span style="--0:#56B6C2;--1:#A626A4">^</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">] </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">rmax</span><span style="--0:#ABB2BF;--1:#383A42">[tag </span><span style="--0:#56B6C2;--1:#A626A4">^</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">] </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">max</span><span style="--0:#ABB2BF;--1:#383A42">[tag </span><span style="--0:#56B6C2;--1:#A626A4">^</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">] </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">;</span><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic"> // 反之，另一个数的最大连续均变为0</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">35</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">lmax</span><span style="--0:#ABB2BF;--1:#383A42">[tag </span><span style="--0:#56B6C2;--1:#A626A4">^</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">] </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">rmax</span><span style="--0:#ABB2BF;--1:#383A42">[tag </span><span style="--0:#56B6C2;--1:#A626A4">^</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">] </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">max</span><span style="--0:#ABB2BF;--1:#383A42">[tag </span><span style="--0:#56B6C2;--1:#A626A4">^</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">] </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">36</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">37</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">size</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">*</span><span style="--0:#ABB2BF;--1:#383A42"> tag;</span><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic"> // 维护和</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">38</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">size</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">*</span><span style="--0:#ABB2BF;--1:#383A42"> tag;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">39</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">40</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">que</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> tag;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">41</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">rev</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">42</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">que</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> tag;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">43</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">rev</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">44</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">que</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">-</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">45</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">rev</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">46</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">47</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">rev</span><span style="--0:#ABB2BF;--1:#383A42">) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">48</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">size</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">-</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">49</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">size</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">-</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">50</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">swap</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">lmax</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">], </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">lmax</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">]);</span><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic"> // 0/1互换，最大连续也互换</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">51</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">swap</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">rmax</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">], </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">rmax</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">]);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">52</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">swap</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">max</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">], </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">max</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">]);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">53</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">swap</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">lmax</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">], </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">lmax</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">]);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">54</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">swap</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">rmax</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">], </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">rmax</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">]);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">55</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">swap</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">max</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">], </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">max</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">]);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">56</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">57</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">que</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">>=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">) </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">que</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">^=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">;</span><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic"> // 如果先有了推平，那么相当于推平成另一个数</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">58</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">else</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">rev</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">^=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">59</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">que</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">>=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">) </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">que</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">^=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">60</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">else</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">rev</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">^=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">61</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">62</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">rev</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">63</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">64</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">65</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">66</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">void</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">build</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">l</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">r</span><span style="--0:#ABB2BF">) {</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">67</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> l, </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> r;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">68</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">size</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> r </span><span style="--0:#CD89E1;--1:#A626A4">-</span><span style="--0:#ABB2BF;--1:#383A42"> l </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">69</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">que</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">-</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">70</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">==</span><span style="--0:#ABB2BF;--1:#383A42"> r) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">71</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">a</span><span style="--0:#ABB2BF;--1:#383A42">[l];</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">72</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">lmax</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#E5C07B;--1:#AF4238">a</span><span style="--0:#ABB2BF;--1:#383A42">[l]] </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">rmax</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#E5C07B;--1:#AF4238">a</span><span style="--0:#ABB2BF;--1:#383A42">[l]] </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">max</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#E5C07B;--1:#AF4238">a</span><span style="--0:#ABB2BF;--1:#383A42">[l]] </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">73</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">lmax</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#E5C07B;--1:#AF4238">a</span><span style="--0:#ABB2BF;--1:#383A42">[l] </span><span style="--0:#56B6C2;--1:#A626A4">^</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">] </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">rmax</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#E5C07B;--1:#AF4238">a</span><span style="--0:#ABB2BF;--1:#383A42">[l] </span><span style="--0:#56B6C2;--1:#A626A4">^</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">] </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">max</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#E5C07B;--1:#AF4238">a</span><span style="--0:#ABB2BF;--1:#383A42">[l] </span><span style="--0:#56B6C2;--1:#A626A4">^</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">] </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">74</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">75</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">76</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> mid </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> r) </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">77</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">build</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, mid);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">78</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">build</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--0:#ABB2BF;--1:#383A42">(idx), mid </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, r);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">79</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">pushup</span><span style="--0:#ABB2BF;--1:#383A42">(idx);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">80</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">81</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">82</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">void</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">modify</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">l</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">r</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">x</span><span style="--0:#ABB2BF">) {</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">83</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">pushdown</span><span style="--0:#ABB2BF;--1:#383A42">(idx);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">84</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#56B6C2;--1:#A626A4">&#x26;&#x26;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> r) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">85</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> x </span><span style="--0:#CD89E1;--1:#A626A4">*</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">size</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">86</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">que</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> x;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">87</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">lmax</span><span style="--0:#ABB2BF;--1:#383A42">[x] </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">rmax</span><span style="--0:#ABB2BF;--1:#383A42">[x] </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">max</span><span style="--0:#ABB2BF;--1:#383A42">[x] </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">size</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">88</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">lmax</span><span style="--0:#ABB2BF;--1:#383A42">[x </span><span style="--0:#56B6C2;--1:#A626A4">^</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">] </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">rmax</span><span style="--0:#ABB2BF;--1:#383A42">[x </span><span style="--0:#56B6C2;--1:#A626A4">^</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">] </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">max</span><span style="--0:#ABB2BF;--1:#383A42">[x </span><span style="--0:#56B6C2;--1:#A626A4">^</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">] </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">89</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">90</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">91</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> mid </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42">) </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">92</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> mid) </span><span style="--0:#61AFEF;--1:#3360C1">modify</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, r, x);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">93</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (r </span><span style="--0:#CD89E1;--1:#A626A4">></span><span style="--0:#ABB2BF;--1:#383A42"> mid) </span><span style="--0:#61AFEF;--1:#3360C1">modify</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, r, x);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">94</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">pushup</span><span style="--0:#ABB2BF;--1:#383A42">(idx);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">95</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">96</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">97</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">void</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">reverse</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">l</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">r</span><span style="--0:#ABB2BF">) {</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">98</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">pushdown</span><span style="--0:#ABB2BF;--1:#383A42">(idx);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">99</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#56B6C2;--1:#A626A4">&#x26;&#x26;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> r) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">100</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">size</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">-</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">101</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">rev</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">^=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">102</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">swap</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">lmax</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">], </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">lmax</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">]);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">103</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">swap</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">rmax</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">], </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">rmax</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">]);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">104</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">swap</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">max</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">], </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">max</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">]);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">105</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">106</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">107</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> mid </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42">) </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">108</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> mid) </span><span style="--0:#61AFEF;--1:#3360C1">reverse</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, r);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">109</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (r </span><span style="--0:#CD89E1;--1:#A626A4">></span><span style="--0:#ABB2BF;--1:#383A42"> mid) </span><span style="--0:#61AFEF;--1:#3360C1">reverse</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, r);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">110</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">pushup</span><span style="--0:#ABB2BF;--1:#383A42">(idx);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">111</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">112</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">113</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">queryTotal</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">l</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">r</span><span style="--0:#ABB2BF">) {</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">114</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">pushdown</span><span style="--0:#ABB2BF;--1:#383A42">(idx);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">115</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#56B6C2;--1:#A626A4">&#x26;&#x26;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> r) </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">116</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> mid </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42">) </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">117</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> res </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">118</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> mid) res </span><span style="--0:#CD89E1;--1:#A626A4">+=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">queryTotal</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, r);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">119</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (r </span><span style="--0:#CD89E1;--1:#A626A4">></span><span style="--0:#ABB2BF;--1:#383A42"> mid) res </span><span style="--0:#CD89E1;--1:#A626A4">+=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">queryTotal</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, r);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">120</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42"> res;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">121</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">122</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">123</div></div><div class="code"><span style="--0:#E5C07B;--1:#885D01">SegmentTree</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">queryMax</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">l</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">r</span><span style="--0:#ABB2BF">) {</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">124</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">pushdown</span><span style="--0:#ABB2BF;--1:#383A42">(idx);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">125</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#56B6C2;--1:#A626A4">&#x26;&#x26;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> r) </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx];</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">126</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> mid </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42">) </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">127</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">></span><span style="--0:#ABB2BF;--1:#383A42"> mid) </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">queryMax</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, r);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">128</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (r </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> mid) </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">queryMax</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, r);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">129</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">SegmentTree L{}, R{}, res{};</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">130</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">L </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">queryMax</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, r);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">131</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">R </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">queryMax</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, r);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">132</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">for</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> i </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">; i </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">; i</span><span style="--0:#CD89E1;--1:#A626A4">++</span><span style="--0:#ABB2BF;--1:#383A42">) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">133</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">res</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">max</span><span style="--0:#ABB2BF;--1:#383A42">[i] </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">max</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">max</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#E5C07B;--1:#AF4238">L</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">max</span><span style="--0:#ABB2BF;--1:#383A42">[i], </span><span style="--0:#E5C07B;--1:#AF4238">R</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">max</span><span style="--0:#ABB2BF;--1:#383A42">[i]), </span><span style="--0:#E5C07B;--1:#AF4238">L</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">rmax</span><span style="--0:#ABB2BF;--1:#383A42">[i] </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">R</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">lmax</span><span style="--0:#ABB2BF;--1:#383A42">[i]);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">134</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">res</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">lmax</span><span style="--0:#ABB2BF;--1:#383A42">[i] </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">L</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">lmax</span><span style="--0:#ABB2BF;--1:#383A42">[i];</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">135</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#E5C07B;--1:#AF4238">L</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">==</span><span style="--0:#ABB2BF;--1:#383A42"> i </span><span style="--0:#CD89E1;--1:#A626A4">*</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">L</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">size</span><span style="--0:#ABB2BF;--1:#383A42">) </span><span style="--0:#E5C07B;--1:#AF4238">res</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">lmax</span><span style="--0:#ABB2BF;--1:#383A42">[i] </span><span style="--0:#CD89E1;--1:#A626A4">+=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">R</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">lmax</span><span style="--0:#ABB2BF;--1:#383A42">[i];</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">136</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">res</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">rmax</span><span style="--0:#ABB2BF;--1:#383A42">[i] </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">R</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">rmax</span><span style="--0:#ABB2BF;--1:#383A42">[i];</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">137</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#E5C07B;--1:#AF4238">R</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">==</span><span style="--0:#ABB2BF;--1:#383A42"> i </span><span style="--0:#CD89E1;--1:#A626A4">*</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">R</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">size</span><span style="--0:#ABB2BF;--1:#383A42">) </span><span style="--0:#E5C07B;--1:#AF4238">res</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">rmax</span><span style="--0:#ABB2BF;--1:#383A42">[i] </span><span style="--0:#CD89E1;--1:#A626A4">+=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">L</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">rmax</span><span style="--0:#ABB2BF;--1:#383A42">[i];</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">138</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">139</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">res</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">L</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">R</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">140</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">res</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">size</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">L</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">size</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">R</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">size</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">141</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42"> res;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">142</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">143</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">144</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">main</span><span style="--0:#ABB2BF;--1:#383A42">() {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">145</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">ios::</span><span style="--0:#61AFEF;--1:#3360C1">sync_with_stdio</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">false</span><span style="--0:#ABB2BF;--1:#383A42">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">146</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">cin</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#61AFEF;--1:#3360C1">tie</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">nullptr</span><span style="--0:#ABB2BF;--1:#383A42">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">147</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">cout</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#61AFEF;--1:#3360C1">tie</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">nullptr</span><span style="--0:#ABB2BF;--1:#383A42">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">148</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">149</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> n, m;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">150</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">cin </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> n </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> m;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">151</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">for</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> i </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">; i </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> n; i</span><span style="--0:#CD89E1;--1:#A626A4">++</span><span style="--0:#ABB2BF;--1:#383A42">) cin </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">a</span><span style="--0:#ABB2BF;--1:#383A42">[i];</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">152</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">build</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, n);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">153</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">while</span><span style="--0:#ABB2BF;--1:#383A42"> (m</span><span style="--0:#CD89E1;--1:#A626A4">--</span><span style="--0:#ABB2BF;--1:#383A42">) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">154</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> op, x, y;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">155</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">        </span></span><span style="--0:#ABB2BF;--1:#383A42">cin </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> op </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> x </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> y;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">156</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">        </span></span><span style="--0:#ABB2BF;--1:#383A42">x</span><span style="--0:#CD89E1;--1:#A626A4">++</span><span style="--0:#ABB2BF;--1:#383A42">, y</span><span style="--0:#CD89E1;--1:#A626A4">++</span><span style="--0:#ABB2BF;--1:#383A42">;</span><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic"> // 勿删！</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">157</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (op </span><span style="--0:#CD89E1;--1:#A626A4">==</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">) </span><span style="--0:#61AFEF;--1:#3360C1">modify</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, x, y, </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">158</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">else</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (op </span><span style="--0:#CD89E1;--1:#A626A4">==</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">) </span><span style="--0:#61AFEF;--1:#3360C1">modify</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, x, y, </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">159</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">else</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (op </span><span style="--0:#CD89E1;--1:#A626A4">==</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">2</span><span style="--0:#ABB2BF;--1:#383A42">) </span><span style="--0:#61AFEF;--1:#3360C1">reverse</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, x, y);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">160</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">else</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (op </span><span style="--0:#CD89E1;--1:#A626A4">==</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">3</span><span style="--0:#ABB2BF;--1:#383A42">) cout </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">queryTotal</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, x, y) </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> endl;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">161</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">else</span><span style="--0:#ABB2BF;--1:#383A42"> cout </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">queryMax</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, x, y).</span><span style="--0:#E6888F;--1:#AF4238">max</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">] </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> endl;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">162</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">163</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">164</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="#include <bits/stdc++.h>#define N 100010using namespace std;struct SegmentTree {#define le(x) (x << 1)#define ri(x) (x << 1 | 1)#define leftSubtree(idx) (tree[le(idx)])#define rightSubtree(idx) (tree[ri(idx)])    int l, r;    int que, rev;    int lmax[2], rmax[2], max[2];    int sum, size;} tree[N << 2];int a[N];void pushup(int idx) {    tree[idx].sum = leftSubtree(idx).sum + rightSubtree(idx).sum;    for (int i = 0; i <= 1; i++) {        tree[idx].max[i] = max(max(leftSubtree(idx).max[i], rightSubtree(idx).max[i]), leftSubtree(idx).rmax[i] + rightSubtree(idx).lmax[i]); // 最大连续数的三种情况        tree[idx].lmax[i] = leftSubtree(idx).lmax[i]; // 左端最大连续为左子树的左端最大连续        if (leftSubtree(idx).sum == i * leftSubtree(idx).size) tree[idx].lmax[i] += rightSubtree(idx).lmax[i]; // 可以跨区间，加入右子树的左端最大连续        tree[idx].rmax[i] = rightSubtree(idx).rmax[i]; // 右端最大连续为右子树的右端最大连续        if (rightSubtree(idx).sum == i * rightSubtree(idx).size) tree[idx].rmax[i] += leftSubtree(idx).rmax[i]; // 可以跨区间，加入左子树的右端最大连续    }}void pushdown(int idx) {    if (tree[idx].que >= 0) {        int tag = tree[idx].que; // 下传推平标记        leftSubtree(idx).lmax[tag] = leftSubtree(idx).rmax[tag] = leftSubtree(idx).max[tag] = leftSubtree(idx).size; // 推平的那个数的最大连续均变为子树大小        rightSubtree(idx).lmax[tag] = rightSubtree(idx).rmax[tag] = rightSubtree(idx).max[tag] = rightSubtree(idx).size;        leftSubtree(idx).lmax[tag ^ 1] = leftSubtree(idx).rmax[tag ^ 1] = leftSubtree(idx).max[tag ^ 1] = 0; // 反之，另一个数的最大连续均变为0        rightSubtree(idx).lmax[tag ^ 1] = rightSubtree(idx).rmax[tag ^ 1] = rightSubtree(idx).max[tag ^ 1] = 0;        leftSubtree(idx).sum = leftSubtree(idx).size * tag; // 维护和        rightSubtree(idx).sum = rightSubtree(idx).size * tag;        leftSubtree(idx).que = tag;        leftSubtree(idx).rev = 0;        rightSubtree(idx).que = tag;        rightSubtree(idx).rev = 0;        tree[idx].que = -1;        tree[idx].rev = 0;    }    if (tree[idx].rev) {        leftSubtree(idx).sum = leftSubtree(idx).size - leftSubtree(idx).sum;        rightSubtree(idx).sum = rightSubtree(idx).size - rightSubtree(idx).sum;        swap(leftSubtree(idx).lmax[0], leftSubtree(idx).lmax[1]); // 0/1互换，最大连续也互换        swap(leftSubtree(idx).rmax[0], leftSubtree(idx).rmax[1]);        swap(leftSubtree(idx).max[0], leftSubtree(idx).max[1]);        swap(rightSubtree(idx).lmax[0], rightSubtree(idx).lmax[1]);        swap(rightSubtree(idx).rmax[0], rightSubtree(idx).rmax[1]);        swap(rightSubtree(idx).max[0], rightSubtree(idx).max[1]);        if (leftSubtree(idx).que >= 0) leftSubtree(idx).que ^= 1; // 如果先有了推平，那么相当于推平成另一个数        else leftSubtree(idx).rev ^= 1;        if (rightSubtree(idx).que >= 0) rightSubtree(idx).que ^= 1;        else rightSubtree(idx).rev ^= 1;        tree[idx].rev = 0;    }}void build(int idx, int l, int r) {    tree[idx].l = l, tree[idx].r = r;    tree[idx].size = r - l + 1;    tree[idx].que = -1;    if (l == r) {        tree[idx].sum = a[l];        tree[idx].lmax[a[l]] = tree[idx].rmax[a[l]] = tree[idx].max[a[l]] = 1;        tree[idx].lmax[a[l] ^ 1] = tree[idx].rmax[a[l] ^ 1] = tree[idx].max[a[l] ^ 1] = 0;        return;    }    int mid = (l + r) >> 1;    build(le(idx), l, mid);    build(ri(idx), mid + 1, r);    pushup(idx);}void modify(int idx, int l, int r, int x) {    pushdown(idx);    if (l <= tree[idx].l &#x26;&#x26; tree[idx].r <= r) {        tree[idx].sum = x * tree[idx].size;        tree[idx].que = x;        tree[idx].lmax[x] = tree[idx].rmax[x] = tree[idx].max[x] = tree[idx].size;        tree[idx].lmax[x ^ 1] = tree[idx].rmax[x ^ 1] = tree[idx].max[x ^ 1] = 0;        return;    }    int mid = (tree[idx].l + tree[idx].r) >> 1;    if (l <= mid) modify(le(idx), l, r, x);    if (r > mid) modify(ri(idx), l, r, x);    pushup(idx);}void reverse(int idx, int l, int r) {    pushdown(idx);    if (l <= tree[idx].l &#x26;&#x26; tree[idx].r <= r) {        tree[idx].sum = tree[idx].size - tree[idx].sum;        tree[idx].rev ^= 1;        swap(tree[idx].lmax[0], tree[idx].lmax[1]);        swap(tree[idx].rmax[0], tree[idx].rmax[1]);        swap(tree[idx].max[0], tree[idx].max[1]);        return;    }    int mid = (tree[idx].l + tree[idx].r) >> 1;    if (l <= mid) reverse(le(idx), l, r);    if (r > mid) reverse(ri(idx), l, r);    pushup(idx);}int queryTotal(int idx, int l, int r) {    pushdown(idx);    if (l <= tree[idx].l &#x26;&#x26; tree[idx].r <= r) return tree[idx].sum;    int mid = (tree[idx].l + tree[idx].r) >> 1;    int res = 0;    if (l <= mid) res += queryTotal(le(idx), l, r);    if (r > mid) res += queryTotal(ri(idx), l, r);    return res;}SegmentTree queryMax(int idx, int l, int r) {    pushdown(idx);    if (l <= tree[idx].l &#x26;&#x26; tree[idx].r <= r) return tree[idx];    int mid = (tree[idx].l + tree[idx].r) >> 1;    if (l > mid) return queryMax(ri(idx), l, r);    if (r <= mid) return queryMax(le(idx), l, r);    SegmentTree L{}, R{}, res{};    L = queryMax(le(idx), l, r);    R = queryMax(ri(idx), l, r);    for (int i = 0; i <= 1; i++) {        res.max[i] = max(max(L.max[i], R.max[i]), L.rmax[i] + R.lmax[i]);        res.lmax[i] = L.lmax[i];        if (L.sum == i * L.size) res.lmax[i] += R.lmax[i];        res.rmax[i] = R.rmax[i];        if (R.sum == i * R.size) res.rmax[i] += L.rmax[i];    }    res.sum = L.sum + R.sum;    res.size = L.size + R.size;    return res;}int main() {    ios::sync_with_stdio(false);    cin.tie(nullptr);    cout.tie(nullptr);    int n, m;    cin >> n >> m;    for (int i = 1; i <= n; i++) cin >> a[i];    build(1, 1, n);    while (m--) {        int op, x, y;        cin >> op >> x >> y;        x++, y++; // 勿删！        if (op == 0) modify(1, x, y, 0);        else if (op == 1) modify(1, x, y, 1);        else if (op == 2) reverse(1, x, y);        else if (op == 3) cout << queryTotal(1, x, y) << endl;        else cout << queryMax(1, x, y).max[1] << endl;    }    return 0;}"><div></div></button></div></figure><div class="ec-collapse__gradient" aria-hidden="true"></div></div><button class="ec-collapse__toggle" type="button" aria-expanded="false" aria-controls="collapse-yr4rv014s"><span class="ec-collapse__text-expand">显示更多</span><span class="ec-collapse__text-collapse">显示更少</span><svg class="ec-collapse__icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" aria-hidden="true"><path fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="M6 9l6 6 6-6"></path></svg></button></div></div></section></section>
<section><h2 id="维护数学运算">维护数学运算<a class="anchor" href="#维护数学运算"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h2><p>针对区间待修和区间查询的问题， 我们一般会首先想到线段树，在一些区间数学操作的题目中也不例外。尽管这些数学运算并不一定具备结合律，有时我们仍然可以通过它们的其他性质（短时性，不会进行太多次操作就会变为可做的形式）来转化为简单维护问题去解决。本节就精选了一些线段树维护数学运算的例子。</p><section><h3 id="区间开方区间和">区间开方+区间和<a class="anchor" href="#区间开方区间和"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h3><p>例题：<a href="https://www.luogu.com.cn/problem/SP2713">GSS4 - Can you answer these queries IV</a></p><p>题目难度：<span data-luogu="" data-blue="">提高+/省选-</span></p><p>维护变量： 区间和、区间开方判别标记</p><p>由于平方根下求和没有计算公式，但是考虑到像 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>10</mn><mn>18</mn></msup></mrow><annotation encoding="application/x-tex">{10^{18}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141em;"></span><span class="mord"><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">18</span></span></span></span></span></span></span></span></span></span></span></span></span> 这样的大数据，在经过 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>6</mn></mrow><annotation encoding="application/x-tex">{6}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord"><span class="mord">6</span></span></span></span></span> 次开方后都会变成 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">{1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord"><span class="mord">1</span></span></span></span></span>，而 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msqrt><mn>1</mn></msqrt><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\sqrt 1=1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.04em;vertical-align:-0.1328em;"></span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9072em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord" style="padding-left:0.833em;">1</span></span><span style="top:-2.8672em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="min-width:0.853em;height:1.08em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="1.08em" viewBox="0 0 400000 1080" preserveAspectRatio="xMinYMin slice"><path d="M95,702
c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14
c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54
c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10
s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429
c69,-144,104.5,-217.7,106.5,-221
l0 -0
c5.3,-9.3,12,-14,20,-14
H400000v40H845.2724
s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7
c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z
M834 80h400000v40h-400000z"></path></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1328em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span>。这就是开方运算的短时性。它启发我们把区间修改变为暴力单点修改，记录一下当前数开方后是否等于 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">{1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord"><span class="mord">1</span></span></span></span></span> 或 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">{0}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord"><span class="mord">0</span></span></span></span></span>，如果是则给它做一个标记、并向上更新标记。如果区间被标记，更改时则无需递归进去，简化了大量操作。</p><div class="expressive-code"><div class="ec-collapse ec-collapse--collapsed" id="collapse-qiasxo3tp" data-collapse-preview-lines="8" data-expanded-announcement="代码块已展开" data-collapsed-announcement="代码块已折叠"><div class="ec-collapse__content"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="C++"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#include</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#98C379;--1:#387138">&#x3C;bits/stdc++.h></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#define</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">N</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">100010</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">using</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">namespace</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E5C07B">std</span><span style="--0:#ABB2BF">;</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">typedef</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">long</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">long</span><span style="--0:#ABB2BF;--1:#383A42"> ll;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">struct</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#885D01">SegmentTree</span><span style="--0:#ABB2BF;--1:#383A42"> {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#define</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--1:#383A42"><span style="--0:#ABB2BF">(</span><span style="--0:#E6888F;--0fs:italic">x</span><span style="--0:#ABB2BF">) (x </span></span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#define</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--1:#383A42"><span style="--0:#ABB2BF">(</span><span style="--0:#E6888F;--0fs:italic">x</span><span style="--0:#ABB2BF">) (x </span></span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#56B6C2;--1:#A626A4">|</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#define</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--1:#383A42"><span style="--0:#ABB2BF">(</span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">) (</span></span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--0:#ABB2BF;--1:#383A42">(idx)])</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#define</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--1:#383A42"><span style="--0:#ABB2BF">(</span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">) (</span></span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--0:#ABB2BF;--1:#383A42">(idx)])</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> l, r;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">13</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">ll sum;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">14</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">} </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[N </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">2</span><span style="--0:#ABB2BF;--1:#383A42">];</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">15</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">16</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">ll </span><span style="--0:#E5C07B;--1:#AF4238">a</span><span style="--0:#ABB2BF;--1:#383A42">[N];</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">17</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">18</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">inline</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">void</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">pushup</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">) {</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">19</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">20</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">21</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">22</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">void</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">build</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">l</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">r</span><span style="--0:#ABB2BF">) {</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">23</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> l, </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> r;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">24</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">==</span><span style="--0:#ABB2BF;--1:#383A42"> r) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">25</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">a</span><span style="--0:#ABB2BF;--1:#383A42">[l];</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">26</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">27</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">28</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> mid </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> r) </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">29</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">build</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, mid);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">30</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">build</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--0:#ABB2BF;--1:#383A42">(idx), mid </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, r);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">31</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">pushup</span><span style="--0:#ABB2BF;--1:#383A42">(idx);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">32</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">33</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">34</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">inline</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">void</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">modify</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">l</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">r</span><span style="--0:#ABB2BF">) {</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">35</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">-</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">) </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42">;</span><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic"> // 已经全为 0/1，开方后不变</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">36</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">==</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42">) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">37</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--1:#A626A4"><span style="--0:#ABB2BF">static_cast</span><span style="--0:#CD89E1">&#x3C;</span></span><span style="--0:#ABB2BF;--1:#383A42">ll</span><span style="--0:#CD89E1;--1:#A626A4">></span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">sqrt</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42">));</span><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic"> // 否则暴力单点修改</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">38</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">39</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">40</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> mid </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42">) </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">41</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> mid) </span><span style="--0:#61AFEF;--1:#3360C1">modify</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, r);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">42</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (r </span><span style="--0:#CD89E1;--1:#A626A4">></span><span style="--0:#ABB2BF;--1:#383A42"> mid) </span><span style="--0:#61AFEF;--1:#3360C1">modify</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, r);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">43</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">pushup</span><span style="--0:#ABB2BF;--1:#383A42">(idx);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">44</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">45</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">46</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">inline</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#885D01">ll</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">query</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">l</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">r</span><span style="--0:#ABB2BF">) {</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">47</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#56B6C2;--1:#A626A4">&#x26;&#x26;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> r) </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">48</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> mid </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42">) </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">49</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">ll res </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">50</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> mid) res </span><span style="--0:#CD89E1;--1:#A626A4">+=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">query</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, r);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">51</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (r </span><span style="--0:#CD89E1;--1:#A626A4">></span><span style="--0:#ABB2BF;--1:#383A42"> mid) res </span><span style="--0:#CD89E1;--1:#A626A4">+=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">query</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, r);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">52</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42"> res;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">53</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">54</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">55</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">main</span><span style="--0:#ABB2BF;--1:#383A42">() {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">56</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">ios::</span><span style="--0:#61AFEF;--1:#3360C1">sync_with_stdio</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">false</span><span style="--0:#ABB2BF;--1:#383A42">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">57</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">cin</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#61AFEF;--1:#3360C1">tie</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">nullptr</span><span style="--0:#ABB2BF;--1:#383A42">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">58</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">cout</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#61AFEF;--1:#3360C1">tie</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">nullptr</span><span style="--0:#ABB2BF;--1:#383A42">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">59</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">60</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> n, c </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">61</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">while</span><span style="--0:#ABB2BF;--1:#383A42"> (cin </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> n) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">62</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">memset</span><span style="--0:#ABB2BF;--1:#383A42">(tree, </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">, sizeof tree);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">63</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">memset</span><span style="--0:#ABB2BF;--1:#383A42">(a, </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">, sizeof a);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">64</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">for</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> i </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">; i </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> n; i</span><span style="--0:#CD89E1;--1:#A626A4">++</span><span style="--0:#ABB2BF;--1:#383A42">) cin </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">a</span><span style="--0:#ABB2BF;--1:#383A42">[i];</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">65</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">build</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, n);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">66</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">67</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">        </span></span><span style="--0:#ABB2BF;--1:#383A42">cout </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#98C379;--1:#387138">"Case #"</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">++</span><span style="--0:#ABB2BF;--1:#383A42">c </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#98C379;--1:#387138">":</span><span style="--0:#56B6C2;--1:#016C9A">\n</span><span style="--0:#98C379;--1:#387138">"</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">68</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> q;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">69</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">        </span></span><span style="--0:#ABB2BF;--1:#383A42">cin </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> q;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">70</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">while</span><span style="--0:#ABB2BF;--1:#383A42"> (q</span><span style="--0:#CD89E1;--1:#A626A4">--</span><span style="--0:#ABB2BF;--1:#383A42">) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">71</div></div><div class="code"><span class="indent">            </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> op, x, y;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">72</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">            </span></span><span style="--0:#ABB2BF;--1:#383A42">cin </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> op </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> x </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> y;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">73</div></div><div class="code"><span class="indent">            </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (x </span><span style="--0:#CD89E1;--1:#A626A4">></span><span style="--0:#ABB2BF;--1:#383A42"> y) </span><span style="--0:#61AFEF;--1:#3360C1">swap</span><span style="--0:#ABB2BF;--1:#383A42">(x, y);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">74</div></div><div class="code"><span class="indent">            </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (op </span><span style="--0:#CD89E1;--1:#A626A4">==</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">) </span><span style="--0:#61AFEF;--1:#3360C1">modify</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, x, y);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">75</div></div><div class="code"><span class="indent">            </span><span style="--0:#CD89E1;--1:#A626A4">else</span><span style="--0:#ABB2BF;--1:#383A42"> cout </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">query</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, x, y) </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#98C379;--1:#387138">'</span><span style="--0:#56B6C2;--1:#016C9A">\n</span><span style="--0:#98C379;--1:#387138">'</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">76</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">        </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">77</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">        </span></span><span style="--0:#ABB2BF;--1:#383A42">cout </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#98C379;--1:#387138">'</span><span style="--0:#56B6C2;--1:#016C9A">\n</span><span style="--0:#98C379;--1:#387138">'</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">78</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">79</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">80</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="#include <bits/stdc++.h>#define N 100010using namespace std;typedef long long ll;struct SegmentTree {#define le(x) (x << 1)#define ri(x) (x << 1 | 1)#define leftSubtree(idx) (tree[le(idx)])#define rightSubtree(idx) (tree[ri(idx)])    int l, r;    ll sum;} tree[N << 2];ll a[N];inline void pushup(int idx) {    tree[idx].sum = leftSubtree(idx).sum + rightSubtree(idx).sum;}void build(int idx, int l, int r) {    tree[idx].l = l, tree[idx].r = r;    if (l == r) {        tree[idx].sum = a[l];        return;    }    int mid = (l + r) >> 1;    build(le(idx), l, mid);    build(ri(idx), mid + 1, r);    pushup(idx);}inline void modify(int idx, int l, int r) {    if (tree[idx].sum <= tree[idx].r - tree[idx].l + 1) return; // 已经全为 0/1，开方后不变    if (tree[idx].l == tree[idx].r) {        tree[idx].sum = static_cast<ll>(sqrt(tree[idx].sum)); // 否则暴力单点修改        return;    }    int mid = (tree[idx].l + tree[idx].r) >> 1;    if (l <= mid) modify(le(idx), l, r);    if (r > mid) modify(ri(idx), l, r);    pushup(idx);}inline ll query(int idx, int l, int r) {    if (l <= tree[idx].l &#x26;&#x26; tree[idx].r <= r) return tree[idx].sum;    int mid = (tree[idx].l + tree[idx].r) >> 1;    ll res = 0;    if (l <= mid) res += query(le(idx), l, r);    if (r > mid) res += query(ri(idx), l, r);    return res;}int main() {    ios::sync_with_stdio(false);    cin.tie(nullptr);    cout.tie(nullptr);    int n, c = 0;    while (cin >> n) {        memset(tree, 0, sizeof tree);        memset(a, 0, sizeof a);        for (int i = 1; i <= n; i++) cin >> a[i];        build(1, 1, n);        cout << &#x22;Case #&#x22; << ++c << &#x22;:\n&#x22;;        int q;        cin >> q;        while (q--) {            int op, x, y;            cin >> op >> x >> y;            if (x > y) swap(x, y);            if (op == 0) modify(1, x, y);            else cout << query(1, x, y) << &#x27;\n&#x27;;        }        cout << &#x27;\n&#x27;;    }    return 0;}"><div></div></button></div></figure><div class="ec-collapse__gradient" aria-hidden="true"></div></div><button class="ec-collapse__toggle" type="button" aria-expanded="false" aria-controls="collapse-qiasxo3tp"><span class="ec-collapse__text-expand">显示更多</span><span class="ec-collapse__text-collapse">显示更少</span><svg class="ec-collapse__icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" aria-hidden="true"><path fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="M6 9l6 6 6-6"></path></svg></button></div></div></section><section><h3 id="区间加区间sin和">区间加+区间sin和<a class="anchor" href="#区间加区间sin和"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h3><p>例题：<a href="https://www.luogu.com.cn/problem/P6327">P6327 区间加区间 sin 和</a></p><p>题目难度：<span data-luogu="" data-blue="">提高+/省选-</span></p><p>维护变量：区间 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>sin</mi><mo>⁡</mo></mrow><annotation encoding="application/x-tex">\sin</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6679em;"></span><span class="mop">sin</span></span></span></span> 和、区间 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>cos</mi><mo>⁡</mo></mrow><annotation encoding="application/x-tex">\cos</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mop">cos</span></span></span></span> 和、角度加法懒标记</p><p>正余弦函数显然具备结合律。根据正弦值的和角公式：<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>sin</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>a</mi><mo>+</mo><mi>b</mi><mo stretchy="false">)</mo><mo>=</mo><mi>sin</mi><mo>⁡</mo><mi>a</mi><mo>⋅</mo><mi>cos</mi><mo>⁡</mo><mi>b</mi><mo>+</mo><mi>cos</mi><mo>⁡</mo><mi>a</mi><mo>⋅</mo><mi>sin</mi><mo>⁡</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">\sin(a+b)=\sin a\cdot\cos b+\cos a\cdot\sin b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop">sin</span><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">b</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6679em;"></span><span class="mop">sin</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.0833em;"></span><span class="mop">cos</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">b</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.4445em;"></span><span class="mop">cos</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mop">sin</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">b</span></span></span></span>，这里维护一个加法懒标记，在下传时使用和角公式一次性计算、同时维护 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>sin</mi><mo>⁡</mo></mrow><annotation encoding="application/x-tex">\sin</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6679em;"></span><span class="mop">sin</span></span></span></span> 和即可。注意需要把相关 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>sin</mi><mo>⁡</mo></mrow><annotation encoding="application/x-tex">\sin</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6679em;"></span><span class="mop">sin</span></span></span></span> 和 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>cos</mi><mo>⁡</mo></mrow><annotation encoding="application/x-tex">\cos</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mop">cos</span></span></span></span> 值存成变量再更新，否则答案错误（<del>这样连样例都能过</del>）。</p><div class="expressive-code"><div class="ec-collapse ec-collapse--collapsed" id="collapse-0ez65dtle" data-collapse-preview-lines="8" data-expanded-announcement="代码块已展开" data-collapsed-announcement="代码块已折叠"><div class="ec-collapse__content"><figure class="frame" style="--lnWidth:3ch"><figcaption class="header"></figcaption><pre data-language="C++"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#include</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#98C379;--1:#387138">&#x3C;bits/stdc++.h></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#define</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">N</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">200010</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">using</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">namespace</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E5C07B">std</span><span style="--0:#ABB2BF">;</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">const</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">double</span><span style="--0:#ABB2BF;--1:#383A42"> EPS </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--1:#875D01"><span style="--0:#D19A66">1</span><span style="--0:#E6888F">e</span></span><span style="--0:#ABB2BF;--1:#A626A4">-</span><span style="--0:#D19A66;--1:#875D01">8</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">struct</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#885D01">SegmentTree</span><span style="--0:#ABB2BF;--1:#383A42"> {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#define</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--1:#383A42"><span style="--0:#ABB2BF">(</span><span style="--0:#E6888F;--0fs:italic">x</span><span style="--0:#ABB2BF">) (x </span></span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#define</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--1:#383A42"><span style="--0:#ABB2BF">(</span><span style="--0:#E6888F;--0fs:italic">x</span><span style="--0:#ABB2BF">) (x </span></span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#56B6C2;--1:#A626A4">|</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#define</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--1:#383A42"><span style="--0:#ABB2BF">(</span><span style="--0:#E6888F;--0fs:italic">x</span><span style="--0:#ABB2BF">) (</span></span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--0:#ABB2BF;--1:#383A42">(x)])</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#define</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--1:#383A42"><span style="--0:#ABB2BF">(</span><span style="--0:#E6888F;--0fs:italic">x</span><span style="--0:#ABB2BF">) (</span></span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--0:#ABB2BF;--1:#383A42">(x)])</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> l, r, size;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">13</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">double</span><span style="--0:#ABB2BF;--1:#383A42"> sin, cos;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">14</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">double</span><span style="--0:#ABB2BF;--1:#383A42"> lazy;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">15</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">} </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[N </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">2</span><span style="--0:#ABB2BF;--1:#383A42">];</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">16</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">double</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">a</span><span style="--0:#ABB2BF;--1:#383A42">[N];</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">17</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">18</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">void</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">pushup</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">) {</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">19</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">sin</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">sin</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">sin</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">20</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">cos</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">cos</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">cos</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">21</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">22</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">23</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">void</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">pushdown</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">) {</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">24</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#61AFEF;--1:#3360C1">abs</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">lazy</span><span style="--0:#ABB2BF;--1:#383A42">) </span><span style="--0:#CD89E1;--1:#A626A4">></span><span style="--0:#ABB2BF;--1:#383A42"> EPS) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">25</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">double</span><span style="--0:#ABB2BF;--1:#383A42"> SIN </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">sin</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">lazy</span><span style="--0:#ABB2BF;--1:#383A42">), COS </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">cos</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">lazy</span><span style="--0:#ABB2BF;--1:#383A42">);</span><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic"> // 需要先存成变量，否则变量中途修改会影响其他变量</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">26</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">double</span><span style="--0:#ABB2BF;--1:#383A42"> LSIN </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">sin</span><span style="--0:#ABB2BF;--1:#383A42">, LCOS </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">cos</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">27</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">double</span><span style="--0:#ABB2BF;--1:#383A42"> RSIN </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">sin</span><span style="--0:#ABB2BF;--1:#383A42">, RCOS </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">cos</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">28</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">29</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">sin</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> SIN </span><span style="--0:#CD89E1;--1:#A626A4">*</span><span style="--0:#ABB2BF;--1:#383A42"> LCOS </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> COS </span><span style="--0:#CD89E1;--1:#A626A4">*</span><span style="--0:#ABB2BF;--1:#383A42"> LSIN;</span><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic"> // sin 和角公式</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">30</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">cos</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> COS </span><span style="--0:#CD89E1;--1:#A626A4">*</span><span style="--0:#ABB2BF;--1:#383A42"> LCOS </span><span style="--0:#CD89E1;--1:#A626A4">-</span><span style="--0:#ABB2BF;--1:#383A42"> SIN </span><span style="--0:#CD89E1;--1:#A626A4">*</span><span style="--0:#ABB2BF;--1:#383A42"> LSIN;</span><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic"> // cos 和角公式</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">31</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">lazy</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">lazy</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">32</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">sin</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> SIN </span><span style="--0:#CD89E1;--1:#A626A4">*</span><span style="--0:#ABB2BF;--1:#383A42"> RCOS </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> COS </span><span style="--0:#CD89E1;--1:#A626A4">*</span><span style="--0:#ABB2BF;--1:#383A42"> RSIN;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">33</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">cos</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> COS </span><span style="--0:#CD89E1;--1:#A626A4">*</span><span style="--0:#ABB2BF;--1:#383A42"> RCOS </span><span style="--0:#CD89E1;--1:#A626A4">-</span><span style="--0:#ABB2BF;--1:#383A42"> SIN </span><span style="--0:#CD89E1;--1:#A626A4">*</span><span style="--0:#ABB2BF;--1:#383A42"> RSIN;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">34</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">lazy</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">lazy</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">35</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">36</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">lazy</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">0.0</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">37</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">38</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">39</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">40</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">void</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">build</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">l</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">r</span><span style="--0:#ABB2BF">) {</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">41</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> l, </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> r;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">42</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">size</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> r </span><span style="--0:#CD89E1;--1:#A626A4">-</span><span style="--0:#ABB2BF;--1:#383A42"> l </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">43</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">lazy</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">0.0</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">44</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">==</span><span style="--0:#ABB2BF;--1:#383A42"> r) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">45</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">sin</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">sin</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#E5C07B;--1:#AF4238">a</span><span style="--0:#ABB2BF;--1:#383A42">[l]);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">46</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">cos</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">cos</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#E5C07B;--1:#AF4238">a</span><span style="--0:#ABB2BF;--1:#383A42">[l]);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">47</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">48</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">49</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> mid </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> r) </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">50</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">build</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, mid);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">51</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">build</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--0:#ABB2BF;--1:#383A42">(idx), mid </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, r);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">52</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">pushup</span><span style="--0:#ABB2BF;--1:#383A42">(idx);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">53</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">54</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">55</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">void</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">modify</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">l</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">r</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">double</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">x</span><span style="--0:#ABB2BF">) {</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">56</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#56B6C2;--1:#A626A4">&#x26;&#x26;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> r) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">57</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">double</span><span style="--0:#ABB2BF;--1:#383A42"> SIN </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">sin</span><span style="--0:#ABB2BF;--1:#383A42">, COS </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">cos</span><span style="--0:#ABB2BF;--1:#383A42">;</span><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic"> // 同理，需要预先存成变量</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">58</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">double</span><span style="--0:#ABB2BF;--1:#383A42"> SINX </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">sin</span><span style="--0:#ABB2BF;--1:#383A42">(x), COSX </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">cos</span><span style="--0:#ABB2BF;--1:#383A42">(x);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">59</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">sin</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> SIN </span><span style="--0:#CD89E1;--1:#A626A4">*</span><span style="--0:#ABB2BF;--1:#383A42"> COSX </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> COS </span><span style="--0:#CD89E1;--1:#A626A4">*</span><span style="--0:#ABB2BF;--1:#383A42"> SINX;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">60</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">cos</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> COS </span><span style="--0:#CD89E1;--1:#A626A4">*</span><span style="--0:#ABB2BF;--1:#383A42"> COSX </span><span style="--0:#CD89E1;--1:#A626A4">-</span><span style="--0:#ABB2BF;--1:#383A42"> SIN </span><span style="--0:#CD89E1;--1:#A626A4">*</span><span style="--0:#ABB2BF;--1:#383A42"> SINX;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">61</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">lazy</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+=</span><span style="--0:#ABB2BF;--1:#383A42"> x;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">62</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">63</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">64</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">pushdown</span><span style="--0:#ABB2BF;--1:#383A42">(idx);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">65</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> mid </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42">) </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">66</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> mid) </span><span style="--0:#61AFEF;--1:#3360C1">modify</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, r, x);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">67</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (r </span><span style="--0:#CD89E1;--1:#A626A4">></span><span style="--0:#ABB2BF;--1:#383A42"> mid) </span><span style="--0:#61AFEF;--1:#3360C1">modify</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, r, x);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">68</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">pushup</span><span style="--0:#ABB2BF;--1:#383A42">(idx);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">69</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">70</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">71</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">double</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">query</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">l</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">r</span><span style="--0:#ABB2BF">) {</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">72</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#56B6C2;--1:#A626A4">&#x26;&#x26;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> r) </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">sin</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">73</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">pushdown</span><span style="--0:#ABB2BF;--1:#383A42">(idx);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">74</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> mid </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42">) </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">75</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">double</span><span style="--0:#ABB2BF;--1:#383A42"> ret </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">0.0</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">76</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> mid) ret </span><span style="--0:#CD89E1;--1:#A626A4">+=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">query</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, r);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">77</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (r </span><span style="--0:#CD89E1;--1:#A626A4">></span><span style="--0:#ABB2BF;--1:#383A42"> mid) ret </span><span style="--0:#CD89E1;--1:#A626A4">+=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">query</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, r);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">78</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42"> ret;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">79</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">80</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">81</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">main</span><span style="--0:#ABB2BF;--1:#383A42">() {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">82</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">ios::</span><span style="--0:#61AFEF;--1:#3360C1">sync_with_stdio</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">false</span><span style="--0:#ABB2BF;--1:#383A42">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">83</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">cin</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#61AFEF;--1:#3360C1">tie</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">nullptr</span><span style="--0:#ABB2BF;--1:#383A42">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">84</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">cout</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#61AFEF;--1:#3360C1">tie</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">nullptr</span><span style="--0:#ABB2BF;--1:#383A42">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">85</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">86</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> n, m;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">87</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">cin </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> n;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">88</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">for</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> i </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">; i </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> n; i</span><span style="--0:#CD89E1;--1:#A626A4">++</span><span style="--0:#ABB2BF;--1:#383A42">) cin </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">a</span><span style="--0:#ABB2BF;--1:#383A42">[i];</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">89</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">build</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, n);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">90</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">cin </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> m;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">91</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">while</span><span style="--0:#ABB2BF;--1:#383A42"> (m</span><span style="--0:#CD89E1;--1:#A626A4">--</span><span style="--0:#ABB2BF;--1:#383A42">) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">92</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> op, l, r;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">93</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">double</span><span style="--0:#ABB2BF;--1:#383A42"> v;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">94</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">        </span></span><span style="--0:#ABB2BF;--1:#383A42">cin </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> op </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> l </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> r;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">95</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (op </span><span style="--0:#CD89E1;--1:#A626A4">==</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">96</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">            </span></span><span style="--0:#ABB2BF;--1:#383A42">cin </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> v;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">97</div></div><div class="code"><span class="indent">            </span><span style="--0:#61AFEF;--1:#3360C1">modify</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, l, r, v);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">98</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">        </span></span><span style="--0:#ABB2BF;--1:#383A42">} </span><span style="--0:#CD89E1;--1:#A626A4">else</span><span style="--0:#ABB2BF;--1:#383A42"> cout </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> fixed </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">setprecision</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">) </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">query</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, l, r) </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> endl;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">99</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">100</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">101</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">102</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="#include <bits/stdc++.h>#define N 200010using namespace std;const double EPS = 1e-8;struct SegmentTree {#define le(x) (x << 1)#define ri(x) (x << 1 | 1)#define leftSubtree(x) (tree[le(x)])#define rightSubtree(x) (tree[ri(x)])    int l, r, size;    double sin, cos;    double lazy;} tree[N << 2];double a[N];void pushup(int idx) {    tree[idx].sin = leftSubtree(idx).sin + rightSubtree(idx).sin;    tree[idx].cos = leftSubtree(idx).cos + rightSubtree(idx).cos;}void pushdown(int idx) {    if (abs(tree[idx].lazy) > EPS) {        double SIN = sin(tree[idx].lazy), COS = cos(tree[idx].lazy); // 需要先存成变量，否则变量中途修改会影响其他变量        double LSIN = leftSubtree(idx).sin, LCOS = leftSubtree(idx).cos;        double RSIN = rightSubtree(idx).sin, RCOS = rightSubtree(idx).cos;        leftSubtree(idx).sin = SIN * LCOS + COS * LSIN; // sin 和角公式        leftSubtree(idx).cos = COS * LCOS - SIN * LSIN; // cos 和角公式        leftSubtree(idx).lazy += tree[idx].lazy;        rightSubtree(idx).sin = SIN * RCOS + COS * RSIN;        rightSubtree(idx).cos = COS * RCOS - SIN * RSIN;        rightSubtree(idx).lazy += tree[idx].lazy;        tree[idx].lazy = 0.0;    }}void build(int idx, int l, int r) {    tree[idx].l = l, tree[idx].r = r;    tree[idx].size = r - l + 1;    tree[idx].lazy = 0.0;    if (l == r) {        tree[idx].sin = sin(a[l]);        tree[idx].cos = cos(a[l]);        return;    }    int mid = (l + r) >> 1;    build(le(idx), l, mid);    build(ri(idx), mid + 1, r);    pushup(idx);}void modify(int idx, int l, int r, double x) {    if (l <= tree[idx].l &#x26;&#x26; tree[idx].r <= r) {        double SIN = tree[idx].sin, COS = tree[idx].cos; // 同理，需要预先存成变量        double SINX = sin(x), COSX = cos(x);        tree[idx].sin = SIN * COSX + COS * SINX;        tree[idx].cos = COS * COSX - SIN * SINX;        tree[idx].lazy += x;        return;    }    pushdown(idx);    int mid = (tree[idx].l + tree[idx].r) >> 1;    if (l <= mid) modify(le(idx), l, r, x);    if (r > mid) modify(ri(idx), l, r, x);    pushup(idx);}double query(int idx, int l, int r) {    if (l <= tree[idx].l &#x26;&#x26; tree[idx].r <= r) return tree[idx].sin;    pushdown(idx);    int mid = (tree[idx].l + tree[idx].r) >> 1;    double ret = 0.0;    if (l <= mid) ret += query(le(idx), l, r);    if (r > mid) ret += query(ri(idx), l, r);    return ret;}int main() {    ios::sync_with_stdio(false);    cin.tie(nullptr);    cout.tie(nullptr);    int n, m;    cin >> n;    for (int i = 1; i <= n; i++) cin >> a[i];    build(1, 1, n);    cin >> m;    while (m--) {        int op, l, r;        double v;        cin >> op >> l >> r;        if (op == 1) {            cin >> v;            modify(1, l, r, v);        } else cout << fixed << setprecision(1) << query(1, l, r) << endl;    }    return 0;}"><div></div></button></div></figure><div class="ec-collapse__gradient" aria-hidden="true"></div></div><button class="ec-collapse__toggle" type="button" aria-expanded="false" aria-controls="collapse-0ez65dtle"><span class="ec-collapse__text-expand">显示更多</span><span class="ec-collapse__text-collapse">显示更少</span><svg class="ec-collapse__icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" aria-hidden="true"><path fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="M6 9l6 6 6-6"></path></svg></button></div></div></section><section><h3 id="区间加区间平均数区间方差">区间加+区间平均数+区间方差<a class="anchor" href="#区间加区间平均数区间方差"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h3><p>例题：<a href="https://www.luogu.com.cn/problem/P1471">P1471 方差</a></p><p>题目难度：<span data-luogu="" data-blue="">提高+/省选-</span></p><p>维护变量：区间平方和、区间和</p><p>方差公式：<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>s</mi><mn>2</mn></msup><mo>=</mo><mfrac><mrow><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></msubsup><mo stretchy="false">(</mo><msub><mi>a</mi><mi>i</mi></msub><mo>−</mo><mover accent="true"><mi>a</mi><mo stretchy="true">‾</mo></mover><msup><mo stretchy="false">)</mo><mn>2</mn></msup></mrow><mi>n</mi></mfrac></mrow><annotation encoding="application/x-tex">s^2=\frac{\sum\limits_{i=1}^{n}(a_i-\overline a)^2}{n}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.3564em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.0114em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-4.0311em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mop op-limits mtight"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.4005em;"><span style="top:-1.8629em;margin-left:0em;"><span class="pstrut" style="height:2.75em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-2.75em;"><span class="pstrut" style="height:2.75em;"></span><span><span class="mop op-symbol small-op mtight">∑</span></span></span><span style="top:-3.7em;margin-left:0em;"><span class="pstrut" style="height:2.75em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.0301em;"><span></span></span></span></span></span><span class="mopen mtight">(</span><span class="mord mtight"><span class="mord mathnormal mtight">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mbin mtight">−</span><span class="mord overline mtight"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6756em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mtight"><span class="mord mathnormal mtight">a</span></span></span><span style="top:-3.5776em;"><span class="pstrut" style="height:3em;"></span><span class="overline-line mtight" style="border-bottom-width:0.049em;"></span></span></span></span></span></span><span class="mclose mtight"><span class="mclose mtight">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913em;"><span style="top:-2.931em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span>，展开化简得 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>s</mi><mn>2</mn></msup><mo>=</mo><mfrac><mrow><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></msubsup><msubsup><mi>a</mi><mi>i</mi><mn>2</mn></msubsup></mrow><mi>n</mi></mfrac><mo>−</mo><msup><mover accent="true"><mi>a</mi><mo stretchy="true">‾</mo></mover><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">s^2=\frac{\sum\limits_{i=1}^{n}a_i^2}{n}-\overline a^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.3564em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.0114em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-4.0311em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mop op-limits mtight"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.4005em;"><span style="top:-1.8629em;margin-left:0em;"><span class="pstrut" style="height:2.75em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-2.75em;"><span class="pstrut" style="height:2.75em;"></span><span><span class="mop op-symbol small-op mtight">∑</span></span></span><span style="top:-3.7em;margin-left:0em;"><span class="pstrut" style="height:2.75em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.0301em;"><span></span></span></span></span></span><span class="mspace mtight" style="margin-right:0.1952em;"></span><span class="mord mtight"><span class="mord mathnormal mtight">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8913em;"><span style="top:-2.214em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">i</span></span></span><span style="top:-2.931em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8346em;"></span><span class="mord"><span class="mord overline"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6306em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">a</span></span></span><span style="top:-3.5506em;"><span class="pstrut" style="height:3em;"></span><span class="overline-line" style="border-bottom-width:0.04em;"></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8346em;"><span style="top:-3.0835em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span>。因此维护平方和用于计算分数部分。进行区间加时，维护平方和有这个公式：<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>∑</mo><mo stretchy="false">(</mo><msub><mi>a</mi><mi>i</mi></msub><mo>+</mo><mi>x</mi><msup><mo stretchy="false">)</mo><mn>2</mn></msup><mo>=</mo><mn>2</mn><mi>x</mi><mo>∑</mo><msub><mi>a</mi><mi>i</mi></msub><mo>+</mo><mo>∑</mo><msubsup><mi>a</mi><mi>i</mi><mn>2</mn></msubsup><mo>+</mo><mi>n</mi><msup><mi>x</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">\sum(a_i+x)^2=2x\sum a_i+\sum a_i^2+nx^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop op-symbol small-op" style="position:relative;top:0em;">∑</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em;"></span><span class="mord mathnormal">x</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">2</span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop op-symbol small-op" style="position:relative;top:0em;">∑</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.0728em;vertical-align:-0.2587em;"></span><span class="mop op-symbol small-op" style="position:relative;top:0em;">∑</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-2.4413em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2587em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8141em;"></span><span class="mord mathnormal">n</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span>。具备结合律。我们按照公式维护即可。</p><div class="expressive-code"><div class="ec-collapse ec-collapse--collapsed" id="collapse-ijppgqbbj" data-collapse-preview-lines="8" data-expanded-announcement="代码块已展开" data-collapsed-announcement="代码块已折叠"><div class="ec-collapse__content"><figure class="frame" style="--lnWidth:3ch"><figcaption class="header"></figcaption><pre data-language="C++"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#include</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#98C379;--1:#387138">&#x3C;bits/stdc++.h></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#define</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">N</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">100010</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">using</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">namespace</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E5C07B">std</span><span style="--0:#ABB2BF">;</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">typedef</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">long</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">long</span><span style="--0:#ABB2BF;--1:#383A42"> ll;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">const</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">double</span><span style="--0:#ABB2BF;--1:#383A42"> EPS </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--1:#875D01"><span style="--0:#D19A66">1</span><span style="--0:#E6888F">e</span></span><span style="--0:#ABB2BF;--1:#A626A4">-</span><span style="--0:#D19A66;--1:#875D01">8</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">struct</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#885D01">SegmentTree</span><span style="--0:#ABB2BF;--1:#383A42"> {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#define</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--1:#383A42"><span style="--0:#ABB2BF">(</span><span style="--0:#E6888F;--0fs:italic">x</span><span style="--0:#ABB2BF">) (x </span></span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#define</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--1:#383A42"><span style="--0:#ABB2BF">(</span><span style="--0:#E6888F;--0fs:italic">x</span><span style="--0:#ABB2BF">) (x </span></span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#56B6C2;--1:#A626A4">|</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#define</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--1:#383A42"><span style="--0:#ABB2BF">(</span><span style="--0:#E6888F;--0fs:italic">x</span><span style="--0:#ABB2BF">) (</span></span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--0:#ABB2BF;--1:#383A42">(x)])</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">13</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#define</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--1:#383A42"><span style="--0:#ABB2BF">(</span><span style="--0:#E6888F;--0fs:italic">x</span><span style="--0:#ABB2BF">) (</span></span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--0:#ABB2BF;--1:#383A42">(x)])</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">14</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> l, r, size;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">15</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">double</span><span style="--0:#ABB2BF;--1:#383A42"> sum, sumSq;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">16</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">double</span><span style="--0:#ABB2BF;--1:#383A42"> lazy, lazySq;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">17</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">} </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[N </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">2</span><span style="--0:#ABB2BF;--1:#383A42">];</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">18</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">double</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">a</span><span style="--0:#ABB2BF;--1:#383A42">[N];</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">19</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">20</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">void</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">pushup</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">) {</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">21</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">22</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">sumSq</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">sumSq</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">sumSq</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">23</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">24</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">25</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">void</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">pushdown</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">) {</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">26</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#61AFEF;--1:#3360C1">abs</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">lazySq</span><span style="--0:#ABB2BF;--1:#383A42">) </span><span style="--0:#CD89E1;--1:#A626A4">></span><span style="--0:#ABB2BF;--1:#383A42"> EPS) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">27</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">sumSq</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">2</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">*</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">*</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">lazySq</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">size</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">*</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">lazySq</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">*</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">lazySq</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">28</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">lazySq</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">lazySq</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">29</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">sumSq</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">2</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">*</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">*</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">lazySq</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">size</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">*</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">lazySq</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">*</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">lazySq</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">30</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">lazySq</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">lazySq</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">31</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">lazySq</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">32</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">33</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#61AFEF;--1:#3360C1">abs</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">lazy</span><span style="--0:#ABB2BF;--1:#383A42">) </span><span style="--0:#CD89E1;--1:#A626A4">></span><span style="--0:#ABB2BF;--1:#383A42"> EPS) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">34</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">size</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">*</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">lazy</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">35</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">lazy</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">lazy</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">36</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">size</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">*</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">lazy</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">37</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">lazy</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">lazy</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">38</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">lazy</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">39</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">40</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">41</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">42</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">void</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">build</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">l</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">r</span><span style="--0:#ABB2BF">) {</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">43</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> l, </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> r;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">44</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">size</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> r </span><span style="--0:#CD89E1;--1:#A626A4">-</span><span style="--0:#ABB2BF;--1:#383A42"> l </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">45</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">==</span><span style="--0:#ABB2BF;--1:#383A42"> r) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">46</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">a</span><span style="--0:#ABB2BF;--1:#383A42">[l];</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">47</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">sumSq</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">a</span><span style="--0:#ABB2BF;--1:#383A42">[l] </span><span style="--0:#CD89E1;--1:#A626A4">*</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">a</span><span style="--0:#ABB2BF;--1:#383A42">[l];</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">48</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">49</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">50</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> mid </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> r) </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">51</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">build</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, mid);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">52</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">build</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--0:#ABB2BF;--1:#383A42">(idx), mid </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, r);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">53</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">pushup</span><span style="--0:#ABB2BF;--1:#383A42">(idx);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">54</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">55</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">56</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">void</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">modify</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">l</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">r</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">double</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">x</span><span style="--0:#ABB2BF">) {</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">57</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42">(l </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#56B6C2;--1:#A626A4">&#x26;&#x26;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> r) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">58</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">sumSq</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">2</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">*</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">*</span><span style="--0:#ABB2BF;--1:#383A42"> x </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">size</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">*</span><span style="--0:#ABB2BF;--1:#383A42"> x </span><span style="--0:#CD89E1;--1:#A626A4">*</span><span style="--0:#ABB2BF;--1:#383A42"> x;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">59</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">lazySq</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+=</span><span style="--0:#ABB2BF;--1:#383A42"> x;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">60</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+=</span><span style="--0:#ABB2BF;--1:#383A42"> x </span><span style="--0:#CD89E1;--1:#A626A4">*</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">size</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">61</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">lazy</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+=</span><span style="--0:#ABB2BF;--1:#383A42"> x;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">62</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">63</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">64</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">pushdown</span><span style="--0:#ABB2BF;--1:#383A42">(idx);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">65</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> mid </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42">) </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">66</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> mid) </span><span style="--0:#61AFEF;--1:#3360C1">modify</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, r, x);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">67</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (r </span><span style="--0:#CD89E1;--1:#A626A4">></span><span style="--0:#ABB2BF;--1:#383A42"> mid) </span><span style="--0:#61AFEF;--1:#3360C1">modify</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, r, x);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">68</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">pushup</span><span style="--0:#ABB2BF;--1:#383A42">(idx);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">69</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">70</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">71</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">double</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">querySum</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">l</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">r</span><span style="--0:#ABB2BF">) {</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">72</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#56B6C2;--1:#A626A4">&#x26;&#x26;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> r) </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">73</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">pushdown</span><span style="--0:#ABB2BF;--1:#383A42">(idx);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">74</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> mid </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42">) </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">75</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">double</span><span style="--0:#ABB2BF;--1:#383A42"> ret </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">0.0</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">76</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> mid) ret </span><span style="--0:#CD89E1;--1:#A626A4">+=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">querySum</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, r);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">77</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (r </span><span style="--0:#CD89E1;--1:#A626A4">></span><span style="--0:#ABB2BF;--1:#383A42"> mid) ret </span><span style="--0:#CD89E1;--1:#A626A4">+=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">querySum</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, r);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">78</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42"> ret;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">79</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">80</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">81</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">double</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">querySumSq</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">l</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">r</span><span style="--0:#ABB2BF">) {</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">82</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#56B6C2;--1:#A626A4">&#x26;&#x26;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> r) </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">sumSq</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">83</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">pushdown</span><span style="--0:#ABB2BF;--1:#383A42">(idx);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">84</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> mid </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42">) </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">85</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">double</span><span style="--0:#ABB2BF;--1:#383A42"> ret </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">0.0</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">86</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> mid) ret </span><span style="--0:#CD89E1;--1:#A626A4">+=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">querySumSq</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, r);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">87</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (r </span><span style="--0:#CD89E1;--1:#A626A4">></span><span style="--0:#ABB2BF;--1:#383A42"> mid) ret </span><span style="--0:#CD89E1;--1:#A626A4">+=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">querySumSq</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, r);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">88</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42"> ret;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">89</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">90</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">91</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">main</span><span style="--0:#ABB2BF;--1:#383A42">() {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">92</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">ios::</span><span style="--0:#61AFEF;--1:#3360C1">sync_with_stdio</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">false</span><span style="--0:#ABB2BF;--1:#383A42">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">93</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">cin</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#61AFEF;--1:#3360C1">tie</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">nullptr</span><span style="--0:#ABB2BF;--1:#383A42">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">94</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">cout</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#61AFEF;--1:#3360C1">tie</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">nullptr</span><span style="--0:#ABB2BF;--1:#383A42">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">95</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">96</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> n, m;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">97</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">cin </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> n </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> m;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">98</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">for</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> i </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">; i </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> n; i</span><span style="--0:#CD89E1;--1:#A626A4">++</span><span style="--0:#ABB2BF;--1:#383A42">) cin </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">a</span><span style="--0:#ABB2BF;--1:#383A42">[i];</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">99</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">build</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, n);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">100</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">while</span><span style="--0:#ABB2BF;--1:#383A42"> (m</span><span style="--0:#CD89E1;--1:#A626A4">--</span><span style="--0:#ABB2BF;--1:#383A42">) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">101</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> op, l, r;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">102</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">double</span><span style="--0:#ABB2BF;--1:#383A42"> x;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">103</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">        </span></span><span style="--0:#ABB2BF;--1:#383A42">cin </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> op </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> l </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> r;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">104</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> size </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> r </span><span style="--0:#CD89E1;--1:#A626A4">-</span><span style="--0:#ABB2BF;--1:#383A42"> l </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">105</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (op </span><span style="--0:#CD89E1;--1:#A626A4">==</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">106</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">            </span></span><span style="--0:#ABB2BF;--1:#383A42">cin </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> x;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">107</div></div><div class="code"><span class="indent">            </span><span style="--0:#61AFEF;--1:#3360C1">modify</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, l, r, x);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">108</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">        </span></span><span style="--0:#ABB2BF;--1:#383A42">} </span><span style="--0:#CD89E1;--1:#A626A4">else</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (op </span><span style="--0:#CD89E1;--1:#A626A4">==</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">2</span><span style="--0:#ABB2BF;--1:#383A42">) cout </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> fixed </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">setprecision</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">4</span><span style="--0:#ABB2BF;--1:#383A42">) </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">querySum</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, l, r) </span><span style="--0:#CD89E1;--1:#A626A4">/</span><span style="--0:#ABB2BF;--1:#383A42"> size </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> endl;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">109</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">else</span><span style="--0:#ABB2BF;--1:#383A42"> cout </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> fixed </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">setprecision</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">4</span><span style="--0:#ABB2BF;--1:#383A42">) </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">querySumSq</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, l, r) </span><span style="--0:#CD89E1;--1:#A626A4">/</span><span style="--0:#ABB2BF;--1:#383A42"> size </span><span style="--0:#CD89E1;--1:#A626A4">-</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">pow</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">querySum</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, l, r) </span><span style="--0:#CD89E1;--1:#A626A4">/</span><span style="--0:#ABB2BF;--1:#383A42"> size, </span><span style="--0:#D19A66;--1:#875D01">2</span><span style="--0:#ABB2BF;--1:#383A42">) </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> endl;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">110</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">111</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">112</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">113</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="#include <bits/stdc++.h>#define N 100010using namespace std;typedef long long ll;const double EPS = 1e-8;struct SegmentTree {#define le(x) (x << 1)#define ri(x) (x << 1 | 1)#define leftSubtree(x) (tree[le(x)])#define rightSubtree(x) (tree[ri(x)])    int l, r, size;    double sum, sumSq;    double lazy, lazySq;} tree[N << 2];double a[N];void pushup(int idx) {    tree[idx].sum = leftSubtree(idx).sum + rightSubtree(idx).sum;    tree[idx].sumSq = leftSubtree(idx).sumSq + rightSubtree(idx).sumSq;}void pushdown(int idx) {    if (abs(tree[idx].lazySq) > EPS) {        leftSubtree(idx).sumSq += 2 * leftSubtree(idx).sum * tree[idx].lazySq + leftSubtree(idx).size * tree[idx].lazySq * tree[idx].lazySq;        leftSubtree(idx).lazySq += tree[idx].lazySq;        rightSubtree(idx).sumSq += 2 * rightSubtree(idx).sum * tree[idx].lazySq + rightSubtree(idx).size * tree[idx].lazySq * tree[idx].lazySq;        rightSubtree(idx).lazySq += tree[idx].lazySq;        tree[idx].lazySq = 0;    }    if (abs(tree[idx].lazy) > EPS) {        leftSubtree(idx).sum += leftSubtree(idx).size * tree[idx].lazy;        leftSubtree(idx).lazy += tree[idx].lazy;        rightSubtree(idx).sum += rightSubtree(idx).size * tree[idx].lazy;        rightSubtree(idx).lazy += tree[idx].lazy;        tree[idx].lazy = 0;    }}void build(int idx, int l, int r) {    tree[idx].l = l, tree[idx].r = r;    tree[idx].size = r - l + 1;    if (l == r) {        tree[idx].sum = a[l];        tree[idx].sumSq = a[l] * a[l];        return;    }    int mid = (l + r) >> 1;    build(le(idx), l, mid);    build(ri(idx), mid + 1, r);    pushup(idx);}void modify(int idx, int l, int r, double x) {    if(l <= tree[idx].l &#x26;&#x26; tree[idx].r <= r) {        tree[idx].sumSq += 2 * tree[idx].sum * x + tree[idx].size * x * x;        tree[idx].lazySq += x;        tree[idx].sum += x * tree[idx].size;        tree[idx].lazy += x;        return;    }    pushdown(idx);    int mid = (tree[idx].l + tree[idx].r) >> 1;    if (l <= mid) modify(le(idx), l, r, x);    if (r > mid) modify(ri(idx), l, r, x);    pushup(idx);}double querySum(int idx, int l, int r) {    if (l <= tree[idx].l &#x26;&#x26; tree[idx].r <= r) return tree[idx].sum;    pushdown(idx);    int mid = (tree[idx].l + tree[idx].r) >> 1;    double ret = 0.0;    if (l <= mid) ret += querySum(le(idx), l, r);    if (r > mid) ret += querySum(ri(idx), l, r);    return ret;}double querySumSq(int idx, int l, int r) {    if (l <= tree[idx].l &#x26;&#x26; tree[idx].r <= r) return tree[idx].sumSq;    pushdown(idx);    int mid = (tree[idx].l + tree[idx].r) >> 1;    double ret = 0.0;    if (l <= mid) ret += querySumSq(le(idx), l, r);    if (r > mid) ret += querySumSq(ri(idx), l, r);    return ret;}int main() {    ios::sync_with_stdio(false);    cin.tie(nullptr);    cout.tie(nullptr);    int n, m;    cin >> n >> m;    for (int i = 1; i <= n; i++) cin >> a[i];    build(1, 1, n);    while (m--) {        int op, l, r;        double x;        cin >> op >> l >> r;        int size = r - l + 1;        if (op == 1) {            cin >> x;            modify(1, l, r, x);        } else if (op == 2) cout << fixed << setprecision(4) << querySum(1, l, r) / size << endl;        else cout << fixed << setprecision(4) << querySumSq(1, l, r) / size - pow(querySum(1, l, r) / size, 2) << endl;    }    return 0;}"><div></div></button></div></figure><div class="ec-collapse__gradient" aria-hidden="true"></div></div><button class="ec-collapse__toggle" type="button" aria-expanded="false" aria-controls="collapse-ijppgqbbj"><span class="ec-collapse__text-expand">显示更多</span><span class="ec-collapse__text-collapse">显示更少</span><svg class="ec-collapse__icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" aria-hidden="true"><path fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="M6 9l6 6 6-6"></path></svg></button></div></div></section></section>
<section><h2 id="维护历史最值历史操作">维护历史最值/历史操作<a class="anchor" href="#维护历史最值历史操作"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h2><p>提到历史操作，我们可能会想到线段树家族的一个分支——可持久化线段树/主席树（或者是吉司机线段树），它通过复制修改时经过的相关节点来实现对某一历史操作的高效维护，更为详细的内容<a href="https://justpureh2o.cn/articles/53799/">见此</a>。一般来说，涉及到历史最值的线段树都需要在平常维护的普通标记上分别新增一个历史最值标记，进而可能涉及到众多懒标记的维护，因此懒标记之间的维护优先级（分类讨论）也是必须弄清的一大重点。</p><p>多标记维护有一个很明显的缺点是分类讨论繁杂、码量膨胀迅速。事实上，除了多标记硬维护，我们还可以稍稍更改矩阵乘法的定义，使用广义矩阵乘法来解决历史最值问题。如果对矩阵乘法不太了解的请左转 <a href="https://justpureh2o.cn/articles/9306/#%E7%AC%AC%E4%BA%8C%E7%AB%A0-%E7%9F%A9%E9%98%B5%E4%B9%98%E6%B3%95">矩阵乘法相关</a>，对矩阵构造不太了解的请右转 <a href="https://justpureh2o.cn/articles/9306/#%E7%AC%AC%E4%BA%8C%E8%8A%82-%E5%88%9D%E7%AD%89%E7%9F%A9%E9%98%B5%E4%B8%8E%E7%9F%A9%E9%98%B5%E9%80%92%E6%8E%A8">初等矩阵与矩阵递推</a>。</p><section><h3 id="多标记历史最值">多标记历史最值<a class="anchor" href="#多标记历史最值"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h3><p>例题：<a href="https://www.luogu.com.cn/problem/P4314">P4314 CPU 监控</a></p><p>难度：<span data-luogu="" data-purple="">省选/NOI-</span></p><p>维护变量：区间加懒标记、区间推平懒标记、区间推平存在性标记、区间历史最大加法懒标记、区间历史最大推平懒标记</p><p>简化题意。<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Q</mi></mrow><annotation encoding="application/x-tex">Q</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">Q</span></span></span></span>：查询区间最大值；<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">A</span></span></span></span>：查询区间曾经出现过的所有值的最大值；<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi></mrow><annotation encoding="application/x-tex">P</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span></span>：区间加；<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi></mrow><annotation encoding="application/x-tex">C</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span></span></span></span>：区间推平。</p><p>首先，维护区间加和区间推平标记是必须的。注意到，在某一次进行了一次推平操作，后到的区间加本质上就是区间推平（即区间推平优先级高于区间加）。我们其实只需考虑首次区间推平前的所有区间加操作与它之间的关系。总而言之，对于一段区间的所有操作，我们都可以把它简化成一次区间加法后接一次区间推平。</p><p>根据优先级关系可得：如果之前已经对区间进行过推平，且当前要对这个区间进行区间加，那么我们就把区间加变成区间推平，只不过推平的数是原来的数加上区间加的操作数。否则就正常执行区间加。这里我们使用一个推平存在性标记来区分曾经执行过推平的区间和没执行过推平的区间。</p><p>接下来是重点，我们要更新历史最值的标记。对于推平操作，如果曾经推平过，就是原先的历史最大值与推平数取最大值、否则标记当前区间为存在过推平，且把历史最大值赋值成操作数；对于区间加，如果存在推平则转化为推平、否则历史标记更新为当前区间的历史标记与操作数总和的最大值。然后是正常加法标记、推平标记和区间最大值的更新，不要忘了用历史值更新当前历史最大值。</p><p>这里使用了复杂查询，其实可以只用简单查询，但是这样会让一个函数变成两个函数，比较占用篇幅。</p><div class="expressive-code"><div class="ec-collapse ec-collapse--collapsed" id="collapse-ke6q6zwzd" data-collapse-preview-lines="8" data-expanded-announcement="代码块已展开" data-collapsed-announcement="代码块已折叠"><div class="ec-collapse__content"><figure class="frame" style="--lnWidth:3ch"><figcaption class="header"></figcaption><pre data-language="C++"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#include</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#98C379;--1:#387138">&#x3C;bits/stdc++.h></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#define</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">N</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">100010</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#define</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">ADD</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">0</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#define</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">COV</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">using</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">namespace</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E5C07B">std</span><span style="--0:#ABB2BF">;</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">struct</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#885D01">SegmentTree</span><span style="--0:#ABB2BF;--1:#383A42"> {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#define</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--1:#383A42"><span style="--0:#ABB2BF">(</span><span style="--0:#E6888F;--0fs:italic">x</span><span style="--0:#ABB2BF">) (x </span></span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#define</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--1:#383A42"><span style="--0:#ABB2BF">(</span><span style="--0:#E6888F;--0fs:italic">x</span><span style="--0:#ABB2BF">) (x </span></span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#56B6C2;--1:#A626A4">|</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#define</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--1:#383A42"><span style="--0:#ABB2BF">(</span><span style="--0:#E6888F;--0fs:italic">x</span><span style="--0:#ABB2BF">) (</span></span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--0:#ABB2BF;--1:#383A42">(x)])</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#define</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--1:#383A42"><span style="--0:#ABB2BF">(</span><span style="--0:#E6888F;--0fs:italic">x</span><span style="--0:#ABB2BF">) (</span></span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--0:#ABB2BF;--1:#383A42">(x)])</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">13</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> l, r, size;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">14</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">bool</span><span style="--0:#ABB2BF;--1:#383A42"> flag_cov;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">15</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> lazy_add, lazy_cov, h_lazy_add, h_lazy_cov;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">16</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> max, hmax;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">17</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">18</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">void</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">cover</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">x</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">hx</span><span style="--0:#ABB2BF">) {</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">19</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (flag_cov) h_lazy_cov </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> std::</span><span style="--0:#61AFEF;--1:#3360C1">max</span><span style="--0:#ABB2BF;--1:#383A42">(h_lazy_cov, hx);</span><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic"> // 存在推平</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">20</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">else</span><span style="--0:#ABB2BF;--1:#383A42"> flag_cov </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">true</span><span style="--0:#ABB2BF;--1:#383A42">, h_lazy_cov </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> hx;</span><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic"> // 不存在推平，标记并更新</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">21</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">        </span></span><span style="--0:#ABB2BF;--1:#383A42">hmax </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> std::</span><span style="--0:#61AFEF;--1:#3360C1">max</span><span style="--0:#ABB2BF;--1:#383A42">(hmax, hx);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">22</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">        </span></span><span style="--0:#ABB2BF;--1:#383A42">max </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> x;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">23</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">        </span></span><span style="--0:#ABB2BF;--1:#383A42">lazy_cov </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> x;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">24</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">        </span></span><span style="--0:#ABB2BF;--1:#383A42">lazy_add </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">25</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">26</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">27</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">void</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">add</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">x</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">hx</span><span style="--0:#ABB2BF">) {</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">28</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (flag_cov) </span><span style="--0:#61AFEF;--1:#3360C1">cover</span><span style="--0:#ABB2BF;--1:#383A42">(lazy_cov </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> x, lazy_cov </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> hx);</span><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic"> // 存在推平，转化为推平</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">29</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">else</span><span style="--0:#ABB2BF;--1:#383A42"> {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">30</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">            </span></span><span style="--0:#ABB2BF;--1:#383A42">h_lazy_add </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> std::</span><span style="--0:#61AFEF;--1:#3360C1">max</span><span style="--0:#ABB2BF;--1:#383A42">(h_lazy_add, lazy_add </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> hx);</span><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic"> // 正常维护区间加法</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">31</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">            </span></span><span style="--0:#ABB2BF;--1:#383A42">hmax </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> std::</span><span style="--0:#61AFEF;--1:#3360C1">max</span><span style="--0:#ABB2BF;--1:#383A42">(hmax, max </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> hx);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">32</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">            </span></span><span style="--0:#ABB2BF;--1:#383A42">lazy_add </span><span style="--0:#CD89E1;--1:#A626A4">+=</span><span style="--0:#ABB2BF;--1:#383A42"> x;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">33</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">            </span></span><span style="--0:#ABB2BF;--1:#383A42">max </span><span style="--0:#CD89E1;--1:#A626A4">+=</span><span style="--0:#ABB2BF;--1:#383A42"> x;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">34</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">        </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">35</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">36</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">} </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[N </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">2</span><span style="--0:#ABB2BF;--1:#383A42">];</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">37</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">38</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">a</span><span style="--0:#ABB2BF;--1:#383A42">[N];</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">39</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">40</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">void</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">pushup</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">) {</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">41</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">max</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">max</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">max</span><span style="--0:#ABB2BF;--1:#383A42">, </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">max</span><span style="--0:#ABB2BF;--1:#383A42">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">42</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">hmax</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">max</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">hmax</span><span style="--0:#ABB2BF;--1:#383A42">, </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">hmax</span><span style="--0:#ABB2BF;--1:#383A42">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">43</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">44</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">45</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">void</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">pushdown</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">) {</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">46</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">lazy_add</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#56B6C2;--1:#A626A4">||</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">h_lazy_add</span><span style="--0:#ABB2BF;--1:#383A42">) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">47</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#61AFEF;--1:#3360C1">add</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">lazy_add</span><span style="--0:#ABB2BF;--1:#383A42">, </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">h_lazy_add</span><span style="--0:#ABB2BF;--1:#383A42">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">48</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#61AFEF;--1:#3360C1">add</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">lazy_add</span><span style="--0:#ABB2BF;--1:#383A42">, </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">h_lazy_add</span><span style="--0:#ABB2BF;--1:#383A42">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">49</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">lazy_add</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">h_lazy_add</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">50</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">51</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">flag_cov</span><span style="--0:#ABB2BF;--1:#383A42">) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">52</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#61AFEF;--1:#3360C1">cover</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">lazy_cov</span><span style="--0:#ABB2BF;--1:#383A42">, </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">h_lazy_cov</span><span style="--0:#ABB2BF;--1:#383A42">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">53</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#61AFEF;--1:#3360C1">cover</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">lazy_cov</span><span style="--0:#ABB2BF;--1:#383A42">, </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">h_lazy_cov</span><span style="--0:#ABB2BF;--1:#383A42">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">54</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">lazy_cov</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">h_lazy_cov</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">55</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">flag_cov</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">false</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">56</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">57</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">58</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">59</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">void</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">build</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">l</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">r</span><span style="--0:#ABB2BF">) {</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">60</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> l, </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> r;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">61</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">size</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> r </span><span style="--0:#CD89E1;--1:#A626A4">-</span><span style="--0:#ABB2BF;--1:#383A42"> l </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">62</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">max</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">hmax</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">-</span><span style="--0:#ABB2BF;--1:#383A42">INT_MAX;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">63</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">==</span><span style="--0:#ABB2BF;--1:#383A42"> r) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">64</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">max</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">hmax</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">a</span><span style="--0:#ABB2BF;--1:#383A42">[l];</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">65</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">66</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">67</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> mid </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> r) </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">68</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">build</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, mid);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">69</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">build</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--0:#ABB2BF;--1:#383A42">(idx), mid </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, r);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">70</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">pushup</span><span style="--0:#ABB2BF;--1:#383A42">(idx);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">71</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">72</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">73</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">void</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">modify</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">l</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">r</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">x</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">type</span><span style="--0:#ABB2BF">) {</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">74</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#56B6C2;--1:#A626A4">&#x26;&#x26;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> r) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">75</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (type </span><span style="--0:#CD89E1;--1:#A626A4">==</span><span style="--0:#ABB2BF;--1:#383A42"> COV) </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#61AFEF;--1:#3360C1">cover</span><span style="--0:#ABB2BF;--1:#383A42">(x, x);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">76</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">else</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (type </span><span style="--0:#CD89E1;--1:#A626A4">==</span><span style="--0:#ABB2BF;--1:#383A42"> ADD) </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#61AFEF;--1:#3360C1">add</span><span style="--0:#ABB2BF;--1:#383A42">(x, x);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">77</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">78</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">79</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">pushdown</span><span style="--0:#ABB2BF;--1:#383A42">(idx);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">80</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> mid </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42">) </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">81</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> mid) </span><span style="--0:#61AFEF;--1:#3360C1">modify</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, r, x, type);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">82</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (r </span><span style="--0:#CD89E1;--1:#A626A4">></span><span style="--0:#ABB2BF;--1:#383A42"> mid) </span><span style="--0:#61AFEF;--1:#3360C1">modify</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, r, x, type);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">83</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">pushup</span><span style="--0:#ABB2BF;--1:#383A42">(idx);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">84</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">85</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">86</div></div><div class="code"><span style="--0:#E5C07B;--1:#885D01">SegmentTree</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">query</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">l</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">r</span><span style="--0:#ABB2BF">) {</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">87</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#56B6C2;--1:#A626A4">&#x26;&#x26;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> r) </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx];</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">88</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">pushdown</span><span style="--0:#ABB2BF;--1:#383A42">(idx);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">89</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> mid </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42">) </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">90</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">></span><span style="--0:#ABB2BF;--1:#383A42"> mid) </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">query</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, r);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">91</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (r </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> mid) </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">query</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, r);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">92</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">SegmentTree L </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">query</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, r);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">93</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">SegmentTree R </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">query</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, r);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">94</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">SegmentTree res{};</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">95</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">res</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">L</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42">, </span><span style="--0:#E5C07B;--1:#AF4238">res</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">R</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42">, </span><span style="--0:#E5C07B;--1:#AF4238">res</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">size</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">L</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">size</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">R</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">size</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">96</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">res</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">max</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">max</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#E5C07B;--1:#AF4238">L</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">max</span><span style="--0:#ABB2BF;--1:#383A42">, </span><span style="--0:#E5C07B;--1:#AF4238">R</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">max</span><span style="--0:#ABB2BF;--1:#383A42">), </span><span style="--0:#E5C07B;--1:#AF4238">res</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">hmax</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">max</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#E5C07B;--1:#AF4238">L</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">hmax</span><span style="--0:#ABB2BF;--1:#383A42">, </span><span style="--0:#E5C07B;--1:#AF4238">R</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">hmax</span><span style="--0:#ABB2BF;--1:#383A42">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">97</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42"> res;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">98</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">99</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">100</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">main</span><span style="--0:#ABB2BF;--1:#383A42">() {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">101</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">ios::</span><span style="--0:#61AFEF;--1:#3360C1">sync_with_stdio</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">false</span><span style="--0:#ABB2BF;--1:#383A42">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">102</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">cin</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#61AFEF;--1:#3360C1">tie</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">nullptr</span><span style="--0:#ABB2BF;--1:#383A42">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">103</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">cout</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#61AFEF;--1:#3360C1">tie</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">nullptr</span><span style="--0:#ABB2BF;--1:#383A42">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">104</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">105</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> n, m;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">106</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">cin </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> n;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">107</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">for</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> i </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">; i </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> n; i</span><span style="--0:#CD89E1;--1:#A626A4">++</span><span style="--0:#ABB2BF;--1:#383A42">) cin </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">a</span><span style="--0:#ABB2BF;--1:#383A42">[i];</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">108</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">build</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, n);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">109</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">cin </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> m;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">110</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">while</span><span style="--0:#ABB2BF;--1:#383A42"> (m</span><span style="--0:#CD89E1;--1:#A626A4">--</span><span style="--0:#ABB2BF;--1:#383A42">) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">111</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">char</span><span style="--0:#ABB2BF;--1:#383A42"> op;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">112</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> l, r, x;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">113</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">        </span></span><span style="--0:#ABB2BF;--1:#383A42">cin </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> op </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> l </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> r;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">114</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (op </span><span style="--0:#CD89E1;--1:#A626A4">==</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#98C379;--1:#387138">'Q'</span><span style="--0:#ABB2BF;--1:#383A42">) cout </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">query</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, l, r).</span><span style="--0:#E6888F;--1:#AF4238">max</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> endl;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">115</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">else</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (op </span><span style="--0:#CD89E1;--1:#A626A4">==</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#98C379;--1:#387138">'A'</span><span style="--0:#ABB2BF;--1:#383A42">) cout </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">query</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, l, r).</span><span style="--0:#E6888F;--1:#AF4238">hmax</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> endl;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">116</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">else</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (op </span><span style="--0:#CD89E1;--1:#A626A4">==</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#98C379;--1:#387138">'P'</span><span style="--0:#ABB2BF;--1:#383A42">) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">117</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">            </span></span><span style="--0:#ABB2BF;--1:#383A42">cin </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> x;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">118</div></div><div class="code"><span class="indent">            </span><span style="--0:#61AFEF;--1:#3360C1">modify</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, l, r, x, ADD);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">119</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">        </span></span><span style="--0:#ABB2BF;--1:#383A42">} </span><span style="--0:#CD89E1;--1:#A626A4">else</span><span style="--0:#ABB2BF;--1:#383A42"> {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">120</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">            </span></span><span style="--0:#ABB2BF;--1:#383A42">cin </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> x;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">121</div></div><div class="code"><span class="indent">            </span><span style="--0:#61AFEF;--1:#3360C1">modify</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, l, r, x, COV);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">122</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">        </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">123</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">124</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">125</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="#include <bits/stdc++.h>#define N 100010#define ADD 0#define COV 1using namespace std;struct SegmentTree {#define le(x) (x << 1)#define ri(x) (x << 1 | 1)#define leftSubtree(x) (tree[le(x)])#define rightSubtree(x) (tree[ri(x)])    int l, r, size;    bool flag_cov;    int lazy_add, lazy_cov, h_lazy_add, h_lazy_cov;    int max, hmax;    void cover(int x, int hx) {        if (flag_cov) h_lazy_cov = std::max(h_lazy_cov, hx); // 存在推平        else flag_cov = true, h_lazy_cov = hx; // 不存在推平，标记并更新        hmax = std::max(hmax, hx);        max = x;        lazy_cov = x;        lazy_add = 0;    }    void add(int x, int hx) {        if (flag_cov) cover(lazy_cov + x, lazy_cov + hx); // 存在推平，转化为推平        else {            h_lazy_add = std::max(h_lazy_add, lazy_add + hx); // 正常维护区间加法            hmax = std::max(hmax, max + hx);            lazy_add += x;            max += x;        }    }} tree[N << 2];int a[N];void pushup(int idx) {    tree[idx].max = max(leftSubtree(idx).max, rightSubtree(idx).max);    tree[idx].hmax = max(leftSubtree(idx).hmax, rightSubtree(idx).hmax);}void pushdown(int idx) {    if (tree[idx].lazy_add || tree[idx].h_lazy_add) {        leftSubtree(idx).add(tree[idx].lazy_add, tree[idx].h_lazy_add);        rightSubtree(idx).add(tree[idx].lazy_add, tree[idx].h_lazy_add);        tree[idx].lazy_add = tree[idx].h_lazy_add = 0;    }    if (tree[idx].flag_cov) {        leftSubtree(idx).cover(tree[idx].lazy_cov, tree[idx].h_lazy_cov);        rightSubtree(idx).cover(tree[idx].lazy_cov, tree[idx].h_lazy_cov);        tree[idx].lazy_cov = tree[idx].h_lazy_cov = 0;        tree[idx].flag_cov = false;    }}void build(int idx, int l, int r) {    tree[idx].l = l, tree[idx].r = r;    tree[idx].size = r - l + 1;    tree[idx].max = tree[idx].hmax = -INT_MAX;    if (l == r) {        tree[idx].max = tree[idx].hmax = a[l];        return;    }    int mid = (l + r) >> 1;    build(le(idx), l, mid);    build(ri(idx), mid + 1, r);    pushup(idx);}void modify(int idx, int l, int r, int x, int type) {    if (l <= tree[idx].l &#x26;&#x26; tree[idx].r <= r) {        if (type == COV) tree[idx].cover(x, x);        else if (type == ADD) tree[idx].add(x, x);        return;    }    pushdown(idx);    int mid = (tree[idx].l + tree[idx].r) >> 1;    if (l <= mid) modify(le(idx), l, r, x, type);    if (r > mid) modify(ri(idx), l, r, x, type);    pushup(idx);}SegmentTree query(int idx, int l, int r) {    if (l <= tree[idx].l &#x26;&#x26; tree[idx].r <= r) return tree[idx];    pushdown(idx);    int mid = (tree[idx].l + tree[idx].r) >> 1;    if (l > mid) return query(ri(idx), l, r);    if (r <= mid) return query(le(idx), l, r);    SegmentTree L = query(le(idx), l, r);    SegmentTree R = query(ri(idx), l, r);    SegmentTree res{};    res.l = L.l, res.r = R.r, res.size = L.size + R.size;    res.max = max(L.max, R.max), res.hmax = max(L.hmax, R.hmax);    return res;}int main() {    ios::sync_with_stdio(false);    cin.tie(nullptr);    cout.tie(nullptr);    int n, m;    cin >> n;    for (int i = 1; i <= n; i++) cin >> a[i];    build(1, 1, n);    cin >> m;    while (m--) {        char op;        int l, r, x;        cin >> op >> l >> r;        if (op == &#x27;Q&#x27;) cout << query(1, l, r).max << endl;        else if (op == &#x27;A&#x27;) cout << query(1, l, r).hmax << endl;        else if (op == &#x27;P&#x27;) {            cin >> x;            modify(1, l, r, x, ADD);        } else {            cin >> x;            modify(1, l, r, x, COV);        }    }    return 0;}"><div></div></button></div></figure><div class="ec-collapse__gradient" aria-hidden="true"></div></div><button class="ec-collapse__toggle" type="button" aria-expanded="false" aria-controls="collapse-ke6q6zwzd"><span class="ec-collapse__text-expand">显示更多</span><span class="ec-collapse__text-collapse">显示更少</span><svg class="ec-collapse__icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" aria-hidden="true"><path fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="M6 9l6 6 6-6"></path></svg></button></div></div></section><section><h3 id="广义矩阵乘法历史最值">广义矩阵乘法历史最值<a class="anchor" href="#广义矩阵乘法历史最值"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h3><p>例题：<a href="https://www.luogu.com.cn/problem/P4314">P4314 CPU 监控</a></p><p>难度：<span data-luogu="" data-purple="">省选/NOI-</span></p><p>维护变量：广义矩阵和、广义矩阵乘法标记</p><p><del>一题多解，多题归一</del></p><p>对于当前最值和历史最值组成的向量 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>a</mi></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>b</mi></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><annotation encoding="application/x-tex">\begin{bmatrix}a&#x26;b\end{bmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2em;vertical-align:-0.35em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.85em;"><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">a</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.85em;"><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">b</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">]</span></span></span></span></span></span>，我们自然希望它在操作后变成我们希望的样子，也就是变成 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>a</mi><mo>+</mo><mi>k</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>max</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>a</mi><mo>+</mo><mi>k</mi><mo separator="true">,</mo><mi>b</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><annotation encoding="application/x-tex">\begin{bmatrix}a+k&#x26;\max(a+k,b)\end{bmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2em;vertical-align:-0.35em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.85em;"><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.85em;"><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mop">max</span><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">b</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">]</span></span></span></span></span></span>。一般采取的措施是重定义矩阵元素间的运算。</p><p>重定义矩阵元素间的加法为取最大值、元素间的乘法为代数加法。因此对于一段区间，和式 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>a</mi><mi>L</mi></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>b</mi><mi>L</mi></msub></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mo>+</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>a</mi><mrow><mi>L</mi><mo>+</mo><mn>1</mn></mrow></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>b</mi><mrow><mi>L</mi><mo>+</mo><mn>1</mn></mrow></msub></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mo>+</mo><mo>⋯</mo><mo>+</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>a</mi><mi>R</mi></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>b</mi><mi>R</mi></msub></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>a</mi></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>b</mi></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">\begin{bmatrix}a_L&#x26;b_L\end{bmatrix}+\begin{bmatrix}a_{L+1}&#x26;b_{L+1}\end{bmatrix}+\dots+\begin{bmatrix}a_R&#x26;b_R\end{bmatrix}=\begin{bmatrix}a&#x26;b\end{bmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2em;vertical-align:-0.35em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.85em;"><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">L</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.85em;"><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">L</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">]</span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.2em;vertical-align:-0.35em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.85em;"><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">L</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.85em;"><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">L</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">]</span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.2em;vertical-align:-0.35em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.85em;"><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.00773em;">R</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.85em;"><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.00773em;">R</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">]</span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.2em;vertical-align:-0.35em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.85em;"><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">a</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.85em;"><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">b</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">]</span></span></span></span></span></span> 就同时维护了当前区间的最大值和历史最大值；乘积 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>a</mi></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>b</mi></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mo>×</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>k</mi></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>k</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mi mathvariant="normal">∞</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>a</mi><mo>+</mo><mi>k</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>max</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>a</mi><mo>+</mo><mi>k</mi><mo separator="true">,</mo><mi>b</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">\begin{bmatrix}a&#x26;b\end{bmatrix}\times\begin{bmatrix}k&#x26;k\\-\infty&#x26;0\end{bmatrix}=\begin{bmatrix}a+k&#x26;\max(a+k,b)\end{bmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2em;vertical-align:-0.35em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.85em;"><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">a</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.85em;"><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">b</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">]</span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:2.4em;vertical-align:-0.95em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">−</span><span class="mord">∞</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">]</span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.2em;vertical-align:-0.35em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.85em;"><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.85em;"><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mop">max</span><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">b</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">]</span></span></span></span></span></span> 维护了单点操作后的最大值和历史最大值。</p><p>在新定义下，我们需要重定义零矩阵和单位矩阵。根据定义，零矩阵乘任何矩阵都是一个零矩阵，可以构造出广义零矩阵 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mi mathvariant="normal">∞</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mi mathvariant="normal">∞</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mi mathvariant="normal">∞</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mi mathvariant="normal">∞</mi></mrow></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">O=\begin{bmatrix}-\infty&#x26;-\infty\\-\infty&#x26;-\infty\end{bmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.4em;vertical-align:-0.95em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">−</span><span class="mord">∞</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">−</span><span class="mord">∞</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">−</span><span class="mord">∞</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">−</span><span class="mord">∞</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">]</span></span></span></span></span></span>；单位矩阵乘任何矩阵都是后者，因此构造广义单位矩阵 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>I</mi><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mi mathvariant="normal">∞</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mi mathvariant="normal">∞</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">I=\begin{bmatrix}0&#x26;-\infty\\-\infty&#x26;0\end{bmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.4em;vertical-align:-0.95em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">−</span><span class="mord">∞</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">−</span><span class="mord">∞</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">]</span></span></span></span></span></span>。</p><p>突然发现还有一个区间推平需要我们维护。换句话说，针对原矩阵 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>a</mi></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>b</mi></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><annotation encoding="application/x-tex">\begin{bmatrix}a&#x26;b\end{bmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2em;vertical-align:-0.35em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.85em;"><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">a</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.85em;"><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">b</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">]</span></span></span></span></span></span>，构造一个右乘矩阵使得二者乘积为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>k</mi></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>max</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>b</mi><mo separator="true">,</mo><mi>k</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><annotation encoding="application/x-tex">\begin{bmatrix}k&#x26;\max(b,k)\end{bmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2em;vertical-align:-0.35em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.85em;"><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.85em;"><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mop">max</span><span class="mopen">(</span><span class="mord mathnormal">b</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">]</span></span></span></span></span></span>。发现似乎构造不出普通的 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn><mo>×</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">{2}\times2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord"><span class="mord">2</span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span></span></span></span> 转移矩阵使条件成立，因此考虑升维。如果原始矩阵是 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>a</mi></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>b</mi></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><annotation encoding="application/x-tex">\begin{bmatrix}a&#x26;b&#x26;0\end{bmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2em;vertical-align:-0.35em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.85em;"><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">a</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.85em;"><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">b</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.85em;"><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">]</span></span></span></span></span></span>，转移矩阵是 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mi mathvariant="normal">∞</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mi mathvariant="normal">∞</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mi mathvariant="normal">∞</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mi mathvariant="normal">∞</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mi mathvariant="normal">∞</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>k</mi></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>k</mi></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><annotation encoding="application/x-tex">\begin{bmatrix}-\infty&#x26;-\infty&#x26;-\infty\\-\infty&#x26;0&#x26;-\infty\\k&#x26;k&#x26;0\end{bmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3.6em;vertical-align:-1.55em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"></span><span style="width:0.667em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="3.600em" viewBox="0 0 667 3600"><path d="M403 1759 V84 H666 V0 H319 V1759 v0 v1759 h347 v-84
H403z M403 1759 V0 H319 V1759 v0 v1759 h84z"></path></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">−</span><span class="mord">∞</span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">−</span><span class="mord">∞</span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">−</span><span class="mord">∞</span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">−</span><span class="mord">∞</span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">−</span><span class="mord">∞</span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"></span><span style="width:0.667em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="3.600em" viewBox="0 0 667 3600"><path d="M347 1759 V0 H0 V84 H263 V1759 v0 v1759 H0 v84 H347z
M347 1759 V0 H263 V1759 v0 v1759 h84z"></path></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span></span></span></span></span> 的话就符合要求了。相应的，区间加操作的转移矩阵需变成 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>k</mi></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>k</mi></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mi mathvariant="normal">∞</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mi mathvariant="normal">∞</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mi mathvariant="normal">∞</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mi mathvariant="normal">∞</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mi mathvariant="normal">∞</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><annotation encoding="application/x-tex">\begin{bmatrix}k&#x26;k&#x26;-\infty\\-\infty&#x26;0&#x26;-\infty\\-\infty&#x26;-\infty&#x26;0\end{bmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3.6em;vertical-align:-1.55em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"></span><span style="width:0.667em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="3.600em" viewBox="0 0 667 3600"><path d="M403 1759 V84 H666 V0 H319 V1759 v0 v1759 h347 v-84
H403z M403 1759 V0 H319 V1759 v0 v1759 h84z"></path></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">−</span><span class="mord">∞</span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">−</span><span class="mord">∞</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">−</span><span class="mord">∞</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">−</span><span class="mord">∞</span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">−</span><span class="mord">∞</span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"></span><span style="width:0.667em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="3.600em" viewBox="0 0 667 3600"><path d="M347 1759 V0 H0 V84 H263 V1759 v0 v1759 H0 v84 H347z
M347 1759 V0 H263 V1759 v0 v1759 h84z"></path></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span></span></span></span></span>。</p><p>于是我们把问题转化成了询问区间矩阵和与区间乘矩阵的问题了，只需维护区间矩阵和、乘数矩阵标记即可。需要注意的是，懒标记的初始值应为广义单位矩阵、区间和的初始值应该是广义零矩阵。</p><div class="expressive-code"><div class="ec-collapse ec-collapse--collapsed" id="collapse-56bozy8jl" data-collapse-preview-lines="8" data-expanded-announcement="代码块已展开" data-collapsed-announcement="代码块已折叠"><div class="ec-collapse__content"><figure class="frame" style="--lnWidth:3ch"><figcaption class="header"></figcaption><pre data-language="C++"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#include</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#98C379;--1:#387138">&#x3C;bits/stdc++.h></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#define</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">N</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">100010</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#define</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">ADD</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">0</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#define</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">COV</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">using</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">namespace</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E5C07B">std</span><span style="--0:#ABB2BF">;</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">typedef</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">long</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">long</span><span style="--0:#ABB2BF;--1:#383A42"> ll;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">const</span><span style="--0:#ABB2BF;--1:#383A42"> ll INF </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--1:#875D01"><span style="--0:#D19A66">1</span><span style="--0:#E6888F">e</span><span style="--0:#D19A66">18</span></span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">struct</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#885D01">Matrix</span><span style="--0:#ABB2BF;--1:#383A42"> {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">13</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">ll </span><span style="--0:#E5C07B;--1:#AF4238">mat</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">3</span><span style="--0:#ABB2BF;--1:#383A42">][</span><span style="--0:#D19A66;--1:#875D01">3</span><span style="--0:#ABB2BF;--1:#383A42">]{};</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">14</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">15</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">void</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">O</span><span style="--0:#ABB2BF;--1:#383A42">() {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">16</div></div><div class="code"><span class="indent"><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic">        </span></span><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic">// 广义零矩阵</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">17</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">for</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#CD89E1;--1:#A626A4">auto</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#56B6C2;--1:#A626A4">&#x26;</span><span style="--0:#ABB2BF;--1:#383A42">i: mat) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">18</div></div><div class="code"><span class="indent">            </span><span style="--0:#CD89E1;--1:#A626A4">for</span><span style="--0:#ABB2BF;--1:#383A42"> (ll </span><span style="--0:#56B6C2;--1:#A626A4">&#x26;</span><span style="--0:#ABB2BF;--1:#383A42">j: i) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">19</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">                </span></span><span style="--0:#ABB2BF;--1:#383A42">j </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">-</span><span style="--0:#ABB2BF;--1:#383A42">INF;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">20</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">            </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">21</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">        </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">22</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">23</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">24</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">void</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">I</span><span style="--0:#ABB2BF;--1:#383A42">() {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">25</div></div><div class="code"><span class="indent"><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic">        </span></span><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic">// 广义单位矩阵</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">26</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">for</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#CD89E1;--1:#A626A4">auto</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#56B6C2;--1:#A626A4">&#x26;</span><span style="--0:#ABB2BF;--1:#383A42">i: mat) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">27</div></div><div class="code"><span class="indent">            </span><span style="--0:#CD89E1;--1:#A626A4">for</span><span style="--0:#ABB2BF;--1:#383A42"> (ll </span><span style="--0:#56B6C2;--1:#A626A4">&#x26;</span><span style="--0:#ABB2BF;--1:#383A42">j: i) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">28</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">                </span></span><span style="--0:#ABB2BF;--1:#383A42">j </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">-</span><span style="--0:#ABB2BF;--1:#383A42">INF;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">29</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">            </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">30</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">        </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">31</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">mat</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">][</span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">] </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">mat</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">][</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">] </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">mat</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">2</span><span style="--0:#ABB2BF;--1:#383A42">][</span><span style="--0:#D19A66;--1:#875D01">2</span><span style="--0:#ABB2BF;--1:#383A42">] </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">32</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">33</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">34</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">bool</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">isI</span><span style="--0:#ABB2BF;--1:#383A42">() {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">35</div></div><div class="code"><span class="indent"><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic">        </span></span><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic">// 判断是否是广义单位矩阵</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">36</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">for</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> i </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">; i </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">3</span><span style="--0:#ABB2BF;--1:#383A42">; i</span><span style="--0:#CD89E1;--1:#A626A4">++</span><span style="--0:#ABB2BF;--1:#383A42">) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">37</div></div><div class="code"><span class="indent">            </span><span style="--0:#CD89E1;--1:#A626A4">for</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> j </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">; j </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">3</span><span style="--0:#ABB2BF;--1:#383A42">; j</span><span style="--0:#CD89E1;--1:#A626A4">++</span><span style="--0:#ABB2BF;--1:#383A42">) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">38</div></div><div class="code"><span class="indent">                </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (i </span><span style="--0:#56B6C2;--1:#A626A4">^</span><span style="--0:#ABB2BF;--1:#383A42"> j </span><span style="--0:#56B6C2;--1:#A626A4">&#x26;&#x26;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">mat</span><span style="--0:#ABB2BF;--1:#383A42">[i][j] </span><span style="--0:#CD89E1;--1:#A626A4">!=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">-</span><span style="--0:#ABB2BF;--1:#383A42">INF) </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">false</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">39</div></div><div class="code"><span class="indent">                </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (i </span><span style="--0:#CD89E1;--1:#A626A4">==</span><span style="--0:#ABB2BF;--1:#383A42"> j </span><span style="--0:#56B6C2;--1:#A626A4">&#x26;&#x26;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">mat</span><span style="--0:#ABB2BF;--1:#383A42">[i][j]) </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">false</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">40</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">            </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">41</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">        </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">42</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">true</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">43</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">44</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">};</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">45</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">46</div></div><div class="code"><span style="--0:#E5C07B;--1:#885D01">Matrix</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">fill</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">x</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">type</span><span style="--0:#ABB2BF">) {</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">47</div></div><div class="code"><span class="indent"><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic">    </span></span><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic">// 根据不同操作填充对应转移矩阵</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">48</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (type </span><span style="--0:#CD89E1;--1:#A626A4">==</span><span style="--0:#ABB2BF;--1:#383A42"> ADD) </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42"> {{{x, x, </span><span style="--0:#CD89E1;--1:#A626A4">-</span><span style="--0:#ABB2BF;--1:#383A42">INF}, {</span><span style="--0:#CD89E1;--1:#A626A4">-</span><span style="--0:#ABB2BF;--1:#383A42">INF, </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">, </span><span style="--0:#CD89E1;--1:#A626A4">-</span><span style="--0:#ABB2BF;--1:#383A42">INF}, {</span><span style="--0:#CD89E1;--1:#A626A4">-</span><span style="--0:#ABB2BF;--1:#383A42">INF, </span><span style="--0:#CD89E1;--1:#A626A4">-</span><span style="--0:#ABB2BF;--1:#383A42">INF, </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">}}};</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">49</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42"> {{{</span><span style="--0:#CD89E1;--1:#A626A4">-</span><span style="--0:#ABB2BF;--1:#383A42">INF, </span><span style="--0:#CD89E1;--1:#A626A4">-</span><span style="--0:#ABB2BF;--1:#383A42">INF, </span><span style="--0:#CD89E1;--1:#A626A4">-</span><span style="--0:#ABB2BF;--1:#383A42">INF}, {</span><span style="--0:#CD89E1;--1:#A626A4">-</span><span style="--0:#ABB2BF;--1:#383A42">INF, </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">, </span><span style="--0:#CD89E1;--1:#A626A4">-</span><span style="--0:#ABB2BF;--1:#383A42">INF}, {x, x, </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">}}};</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">50</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">51</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">52</div></div><div class="code"><span style="--0:#E5C07B;--1:#885D01">Matrix</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">operator</span><span style="--0:#ABB2BF;--1:#383A42">*(</span><span style="--0:#CD89E1;--1:#A626A4">const</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#885D01">Matrix</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">&#x26;</span><span style="--1:#383A42"><span style="--0:#E6888F;--0fs:italic">l</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">const</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#885D01">Matrix</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">&#x26;</span><span style="--1:#383A42"><span style="--0:#E6888F;--0fs:italic">r</span><span style="--0:#ABB2BF">) {</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">53</div></div><div class="code"><span class="indent"><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic">    </span></span><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic">// 广义矩阵乘法</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">54</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">Matrix ret;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">55</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">ret</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#61AFEF;--1:#3360C1">O</span><span style="--0:#ABB2BF;--1:#383A42">();</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">56</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">for</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> i </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">; i </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">3</span><span style="--0:#ABB2BF;--1:#383A42">; i</span><span style="--0:#CD89E1;--1:#A626A4">++</span><span style="--0:#ABB2BF;--1:#383A42">) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">57</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">for</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> j </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">; j </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">3</span><span style="--0:#ABB2BF;--1:#383A42">; j</span><span style="--0:#CD89E1;--1:#A626A4">++</span><span style="--0:#ABB2BF;--1:#383A42">) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">58</div></div><div class="code"><span class="indent">            </span><span style="--0:#CD89E1;--1:#A626A4">for</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> k </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">; k </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">3</span><span style="--0:#ABB2BF;--1:#383A42">; k</span><span style="--0:#CD89E1;--1:#A626A4">++</span><span style="--0:#ABB2BF;--1:#383A42">) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">59</div></div><div class="code"><span class="indent">                </span><span style="--0:#E5C07B;--1:#AF4238">ret</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">mat</span><span style="--0:#ABB2BF;--1:#383A42">[i][j] </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">max</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#E5C07B;--1:#AF4238">ret</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">mat</span><span style="--0:#ABB2BF;--1:#383A42">[i][j], </span><span style="--0:#E5C07B;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">mat</span><span style="--0:#ABB2BF;--1:#383A42">[i][k] </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">mat</span><span style="--0:#ABB2BF;--1:#383A42">[k][j]);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">60</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">            </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">61</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">        </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">62</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">63</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42"> ret;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">64</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">65</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">66</div></div><div class="code"><span style="--0:#E5C07B;--1:#885D01">Matrix</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">operator</span><span style="--0:#ABB2BF;--1:#383A42">+(</span><span style="--0:#CD89E1;--1:#A626A4">const</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#885D01">Matrix</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">&#x26;</span><span style="--1:#383A42"><span style="--0:#E6888F;--0fs:italic">l</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">const</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#885D01">Matrix</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">&#x26;</span><span style="--1:#383A42"><span style="--0:#E6888F;--0fs:italic">r</span><span style="--0:#ABB2BF">) {</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">67</div></div><div class="code"><span class="indent"><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic">    </span></span><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic">// 广义矩阵加法</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">68</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">Matrix ret;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">69</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">ret</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#61AFEF;--1:#3360C1">O</span><span style="--0:#ABB2BF;--1:#383A42">();</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">70</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">for</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> i </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">; i </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">3</span><span style="--0:#ABB2BF;--1:#383A42">; i</span><span style="--0:#CD89E1;--1:#A626A4">++</span><span style="--0:#ABB2BF;--1:#383A42">) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">71</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">for</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> j </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">; j </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">3</span><span style="--0:#ABB2BF;--1:#383A42">; j</span><span style="--0:#CD89E1;--1:#A626A4">++</span><span style="--0:#ABB2BF;--1:#383A42">) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">72</div></div><div class="code"><span class="indent">            </span><span style="--0:#E5C07B;--1:#AF4238">ret</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">mat</span><span style="--0:#ABB2BF;--1:#383A42">[i][j] </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">max</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#E5C07B;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">mat</span><span style="--0:#ABB2BF;--1:#383A42">[i][j], </span><span style="--0:#E5C07B;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">mat</span><span style="--0:#ABB2BF;--1:#383A42">[i][j]);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">73</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">        </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">74</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">75</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42"> ret;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">76</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">77</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">78</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">struct</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#885D01">SegmentTree</span><span style="--0:#ABB2BF;--1:#383A42"> {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">79</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#define</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--1:#383A42"><span style="--0:#ABB2BF">(</span><span style="--0:#E6888F;--0fs:italic">x</span><span style="--0:#ABB2BF">) (x </span></span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">80</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#define</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--1:#383A42"><span style="--0:#ABB2BF">(</span><span style="--0:#E6888F;--0fs:italic">x</span><span style="--0:#ABB2BF">) (x </span></span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#56B6C2;--1:#A626A4">|</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">81</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#define</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--1:#383A42"><span style="--0:#ABB2BF">(</span><span style="--0:#E6888F;--0fs:italic">x</span><span style="--0:#ABB2BF">) (</span></span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--0:#ABB2BF;--1:#383A42">(x)])</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">82</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#define</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--1:#383A42"><span style="--0:#ABB2BF">(</span><span style="--0:#E6888F;--0fs:italic">x</span><span style="--0:#ABB2BF">) (</span></span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--0:#ABB2BF;--1:#383A42">(x)])</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">83</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> l, r, size;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">84</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">Matrix lazy, sum;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">85</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">} </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[N </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">2</span><span style="--0:#ABB2BF;--1:#383A42">];</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">86</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">a</span><span style="--0:#ABB2BF;--1:#383A42">[N];</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">87</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">88</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">void</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">pushup</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">) {</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">89</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">90</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">91</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">92</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">void</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">pushdown</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">) {</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">93</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#56B6C2;--1:#A626A4">!</span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E5C07B;--1:#AF4238">lazy</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#61AFEF;--1:#3360C1">isI</span><span style="--0:#ABB2BF;--1:#383A42">()) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">94</div></div><div class="code"><span class="indent"><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic">        </span></span><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic">// 存在标记（不为广义单位矩阵）</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">95</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">*</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">lazy</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">96</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">lazy</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">lazy</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">*</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">lazy</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">97</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">*</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">lazy</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">98</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">lazy</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">lazy</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">*</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">lazy</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">99</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E5C07B;--1:#AF4238">lazy</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#61AFEF;--1:#3360C1">I</span><span style="--0:#ABB2BF;--1:#383A42">();</span><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic"> // 清空成广义单位矩阵</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">100</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">101</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">102</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">103</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">void</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">build</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">l</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">r</span><span style="--0:#ABB2BF">) {</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">104</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> l, </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> r;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">105</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">size</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> r </span><span style="--0:#CD89E1;--1:#A626A4">-</span><span style="--0:#ABB2BF;--1:#383A42"> l </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">106</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E5C07B;--1:#AF4238">lazy</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#61AFEF;--1:#3360C1">I</span><span style="--0:#ABB2BF;--1:#383A42">();</span><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic"> // 特别注意标记和区间和的清空</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">107</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E5C07B;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#61AFEF;--1:#3360C1">O</span><span style="--0:#ABB2BF;--1:#383A42">();</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">108</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">==</span><span style="--0:#ABB2BF;--1:#383A42"> r) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">109</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> {{{</span><span style="--0:#E5C07B;--1:#AF4238">a</span><span style="--0:#ABB2BF;--1:#383A42">[l], </span><span style="--0:#E5C07B;--1:#AF4238">a</span><span style="--0:#ABB2BF;--1:#383A42">[l], </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">}, {</span><span style="--0:#CD89E1;--1:#A626A4">-</span><span style="--0:#ABB2BF;--1:#383A42">INF, </span><span style="--0:#CD89E1;--1:#A626A4">-</span><span style="--0:#ABB2BF;--1:#383A42">INF, </span><span style="--0:#CD89E1;--1:#A626A4">-</span><span style="--0:#ABB2BF;--1:#383A42">INF}, {</span><span style="--0:#CD89E1;--1:#A626A4">-</span><span style="--0:#ABB2BF;--1:#383A42">INF, </span><span style="--0:#CD89E1;--1:#A626A4">-</span><span style="--0:#ABB2BF;--1:#383A42">INF, </span><span style="--0:#CD89E1;--1:#A626A4">-</span><span style="--0:#ABB2BF;--1:#383A42">INF}}};</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">110</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">111</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">112</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> mid </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> r) </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">113</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">build</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, mid);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">114</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">build</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--0:#ABB2BF;--1:#383A42">(idx), mid </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, r);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">115</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">pushup</span><span style="--0:#ABB2BF;--1:#383A42">(idx);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">116</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">117</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">118</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">void</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">modify</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">l</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">r</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">x</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">type</span><span style="--0:#ABB2BF">) {</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">119</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#56B6C2;--1:#A626A4">&#x26;&#x26;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> r) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">120</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">*</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">fill</span><span style="--0:#ABB2BF;--1:#383A42">(x, type);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">121</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">lazy</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">lazy</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">*</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">fill</span><span style="--0:#ABB2BF;--1:#383A42">(x, type);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">122</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">123</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">124</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">pushdown</span><span style="--0:#ABB2BF;--1:#383A42">(idx);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">125</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> mid </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42">) </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">126</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> mid) </span><span style="--0:#61AFEF;--1:#3360C1">modify</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, r, x, type);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">127</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (r </span><span style="--0:#CD89E1;--1:#A626A4">></span><span style="--0:#ABB2BF;--1:#383A42"> mid) </span><span style="--0:#61AFEF;--1:#3360C1">modify</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, r, x, type);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">128</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">pushup</span><span style="--0:#ABB2BF;--1:#383A42">(idx);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">129</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">130</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">131</div></div><div class="code"><span style="--0:#E5C07B;--1:#885D01">SegmentTree</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">query</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">l</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">r</span><span style="--0:#ABB2BF">) {</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">132</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#56B6C2;--1:#A626A4">&#x26;&#x26;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> r) </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx];</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">133</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">pushdown</span><span style="--0:#ABB2BF;--1:#383A42">(idx);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">134</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> mid </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42">) </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">135</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">></span><span style="--0:#ABB2BF;--1:#383A42"> mid) </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">query</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, r);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">136</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (r </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> mid) </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">query</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, r);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">137</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">SegmentTree L </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">query</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, r);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">138</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">SegmentTree R </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">query</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, r);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">139</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">SegmentTree res{};</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">140</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">res</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">L</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42">, </span><span style="--0:#E5C07B;--1:#AF4238">res</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">R</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42">, </span><span style="--0:#E5C07B;--1:#AF4238">res</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">size</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">L</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">size</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">R</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">size</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">141</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">res</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">L</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">R</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">142</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42"> res;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">143</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">144</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">145</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">main</span><span style="--0:#ABB2BF;--1:#383A42">() {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">146</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">ios::</span><span style="--0:#61AFEF;--1:#3360C1">sync_with_stdio</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">false</span><span style="--0:#ABB2BF;--1:#383A42">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">147</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">cin</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#61AFEF;--1:#3360C1">tie</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">nullptr</span><span style="--0:#ABB2BF;--1:#383A42">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">148</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">cout</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#61AFEF;--1:#3360C1">tie</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">nullptr</span><span style="--0:#ABB2BF;--1:#383A42">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">149</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">150</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> n, m;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">151</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">cin </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> n;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">152</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">for</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> i </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">; i </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> n; i</span><span style="--0:#CD89E1;--1:#A626A4">++</span><span style="--0:#ABB2BF;--1:#383A42">) cin </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">a</span><span style="--0:#ABB2BF;--1:#383A42">[i];</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">153</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">build</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, n);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">154</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">cin </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> m;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">155</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">while</span><span style="--0:#ABB2BF;--1:#383A42"> (m</span><span style="--0:#CD89E1;--1:#A626A4">--</span><span style="--0:#ABB2BF;--1:#383A42">) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">156</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">char</span><span style="--0:#ABB2BF;--1:#383A42"> op;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">157</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> l, r, x;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">158</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">        </span></span><span style="--0:#ABB2BF;--1:#383A42">cin </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> op </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> l </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> r;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">159</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (op </span><span style="--0:#CD89E1;--1:#A626A4">==</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#98C379;--1:#387138">'Q'</span><span style="--0:#ABB2BF;--1:#383A42">) cout </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">query</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, l, r).</span><span style="--0:#E5C07B;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">mat</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">][</span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">] </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> endl;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">160</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">else</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (op </span><span style="--0:#CD89E1;--1:#A626A4">==</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#98C379;--1:#387138">'A'</span><span style="--0:#ABB2BF;--1:#383A42">) cout </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">query</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, l, r).</span><span style="--0:#E5C07B;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">mat</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">][</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">] </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> endl;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">161</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">else</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (op </span><span style="--0:#CD89E1;--1:#A626A4">==</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#98C379;--1:#387138">'P'</span><span style="--0:#ABB2BF;--1:#383A42">) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">162</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">            </span></span><span style="--0:#ABB2BF;--1:#383A42">cin </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> x;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">163</div></div><div class="code"><span class="indent">            </span><span style="--0:#61AFEF;--1:#3360C1">modify</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, l, r, x, ADD);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">164</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">        </span></span><span style="--0:#ABB2BF;--1:#383A42">} </span><span style="--0:#CD89E1;--1:#A626A4">else</span><span style="--0:#ABB2BF;--1:#383A42"> {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">165</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">            </span></span><span style="--0:#ABB2BF;--1:#383A42">cin </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> x;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">166</div></div><div class="code"><span class="indent">            </span><span style="--0:#61AFEF;--1:#3360C1">modify</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, l, r, x, COV);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">167</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">        </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">168</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">169</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">170</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="#include <bits/stdc++.h>#define N 100010#define ADD 0#define COV 1using namespace std;typedef long long ll;const ll INF = 1e18;struct Matrix {    ll mat[3][3]{};    void O() {        // 广义零矩阵        for (auto &#x26;i: mat) {            for (ll &#x26;j: i) {                j = -INF;            }        }    }    void I() {        // 广义单位矩阵        for (auto &#x26;i: mat) {            for (ll &#x26;j: i) {                j = -INF;            }        }        mat[0][0] = mat[1][1] = mat[2][2] = 0;    }    bool isI() {        // 判断是否是广义单位矩阵        for (int i = 0; i < 3; i++) {            for (int j = 0; j < 3; j++) {                if (i ^ j &#x26;&#x26; mat[i][j] != -INF) return false;                if (i == j &#x26;&#x26; mat[i][j]) return false;            }        }        return true;    }};Matrix fill(int x, int type) {    // 根据不同操作填充对应转移矩阵    if (type == ADD) return {{{x, x, -INF}, {-INF, 0, -INF}, {-INF, -INF, 0}}};    return {{{-INF, -INF, -INF}, {-INF, 0, -INF}, {x, x, 0}}};}Matrix operator*(const Matrix &#x26;l, const Matrix &#x26;r) {    // 广义矩阵乘法    Matrix ret;    ret.O();    for (int i = 0; i < 3; i++) {        for (int j = 0; j < 3; j++) {            for (int k = 0; k < 3; k++) {                ret.mat[i][j] = max(ret.mat[i][j], l.mat[i][k] + r.mat[k][j]);            }        }    }    return ret;}Matrix operator+(const Matrix &#x26;l, const Matrix &#x26;r) {    // 广义矩阵加法    Matrix ret;    ret.O();    for (int i = 0; i < 3; i++) {        for (int j = 0; j < 3; j++) {            ret.mat[i][j] = max(l.mat[i][j], r.mat[i][j]);        }    }    return ret;}struct SegmentTree {#define le(x) (x << 1)#define ri(x) (x << 1 | 1)#define leftSubtree(x) (tree[le(x)])#define rightSubtree(x) (tree[ri(x)])    int l, r, size;    Matrix lazy, sum;} tree[N << 2];int a[N];void pushup(int idx) {    tree[idx].sum = leftSubtree(idx).sum + rightSubtree(idx).sum;}void pushdown(int idx) {    if (!tree[idx].lazy.isI()) {        // 存在标记（不为广义单位矩阵）        leftSubtree(idx).sum = leftSubtree(idx).sum * tree[idx].lazy;        leftSubtree(idx).lazy = leftSubtree(idx).lazy * tree[idx].lazy;        rightSubtree(idx).sum = rightSubtree(idx).sum * tree[idx].lazy;        rightSubtree(idx).lazy = rightSubtree(idx).lazy * tree[idx].lazy;        tree[idx].lazy.I(); // 清空成广义单位矩阵    }}void build(int idx, int l, int r) {    tree[idx].l = l, tree[idx].r = r;    tree[idx].size = r - l + 1;    tree[idx].lazy.I(); // 特别注意标记和区间和的清空    tree[idx].sum.O();    if (l == r) {        tree[idx].sum = {{{a[l], a[l], 0}, {-INF, -INF, -INF}, {-INF, -INF, -INF}}};        return;    }    int mid = (l + r) >> 1;    build(le(idx), l, mid);    build(ri(idx), mid + 1, r);    pushup(idx);}void modify(int idx, int l, int r, int x, int type) {    if (l <= tree[idx].l &#x26;&#x26; tree[idx].r <= r) {        tree[idx].sum = tree[idx].sum * fill(x, type);        tree[idx].lazy = tree[idx].lazy * fill(x, type);        return;    }    pushdown(idx);    int mid = (tree[idx].l + tree[idx].r) >> 1;    if (l <= mid) modify(le(idx), l, r, x, type);    if (r > mid) modify(ri(idx), l, r, x, type);    pushup(idx);}SegmentTree query(int idx, int l, int r) {    if (l <= tree[idx].l &#x26;&#x26; tree[idx].r <= r) return tree[idx];    pushdown(idx);    int mid = (tree[idx].l + tree[idx].r) >> 1;    if (l > mid) return query(ri(idx), l, r);    if (r <= mid) return query(le(idx), l, r);    SegmentTree L = query(le(idx), l, r);    SegmentTree R = query(ri(idx), l, r);    SegmentTree res{};    res.l = L.l, res.r = R.r, res.size = L.size + R.size;    res.sum = L.sum + R.sum;    return res;}int main() {    ios::sync_with_stdio(false);    cin.tie(nullptr);    cout.tie(nullptr);    int n, m;    cin >> n;    for (int i = 1; i <= n; i++) cin >> a[i];    build(1, 1, n);    cin >> m;    while (m--) {        char op;        int l, r, x;        cin >> op >> l >> r;        if (op == &#x27;Q&#x27;) cout << query(1, l, r).sum.mat[0][0] << endl;        else if (op == &#x27;A&#x27;) cout << query(1, l, r).sum.mat[0][1] << endl;        else if (op == &#x27;P&#x27;) {            cin >> x;            modify(1, l, r, x, ADD);        } else {            cin >> x;            modify(1, l, r, x, COV);        }    }    return 0;}"><div></div></button></div></figure><div class="ec-collapse__gradient" aria-hidden="true"></div></div><button class="ec-collapse__toggle" type="button" aria-expanded="false" aria-controls="collapse-56bozy8jl"><span class="ec-collapse__text-expand">显示更多</span><span class="ec-collapse__text-collapse">显示更少</span><svg class="ec-collapse__icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" aria-hidden="true"><path fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="M6 9l6 6 6-6"></path></svg></button></div></div></section></section>
<section><h2 id="维护其他结合律算符">维护其他结合律算符<a class="anchor" href="#维护其他结合律算符"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h2><p>线段树的基本操作就基于子节点向当前节点的合并更新与当前节点向子节点的递归，对于具有结合律的算符，线段树能做到很好的 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="script">O</mi><mo stretchy="false">(</mo><mi>n</mi><mi>log</mi><mo>⁡</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\mathcal O(n\log n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathcal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span> 维护并查询。本节将重点探讨线段树维护结合律算符的部分实例。</p><section><h3 id="区间加区间斐波那契数求和">区间加+区间斐波那契数求和<a class="anchor" href="#区间加区间斐波那契数求和"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h3><p>例题：<a href="https://www.luogu.com.cn/problem/CF718C">CF718C Sasha and Array</a></p><p>难度：<span data-luogu="" data-purple="">省选/NOI-</span></p><p>维护变量：<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn><mo>×</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">{2\times2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord"><span class="mord">2</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">2</span></span></span></span></span> 矩阵和、<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn><mo>×</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">{2\times2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord"><span class="mord">2</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">2</span></span></span></span></span> 矩阵加法标记</p><p>理论基础：<a href="https://justpureh2o.cn/articles/11861/#%E6%B4%9B%E8%B0%B7-p1962-%E6%96%90%E6%B3%A2%E9%82%A3%E5%A5%91%E6%95%B0%E5%88%97">矩阵加速递推 斐波那契数列</a></p><p><del>我在 11 月 23 日斐波那契日写下这段线段树维护斐波那契数列的文字……</del></p><p>我们知道矩阵快速幂可以在 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>log</mi><mo>⁡</mo><mi>N</mi></mrow><annotation encoding="application/x-tex">\log N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span></span></span></span> 的时间复杂度内快速求出斐波那契数列第 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span> 项，那么怎么把它运用在这道题中呢？</p><p>这道题要求将区间里的每个数作为下标并获得对应的斐波那契数并对其求和，不妨把区间加运算看作将当前的节点维护的斐波那契数继续向后递推 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span> 项，思路就出来了——在线段树的每个节点上维护一个矩阵，每次更新相当于对它右乘一个转移矩阵的 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span> 次幂，求和时在矩阵间进行加法运算。可以通过维护一个懒标记实现，注意下传标记时对子树标记进行矩阵乘法运算，因而懒标记的初始值应为单位矩阵、区间和的初始值应为零矩阵。</p><p>尽管此题时限有足足五秒，但仍然卡常。建议减少取模次数、展开计算矩阵乘法。我的代码在 C++17 标准下好像最后一个点会超时，换成 C++20 或 C++23（仅 CF）就快得多了。</p><div class="expressive-code"><div class="ec-collapse ec-collapse--collapsed" id="collapse-o1sylf6hq" data-collapse-preview-lines="8" data-expanded-announcement="代码块已展开" data-collapsed-announcement="代码块已折叠"><div class="ec-collapse__content"><figure class="frame" style="--lnWidth:3ch"><figcaption class="header"></figcaption><pre data-language="C++"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#include</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#98C379;--1:#387138">&#x3C;bits/stdc++.h></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#define</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">N</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">100010</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#define</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">MOD</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1000000007</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">using</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">namespace</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E5C07B">std</span><span style="--0:#ABB2BF">;</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">typedef</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">long</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">long</span><span style="--0:#ABB2BF;--1:#383A42"> ll;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">struct</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#885D01">Matrix</span><span style="--0:#ABB2BF;--1:#383A42"> {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">ll </span><span style="--0:#E5C07B;--1:#AF4238">mat</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">3</span><span style="--0:#ABB2BF;--1:#383A42">][</span><span style="--0:#D19A66;--1:#875D01">3</span><span style="--0:#ABB2BF;--1:#383A42">]{};</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">Matrix</span><span style="--0:#ABB2BF;--1:#383A42">() {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">13</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">mat</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">][</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">] </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">mat</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">][</span><span style="--0:#D19A66;--1:#875D01">2</span><span style="--0:#ABB2BF;--1:#383A42">] </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">mat</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">2</span><span style="--0:#ABB2BF;--1:#383A42">][</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">] </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">mat</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">2</span><span style="--0:#ABB2BF;--1:#383A42">][</span><span style="--0:#D19A66;--1:#875D01">2</span><span style="--0:#ABB2BF;--1:#383A42">] </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">;</span><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic"> // 慎用 memset</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">14</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">15</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">16</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">Matrix</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">a</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">b</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">c</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">d</span><span style="--0:#ABB2BF">) {</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">17</div></div><div class="code"><span class="indent"><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic">        </span></span><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic">// 快速赋值</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">18</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">mat</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">][</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">] </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> a;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">19</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">mat</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">][</span><span style="--0:#D19A66;--1:#875D01">2</span><span style="--0:#ABB2BF;--1:#383A42">] </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> b;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">20</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">mat</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">2</span><span style="--0:#ABB2BF;--1:#383A42">][</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">] </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> c;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">21</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">mat</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">2</span><span style="--0:#ABB2BF;--1:#383A42">][</span><span style="--0:#D19A66;--1:#875D01">2</span><span style="--0:#ABB2BF;--1:#383A42">] </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> d;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">22</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">23</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">24</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#885D01">Matrix</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">operator</span><span style="--0:#ABB2BF;--1:#383A42">+(</span><span style="--0:#E5C07B;--1:#885D01">Matrix</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">b</span><span style="--0:#ABB2BF">) </span></span><span style="--0:#CD89E1;--1:#A626A4">const</span><span style="--0:#ABB2BF;--1:#383A42"> {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">25</div></div><div class="code"><span class="indent"><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic">        </span></span><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic">// 矩阵加法 对位相加</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">26</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">        </span></span><span style="--0:#ABB2BF;--1:#383A42">Matrix ret;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">27</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">ret</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">mat</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">][</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">] </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#E5C07B;--1:#AF4238">mat</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">][</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">] </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">b</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">mat</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">][</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">]) </span><span style="--0:#CD89E1;--1:#A626A4">%</span><span style="--0:#ABB2BF;--1:#383A42"> MOD;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">28</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">ret</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">mat</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">][</span><span style="--0:#D19A66;--1:#875D01">2</span><span style="--0:#ABB2BF;--1:#383A42">] </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#E5C07B;--1:#AF4238">mat</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">][</span><span style="--0:#D19A66;--1:#875D01">2</span><span style="--0:#ABB2BF;--1:#383A42">] </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">b</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">mat</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">][</span><span style="--0:#D19A66;--1:#875D01">2</span><span style="--0:#ABB2BF;--1:#383A42">]) </span><span style="--0:#CD89E1;--1:#A626A4">%</span><span style="--0:#ABB2BF;--1:#383A42"> MOD;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">29</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">ret</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">mat</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">2</span><span style="--0:#ABB2BF;--1:#383A42">][</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">] </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#E5C07B;--1:#AF4238">mat</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">2</span><span style="--0:#ABB2BF;--1:#383A42">][</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">] </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">b</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">mat</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">2</span><span style="--0:#ABB2BF;--1:#383A42">][</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">]) </span><span style="--0:#CD89E1;--1:#A626A4">%</span><span style="--0:#ABB2BF;--1:#383A42"> MOD;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">30</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">ret</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">mat</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">2</span><span style="--0:#ABB2BF;--1:#383A42">][</span><span style="--0:#D19A66;--1:#875D01">2</span><span style="--0:#ABB2BF;--1:#383A42">] </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#E5C07B;--1:#AF4238">mat</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">2</span><span style="--0:#ABB2BF;--1:#383A42">][</span><span style="--0:#D19A66;--1:#875D01">2</span><span style="--0:#ABB2BF;--1:#383A42">] </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">b</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">mat</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">2</span><span style="--0:#ABB2BF;--1:#383A42">][</span><span style="--0:#D19A66;--1:#875D01">2</span><span style="--0:#ABB2BF;--1:#383A42">]) </span><span style="--0:#CD89E1;--1:#A626A4">%</span><span style="--0:#ABB2BF;--1:#383A42"> MOD;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">31</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42"> ret;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">32</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">33</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">34</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#885D01">Matrix</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">operator</span><span style="--0:#ABB2BF;--1:#383A42">*(</span><span style="--0:#E5C07B;--1:#885D01">Matrix</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">b</span><span style="--0:#ABB2BF">) </span></span><span style="--0:#CD89E1;--1:#A626A4">const</span><span style="--0:#ABB2BF;--1:#383A42"> {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">35</div></div><div class="code"><span class="indent"><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic">        </span></span><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic">// 矩阵乘法的展开形式</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">36</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">        </span></span><span style="--0:#ABB2BF;--1:#383A42">Matrix ret;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">37</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">ret</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">mat</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">][</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">] </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#E5C07B;--1:#AF4238">mat</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">][</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">] </span><span style="--0:#CD89E1;--1:#A626A4">*</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">b</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">mat</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">][</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">] </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">mat</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">][</span><span style="--0:#D19A66;--1:#875D01">2</span><span style="--0:#ABB2BF;--1:#383A42">] </span><span style="--0:#CD89E1;--1:#A626A4">*</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">b</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">mat</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">2</span><span style="--0:#ABB2BF;--1:#383A42">][</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">]) </span><span style="--0:#CD89E1;--1:#A626A4">%</span><span style="--0:#ABB2BF;--1:#383A42"> MOD;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">38</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">ret</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">mat</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">][</span><span style="--0:#D19A66;--1:#875D01">2</span><span style="--0:#ABB2BF;--1:#383A42">] </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#E5C07B;--1:#AF4238">mat</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">][</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">] </span><span style="--0:#CD89E1;--1:#A626A4">*</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">b</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">mat</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">][</span><span style="--0:#D19A66;--1:#875D01">2</span><span style="--0:#ABB2BF;--1:#383A42">] </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">mat</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">][</span><span style="--0:#D19A66;--1:#875D01">2</span><span style="--0:#ABB2BF;--1:#383A42">] </span><span style="--0:#CD89E1;--1:#A626A4">*</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">b</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">mat</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">2</span><span style="--0:#ABB2BF;--1:#383A42">][</span><span style="--0:#D19A66;--1:#875D01">2</span><span style="--0:#ABB2BF;--1:#383A42">]) </span><span style="--0:#CD89E1;--1:#A626A4">%</span><span style="--0:#ABB2BF;--1:#383A42"> MOD;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">39</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">ret</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">mat</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">2</span><span style="--0:#ABB2BF;--1:#383A42">][</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">] </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#E5C07B;--1:#AF4238">mat</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">2</span><span style="--0:#ABB2BF;--1:#383A42">][</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">] </span><span style="--0:#CD89E1;--1:#A626A4">*</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">b</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">mat</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">][</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">] </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">mat</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">2</span><span style="--0:#ABB2BF;--1:#383A42">][</span><span style="--0:#D19A66;--1:#875D01">2</span><span style="--0:#ABB2BF;--1:#383A42">] </span><span style="--0:#CD89E1;--1:#A626A4">*</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">b</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">mat</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">][</span><span style="--0:#D19A66;--1:#875D01">2</span><span style="--0:#ABB2BF;--1:#383A42">]) </span><span style="--0:#CD89E1;--1:#A626A4">%</span><span style="--0:#ABB2BF;--1:#383A42"> MOD;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">40</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">ret</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">mat</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">2</span><span style="--0:#ABB2BF;--1:#383A42">][</span><span style="--0:#D19A66;--1:#875D01">2</span><span style="--0:#ABB2BF;--1:#383A42">] </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#E5C07B;--1:#AF4238">mat</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">2</span><span style="--0:#ABB2BF;--1:#383A42">][</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">] </span><span style="--0:#CD89E1;--1:#A626A4">*</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">b</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">mat</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">][</span><span style="--0:#D19A66;--1:#875D01">2</span><span style="--0:#ABB2BF;--1:#383A42">] </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">mat</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">2</span><span style="--0:#ABB2BF;--1:#383A42">][</span><span style="--0:#D19A66;--1:#875D01">2</span><span style="--0:#ABB2BF;--1:#383A42">] </span><span style="--0:#CD89E1;--1:#A626A4">*</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">b</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">mat</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">2</span><span style="--0:#ABB2BF;--1:#383A42">][</span><span style="--0:#D19A66;--1:#875D01">2</span><span style="--0:#ABB2BF;--1:#383A42">]) </span><span style="--0:#CD89E1;--1:#A626A4">%</span><span style="--0:#ABB2BF;--1:#383A42"> MOD;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">41</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42"> ret;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">42</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">43</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">44</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#885D01">Matrix</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">operator</span><span style="--0:#ABB2BF;--1:#383A42">^(</span><span style="--0:#E5C07B;--1:#885D01">ll</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">b</span><span style="--0:#ABB2BF">) </span></span><span style="--0:#CD89E1;--1:#A626A4">const</span><span style="--0:#ABB2BF;--1:#383A42"> {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">45</div></div><div class="code"><span class="indent"><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic">        </span></span><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic">// 重载异或算符实现矩阵快速幂</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">46</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">        </span></span><span style="--0:#ABB2BF;--1:#383A42">Matrix ret, a </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">*</span><span style="--0:#E5C07B;--1:#AF4238">this</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">47</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">ret</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#61AFEF;--1:#3360C1">I</span><span style="--0:#ABB2BF;--1:#383A42">();</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">48</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">while</span><span style="--0:#ABB2BF;--1:#383A42"> (b) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">49</div></div><div class="code"><span class="indent">            </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (b </span><span style="--0:#56B6C2;--1:#A626A4">&#x26;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">) ret </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> ret </span><span style="--0:#CD89E1;--1:#A626A4">*</span><span style="--0:#ABB2BF;--1:#383A42"> a;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">50</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">            </span></span><span style="--0:#ABB2BF;--1:#383A42">a </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> a </span><span style="--0:#CD89E1;--1:#A626A4">*</span><span style="--0:#ABB2BF;--1:#383A42"> a;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">51</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">            </span></span><span style="--0:#ABB2BF;--1:#383A42">b </span><span style="--0:#CD89E1;--1:#A626A4">>>=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">52</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">        </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">53</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42"> ret;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">54</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">55</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">56</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">void</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">I</span><span style="--0:#ABB2BF;--1:#383A42">() {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">57</div></div><div class="code"><span class="indent"><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic">        </span></span><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic">// 生成单位矩阵，置零是必须的</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">58</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">mat</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">][</span><span style="--0:#D19A66;--1:#875D01">2</span><span style="--0:#ABB2BF;--1:#383A42">] </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">mat</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">2</span><span style="--0:#ABB2BF;--1:#383A42">][</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">] </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">59</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">mat</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">][</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">] </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">mat</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">2</span><span style="--0:#ABB2BF;--1:#383A42">][</span><span style="--0:#D19A66;--1:#875D01">2</span><span style="--0:#ABB2BF;--1:#383A42">] </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">60</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">61</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">62</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">bool</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">isI</span><span style="--0:#ABB2BF;--1:#383A42">() {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">63</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">mat</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">][</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">] </span><span style="--0:#CD89E1;--1:#A626A4">==</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#56B6C2;--1:#A626A4">&#x26;&#x26;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">mat</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">][</span><span style="--0:#D19A66;--1:#875D01">2</span><span style="--0:#ABB2BF;--1:#383A42">] </span><span style="--0:#CD89E1;--1:#A626A4">==</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#56B6C2;--1:#A626A4">&#x26;&#x26;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">mat</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">2</span><span style="--0:#ABB2BF;--1:#383A42">][</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">] </span><span style="--0:#CD89E1;--1:#A626A4">==</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#56B6C2;--1:#A626A4">&#x26;&#x26;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">mat</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">2</span><span style="--0:#ABB2BF;--1:#383A42">][</span><span style="--0:#D19A66;--1:#875D01">2</span><span style="--0:#ABB2BF;--1:#383A42">] </span><span style="--0:#CD89E1;--1:#A626A4">==</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">;</span><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic"> // 判断是否是单位矩阵（是否存在懒标记）</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">64</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">65</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">};</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">66</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">67</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">struct</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#885D01">SegmentTree</span><span style="--0:#ABB2BF;--1:#383A42"> {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">68</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#define</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--1:#383A42"><span style="--0:#ABB2BF">(</span><span style="--0:#E6888F;--0fs:italic">x</span><span style="--0:#ABB2BF">) (x </span></span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">69</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#define</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--1:#383A42"><span style="--0:#ABB2BF">(</span><span style="--0:#E6888F;--0fs:italic">x</span><span style="--0:#ABB2BF">) (x </span></span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#56B6C2;--1:#A626A4">|</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">70</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#define</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--1:#383A42"><span style="--0:#ABB2BF">(</span><span style="--0:#E6888F;--0fs:italic">x</span><span style="--0:#ABB2BF">) (</span></span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--0:#ABB2BF;--1:#383A42">(x)])</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">71</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#define</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--1:#383A42"><span style="--0:#ABB2BF">(</span><span style="--0:#E6888F;--0fs:italic">x</span><span style="--0:#ABB2BF">) (</span></span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--0:#ABB2BF;--1:#383A42">(x)])</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">72</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> l, r, size;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">73</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">Matrix lazy, sum;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">74</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">} </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[N </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">2</span><span style="--0:#ABB2BF;--1:#383A42">];</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">75</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">76</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">const</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#885D01">Matrix</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">A</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">, </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">), </span><span style="--0:#61AFEF;--1:#3360C1">M</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">, </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">77</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">ll </span><span style="--0:#E5C07B;--1:#AF4238">a</span><span style="--0:#ABB2BF;--1:#383A42">[N];</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">78</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">79</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">void</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">pushup</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">) {</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">80</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">81</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">82</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">83</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">void</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">pushdown</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">) {</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">84</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#56B6C2;--1:#A626A4">!</span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E5C07B;--1:#AF4238">lazy</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#61AFEF;--1:#3360C1">isI</span><span style="--0:#ABB2BF;--1:#383A42">()) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">85</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">*</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">lazy</span><span style="--0:#ABB2BF;--1:#383A42">;</span><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic"> // 注意是乘法</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">86</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">lazy</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">lazy</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">*</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">lazy</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">87</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">88</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">*</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">lazy</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">89</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">lazy</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">lazy</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">*</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">lazy</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">90</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">91</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E5C07B;--1:#AF4238">lazy</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#61AFEF;--1:#3360C1">I</span><span style="--0:#ABB2BF;--1:#383A42">();</span><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic"> // 重置为单位矩阵</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">92</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">93</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">94</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">95</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">void</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">build</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">l</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">r</span><span style="--0:#ABB2BF">) {</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">96</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> l, </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> r;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">97</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">size</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> r </span><span style="--0:#CD89E1;--1:#A626A4">-</span><span style="--0:#ABB2BF;--1:#383A42"> l </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">98</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E5C07B;--1:#AF4238">lazy</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#61AFEF;--1:#3360C1">I</span><span style="--0:#ABB2BF;--1:#383A42">();</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">99</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">==</span><span style="--0:#ABB2BF;--1:#383A42"> r) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">100</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> A </span><span style="--0:#CD89E1;--1:#A626A4">*</span><span style="--0:#ABB2BF;--1:#383A42"> (M </span><span style="--0:#56B6C2;--1:#A626A4">^</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#E5C07B;--1:#AF4238">a</span><span style="--0:#ABB2BF;--1:#383A42">[l] </span><span style="--0:#CD89E1;--1:#A626A4">-</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">));</span><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic"> // 初始值就是斐波那契数列第 a[i] 项</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">101</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">102</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">103</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> mid </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> r) </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">104</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">build</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, mid);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">105</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">build</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--0:#ABB2BF;--1:#383A42">(idx), mid </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, r);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">106</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">pushup</span><span style="--0:#ABB2BF;--1:#383A42">(idx);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">107</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">108</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">109</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">void</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">modify</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">l</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">r</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#E5C07B;--1:#885D01">ll</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">x</span><span style="--0:#ABB2BF">) {</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">110</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#56B6C2;--1:#A626A4">&#x26;&#x26;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> r) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">111</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">*</span><span style="--0:#ABB2BF;--1:#383A42"> (M </span><span style="--0:#56B6C2;--1:#A626A4">^</span><span style="--0:#ABB2BF;--1:#383A42"> x);</span><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic"> // 向后递推 x 项</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">112</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">lazy</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">lazy</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">*</span><span style="--0:#ABB2BF;--1:#383A42"> (M </span><span style="--0:#56B6C2;--1:#A626A4">^</span><span style="--0:#ABB2BF;--1:#383A42"> x);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">113</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">114</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">115</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">pushdown</span><span style="--0:#ABB2BF;--1:#383A42">(idx);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">116</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> mid </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42">) </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">117</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> mid) </span><span style="--0:#61AFEF;--1:#3360C1">modify</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, r, x);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">118</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (r </span><span style="--0:#CD89E1;--1:#A626A4">></span><span style="--0:#ABB2BF;--1:#383A42"> mid) </span><span style="--0:#61AFEF;--1:#3360C1">modify</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, r, x);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">119</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">pushup</span><span style="--0:#ABB2BF;--1:#383A42">(idx);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">120</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">121</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">122</div></div><div class="code"><span style="--0:#E5C07B;--1:#885D01">Matrix</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">query</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">l</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">r</span><span style="--0:#ABB2BF">) {</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">123</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#56B6C2;--1:#A626A4">&#x26;&#x26;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> r) </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">124</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">pushdown</span><span style="--0:#ABB2BF;--1:#383A42">(idx);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">125</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> mid </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42">) </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">126</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">Matrix ret;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">127</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> mid) ret </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> ret </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">query</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, r);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">128</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (r </span><span style="--0:#CD89E1;--1:#A626A4">></span><span style="--0:#ABB2BF;--1:#383A42"> mid) ret </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> ret </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">query</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, r);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">129</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42"> ret;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">130</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">131</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">132</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">main</span><span style="--0:#ABB2BF;--1:#383A42">() {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">133</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">ios::</span><span style="--0:#61AFEF;--1:#3360C1">sync_with_stdio</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">false</span><span style="--0:#ABB2BF;--1:#383A42">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">134</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">cin</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#61AFEF;--1:#3360C1">tie</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">nullptr</span><span style="--0:#ABB2BF;--1:#383A42">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">135</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">cout</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#61AFEF;--1:#3360C1">tie</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">nullptr</span><span style="--0:#ABB2BF;--1:#383A42">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">136</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">137</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> n, m;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">138</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">cin </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> n </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> m;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">139</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">140</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">for</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> i </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">; i </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> n; i</span><span style="--0:#CD89E1;--1:#A626A4">++</span><span style="--0:#ABB2BF;--1:#383A42">) cin </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">a</span><span style="--0:#ABB2BF;--1:#383A42">[i];</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">141</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">build</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, n);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">142</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">while</span><span style="--0:#ABB2BF;--1:#383A42"> (m</span><span style="--0:#CD89E1;--1:#A626A4">--</span><span style="--0:#ABB2BF;--1:#383A42">) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">143</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> op, l, r;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">144</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">        </span></span><span style="--0:#ABB2BF;--1:#383A42">cin </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> op </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> l </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> r;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">145</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (op </span><span style="--0:#CD89E1;--1:#A626A4">==</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">146</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">            </span></span><span style="--0:#ABB2BF;--1:#383A42">ll x;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">147</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">            </span></span><span style="--0:#ABB2BF;--1:#383A42">cin </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> x;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">148</div></div><div class="code"><span class="indent">            </span><span style="--0:#61AFEF;--1:#3360C1">modify</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, l, r, x);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">149</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">        </span></span><span style="--0:#ABB2BF;--1:#383A42">} </span><span style="--0:#CD89E1;--1:#A626A4">else</span><span style="--0:#ABB2BF;--1:#383A42"> cout </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">query</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, l, r).</span><span style="--0:#E6888F;--1:#AF4238">mat</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">][</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">] </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> endl;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">150</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">151</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">152</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">153</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="#include <bits/stdc++.h>#define N 100010#define MOD 1000000007using namespace std;typedef long long ll;struct Matrix {    ll mat[3][3]{};    Matrix() {        mat[1][1] = mat[1][2] = mat[2][1] = mat[2][2] = 0; // 慎用 memset    }    Matrix(int a, int b, int c, int d) {        // 快速赋值        mat[1][1] = a;        mat[1][2] = b;        mat[2][1] = c;        mat[2][2] = d;    }    Matrix operator+(Matrix b) const {        // 矩阵加法 对位相加        Matrix ret;        ret.mat[1][1] = (mat[1][1] + b.mat[1][1]) % MOD;        ret.mat[1][2] = (mat[1][2] + b.mat[1][2]) % MOD;        ret.mat[2][1] = (mat[2][1] + b.mat[2][1]) % MOD;        ret.mat[2][2] = (mat[2][2] + b.mat[2][2]) % MOD;        return ret;    }    Matrix operator*(Matrix b) const {        // 矩阵乘法的展开形式        Matrix ret;        ret.mat[1][1] = (mat[1][1] * b.mat[1][1] + mat[1][2] * b.mat[2][1]) % MOD;        ret.mat[1][2] = (mat[1][1] * b.mat[1][2] + mat[1][2] * b.mat[2][2]) % MOD;        ret.mat[2][1] = (mat[2][1] * b.mat[1][1] + mat[2][2] * b.mat[1][2]) % MOD;        ret.mat[2][2] = (mat[2][1] * b.mat[1][2] + mat[2][2] * b.mat[2][2]) % MOD;        return ret;    }    Matrix operator^(ll b) const {        // 重载异或算符实现矩阵快速幂        Matrix ret, a = *this;        ret.I();        while (b) {            if (b &#x26; 1) ret = ret * a;            a = a * a;            b >>= 1;        }        return ret;    }    void I() {        // 生成单位矩阵，置零是必须的        mat[1][2] = mat[2][1] = 0;        mat[1][1] = mat[2][2] = 1;    }    bool isI() {        return mat[1][1] == 1 &#x26;&#x26; mat[1][2] == 0 &#x26;&#x26; mat[2][1] == 0 &#x26;&#x26; mat[2][2] == 1; // 判断是否是单位矩阵（是否存在懒标记）    }};struct SegmentTree {#define le(x) (x << 1)#define ri(x) (x << 1 | 1)#define leftSubtree(x) (tree[le(x)])#define rightSubtree(x) (tree[ri(x)])    int l, r, size;    Matrix lazy, sum;} tree[N << 2];const Matrix A(1, 1, 0, 0), M(0, 1, 1, 1);ll a[N];void pushup(int idx) {    tree[idx].sum = leftSubtree(idx).sum + rightSubtree(idx).sum;}void pushdown(int idx) {    if (!tree[idx].lazy.isI()) {        leftSubtree(idx).sum = leftSubtree(idx).sum * tree[idx].lazy; // 注意是乘法        leftSubtree(idx).lazy = leftSubtree(idx).lazy * tree[idx].lazy;        rightSubtree(idx).sum = rightSubtree(idx).sum * tree[idx].lazy;        rightSubtree(idx).lazy = rightSubtree(idx).lazy * tree[idx].lazy;        tree[idx].lazy.I(); // 重置为单位矩阵    }}void build(int idx, int l, int r) {    tree[idx].l = l, tree[idx].r = r;    tree[idx].size = r - l + 1;    tree[idx].lazy.I();    if (l == r) {        tree[idx].sum = A * (M ^ (a[l] - 1)); // 初始值就是斐波那契数列第 a[i] 项        return;    }    int mid = (l + r) >> 1;    build(le(idx), l, mid);    build(ri(idx), mid + 1, r);    pushup(idx);}void modify(int idx, int l, int r, ll x) {    if (l <= tree[idx].l &#x26;&#x26; tree[idx].r <= r) {        tree[idx].sum = tree[idx].sum * (M ^ x); // 向后递推 x 项        tree[idx].lazy = tree[idx].lazy * (M ^ x);        return;    }    pushdown(idx);    int mid = (tree[idx].l + tree[idx].r) >> 1;    if (l <= mid) modify(le(idx), l, r, x);    if (r > mid) modify(ri(idx), l, r, x);    pushup(idx);}Matrix query(int idx, int l, int r) {    if (l <= tree[idx].l &#x26;&#x26; tree[idx].r <= r) return tree[idx].sum;    pushdown(idx);    int mid = (tree[idx].l + tree[idx].r) >> 1;    Matrix ret;    if (l <= mid) ret = ret + query(le(idx), l, r);    if (r > mid) ret = ret + query(ri(idx), l, r);    return ret;}int main() {    ios::sync_with_stdio(false);    cin.tie(nullptr);    cout.tie(nullptr);    int n, m;    cin >> n >> m;    for (int i = 1; i <= n; i++) cin >> a[i];    build(1, 1, n);    while (m--) {        int op, l, r;        cin >> op >> l >> r;        if (op == 1) {            ll x;            cin >> x;            modify(1, l, r, x);        } else cout << query(1, l, r).mat[1][1] << endl;    }    return 0;}"><div></div></button></div></figure><div class="ec-collapse__gradient" aria-hidden="true"></div></div><button class="ec-collapse__toggle" type="button" aria-expanded="false" aria-controls="collapse-o1sylf6hq"><span class="ec-collapse__text-expand">显示更多</span><span class="ec-collapse__text-collapse">显示更少</span><svg class="ec-collapse__icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" aria-hidden="true"><path fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="M6 9l6 6 6-6"></path></svg></button></div></div></section></section>
<section><h2 id="线段树二分">线段树二分<a class="anchor" href="#线段树二分"><span class="anchor-icon" data-pagefind-ignore="">#</span></a></h2><p>有时我们会遇到二分和线段树结合起来的题。如果使用二分区间加区间查询的方案，其时间复杂度将是 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="script">O</mi><mo stretchy="false">(</mo><mi>n</mi><msup><mrow><mi>log</mi><mo>⁡</mo></mrow><mn>2</mn></msup><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\mathcal O(n\log^2n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1484em;vertical-align:-0.25em;"></span><span class="mord mathcal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop"><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8984em;"><span style="top:-3.1473em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span>，在 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>≈</mo><msup><mn>10</mn><mn>5</mn></msup></mrow><annotation encoding="application/x-tex">n\approx10^5</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4831em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8141em;"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">5</span></span></span></span></span></span></span></span></span></span></span> 的时候会超时。此时可以借助线段树的有序性，在线段树上二分。</p><p>例题：<a href="https://www.luogu.com.cn/problem/P11217">P11217 youyou 的垃圾桶</a></p><p>题目难度：<span data-luogu="" data-green="">普及+/提高</span></p><p>维护变量：区间和、区间加标记</p><p>我们知道线段树可以维护一段连续的区间，这意味着我们可以在上面二分一个具有单调性的值。在线段树的最底层，从左到右分别就对应着原序列从左到右的元素。当我们需要对某个区间进行二分时，转换到树上就是看左右子树——若左子树的总和仍小于查询值，那么就在右子树查找原值减去左子树总和的值即可；否则就转到左子树找查询值。可以发现，这个逻辑和平衡树根据排名查询对应值是一样的。</p><div class="expressive-code"><div class="ec-collapse ec-collapse--collapsed" id="collapse-rwm8c2xa2" data-collapse-preview-lines="8" data-expanded-announcement="代码块已展开" data-collapsed-announcement="代码块已折叠"><div class="ec-collapse__content"><figure class="frame" style="--lnWidth:3ch"><figcaption class="header"></figcaption><pre data-language="C++"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#include</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#98C379;--1:#387138">&#x3C;bits/stdc++.h></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#define</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">N</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">200010</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">using</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">namespace</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E5C07B">std</span><span style="--0:#ABB2BF">;</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">typedef</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">long</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">long</span><span style="--0:#ABB2BF;--1:#383A42"> ll;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">a</span><span style="--0:#ABB2BF;--1:#383A42">[N];</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">struct</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#885D01">SegmentTree</span><span style="--0:#ABB2BF;--1:#383A42"> {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#define</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--1:#383A42"><span style="--0:#ABB2BF">(</span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">) (idx </span></span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#define</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--1:#383A42"><span style="--0:#ABB2BF">(</span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">) (idx </span></span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#56B6C2;--1:#A626A4">|</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#define</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--1:#383A42"><span style="--0:#ABB2BF">(</span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">) (</span></span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--0:#ABB2BF;--1:#383A42">(idx)])</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">13</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#define</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--1:#383A42"><span style="--0:#ABB2BF">(</span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">) (</span></span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--0:#ABB2BF;--1:#383A42">(idx)])</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">14</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> l, r;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">15</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">ll sum;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">16</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">ll lazy;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">17</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> size;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">18</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">} </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[N </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">2</span><span style="--0:#ABB2BF;--1:#383A42">];</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">19</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">20</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">void</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">pushup</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">) {</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">21</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">22</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">23</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">24</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">void</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">build</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">l</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">r</span><span style="--0:#ABB2BF">) {</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">25</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">lazy</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">26</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">size</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> r </span><span style="--0:#CD89E1;--1:#A626A4">-</span><span style="--0:#ABB2BF;--1:#383A42"> l </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">27</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> l, </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> r;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">28</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">==</span><span style="--0:#ABB2BF;--1:#383A42"> r) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">29</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">a</span><span style="--0:#ABB2BF;--1:#383A42">[l];</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">30</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">31</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">32</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> mid </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> l </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> r </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">33</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">build</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, mid);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">34</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">build</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--0:#ABB2BF;--1:#383A42">(idx), mid </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, r);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">35</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">pushup</span><span style="--0:#ABB2BF;--1:#383A42">(idx);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">36</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">37</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">38</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">void</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">pushdown</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">) {</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">39</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">lazy</span><span style="--0:#ABB2BF;--1:#383A42">) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">40</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">lazy</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">lazy</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">41</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">size</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">*</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">lazy</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">42</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">lazy</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">lazy</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">43</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">size</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">*</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">lazy</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">44</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">lazy</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">45</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">46</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">47</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">48</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">void</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">modify</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">l</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">r</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#E5C07B;--1:#885D01">ll</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">x</span><span style="--0:#ABB2BF">) {</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">49</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">></span><span style="--0:#ABB2BF;--1:#383A42"> r </span><span style="--0:#56B6C2;--1:#A626A4">||</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> l) </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">50</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#56B6C2;--1:#A626A4">&#x26;&#x26;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> r) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">51</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+=</span><span style="--0:#ABB2BF;--1:#383A42"> x </span><span style="--0:#CD89E1;--1:#A626A4">*</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">size</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">52</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">lazy</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+=</span><span style="--0:#ABB2BF;--1:#383A42"> x;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">53</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">54</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">55</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">pushdown</span><span style="--0:#ABB2BF;--1:#383A42">(idx);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">56</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> mid </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">57</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> mid) </span><span style="--0:#61AFEF;--1:#3360C1">modify</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, r, x);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">58</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (r </span><span style="--0:#CD89E1;--1:#A626A4">></span><span style="--0:#ABB2BF;--1:#383A42"> mid) </span><span style="--0:#61AFEF;--1:#3360C1">modify</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, r, x);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">59</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">pushup</span><span style="--0:#ABB2BF;--1:#383A42">(idx);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">60</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">61</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">62</div></div><div class="code"><span style="--0:#E5C07B;--1:#885D01">ll</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">query</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">l</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">r</span><span style="--0:#ABB2BF">) {</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">63</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">></span><span style="--0:#ABB2BF;--1:#383A42"> r </span><span style="--0:#56B6C2;--1:#A626A4">||</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> l) </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">64</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#56B6C2;--1:#A626A4">&#x26;&#x26;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> r) </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">65</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">pushdown</span><span style="--0:#ABB2BF;--1:#383A42">(idx);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">66</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> mid </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">67</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">ll ret </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">68</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> mid) ret </span><span style="--0:#CD89E1;--1:#A626A4">+=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">query</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, r);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">69</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (r </span><span style="--0:#CD89E1;--1:#A626A4">></span><span style="--0:#ABB2BF;--1:#383A42"> mid) ret </span><span style="--0:#CD89E1;--1:#A626A4">+=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">query</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, r);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">70</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42"> ret;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">71</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">72</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">73</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">get</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#E5C07B;--1:#885D01">ll</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">x</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#E5C07B;--1:#885D01">ll</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">amp</span><span style="--0:#ABB2BF">) {</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">74</div></div><div class="code"><span class="indent"><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic">    </span></span><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic">// 线段树二分</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">75</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">==</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42">) </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">76</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">pushdown</span><span style="--0:#ABB2BF;--1:#383A42">(idx);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">77</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> amp </span><span style="--0:#CD89E1;--1:#A626A4">>=</span><span style="--0:#ABB2BF;--1:#383A42"> x) </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">get</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--0:#ABB2BF;--1:#383A42">(idx), x, amp);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">78</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">get</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--0:#ABB2BF;--1:#383A42">(idx), x </span><span style="--0:#CD89E1;--1:#A626A4">-</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> amp), amp);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">79</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">80</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">81</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">main</span><span style="--0:#ABB2BF;--1:#383A42">() {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">82</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">ios::</span><span style="--0:#61AFEF;--1:#3360C1">sync_with_stdio</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">false</span><span style="--0:#ABB2BF;--1:#383A42">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">83</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">cin</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#61AFEF;--1:#3360C1">tie</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">nullptr</span><span style="--0:#ABB2BF;--1:#383A42">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">84</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">cout</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#61AFEF;--1:#3360C1">tie</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">nullptr</span><span style="--0:#ABB2BF;--1:#383A42">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">85</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">86</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> n, q;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">87</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">ll w;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">88</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">cin </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> n </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> q </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> w;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">89</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">for</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> i </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">; i </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> n; i</span><span style="--0:#CD89E1;--1:#A626A4">++</span><span style="--0:#ABB2BF;--1:#383A42">) cin </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">a</span><span style="--0:#ABB2BF;--1:#383A42">[i];</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">90</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">build</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, n);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">91</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">while</span><span style="--0:#ABB2BF;--1:#383A42"> (q</span><span style="--0:#CD89E1;--1:#A626A4">--</span><span style="--0:#ABB2BF;--1:#383A42">) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">92</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> l, r, d;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">93</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">        </span></span><span style="--0:#ABB2BF;--1:#383A42">cin </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> l </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> r </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> d;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">94</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">modify</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, l, r, d);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">95</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">        </span></span><span style="--0:#ABB2BF;--1:#383A42">ll sum </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">].</span><span style="--0:#E6888F;--1:#AF4238">sum</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">96</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">        </span></span><span style="--0:#ABB2BF;--1:#383A42">ll cur </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">97</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">        </span></span><span style="--0:#ABB2BF;--1:#383A42">ll k </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">2</span><span style="--0:#ABB2BF;--1:#383A42">, i </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">98</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">for</span><span style="--0:#ABB2BF;--1:#383A42"> (;; i</span><span style="--0:#CD89E1;--1:#A626A4">++</span><span style="--0:#ABB2BF;--1:#383A42">) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">99</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">            </span></span><span style="--0:#ABB2BF;--1:#383A42">cur </span><span style="--0:#CD89E1;--1:#A626A4">+=</span><span style="--0:#ABB2BF;--1:#383A42"> sum </span><span style="--0:#CD89E1;--1:#A626A4">*</span><span style="--0:#ABB2BF;--1:#383A42"> (k </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">100</div></div><div class="code"><span class="indent">            </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (cur </span><span style="--0:#CD89E1;--1:#A626A4">>=</span><span style="--0:#ABB2BF;--1:#383A42"> w) </span><span style="--0:#CD89E1;--1:#A626A4">break</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">101</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">            </span></span><span style="--0:#ABB2BF;--1:#383A42">k </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">102</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">        </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">103</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">        </span></span><span style="--0:#ABB2BF;--1:#383A42">cout </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> n </span><span style="--0:#CD89E1;--1:#A626A4">*</span><span style="--0:#ABB2BF;--1:#383A42"> (i </span><span style="--0:#CD89E1;--1:#A626A4">-</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">) </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">get</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, w </span><span style="--0:#CD89E1;--1:#A626A4">-</span><span style="--0:#ABB2BF;--1:#383A42"> sum </span><span style="--0:#CD89E1;--1:#A626A4">*</span><span style="--0:#ABB2BF;--1:#383A42"> ((k </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">) </span><span style="--0:#CD89E1;--1:#A626A4">-</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">), i </span><span style="--0:#CD89E1;--1:#A626A4">-</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">) </span><span style="--0:#CD89E1;--1:#A626A4">-</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#98C379;--1:#387138">'</span><span style="--0:#56B6C2;--1:#016C9A">\n</span><span style="--0:#98C379;--1:#387138">'</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">104</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">105</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">106</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="#include <bits/stdc++.h>#define N 200010using namespace std;typedef long long ll;int a[N];struct SegmentTree {#define le(idx) (idx << 1)#define ri(idx) (idx << 1 | 1)#define leftSubtree(idx) (tree[le(idx)])#define rightSubtree(idx) (tree[ri(idx)])    int l, r;    ll sum;    ll lazy;    int size;} tree[N << 2];void pushup(int idx) {    tree[idx].sum = leftSubtree(idx).sum + rightSubtree(idx).sum;}void build(int idx, int l, int r) {    tree[idx].lazy = tree[idx].sum = 0;    tree[idx].size = r - l + 1;    tree[idx].l = l, tree[idx].r = r;    if (l == r) {        tree[idx].sum = a[l];        return;    }    int mid = l + r >> 1;    build(le(idx), l, mid);    build(ri(idx), mid + 1, r);    pushup(idx);}void pushdown(int idx) {    if (tree[idx].lazy) {        leftSubtree(idx).lazy += tree[idx].lazy;        leftSubtree(idx).sum += leftSubtree(idx).size * tree[idx].lazy;        rightSubtree(idx).lazy += tree[idx].lazy;        rightSubtree(idx).sum += rightSubtree(idx).size * tree[idx].lazy;        tree[idx].lazy = 0;    }}void modify(int idx, int l, int r, ll x) {    if (tree[idx].l > r || tree[idx].r < l) return;    if (l <= tree[idx].l &#x26;&#x26; tree[idx].r <= r) {        tree[idx].sum += x * tree[idx].size;        tree[idx].lazy += x;        return;    }    pushdown(idx);    int mid = tree[idx].l + tree[idx].r >> 1;    if (l <= mid) modify(le(idx), l, r, x);    if (r > mid) modify(ri(idx), l, r, x);    pushup(idx);}ll query(int idx, int l, int r) {    if (tree[idx].l > r || tree[idx].r < l) return 0;    if (l <= tree[idx].l &#x26;&#x26; tree[idx].r <= r) return tree[idx].sum;    pushdown(idx);    int mid = tree[idx].l + tree[idx].r >> 1;    ll ret = 0;    if (l <= mid) ret += query(le(idx), l, r);    if (r > mid) ret += query(ri(idx), l, r);    return ret;}int get(int idx, ll x, ll amp) {    // 线段树二分    if (tree[idx].l == tree[idx].r) return tree[idx].l;    pushdown(idx);    if (leftSubtree(idx).sum << amp >= x) return get(le(idx), x, amp);    return get(ri(idx), x - (leftSubtree(idx).sum << amp), amp);}int main() {    ios::sync_with_stdio(false);    cin.tie(nullptr);    cout.tie(nullptr);    int n, q;    ll w;    cin >> n >> q >> w;    for (int i = 1; i <= n; i++) cin >> a[i];    build(1, 1, n);    while (q--) {        int l, r, d;        cin >> l >> r >> d;        modify(1, l, r, d);        ll sum = tree[1].sum;        ll cur = 0;        ll k = 2, i = 1;        for (;; i++) {            cur += sum * (k >> 1);            if (cur >= w) break;            k <<= 1;        }        cout << n * (i - 1) + get(1, w - sum * ((k >> 1) - 1), i - 1) - 1 << &#x27;\n&#x27;;    }    return 0;}"><div></div></button></div></figure><div class="ec-collapse__gradient" aria-hidden="true"></div></div><button class="ec-collapse__toggle" type="button" aria-expanded="false" aria-controls="collapse-rwm8c2xa2"><span class="ec-collapse__text-expand">显示更多</span><span class="ec-collapse__text-collapse">显示更少</span><svg class="ec-collapse__icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" aria-hidden="true"><path fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="M6 9l6 6 6-6"></path></svg></button></div></div><hr><p>例题：<a href="https://www.luogu.com.cn/problem/P11289">P11289 【MX-S6-T1】「KDOI-11」打印</a></p><p>题目难度：<span data-luogu="" data-green="">普及+/提高</span></p><p>维护变量：区间加标记、等待时间、区间等待时间最小值</p><p><del>才复习的线段树结果赛时还是没想到线段树做法</del></p><p>对于每个打印请求，我们预先把它们按照起始时间升序排序，然后再一个一个考虑。维护当前时间，读入到一个请求时，相当于要把当前时间后移到该请求的起始时间。此时我们让所有打印机的等待时间减去二者差值，并找出序号最小的那个打印机、更新选中打印机的等待时间、接着更新答案即可。注意等待时间最小为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">{0}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord"><span class="mord">0</span></span></span></span></span>。</p><div class="expressive-code"><div class="ec-collapse ec-collapse--collapsed" id="collapse-hdf4eu9j2" data-collapse-preview-lines="8" data-expanded-announcement="代码块已展开" data-collapsed-announcement="代码块已折叠"><div class="ec-collapse__content"><figure class="frame" style="--lnWidth:3ch"><figcaption class="header"></figcaption><pre data-language="C++"><code><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">1</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#include</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#98C379;--1:#387138">&#x3C;bits/stdc++.h></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">2</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#define</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">N</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">200010</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">3</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">using</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">namespace</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E5C07B">std</span><span style="--0:#ABB2BF">;</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">4</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">5</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">typedef</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">long</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">long</span><span style="--0:#ABB2BF;--1:#383A42"> ll;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">6</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">7</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">struct</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#885D01">Node</span><span style="--0:#ABB2BF;--1:#383A42"> {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">8</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> id;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">9</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">ll s, t;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">10</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">} </span><span style="--0:#E5C07B;--1:#AF4238">nodes</span><span style="--0:#ABB2BF;--1:#383A42">[N];</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">11</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">12</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">struct</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#885D01">SegmentTree</span><span style="--0:#ABB2BF;--1:#383A42"> {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">13</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#define</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--1:#383A42"><span style="--0:#ABB2BF">(</span><span style="--0:#E6888F;--0fs:italic">x</span><span style="--0:#ABB2BF">) (x </span></span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">14</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#define</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--1:#383A42"><span style="--0:#ABB2BF">(</span><span style="--0:#E6888F;--0fs:italic">x</span><span style="--0:#ABB2BF">) (x </span></span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#56B6C2;--1:#A626A4">|</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">15</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#define</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--1:#383A42"><span style="--0:#ABB2BF">(</span><span style="--0:#E6888F;--0fs:italic">x</span><span style="--0:#ABB2BF">) (</span></span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--0:#ABB2BF;--1:#383A42">(x)])</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">16</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">#define</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--1:#383A42"><span style="--0:#ABB2BF">(</span><span style="--0:#E6888F;--0fs:italic">x</span><span style="--0:#ABB2BF">) (</span></span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--0:#ABB2BF;--1:#383A42">(x)])</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">17</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> l, r, size;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">18</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> real_id;</span><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic"> // 记录打印机的编号</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">19</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">ll time, lazy;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">20</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">} </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[N </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">2</span><span style="--0:#ABB2BF;--1:#383A42">];</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">21</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">22</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">vector</span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;int></span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">ans</span><span style="--0:#ABB2BF;--1:#383A42">[N];</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">23</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">24</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">bool</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">cmp</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#CD89E1;--1:#A626A4">const</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#885D01">Node</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">&#x26;</span><span style="--1:#383A42"><span style="--0:#E6888F;--0fs:italic">l</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">const</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#885D01">Node</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">&#x26;</span><span style="--1:#383A42"><span style="--0:#E6888F;--0fs:italic">r</span><span style="--0:#ABB2BF">) {</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">25</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">t</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#E6888F;--1:#AF4238">t</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">26</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">27</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">28</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">void</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">pushup</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">) {</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">29</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">time</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">min</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">time</span><span style="--0:#ABB2BF;--1:#383A42">, </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">time</span><span style="--0:#ABB2BF;--1:#383A42">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">30</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">31</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">32</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">void</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">pushdown</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">) {</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">33</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">lazy</span><span style="--0:#ABB2BF;--1:#383A42">) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">34</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">time</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">max</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--1:#875D01"><span style="--0:#D19A66">0</span><span style="--0:#E6888F">ll</span></span><span style="--0:#ABB2BF;--1:#383A42">, </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">time</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">lazy</span><span style="--0:#ABB2BF;--1:#383A42">);</span><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic"> // 等待时间不能为负</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">35</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">lazy</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">lazy</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">36</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">time</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">max</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--1:#875D01"><span style="--0:#D19A66">0</span><span style="--0:#E6888F">ll</span></span><span style="--0:#ABB2BF;--1:#383A42">, </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">time</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">lazy</span><span style="--0:#ABB2BF;--1:#383A42">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">37</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">rightSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">lazy</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">lazy</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">38</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">lazy</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">39</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">40</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">41</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">42</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">void</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">build</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">l</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">r</span><span style="--0:#ABB2BF">) {</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">43</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> l, </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> r;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">44</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">size</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> r </span><span style="--0:#CD89E1;--1:#A626A4">-</span><span style="--0:#ABB2BF;--1:#383A42"> l </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">45</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">==</span><span style="--0:#ABB2BF;--1:#383A42"> r) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">46</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">real_id</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> l;</span><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic"> // 记录原始编号</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">47</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">48</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">49</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> mid </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> r) </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">50</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">build</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, mid);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">51</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">build</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--0:#ABB2BF;--1:#383A42">(idx), mid </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, r);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">52</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">pushup</span><span style="--0:#ABB2BF;--1:#383A42">(idx);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">53</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">54</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">55</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">void</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">modify</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">l</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">r</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#E5C07B;--1:#885D01">ll</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">x</span><span style="--0:#ABB2BF">) {</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">56</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#56B6C2;--1:#A626A4">&#x26;&#x26;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> r) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">57</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">lazy</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+=</span><span style="--0:#ABB2BF;--1:#383A42"> x;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">58</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">time</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">max</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--1:#875D01"><span style="--0:#D19A66">0</span><span style="--0:#E6888F">ll</span></span><span style="--0:#ABB2BF;--1:#383A42">, </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">time</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> x);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">59</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">60</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">61</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">pushdown</span><span style="--0:#ABB2BF;--1:#383A42">(idx);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">62</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> mid </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42">) </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">63</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (l </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> mid) </span><span style="--0:#61AFEF;--1:#3360C1">modify</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, r, x);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">64</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (r </span><span style="--0:#CD89E1;--1:#A626A4">></span><span style="--0:#ABB2BF;--1:#383A42"> mid) </span><span style="--0:#61AFEF;--1:#3360C1">modify</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--0:#ABB2BF;--1:#383A42">(idx), l, r, x);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">65</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">pushup</span><span style="--0:#ABB2BF;--1:#383A42">(idx);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">66</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">67</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">68</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">void</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">modify</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">uid</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#E5C07B;--1:#885D01">ll</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">x</span><span style="--0:#ABB2BF">) {</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">69</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">size</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">==</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#56B6C2;--1:#A626A4">&#x26;&#x26;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">==</span><span style="--0:#ABB2BF;--1:#383A42"> uid) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">70</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">time</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">max</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--1:#875D01"><span style="--0:#D19A66">0</span><span style="--0:#E6888F">ll</span></span><span style="--0:#ABB2BF;--1:#383A42">, </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">time</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> x);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">71</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">72</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">73</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">pushdown</span><span style="--0:#ABB2BF;--1:#383A42">(idx);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">74</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> mid </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">l</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">r</span><span style="--0:#ABB2BF;--1:#383A42">) </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">75</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (uid </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> mid) </span><span style="--0:#61AFEF;--1:#3360C1">modify</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--0:#ABB2BF;--1:#383A42">(idx), uid, x);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">76</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (uid </span><span style="--0:#CD89E1;--1:#A626A4">></span><span style="--0:#ABB2BF;--1:#383A42"> mid) </span><span style="--0:#61AFEF;--1:#3360C1">modify</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--0:#ABB2BF;--1:#383A42">(idx), uid, x);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">77</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">pushup</span><span style="--0:#ABB2BF;--1:#383A42">(idx);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">78</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">79</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">80</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">find</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">idx</span><span style="--0:#ABB2BF">, </span></span><span style="--0:#E5C07B;--1:#885D01">ll</span><span style="--1:#383A42"><span style="--0:#ABB2BF"> </span><span style="--0:#E6888F;--0fs:italic">time</span><span style="--0:#ABB2BF">) {</span></span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">81</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">size</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">==</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">) </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[idx].</span><span style="--0:#E6888F;--1:#AF4238">real_id</span><span style="--0:#ABB2BF;--1:#383A42">;</span><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic"> // 找到了，返回对应打印机的编号</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">82</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">pushdown</span><span style="--0:#ABB2BF;--1:#383A42">(idx);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">83</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">if</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#61AFEF;--1:#3360C1">leftSubtree</span><span style="--0:#ABB2BF;--1:#383A42">(idx).</span><span style="--0:#E6888F;--1:#AF4238">time</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> time) </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">find</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">le</span><span style="--0:#ABB2BF;--1:#383A42">(idx), time);</span><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic"> // 根据建树时的编号单调性进行二分，若左侧等待时间小于等于目标，则尽量向左找</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">84</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">find</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#61AFEF;--1:#3360C1">ri</span><span style="--0:#ABB2BF;--1:#383A42">(idx), time);</span><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic"> // 左侧编号更小的打印机都在工作，只能向右找空闲打印机</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">85</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">86</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">87</div></div><div class="code"><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">main</span><span style="--0:#ABB2BF;--1:#383A42">() {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">88</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">ios::</span><span style="--0:#61AFEF;--1:#3360C1">sync_with_stdio</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">false</span><span style="--0:#ABB2BF;--1:#383A42">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">89</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">cin</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#61AFEF;--1:#3360C1">tie</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">nullptr</span><span style="--0:#ABB2BF;--1:#383A42">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">90</div></div><div class="code"><span class="indent">    </span><span style="--0:#E5C07B;--1:#AF4238">cout</span><span style="--0:#ABB2BF;--1:#383A42">.</span><span style="--0:#61AFEF;--1:#3360C1">tie</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">nullptr</span><span style="--0:#ABB2BF;--1:#383A42">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">91</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">92</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> n, m;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">93</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">cin </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> n </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> m;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">94</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">build</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, m);</span><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic"> // 注意是 m 台打印机</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">95</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">for</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> i </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">; i </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> n; i</span><span style="--0:#CD89E1;--1:#A626A4">++</span><span style="--0:#ABB2BF;--1:#383A42">) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">96</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">        </span></span><span style="--0:#ABB2BF;--1:#383A42">cin </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">nodes</span><span style="--0:#ABB2BF;--1:#383A42">[i].</span><span style="--0:#E6888F;--1:#AF4238">s</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">>></span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">nodes</span><span style="--0:#ABB2BF;--1:#383A42">[i].</span><span style="--0:#E6888F;--1:#AF4238">t</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">97</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">nodes</span><span style="--0:#ABB2BF;--1:#383A42">[i].</span><span style="--0:#E6888F;--1:#AF4238">id</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> i;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">98</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">99</div></div><div class="code"><span class="indent">    </span><span style="--0:#61AFEF;--1:#3360C1">sort</span><span style="--0:#ABB2BF;--1:#383A42">(nodes </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, nodes </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#CD89E1;--1:#A626A4">+</span><span style="--0:#ABB2BF;--1:#383A42"> n, cmp);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">100</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">ll time </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">101</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">for</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> i </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">; i </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> n; i</span><span style="--0:#CD89E1;--1:#A626A4">++</span><span style="--0:#ABB2BF;--1:#383A42">) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">102</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">modify</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, m, time </span><span style="--0:#CD89E1;--1:#A626A4">-</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">nodes</span><span style="--0:#ABB2BF;--1:#383A42">[i].</span><span style="--0:#E6888F;--1:#AF4238">t</span><span style="--0:#ABB2BF;--1:#383A42">);</span><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic"> // 减去时间差</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">103</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> id </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#61AFEF;--1:#3360C1">find</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, </span><span style="--0:#E5C07B;--1:#AF4238">tree</span><span style="--0:#ABB2BF;--1:#383A42">[</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">].</span><span style="--0:#E6888F;--1:#AF4238">time</span><span style="--0:#ABB2BF;--1:#383A42">);</span><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic"> // 找出编号最小的空闲打印机</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">104</div></div><div class="code"><span class="indent">        </span><span style="--0:#E5C07B;--1:#AF4238">ans</span><span style="--0:#ABB2BF;--1:#383A42">[id].</span><span style="--0:#61AFEF;--1:#3360C1">push_back</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#E5C07B;--1:#AF4238">nodes</span><span style="--0:#ABB2BF;--1:#383A42">[i].</span><span style="--0:#E6888F;--1:#AF4238">id</span><span style="--0:#ABB2BF;--1:#383A42">);</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">105</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">modify</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">, id, </span><span style="--0:#E5C07B;--1:#AF4238">nodes</span><span style="--0:#ABB2BF;--1:#383A42">[i].</span><span style="--0:#E6888F;--1:#AF4238">s</span><span style="--0:#ABB2BF;--1:#383A42">);</span><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic"> // 为当前打印机分配了任务，更新单点等待时间</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">106</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">        </span></span><span style="--0:#ABB2BF;--1:#383A42">time </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">nodes</span><span style="--0:#ABB2BF;--1:#383A42">[i].</span><span style="--0:#E6888F;--1:#AF4238">t</span><span style="--0:#ABB2BF;--1:#383A42">;</span><span style="--0:#9FA3AA;--0fs:italic;--1:#646568;--1fs:italic"> // 当前时间后移</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">107</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">108</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">for</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> i </span><span style="--0:#CD89E1;--1:#A626A4">=</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">1</span><span style="--0:#ABB2BF;--1:#383A42">; i </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;=</span><span style="--0:#ABB2BF;--1:#383A42"> m; i</span><span style="--0:#CD89E1;--1:#A626A4">++</span><span style="--0:#ABB2BF;--1:#383A42">) {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">109</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">        </span></span><span style="--0:#ABB2BF;--1:#383A42">cout </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#E5C07B;--1:#AF4238">ans</span><span style="--0:#ABB2BF;--1:#383A42">[i].</span><span style="--0:#61AFEF;--1:#3360C1">size</span><span style="--0:#ABB2BF;--1:#383A42">() </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#98C379;--1:#387138">' '</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">110</div></div><div class="code"><span class="indent">        </span><span style="--0:#61AFEF;--1:#3360C1">sort</span><span style="--0:#ABB2BF;--1:#383A42">(</span><span style="--0:#E5C07B;--1:#AF4238">ans</span><span style="--0:#ABB2BF;--1:#383A42">[i].</span><span style="--0:#61AFEF;--1:#3360C1">begin</span><span style="--0:#ABB2BF;--1:#383A42">(), </span><span style="--0:#E5C07B;--1:#AF4238">ans</span><span style="--0:#ABB2BF;--1:#383A42">[i].</span><span style="--0:#61AFEF;--1:#3360C1">end</span><span style="--0:#ABB2BF;--1:#383A42">());</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">111</div></div><div class="code"><span class="indent">        </span><span style="--0:#CD89E1;--1:#A626A4">for</span><span style="--0:#ABB2BF;--1:#383A42"> (</span><span style="--0:#CD89E1;--1:#A626A4">int</span><span style="--0:#ABB2BF;--1:#383A42"> j: </span><span style="--0:#E5C07B;--1:#AF4238">ans</span><span style="--0:#ABB2BF;--1:#383A42">[i]) cout </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> j </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#98C379;--1:#387138">' '</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">112</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">        </span></span><span style="--0:#ABB2BF;--1:#383A42">cout </span><span style="--0:#CD89E1;--1:#A626A4">&#x3C;&#x3C;</span><span style="--0:#ABB2BF;--1:#383A42"> endl;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">113</div></div><div class="code"><span class="indent"><span style="--0:#ABB2BF;--1:#383A42">    </span></span><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">114</div></div><div class="code"><span class="indent">    </span><span style="--0:#CD89E1;--1:#A626A4">return</span><span style="--0:#ABB2BF;--1:#383A42"> </span><span style="--0:#D19A66;--1:#875D01">0</span><span style="--0:#ABB2BF;--1:#383A42">;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln" aria-hidden="true">115</div></div><div class="code"><span style="--0:#ABB2BF;--1:#383A42">}</span></div></div></code></pre><div class="copy"><div aria-live="polite"></div><button title="Copy to clipboard" data-copied="Copied!" data-code="#include <bits/stdc++.h>#define N 200010using namespace std;typedef long long ll;struct Node {    int id;    ll s, t;} nodes[N];struct SegmentTree {#define le(x) (x << 1)#define ri(x) (x << 1 | 1)#define leftSubtree(x) (tree[le(x)])#define rightSubtree(x) (tree[ri(x)])    int l, r, size;    int real_id; // 记录打印机的编号    ll time, lazy;} tree[N << 2];vector<int> ans[N];bool cmp(const Node &#x26;l, const Node &#x26;r) {    return l.t < r.t;}void pushup(int idx) {    tree[idx].time = min(leftSubtree(idx).time, rightSubtree(idx).time);}void pushdown(int idx) {    if (tree[idx].lazy) {        leftSubtree(idx).time = max(0ll, leftSubtree(idx).time + tree[idx].lazy); // 等待时间不能为负        leftSubtree(idx).lazy += tree[idx].lazy;        rightSubtree(idx).time = max(0ll, rightSubtree(idx).time + tree[idx].lazy);        rightSubtree(idx).lazy += tree[idx].lazy;        tree[idx].lazy = 0;    }}void build(int idx, int l, int r) {    tree[idx].l = l, tree[idx].r = r;    tree[idx].size = r - l + 1;    if (l == r) {        tree[idx].real_id = l; // 记录原始编号        return;    }    int mid = (l + r) >> 1;    build(le(idx), l, mid);    build(ri(idx), mid + 1, r);    pushup(idx);}void modify(int idx, int l, int r, ll x) {    if (l <= tree[idx].l &#x26;&#x26; tree[idx].r <= r) {        tree[idx].lazy += x;        tree[idx].time = max(0ll, tree[idx].time + x);        return;    }    pushdown(idx);    int mid = (tree[idx].l + tree[idx].r) >> 1;    if (l <= mid) modify(le(idx), l, r, x);    if (r > mid) modify(ri(idx), l, r, x);    pushup(idx);}void modify(int idx, int uid, ll x) {    if (tree[idx].size == 1 &#x26;&#x26; tree[idx].l == uid) {        tree[idx].time = max(0ll, tree[idx].time + x);        return;    }    pushdown(idx);    int mid = (tree[idx].l + tree[idx].r) >> 1;    if (uid <= mid) modify(le(idx), uid, x);    if (uid > mid) modify(ri(idx), uid, x);    pushup(idx);}int find(int idx, ll time) {    if (tree[idx].size == 1) return tree[idx].real_id; // 找到了，返回对应打印机的编号    pushdown(idx);    if (leftSubtree(idx).time <= time) return find(le(idx), time); // 根据建树时的编号单调性进行二分，若左侧等待时间小于等于目标，则尽量向左找    return find(ri(idx), time); // 左侧编号更小的打印机都在工作，只能向右找空闲打印机}int main() {    ios::sync_with_stdio(false);    cin.tie(nullptr);    cout.tie(nullptr);    int n, m;    cin >> n >> m;    build(1, 1, m); // 注意是 m 台打印机    for (int i = 1; i <= n; i++) {        cin >> nodes[i].s >> nodes[i].t;        nodes[i].id = i;    }    sort(nodes + 1, nodes + 1 + n, cmp);    ll time = 1;    for (int i = 1; i <= n; i++) {        modify(1, 1, m, time - nodes[i].t); // 减去时间差        int id = find(1, tree[1].time); // 找出编号最小的空闲打印机        ans[id].push_back(nodes[i].id);        modify(1, id, nodes[i].s); // 为当前打印机分配了任务，更新单点等待时间        time = nodes[i].t; // 当前时间后移    }    for (int i = 1; i <= m; i++) {        cout << ans[i].size() << &#x27; &#x27;;        sort(ans[i].begin(), ans[i].end());        for (int j: ans[i]) cout << j << &#x27; &#x27;;        cout << endl;    }    return 0;}"><div></div></button></div></figure><div class="ec-collapse__gradient" aria-hidden="true"></div></div><button class="ec-collapse__toggle" type="button" aria-expanded="false" aria-controls="collapse-hdf4eu9j2"><span class="ec-collapse__text-expand">显示更多</span><span class="ec-collapse__text-collapse">显示更少</span><svg class="ec-collapse__icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" aria-hidden="true"><path fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="M6 9l6 6 6-6"></path></svg></button></div></div></section>  </div>  <div class="mb-6 rounded-xl onload-animation"> <div class="p-6 bg-(--license-block-bg) rounded-xl"> <div class="flex flex-col sm:flex-row items-center justify-between gap-4"> <div class="flex items-center gap-3 flex-1"> <div class="h-12 w-12 rounded-lg bg-(--primary) flex items-center justify-center text-white dark:text-black/70 shrink-0"> <svg width="1em" height="1em" viewBox="0 0 24 24" class="text-2xl" data-icon="material-symbols:favorite">   <use href="#ai:material-symbols:favorite"></use>  </svg> </div> <div> <h3 class="text-lg font-semibold text-neutral-900 dark:text-neutral-100 mb-1"> 支持与分享 </h3> <p class="text-sm text-neutral-600 dark:text-neutral-400"> 如果这篇文章对你有帮助，欢迎分享给更多人或赞助支持！ </p> </div> </div> <div class="flex items-center gap-3"> <astro-island uid="Z2sv3xr" component-url="/_astro/SharePoster.BmOcK7J4.js" component-export="default" renderer-url="/_astro/client.svelte.C7wO1dt2.js" props="{&quot;title&quot;:[0,&quot;基础数据结构 线段树&quot;],&quot;author&quot;:[0,&quot;JustPureH&lt;sub&gt;2&lt;/sub&gt;O&quot;],&quot;description&quot;:[0,&quot;基础数据结构 线段树&quot;],&quot;pubDate&quot;:[0,&quot;2024-08-08&quot;],&quot;coverImage&quot;:[0,&quot;https://cdn.luogu.com.cn/upload/image_hosting/qvw4aoyc.png&quot;],&quot;url&quot;:[0,&quot;https://justpureh2o.cn/articles/48920/&quot;],&quot;siteTitle&quot;:[0,&quot;JustPureH2O 的博客&quot;],&quot;avatar&quot;:[0,&quot;/_astro/avatar.CoDEkAKE.jpg&quot;]}" ssr client="load" opts="{&quot;name&quot;:&quot;SharePoster&quot;,&quot;value&quot;:true}" await-children><!--[--><button class="btn-regular rounded-lg h-12 px-6 gap-2 hover:scale-105 active:scale-95 whitespace-nowrap" aria-label="Generate Share Poster"><!--[--><span class="inline-icon inline-flex items-center justify-center text-base svelte-ktjbt7" aria-hidden="true"><!----><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><path fill="currentColor" d="M17 22q-1.25 0-2.125-.875T14 19q0-.15.075-.7L7.05 14.2q-.4.375-.925.588T5 15q-1.25 0-2.125-.875T2 12t.875-2.125T5 9q.6 0 1.125.213t.925.587l7.025-4.1q-.05-.175-.062-.337T14 5q0-1.25.875-2.125T17 2t2.125.875T20 5t-.875 2.125T17 8q-.6 0-1.125-.213T14.95 7.2l-7.025 4.1q.05.175.063.338T8 12t-.012.363t-.063.337l7.025 4.1q.4-.375.925-.587T17 16q1.25 0 2.125.875T20 19t-.875 2.125T17 22"/></svg><!----></span><!--]--><!----> <span>分享</span></button> <!--[!--><!--]--><!--]--><!--astro:end--></astro-island> <a href="/sponsor/" class="inline-flex items-center gap-2 px-6 py-3 bg-(--primary) text-white dark:text-black/70 rounded-lg font-medium hover:bg-(--primary)/80 hover:scale-105 active:scale-95 transition-all whitespace-nowrap"> <span>赞助</span> <svg width="1em" height="1em" class="text-sm" data-icon="fa7-solid:arrow-right">   <symbol id="ai:fa7-solid:arrow-right" viewBox="0 0 640 640"><path fill="currentColor" d="M566.6 342.6c12.5-12.5 12.5-32.8 0-45.3l-160-160c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L466.7 288H96c-17.7 0-32 14.3-32 32s14.3 32 32 32h370.7L361.3 457.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0l160-160z"/></symbol><use href="#ai:fa7-solid:arrow-right"></use>  </svg> </a> </div> </div> </div> </div> <div class="relative transition overflow-hidden bg-(--license-block-bg) py-5 px-6 mb-6 rounded-xl license-container onload-animation"> <div class="transition font-bold text-black/75 dark:text-white/75"> 基础数据结构 线段树 </div> <a href="https://justpureh2o.cn/articles/48920/" class="link text-(--primary)"> https://justpureh2o.cn/articles/48920/ </a> <div class="flex gap-6 mt-2"> <div> <div class="transition text-black/30 dark:text-white/30 text-sm"> 作者 </div> <div class="transition text-black/75 dark:text-white/75 line-clamp-2"> JustPureH<sub>2</sub>O </div> </div> <div> <div class="transition text-black/30 dark:text-white/30 text-sm"> 发布于 </div> <div class="transition text-black/75 dark:text-white/75 line-clamp-2"> 2024-08-08 </div> </div> <div> <div class="transition text-black/30 dark:text-white/30 text-sm"> 许可协议 </div> <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" class="link text-(--primary) line-clamp-2">CC BY-NC-SA 4.0</a> </div> </div> <svg width="1em" height="1em" class="transition text-[15rem] absolute pointer-events-none right-6 top-1/2 -translate-y-1/2 text-black/5 dark:text-white/5" data-icon="fa7-brands:creative-commons">   <symbol id="ai:fa7-brands:creative-commons" viewBox="0 0 640 640"><path fill="currentColor" d="m317.8 278.9l-33.2 17.3c-9.4-19.6-25.2-19.9-27.5-19.9c-22.1 0-33.2 14.6-33.2 43.8c0 23.6 9.2 43.8 33.2 43.8c14.5 0 24.6-7.1 30.6-21.3l30.6 15.5c-6.2 11.5-25.7 39-65.1 39c-22.6 0-74-10.3-74-77c0-58.7 43-77.1 72.6-77.1c30.7 0 52.7 11.9 66 35.9m143 0L428 296.2c-9.5-19.8-25.7-19.9-27.9-19.9c-22.1 0-33.2 14.6-33.2 43.8c0 23.5 9.2 43.8 33.2 43.8c14.4 0 24.6-7.1 30.5-21.3l31 15.5c-2.1 3.8-21.4 39-65.1 39c-22.7 0-74-9.9-74-77c0-58.7 43-77.1 72.6-77.1c30.7 0 52.6 11.9 65.6 35.9zM319.6 72C176.7 72 72 187.1 72 320.1c0 138.4 113.6 248 247.6 248c129.9 0 248.4-100.9 248.4-248C568 182.2 461.4 72 319.6 72m.9 450.8c-112.5 0-203.7-93-203.7-202.8c0-105.4 85.4-203.3 203.7-203.3c112.5 0 202.8 89.5 202.8 203.3c0 121.7-99.7 202.8-202.8 202.8"/></symbol><use href="#ai:fa7-brands:creative-commons"></use>  </svg> </div> </div> </div>  <div class="card-base p-6 mb-4"> <div class="flex items-center gap-2"> <div class="transition h-9 w-9 rounded-lg overflow-hidden relative flex items-center justify-center mr-0"> <svg width="1em" height="1em" class="text-4xl text-(--primary) transition-transform group-hover:translate-x-0.5 bg-(--enter-btn-bg) p-2 rounded-md" data-icon="material-symbols:history-rounded">   <symbol id="ai:material-symbols:history-rounded" viewBox="0 0 24 24"><path fill="currentColor" d="M12 21q-3.15 0-5.575-1.912T3.275 14.2q-.1-.375.15-.687t.675-.363q.4-.05.725.15t.45.6q.6 2.25 2.475 3.675T12 19q2.925 0 4.963-2.037T19 12t-2.037-4.962T12 5q-1.725 0-3.225.8T6.25 8H8q.425 0 .713.288T9 9t-.288.713T8 10H4q-.425 0-.712-.288T3 9V5q0-.425.288-.712T4 4t.713.288T5 5v1.35q1.275-1.6 3.113-2.475T12 3q1.875 0 3.513.713t2.85 1.924t1.925 2.85T21 12t-.712 3.513t-1.925 2.85t-2.85 1.925T12 21m1-9.4l2.5 2.5q.275.275.275.7t-.275.7t-.7.275t-.7-.275l-2.8-2.8q-.15-.15-.225-.337T11 11.975V8q0-.425.288-.712T12 7t.713.288T13 8z"/></symbol><use href="#ai:material-symbols:history-rounded"></use>  </svg> </div> <div class="flex flex-col gap-0.1"> <div class="text-[1.0rem] leading-tight text-black/75 dark:text-white/75"> 最后更新于 2024-11-27，距今已过 452 天 </div> <p class="text-[0.8rem] leading-tight text-black/75 dark:text-white/75"> 部分内容可能已过时 </p> </div> </div> </div><div class="flex flex-col md:flex-row justify-between mb-4 gap-4 overflow-hidden w-full"> <a href="/articles/53799/" class="w-full font-bold overflow-hidden active:scale-95"> <div class="btn-card rounded-2xl w-full h-15 max-w-full px-4 flex items-center justify-start! gap-4"> <svg width="1em" height="1em" class="text-[2rem] text-(--primary)" data-icon="material-symbols:chevron-left-rounded">   <symbol id="ai:material-symbols:chevron-left-rounded" viewBox="0 0 24 24"><path fill="currentColor" d="m10.8 12l3.9 3.9q.275.275.275.7t-.275.7t-.7.275t-.7-.275l-4.6-4.6q-.15-.15-.212-.325T8.425 12t.063-.375t.212-.325l4.6-4.6q.275-.275.7-.275t.7.275t.275.7t-.275.7z"/></symbol><use href="#ai:material-symbols:chevron-left-rounded"></use>  </svg> <div class="overflow-hidden transition text-ellipsis whitespace-nowrap max-w-[calc(100%-3rem)] text-black/75 dark:text-white/75"> [熟肉] 一棵主席树新增了一个数据，这是它的结构发生的变化 </div> </div> </a> <a href="/articles/12494/" class="w-full font-bold overflow-hidden active:scale-95"> <div class="btn-card rounded-2xl w-full h-15 max-w-full px-4 flex items-center justify-end! gap-4"> <div class="overflow-hidden transition text-ellipsis whitespace-nowrap max-w-[calc(100%-3rem)] text-black/75 dark:text-white/75"> 图论 欧拉图 </div> <svg width="1em" height="1em" viewBox="0 0 24 24" class="text-[2rem] text-(--primary)" data-icon="material-symbols:chevron-right-rounded">   <use href="#ai:material-symbols:chevron-right-rounded"></use>  </svg> </div> </a> </div>  <div class="card-base p-8 mb-6 relative overflow-hidden"><!-- 评论区装饰性背景 --><div class="absolute top-0 right-0 w-32 h-32 opacity-5 pointer-events-none"><svg viewBox="0 0 100 100" class="w-full h-full"><circle cx="50" cy="50" r="40" fill="currentColor" class="text-(--primary)"></circle><circle cx="50" cy="50" r="25" fill="none" stroke="currentColor" stroke-width="2" class="text-(--primary)"></circle><circle cx="50" cy="50" r="10" fill="currentColor" class="text-(--primary)"></circle></svg></div><!-- 评论区标题 --><div class="relative z-10 mb-6"><div class="flex items-center gap-3 mb-2"><div class="w-1 h-6 bg-linear-to-b from-(--primary) to-transparent rounded-full"></div><h3 class="text-xl font-bold text-(--btn-content)">评论区</h3></div><p class="text-sm text-(--content-meta) ml-4">分享你的想法，与大家交流讨论</p></div><!-- 评论内容区域 --><div class="relative z-10"><div id="tcomment"></div> <!-- 使用自编译的 Twikoo 文件，避免点赞等按钮导致页面触发滚动回顶部 https://github.com/twikoojs/twikoo/issues/721 --> <script src="/assets/js/firefly-twikoo-1.6.44.all.min.js"></script> <script>(function(){const config = {"envId":"https://commentdb.justpureh2o.cn","lang":"zh-CN","visitorCount":true,"el":"#tcomment","path":"/articles/48920"};

  // 获取当前页面路径
  function getCurrentPath() {
    const pathname = window.location.pathname;
    return pathname.endsWith("/") && pathname.length > 1
      ? pathname.slice(0, -1)
      : pathname;
  }

  // 动态创建配置对象
  function createTwikooConfig() {
    return {
      ...config,
      path: getCurrentPath(),
      el: "#tcomment",
    };
  }

  // 初始化 Twikoo
  function initTwikoo() {
    if (typeof twikoo !== "undefined") {
      const commentEl = document.getElementById("tcomment");
      if (commentEl) {
        commentEl.innerHTML = "";

        const dynamicConfig = createTwikooConfig();
        console.log("[Twikoo] 初始化配置:", dynamicConfig);

        twikoo
          .init(dynamicConfig)
          .then(() => {
            console.log("[Twikoo] 初始化完成");
          })
          .catch((error) => {
            console.error("[Twikoo] 初始化失败:", error);
          });
      }
    } else {
      // 如果 Twikoo 未加载，稍后重试
      setTimeout(initTwikoo, 500);
    }
  }

  // 页面加载时初始化
  document.addEventListener("DOMContentLoaded", initTwikoo);

  // Swup 页面切换后重新初始化
  if (window.swup && window.swup.hooks) {
    window.swup.hooks.on("content:replace", function () {
      setTimeout(initTwikoo, 200);
    });
  } else {
    document.addEventListener("swup:enable", function () {
      if (window.swup && window.swup.hooks) {
        window.swup.hooks.on("content:replace", function () {
          setTimeout(initTwikoo, 200);
        });
      }
    });
  }

  // 自定义事件监听
  document.addEventListener("firefly:page:loaded", function () {
    const commentEl = document.getElementById("tcomment");
    if (commentEl) {
      console.log("[Twikoo] 通过自定义事件重新初始化");
      initTwikoo();
    }
  });
})();</script></div></div> </div> </main>   <script type="module" src="/_astro/SidebarTOC.astro_astro_type_script_index_0_lang.CBN-kGT8.js"></script> <div id="right-sidebar-static" class="contents"> <div id="right-sidebar" class="mb-4 hidden xl:block xl:row-start-1 xl:row-end-2 xl:col-span-1 xl:max-w-70 onload-animation xl:col-start-3  flex flex-col w-full pt-0"><div class="flex flex-col w-full gap-4 mb-4"><widget-layout data-id="site-stats" data-is-collapsed="undefined" class="pb-4 card-base onload-animation" style="animation-delay: 0ms; " data-astro-cid-wbzkcah3="true"> <div class="widget-title font-bold transition text-lg text-neutral-900 dark:text-neutral-100 relative ml-8 mt-4 mb-2
            before:w-1 before:h-4 before:rounded-md before:bg-(--primary)
            before:absolute before:left-[-16px] before:top-[5.5px] flex items-center justify-between" data-astro-cid-wbzkcah3 style=""> <span class="widget-name" data-astro-cid-wbzkcah3 style="">站点统计</span>  </div> <div id="site-stats" class="collapse-wrapper px-4 overflow-hidden" data-astro-cid-wbzkcah3 style="">  <div class="flex flex-col gap-2"> <div class="flex items-center justify-between px-3 py-1.5"> <div class="flex items-center gap-2.5"> <div class="text-(--primary) text-xl"> <svg width="1em" height="1em" data-icon="material-symbols:article-outline">   <symbol id="ai:material-symbols:article-outline" viewBox="0 0 24 24"><path fill="currentColor" d="M7 17h7v-2H7zm0-4h10v-2H7zm0-4h10V7H7zM5 21q-.825 0-1.412-.587T3 19V5q0-.825.588-1.412T5 3h14q.825 0 1.413.588T21 5v14q0 .825-.587 1.413T19 21zm0-2h14V5H5zM5 5v14z"/></symbol><use href="#ai:material-symbols:article-outline"></use>  </svg> </div> <span class="text-neutral-700 dark:text-neutral-300 font-medium text-sm"> 文章 </span> </div> <div class="flex items-center"> <span class="text-base font-bold text-neutral-900 dark:text-neutral-100"> 66 </span>  </div> </div><div class="flex items-center justify-between px-3 py-1.5"> <div class="flex items-center gap-2.5"> <div class="text-(--primary) text-xl"> <svg width="1em" height="1em" data-icon="material-symbols:folder-outline">   <symbol id="ai:material-symbols:folder-outline" viewBox="0 0 24 24"><path fill="currentColor" d="M4 20q-.825 0-1.412-.587T2 18V6q0-.825.588-1.412T4 4h6l2 2h8q.825 0 1.413.588T22 8v10q0 .825-.587 1.413T20 20zm0-2h16V8h-8.825l-2-2H4zm0 0V6z"/></symbol><use href="#ai:material-symbols:folder-outline"></use>  </svg> </div> <span class="text-neutral-700 dark:text-neutral-300 font-medium text-sm"> 分类 </span> </div> <div class="flex items-center"> <span class="text-base font-bold text-neutral-900 dark:text-neutral-100"> 11 </span>  </div> </div><div class="flex items-center justify-between px-3 py-1.5"> <div class="flex items-center gap-2.5"> <div class="text-(--primary) text-xl"> <svg width="1em" height="1em" data-icon="material-symbols:label-outline">   <symbol id="ai:material-symbols:label-outline" viewBox="0 0 24 24"><path fill="currentColor" d="M4 20q-.825 0-1.412-.587T2 18V6q0-.825.588-1.412T4 4h11q.475 0 .9.213t.7.587L22 12l-5.4 7.2q-.275.375-.7.588T15 20zm0-2h11l4.5-6L15 6H4zm5.5-6"/></symbol><use href="#ai:material-symbols:label-outline"></use>  </svg> </div> <span class="text-neutral-700 dark:text-neutral-300 font-medium text-sm"> 标签 </span> </div> <div class="flex items-center"> <span class="text-base font-bold text-neutral-900 dark:text-neutral-100"> 46 </span>  </div> </div><div class="flex items-center justify-between px-3 py-1.5"> <div class="flex items-center gap-2.5"> <div class="text-(--primary) text-xl"> <svg width="1em" height="1em" data-icon="material-symbols:text-ad-outline-rounded">   <symbol id="ai:material-symbols:text-ad-outline-rounded" viewBox="0 0 24 24"><path fill="currentColor" d="M4 20q-.825 0-1.412-.587T2 18V6q0-.825.588-1.412T4 4h16q.825 0 1.413.588T22 6v12q0 .825-.587 1.413T20 20zm0-2h16V6H4zm0 0V6zm2-1h12q.425 0 .713-.288T19 16t-.288-.712T18 15H6q-.425 0-.712.288T5 16t.288.713T6 17m0-4h12q.425 0 .713-.288T19 12t-.288-.712T18 11H6q-.425 0-.712.288T5 12t.288.713T6 13m0-4h8q.425 0 .713-.288T15 8t-.288-.712T14 7H6q-.425 0-.712.288T5 8t.288.713T6 9"/></symbol><use href="#ai:material-symbols:text-ad-outline-rounded"></use>  </svg> </div> <span class="text-neutral-700 dark:text-neutral-300 font-medium text-sm"> 总字数 </span> </div> <div class="flex items-center"> <span class="text-base font-bold text-neutral-900 dark:text-neutral-100"> 263,037 </span>  </div> </div><div class="flex items-center justify-between px-3 py-1.5"> <div class="flex items-center gap-2.5"> <div class="text-(--primary) text-xl"> <svg width="1em" height="1em" data-icon="material-symbols:calendar-clock-outline">   <symbol id="ai:material-symbols:calendar-clock-outline" viewBox="0 0 24 24"><path fill="currentColor" d="M5 8h14V6H5zm0 0V6zm0 14q-.825 0-1.412-.587T3 20V6q0-.825.588-1.412T5 4h1V2h2v2h8V2h2v2h1q.825 0 1.413.588T21 6v5.675q-.475-.225-.975-.375T19 11.075V10H5v10h6.3q.175.55.413 1.05t.562.95zm13 1q-2.075 0-3.537-1.463T13 18t1.463-3.537T18 13t3.538 1.463T23 18t-1.463 3.538T18 23m1.675-2.625l.7-.7L18.5 17.8V15h-1v3.2z"/></symbol><use href="#ai:material-symbols:calendar-clock-outline"></use>  </svg> </div> <span class="text-neutral-700 dark:text-neutral-300 font-medium text-sm"> 运行时长 </span> </div> <div class="flex items-center"> <span class="text-base font-bold text-neutral-900 dark:text-neutral-100" data-stat-id="running-days"> 0 </span> <span class="text-sm text-neutral-500 dark:text-neutral-400 ml-1">  天 </span> </div> </div><div class="flex items-center justify-between px-3 py-1.5"> <div class="flex items-center gap-2.5"> <div class="text-(--primary) text-xl"> <svg width="1em" height="1em" data-icon="material-symbols:ecg-heart-outline">   <symbol id="ai:material-symbols:ecg-heart-outline" viewBox="0 0 24 24"><path fill="currentColor" d="M12 21q-.45 0-.862-.162t-.738-.488l-6.7-6.725q-.875-.875-1.287-2T2 9.275Q2 6.7 3.675 4.85T7.85 3q1.2 0 2.263.475T12 4.8q.8-.85 1.863-1.325T16.125 3q2.5 0 4.188 1.85T22 9.25q0 1.225-.425 2.35t-1.275 2l-6.725 6.75q-.325.325-.725.488T12 21m1-13q.25 0 .475.125t.35.325l1.7 2.55h4.15q.175-.425.263-.862t.087-.888q-.05-1.725-1.15-2.963t-2.75-1.237q-.775 0-1.487.3t-1.238.875l-.675.725q-.125.15-.325.238t-.4.087t-.4-.087t-.35-.238l-.675-.725q-.525-.575-1.225-.9T7.85 5Q6.2 5 5.1 6.263T4 9.25q0 .45.075.888t.25.862H9q.25 0 .475.125t.35.325l.875 1.3l1.35-4.05q.1-.3.362-.5T13 8m.3 3.25l-1.35 4.05q-.1.3-.375.5t-.6.2q-.25 0-.475-.125t-.35-.325L8.45 13H5.9l5.925 5.925q.05.05.088.063T12 19t.088-.012t.087-.063l5.9-5.925H15q-.25 0-.475-.125t-.375-.325z"/></symbol><use href="#ai:material-symbols:ecg-heart-outline"></use>  </svg> </div> <span class="text-neutral-700 dark:text-neutral-300 font-medium text-sm"> 最后活动 </span> </div> <div class="flex items-center"> <span class="text-base font-bold text-neutral-900 dark:text-neutral-100" data-stat-id="last-update"> 0 </span> <span class="text-sm text-neutral-500 dark:text-neutral-400 ml-1">  天前 </span> </div> </div> </div>  </div>  </widget-layout>   <script>(function(){const siteStartDate = "2023-10-26";
const lastPostDate = "2026-02-21T00:00:00.000Z";
const todayText = "今天";

  function updateDynamicStats() {
    const today = new Date();

    // 更新运行天数
    const startDate = new Date(siteStartDate);
    const diffTime = Math.abs(today.getTime() - startDate.getTime());
    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

    const runningDaysElements = document.querySelectorAll('[data-stat-id="running-days"]');
    runningDaysElements.forEach((element) => {
      element.textContent = diffDays.toString();
    });

    // 更新最后活动时间
    if (lastPostDate) {
      const lastPost = new Date(lastPostDate);
      const timeSinceLastPost = Math.abs(today.getTime() - lastPost.getTime());
      const daysSinceLastUpdate = Math.floor(timeSinceLastPost / (1000 * 60 * 60 * 24));

      const lastUpdateElements = document.querySelectorAll('[data-stat-id="last-update"]');
      lastUpdateElements.forEach((element) => {
        if (daysSinceLastUpdate === 0) {
          element.textContent = todayText;
          if (element.nextElementSibling) {
            element.nextElementSibling.style.display = 'none';
          }
        } else {
          element.textContent = daysSinceLastUpdate.toString();
          if (element.nextElementSibling) {
            element.nextElementSibling.style.display = '';
          }
        }
      });
    }
  }

  // 页面加载时更新
  updateDynamicStats();

  // 页面切换时重新更新
  document.addEventListener("swup:contentReplaced", () => {
    setTimeout(updateDynamicStats, 100);
  });
})();</script></div><div id="right-sidebar-sticky" class="transition-all duration-700 flex flex-col w-full mt-0 sticky top-4 gap-4"><widget-layout data-id="calendar-widget" data-is-collapsed="undefined" class="pb-4 card-base onload-animation widget-hide-on-post" style="animation-delay: 50ms; " data-astro-cid-wbzkcah3="true">  <div id="calendar-widget" class="collapse-wrapper px-4 overflow-hidden pt-4" data-astro-cid-wbzkcah3 style="">  <div class="calendar-container" data-astro-cid-o3b4delr> <div class="flex justify-between items-center mb-4" data-astro-cid-o3b4delr> <button id="prev-month-btn" class="btn-plain rounded-lg w-8 h-8 flex items-center justify-center hover:bg-(--btn-plain-bg-hover) transition-colors" aria-label="Previous Month" data-astro-cid-o3b4delr> <svg width="1em" height="1em" class="text-sm" data-astro-cid-o3b4delr="true" data-icon="fa7-solid:chevron-left">   <symbol id="ai:fa7-solid:chevron-left" viewBox="0 0 640 640"><path fill="currentColor" d="M169.4 297.4c-12.5 12.5-12.5 32.8 0 45.3l192 192c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L237.3 320l169.3-169.4c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-192 192z"/></symbol><use href="#ai:fa7-solid:chevron-left"></use>  </svg> </button> <div id="current-month-display" class="text-lg font-bold text-neutral-900 dark:text-neutral-100 cursor-pointer hover:text-(--primary) transition-colors select-none" data-astro-cid-o3b4delr></div> <div class="flex gap-2" data-astro-cid-o3b4delr> <button id="reset-month-btn" class="btn-plain rounded-lg w-8 h-8 flex items-center justify-center hover:bg-(--btn-plain-bg-hover) transition-colors" aria-label="Back to Today" data-astro-cid-o3b4delr> <svg width="1em" height="1em" class="text-sm" data-astro-cid-o3b4delr="true" data-icon="fa7-solid:arrow-rotate-left">   <symbol id="ai:fa7-solid:arrow-rotate-left" viewBox="0 0 640 640"><path fill="currentColor" d="M320 128c-56.8 0-107.9 24.7-143.1 64H224c17.7 0 32 14.3 32 32s-14.3 32-32 32H96c-17.7 0-32-14.3-32-32V96c0-17.7 14.3-32 32-32s32 14.3 32 32v54.7C174.9 97.6 243.5 64 320 64c141.4 0 256 114.6 256 256S461.4 576 320 576c-87 0-163.9-43.4-210.1-109.7c-10.1-14.5-6.6-34.4 7.9-44.6s34.4-6.6 44.6 7.9c34.8 49.8 92.4 82.3 157.6 82.3c106 0 192-86 192-192S426 128 320 128"/></symbol><use href="#ai:fa7-solid:arrow-rotate-left"></use>  </svg> </button> <button id="next-month-btn" class="btn-plain rounded-lg w-8 h-8 flex items-center justify-center hover:bg-(--btn-plain-bg-hover) transition-colors" aria-label="Next Month" data-astro-cid-o3b4delr> <svg width="1em" height="1em" class="text-sm" data-astro-cid-o3b4delr="true" data-icon="fa7-solid:chevron-right">   <symbol id="ai:fa7-solid:chevron-right" viewBox="0 0 640 640"><path fill="currentColor" d="M471.1 297.4c12.5 12.5 12.5 32.8 0 45.3l-192 192c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L403.2 320L233.9 150.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l192 192z"/></symbol><use href="#ai:fa7-solid:chevron-right"></use>  </svg> </button> </div> </div> <!-- 日历视图容器 --> <div id="calendar-view-container" data-astro-cid-o3b4delr> <!-- 星期标题 --> <div class="weekdays grid grid-cols-7 gap-1 mb-2" data-astro-cid-o3b4delr> <div class="text-center text-xs text-neutral-500 dark:text-neutral-400 font-medium" data-astro-cid-o3b4delr> 日 </div><div class="text-center text-xs text-neutral-500 dark:text-neutral-400 font-medium" data-astro-cid-o3b4delr> 一 </div><div class="text-center text-xs text-neutral-500 dark:text-neutral-400 font-medium" data-astro-cid-o3b4delr> 二 </div><div class="text-center text-xs text-neutral-500 dark:text-neutral-400 font-medium" data-astro-cid-o3b4delr> 三 </div><div class="text-center text-xs text-neutral-500 dark:text-neutral-400 font-medium" data-astro-cid-o3b4delr> 四 </div><div class="text-center text-xs text-neutral-500 dark:text-neutral-400 font-medium" data-astro-cid-o3b4delr> 五 </div><div class="text-center text-xs text-neutral-500 dark:text-neutral-400 font-medium" data-astro-cid-o3b4delr> 六 </div> </div> <!-- 日历格子（由客户端动态生成） --> <div class="calendar-grid grid grid-cols-7 gap-1" id="calendar-grid" data-astro-cid-o3b4delr> <!-- 将由 JavaScript 填充 --> </div> </div> <!-- 月份选择视图 --> <div id="month-view-container" class="hidden grid grid-cols-3 gap-2" data-astro-cid-o3b4delr> <!-- 将由 JavaScript 填充 --> </div> <!-- 年份选择视图 --> <div id="year-view-container" class="hidden grid grid-cols-3 gap-2" data-astro-cid-o3b4delr> <!-- 将由 JavaScript 填充 --> </div> <!-- 文章列表 --> <div id="calendar-posts" class="mt-3" data-astro-cid-o3b4delr> <div class="border-t border-neutral-200 dark:border-neutral-700 mb-2" id="calendar-posts-divider" style="display: none;" data-astro-cid-o3b4delr></div> <div class="flex flex-col gap-1" id="calendar-posts-list" data-astro-cid-o3b4delr> <!-- 将由 JavaScript 填充 --> </div> </div> </div>  </div>  </widget-layout>   <script>(function(){const monthNames = ["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"];
const weekDays = ["日","一","二","三","四","五","六"];
const yearText = "年";
const currentLang = "zh_CN";
const calendarDataUrl = "/api/calendar.json";
const postUrlPrefix = "/articles/";

  // State variables
  let displayYear = new Date().getFullYear();
  let displayMonth = new Date().getMonth();
  let currentView = 'day'; // 'day' | 'month' | 'year'
  let postDateMap = {};
  let allPostsData = [];
  let availableYears = [];

  async function fetchData() {
    try {
      const response = await fetch(calendarDataUrl);
      allPostsData = await response.json();
      
      // Reconstruct postDateMap and availableYears
      postDateMap = {};
      const yearsSet = new Set();
      allPostsData.forEach(post => {
        const date = new Date(post.published);
        const dateKey = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, "0")}-${String(date.getDate()).padStart(2, "0")}`;
        if (!postDateMap[dateKey]) {
          postDateMap[dateKey] = [];
        }
        postDateMap[dateKey].push({ id: post.id, title: post.title, published: post.published });
        yearsSet.add(date.getFullYear());
      });
      
      availableYears = Array.from(yearsSet).sort((a, b) => b - a);
      
      renderCalendar();
    } catch (error) {
      console.error("Failed to fetch calendar data", error);
    }
  }

  // 客户端动态渲染日历
  function renderCalendar() {
    const container = document.getElementById('calendar-view-container');
    const monthContainer = document.getElementById('month-view-container');
    const yearContainer = document.getElementById('year-view-container');
    const postsContainer = document.getElementById('calendar-posts');
    
    // Update visibility
    if (container) container.style.display = currentView === 'day' ? 'block' : 'none';
    if (monthContainer) monthContainer.style.display = currentView === 'month' ? 'grid' : 'none';
    if (yearContainer) yearContainer.style.display = currentView === 'year' ? 'grid' : 'none';
    if (postsContainer) postsContainer.style.display = currentView === 'day' ? 'block' : 'none';

    updateHeader();

    if (currentView === 'day') {
      renderDayView();
    } else if (currentView === 'month') {
      renderMonthView();
    } else if (currentView === 'year') {
      renderYearView();
    }
  }

  function updateHeader() {
    const navDisplay = document.getElementById('current-month-display');
    const resetBtn = document.getElementById('reset-month-btn');
    const prevBtn = document.getElementById('prev-month-btn');
    const nextBtn = document.getElementById('next-month-btn');
    
    if (navDisplay) {
      if (currentView === 'day') {
        if (currentLang.startsWith('zh') || currentLang.startsWith('ja')) {
            navDisplay.textContent = `${displayYear}${yearText}${monthNames[displayMonth]}`;
        } else {
            navDisplay.textContent = `${monthNames[displayMonth]} ${displayYear}`;
        }
      } else if (currentView === 'month') {
        navDisplay.textContent = `${displayYear}${yearText}`;
      } else if (currentView === 'year') {
        navDisplay.textContent = yearText;
      }
    }

    if (resetBtn) {
      const now = new Date();
      const isCurrent = displayYear === now.getFullYear() && displayMonth === now.getMonth();
      resetBtn.style.display = (currentView === 'day' && isCurrent) ? 'none' : 'flex';
    }
    
    // Hide prev/next buttons in year view as we show all years
    if (prevBtn) prevBtn.style.visibility = currentView === 'year' ? 'hidden' : 'visible';
    if (nextBtn) nextBtn.style.visibility = currentView === 'year' ? 'hidden' : 'visible';
  }

  function renderDayView() {
    const now = new Date();
    const currentYear = displayYear;
    const currentMonth = displayMonth;
    const currentDate = now.getDate();
    const isCurrentMonth = currentYear === now.getFullYear() && currentMonth === now.getMonth();
    
    // 获取月份的第一天是星期几
    const firstDayOfMonth = new Date(currentYear, currentMonth, 1).getDay();
    
    // 获取当月天数
    const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
    
    // 生成日历格子
    const calendarGrid = document.getElementById('calendar-grid');
    if (!calendarGrid) return;
    
    const calendarDays = [];
    
    // 添加空白格子（月初空白）
    for (let i = 0; i < firstDayOfMonth; i++) {
      calendarDays.push({ day: null, hasPost: false, count: 0, dateKey: "" });
    }
    
    // 添加每一天
    for (let day = 1; day <= daysInMonth; day++) {
      const dateKey = `${currentYear}-${String(currentMonth + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
      const posts = postDateMap[dateKey] || [];
      const count = posts.length;
      calendarDays.push({
        day,
        hasPost: count > 0,
        count,
        dateKey
      });
    }
    
    // 渲染日历格子
    calendarGrid.innerHTML = calendarDays.map(({day, hasPost, count, dateKey}) => {
      const isToday = day === currentDate && isCurrentMonth;
      const classes = [
        "calendar-day aspect-square flex items-center justify-center rounded text-sm relative cursor-pointer"
      ];
      
      if (!day) {
        classes.push("text-neutral-400 dark:text-neutral-600");
      } else if (!hasPost) {
        classes.push("text-neutral-700 dark:text-neutral-300");
      } else {
        classes.push("text-neutral-900 dark:text-neutral-100 font-bold");
      }
      
      if (isToday) {
        classes.push("ring-2 ring-(--primary)");
      }
      
      return `
        <div
          class="${classes.join(' ')}"
          data-date="${dateKey}"
          data-has-post="${hasPost}"
        >
          ${day || ''}
          ${hasPost ? '<span class="absolute bottom-0 left-1/2 -translate-x-1/2 w-1 h-1 rounded-full bg-(--primary)"></span>' : ''}
          ${hasPost && count > 1 ? `<span class="absolute top-0 right-0 text-[10px] text-(--primary) font-bold">${count}</span>` : ''}
        </div>
      `;
    }).join('');
    
    // 获取当月所有文章
    const currentMonthPosts = allPostsData.filter(post => {
      const date = new Date(post.published);
      return date.getFullYear() === currentYear && date.getMonth() === currentMonth;
    });
    
    // 显示当月文章列表
    showMonthlyPosts(currentMonthPosts);
    
    // 添加点击事件监听
    setupClickHandlers(currentMonthPosts);
  }

  function renderMonthView() {
    const container = document.getElementById('month-view-container');
    if (!container) return;

    // Calculate which months have posts for the currently displayed year
    const monthsWithPosts = new Set();
    allPostsData.forEach(post => {
        const date = new Date(post.published);
        if (date.getFullYear() === displayYear) {
            monthsWithPosts.add(date.getMonth());
        }
    });

    container.innerHTML = monthNames.map((name, index) => {
      const isCurrent = index === displayMonth;
      const hasPost = monthsWithPosts.has(index);
      const classes = [
        "p-2 text-center text-sm rounded cursor-pointer hover:bg-(--btn-plain-bg-hover) transition-colors relative"
      ];
      if (isCurrent) {
        classes.push("text-(--primary) font-bold bg-(--btn-plain-bg-hover)");
      } else {
        classes.push("text-neutral-700 dark:text-neutral-300");
      }
      
      const dotHtml = hasPost ? '<span class="absolute bottom-1 left-1/2 -translate-x-1/2 w-1 h-1 rounded-full bg-(--primary)"></span>' : '';
      
      return `<div class="${classes.join(' ')}" data-month="${index}">${name}${dotHtml}</div>`;
    }).join('');

    container.querySelectorAll('[data-month]').forEach(el => {
      el.addEventListener('click', () => {
        displayMonth = parseInt(el.getAttribute('data-month'));
        currentView = 'day';
        renderCalendar();
      });
    });
  }

  function renderYearView() {
    const container = document.getElementById('year-view-container');
    if (!container) return;

    container.innerHTML = availableYears.map(year => {
      const isCurrent = year === displayYear;
      const classes = [
        "p-2 text-center text-sm rounded cursor-pointer hover:bg-(--btn-plain-bg-hover) transition-colors"
      ];
      if (isCurrent) {
        classes.push("text-(--primary) font-bold bg-(--btn-plain-bg-hover)");
      } else {
        classes.push("text-neutral-700 dark:text-neutral-300");
      }
      return `<div class="${classes.join(' ')}" data-year="${year}">${year}</div>`;
    }).join('');

    container.querySelectorAll('[data-year]').forEach(el => {
      el.addEventListener('click', () => {
        displayYear = parseInt(el.getAttribute('data-year'));
        currentView = 'month';
        renderCalendar();
      });
    });
  }
  
  // 显示当月所有文章
  function showMonthlyPosts(currentMonthPosts) {
    const postsList = document.getElementById('calendar-posts-list');
    const divider = document.getElementById('calendar-posts-divider');
    
    if (postsList) {
      postsList.innerHTML = currentMonthPosts.map(post => {
        const date = new Date(post.published);
        const dateStr = `${date.getMonth() + 1}-${date.getDate()}`;
        return `
        <a href="${postUrlPrefix}${post.id}/" class="flex justify-between items-center text-sm text-neutral-700 dark:text-neutral-300 hover:text-(--primary) dark:hover:text-(--primary) transition-colors px-2 py-1 rounded hover:bg-(--btn-plain-bg-hover)">
          <span class="truncate">${post.title}</span>
          <span class="text-xs text-neutral-500 dark:text-neutral-400 ml-2 whitespace-nowrap">${dateStr}</span>
        </a>
      `}).join('');
      
      // 显示/隐藏分割线
      if (divider) {
        divider.style.display = currentMonthPosts.length > 0 ? 'block' : 'none';
      }
    }
  }
  
  // 设置日历格子点击事件
  function setupClickHandlers(currentMonthPosts) {
    const calendarDays = document.querySelectorAll('.calendar-day[data-date]');
    const postsList = document.getElementById('calendar-posts-list');
    const divider = document.getElementById('calendar-posts-divider');
    
    let currentSelectedDay = null;
    
    calendarDays.forEach(dayElement => {
      dayElement.addEventListener('click', () => {
        const dateKey = dayElement.getAttribute('data-date');
        const hasPost = dayElement.getAttribute('data-has-post') === 'true';
        
        if (!hasPost || !dateKey) return;
        
        // 切换选中状态
        if (currentSelectedDay === dayElement) {
          // 取消选中，恢复显示当月所有文章
          dayElement.classList.remove('calendar-day-selected');
          currentSelectedDay = null;
          showMonthlyPosts(currentMonthPosts);
          return;
        }
        
        // 移除之前选中的样式
        if (currentSelectedDay) {
          currentSelectedDay.classList.remove('calendar-day-selected');
        }
        
        // 添加选中样式
        dayElement.classList.add('calendar-day-selected');
        currentSelectedDay = dayElement;
        
        // 获取该日期的文章
        const posts = postDateMap[dateKey] || [];
        
        if (posts.length > 0 && postsList) {
          // 渲染文章列表
          postsList.innerHTML = posts.map(post => {
            const date = new Date(post.published);
            const dateStr = `${date.getMonth() + 1}-${date.getDate()}`;
            return `
            <a href="${postUrlPrefix}${post.id}/" class="flex justify-between items-center text-sm text-neutral-700 dark:text-neutral-300 hover:text-(--primary) dark:hover:text-(--primary) transition-colors px-2 py-1 rounded hover:bg-(--btn-plain-bg-hover)">
              <span class="truncate">${post.title}</span>
              <span class="text-xs text-neutral-500 dark:text-neutral-400 ml-2 whitespace-nowrap">${dateStr}</span>
            </a>
          `}).join('');
          
          // 显示分割线
          if (divider) {
            divider.style.display = 'block';
          }
        }
      });
    });
  }

  function changeMonth(delta) {
    if (currentView === 'day') {
      displayMonth += delta;
      if (displayMonth > 11) {
          displayMonth = 0;
          displayYear++;
      } else if (displayMonth < 0) {
          displayMonth = 11;
          displayYear--;
      }
    } else if (currentView === 'month') {
      displayYear += delta;
    }
    renderCalendar();
  }

  function resetToToday() {
      const now = new Date();
      displayYear = now.getFullYear();
      displayMonth = now.getMonth();
      currentView = 'day';
      renderCalendar();
  }

  function initCalendar() {
      // Reset to current date on init
      const now = new Date();
      displayYear = now.getFullYear();
      displayMonth = now.getMonth();
      
      fetchData();
      
      // Bind events
      const prevBtn = document.getElementById('prev-month-btn');
      const nextBtn = document.getElementById('next-month-btn');
      const resetBtn = document.getElementById('reset-month-btn');
      const navDisplay = document.getElementById('current-month-display');
      
      if (prevBtn) prevBtn.onclick = () => changeMonth(-1);
      if (nextBtn) nextBtn.onclick = () => changeMonth(1);
      if (resetBtn) resetBtn.onclick = () => resetToToday();
      
      if (navDisplay) {
        navDisplay.onclick = () => {
          if (currentView === 'day') {
            currentView = 'month';
          } else if (currentView === 'month') {
            currentView = 'year';
          }
          renderCalendar();
        };
      }
  }
  
  // 页面加载时渲染日历
  initCalendar();

  // 页面切换时重新渲染
  document.addEventListener("swup:contentReplaced", () => {
    setTimeout(initCalendar, 100);
  });
})();</script> <widget-layout data-id="sidebar-toc" data-is-collapsed="undefined" class="pb-4 card-base onload-animation widget-hide-on-non-post" style="animation-delay: 100ms; " data-astro-cid-wbzkcah3="true"> <div class="widget-title font-bold transition text-lg text-neutral-900 dark:text-neutral-100 relative ml-8 mt-4 mb-2
            before:w-1 before:h-4 before:rounded-md before:bg-(--primary)
            before:absolute before:left-[-16px] before:top-[5.5px] flex items-center justify-between" data-astro-cid-wbzkcah3 style=""> <span class="widget-name" data-astro-cid-wbzkcah3 style="">目录</span>  </div> <div id="sidebar-toc" class="collapse-wrapper px-4 overflow-hidden" data-astro-cid-wbzkcah3 style="">  <div class="toc-scroll-container custom-scrollbar" data-astro-cid-lh73owgj> <div class="toc-content" id="sidebar-toc-content" data-astro-cid-lh73owgj> <!-- TOC内容将由JavaScript动态生成 --> </div> </div>  </div>  </widget-layout>    </div></div> </div> <div id="right-sidebar-dynamic" class="hidden transition-swup-fade"></div>   <div id="mobile-bottom-sidebar" class="col-span-1 block md:hidden mt-4"> <div id="bottom-sidebar" class="flex flex-col w-full pt-0"><div class="flex flex-col w-full gap-4"><div class="card-base p-3"> <a aria-label="Go to About Page" href="/about/" class="group block relative mx-auto mt-1 lg:mx-0 lg:mt-0 mb-3
       max-w-48 lg:max-w-none overflow-hidden rounded-xl active:scale-95"> <div class="absolute transition pointer-events-none group-hover:bg-black/30 group-active:bg-black/50
        w-full h-full z-50 flex items-center justify-center"> <svg width="1em" height="1em" viewBox="0 0 640 640" class="transition opacity-0 scale-90 group-hover:scale-100 group-hover:opacity-100 text-white text-5xl" data-icon="fa7-regular:address-card">   <use href="#ai:fa7-regular:address-card"></use>  </svg> </div> <div class="mx-auto lg:w-full h-full lg:mt-0 overflow-hidden relative"> <div class="transition absolute inset-0 dark:bg-black/10 pointer-events-none"></div> <picture> <source srcset="/_astro/avatar.CoDEkAKE_1xljaq.webp 350w" type="image/webp" sizes="350px">  <img src="/_astro/avatar.CoDEkAKE_17E0N3.webp" srcset="/_astro/avatar.CoDEkAKE_1xljaq.webp 350w" alt="Profile Image of the Author" style="--fit: cover; --pos: center; object-position: center" loading="eager" fetchpriority="high" sizes="350px" decoding="async" data-astro-image="constrained" width="940" height="940" class="w-full h-full object-cover"> </picture>   </div> </a> <div class="px-2"> <div class="font-bold text-xl text-center mb-1 dark:text-neutral-50 transition"> <span style="font-family:'Logo','system-ui';font-size:1.75rem;">JustPure<b><span style="color:#0080c0">H</span><sub style="color:#ff9800">2</sub><span style="color:#0080c0">O</span></b></span> </div> <div class="h-1 w-5 bg-(--primary) mx-auto rounded-full mb-2 transition"></div> <div class="text-center text-neutral-400 mb-2.5 transition"> 穷方圆平直之情，尽规矩准绳之用 </div> <div class="flex flex-wrap gap-2 justify-center mb-1"> <a rel="me" aria-label="GitHub" href="https://github.com/JustPureH2O" target="_blank" class="btn-regular rounded-lg h-10 w-10 active:scale-90"> <svg width="1em" height="1em" viewBox="0 0 640 640" class="text-[1.5rem]" data-icon="fa7-brands:github">   <use href="#ai:fa7-brands:github"></use>  </svg>  </a><a rel="me" aria-label="Email" href="#" data-encoded-email="anVzdHB1cmVoMm9Ab3V0bG9vay5jb20=" onclick="(function() { const encodedEmail = this.getAttribute('data-encoded-email'); const decodedEmail = atob(encodedEmail); this.href = 'mailto:' + decodedEmail; this.removeAttribute('data-encoded-email'); this.removeAttribute('onclick'); this.click(); return false; }).call(this);" , class="btn-regular rounded-lg h-10 w-10 active:scale-90"> <svg width="1em" height="1em" viewBox="0 0 640 640" class="text-[1.5rem]" data-icon="fa7-solid:envelope">   <use href="#ai:fa7-solid:envelope"></use>  </svg>  </a><a rel="me" aria-label="RSS" href="/rss/" target="_blank" class="btn-regular rounded-lg h-10 w-10 active:scale-90"> <svg width="1em" height="1em" viewBox="0 0 640 640" class="text-[1.5rem]" data-icon="fa7-solid:rss">   <use href="#ai:fa7-solid:rss"></use>  </svg>  </a>  </div> </div> </div><!-- 组件显示现在由sidebarLayoutConfig统一控制，无需检查config.enable --><widget-layout data-id="announcement" data-is-collapsed="undefined" class="pb-4 card-base onload-animation" style="animation-delay: 50ms; " data-astro-cid-wbzkcah3="true"> <div class="widget-title font-bold transition text-lg text-neutral-900 dark:text-neutral-100 relative ml-8 mt-4 mb-2
            before:w-1 before:h-4 before:rounded-md before:bg-(--primary)
            before:absolute before:left-[-16px] before:top-[5.5px] flex items-center justify-between" data-astro-cid-wbzkcah3 style=""> <span class="widget-name" data-astro-cid-wbzkcah3 style="">公告</span>  </div> <div id="announcement" class="collapse-wrapper px-4 overflow-hidden" data-astro-cid-wbzkcah3 style="">  <div> <!-- 公告栏内容 --> <div class="text-neutral-600 dark:text-neutral-300 leading-relaxed mb-3"> JustPureH2O 的博客现已正式迁移至 Astro！原 Hexo 网站将移至 https://hexo.justpureh2o.cn/ </div> <!-- 可选链接和关闭按钮 --> <div class="flex items-center justify-between gap-3"> <div>  </div> <button class="btn-regular rounded-lg h-8 w-8 text-sm hover:bg-red-100 dark:hover:bg-red-900/30 transition-colors" onclick="closeAnnouncement()" aria-label="关闭"> <svg width="1em" height="1em" viewBox="0 0 640 640" class="text-sm" data-icon="fa7-solid:xmark">   <use href="#ai:fa7-solid:xmark"></use>  </svg> </button> </div> </div>  </div>  </widget-layout>   <widget-layout data-id="music-widget-4gbn76e-layout" data-is-collapsed="undefined" class="pb-4 card-base onload-animation" style="animation-delay: 100ms; " data-astro-cid-wbzkcah3="true"> <div class="widget-title font-bold transition text-lg text-neutral-900 dark:text-neutral-100 relative ml-8 mt-4 mb-2
            before:w-1 before:h-4 before:rounded-md before:bg-(--primary)
            before:absolute before:left-[-16px] before:top-[5.5px] flex items-center justify-between" data-astro-cid-wbzkcah3 style=""> <span class="widget-name" data-astro-cid-wbzkcah3 style="">音乐</span>  </div> <div id="music-widget-4gbn76e-layout" class="collapse-wrapper px-4 overflow-hidden" data-astro-cid-wbzkcah3 style="">  <div id="music-widget-4gbn76e" class="music-player-widget w-full relative transition-all duration-300" role="region" aria-label="音乐" data-astro-cid-reypjcyh> <!-- Top Row: Cover & Info --> <div class="flex items-center gap-2 mb-2 px-1" data-astro-cid-reypjcyh> <!-- Circular Cover --> <div class="relative shrink-0 w-14 h-14 group" data-astro-cid-reypjcyh> <div class="w-full h-full rounded-full overflow-hidden shadow-lg border-2 border-white dark:border-neutral-700 relative z-10 bg-[var(--primary)]/10 flex items-center justify-center" data-astro-cid-reypjcyh> <svg width="1em" height="1em" viewBox="0 0 24 24" class="text-2xl text-[var(--primary)] opacity-40 absolute" aria-hidden="true" data-astro-cid-reypjcyh="true" data-icon="material-symbols:music-note-rounded">   <use href="#ai:material-symbols:music-note-rounded"></use>  </svg> <img class="music-cover w-full h-full object-cover animate-spin-slow relative z-10 opacity-0 transition-opacity duration-300" src="" alt="封面" style="animation-play-state: paused;" data-astro-cid-reypjcyh> </div> </div> <!-- Info Section --> <div class="flex-1 min-w-0 flex flex-col overflow-hidden" data-astro-cid-reypjcyh> <div class="flex items-center justify-between overflow-hidden gap-2" data-astro-cid-reypjcyh> <div class="flex-1 min-w-0 overflow-hidden relative" data-astro-cid-reypjcyh> <h3 class="music-title font-bold text-base text-neutral-800 dark:text-neutral-100 leading-tight truncate" data-astro-cid-reypjcyh> 音乐 </h3> </div> <!-- Top Right: Lyric Toggle --> <button class="btn-lrc-toggle hover:text-[var(--primary)] transition-all duration-300 p-0.5 pr-2 transform active:scale-95 text-neutral-400 shrink-0 " title="歌词" aria-label="歌词" data-astro-cid-reypjcyh> <svg width="1em" height="1em" viewBox="0 0 24 24" class="icon-lrc-off text-xl" aria-hidden="true" data-astro-cid-reypjcyh="true" data-icon="material-symbols:subtitles-off-outline-rounded">   <use href="#ai:material-symbols:subtitles-off-outline-rounded"></use>  </svg> <svg width="1em" height="1em" viewBox="0 0 24 24" class="icon-lrc-on text-xl hidden" aria-hidden="true" data-astro-cid-reypjcyh="true" data-icon="material-symbols:subtitles-outline-rounded">   <use href="#ai:material-symbols:subtitles-outline-rounded"></use>  </svg> </button> </div> <div class="min-w-0 overflow-hidden" data-astro-cid-reypjcyh> <p class="music-artist text-xs font-medium text-neutral-500 dark:text-neutral-400 truncate" data-astro-cid-reypjcyh> 暂未播放 </p> </div> <!-- Time Display & Volume --> <div class="flex items-center gap-3 text-neutral-400 h-5" data-astro-cid-reypjcyh> <div class="text-[10px] font-mono flex items-center gap-1 shrink-0 h-full" aria-live="polite" data-astro-cid-reypjcyh> <span class="current-time" data-astro-cid-reypjcyh>0:00</span> <span class="opacity-50" aria-hidden="true" data-astro-cid-reypjcyh>/</span> <span class="total-time" data-astro-cid-reypjcyh>0:00</span> </div> <!-- Volume (Always visible) --> <div class="flex items-center gap-1 bg-transparent h-full" data-astro-cid-reypjcyh> <button class="btn-mute hover:text-[var(--primary)] transition-colors p-0.5 rounded-md flex items-center" title="音量" aria-label="音量" data-astro-cid-reypjcyh> <svg width="1em" height="1em" viewBox="0 0 24 24" class=" icon-vol-high text-lg" aria-hidden="true" data-astro-cid-reypjcyh="true" data-icon="material-symbols:volume-up-rounded">   <use href="#ai:material-symbols:volume-up-rounded"></use>  </svg> <svg width="1em" height="1em" viewBox="0 0 24 24" class="icon-vol-mute text-lg hidden" aria-hidden="true" data-astro-cid-reypjcyh="true" data-icon="material-symbols:volume-off-rounded">   <use href="#ai:material-symbols:volume-off-rounded"></use>  </svg> </button> <div class="w-16 transition-all duration-300 ease-out flex items-center" data-astro-cid-reypjcyh> <div class="vol-container h-1 w-16 bg-neutral-200 dark:bg-neutral-600 rounded-full cursor-pointer relative ml-1" role="slider" aria-label="音量" aria-valuemin="0" aria-valuemax="100" aria-valuenow="70" data-astro-cid-reypjcyh> <div class="vol-bar absolute left-0 top-0 h-full bg-[var(--primary)] rounded-full w-[70%]" data-astro-cid-reypjcyh></div> </div> </div> </div> </div> </div> </div> <!-- Progress Bar (Slim) --> <div class="progress-container relative w-full h-1 bg-neutral-100 dark:bg-neutral-700/50 rounded-full cursor-pointer touch-none mb-2 group mt-2" role="slider" aria-label="播放进度" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0" data-astro-cid-reypjcyh> <div class="progress-bar absolute left-0 top-0 h-full bg-[var(--primary)] rounded-full w-0 transition-[width] duration-100" data-astro-cid-reypjcyh></div> <!-- Hover Thumb --> <div class="progress-thumb absolute top-1/2 -mt-1.5 -ml-1.5 w-3 h-3 bg-[var(--primary)] ring-2 ring-white dark:ring-neutral-800 rounded-full shadow-sm scale-0 group-hover:scale-100 transition-transform duration-200" data-astro-cid-reypjcyh></div> </div> <!-- Controls Row --> <div class="flex items-center justify-between px-1 select-none" data-astro-cid-reypjcyh> <!-- Repeat Mode --> <button class="btn-repeat text-neutral-300 dark:text-neutral-600 hover:text-[var(--primary)] transition-colors p-2 active:scale-95" title="切换播放模式" aria-label="切换播放模式" data-astro-cid-reypjcyh> <svg width="1em" height="1em" viewBox="0 0 24 24" class="icon-repeat text-xl" aria-hidden="true" data-astro-cid-reypjcyh="true" data-icon="material-symbols:repeat-rounded">   <use href="#ai:material-symbols:repeat-rounded"></use>  </svg> <svg width="1em" height="1em" viewBox="0 0 24 24" class="icon-repeat-one text-xl hidden" aria-hidden="true" data-astro-cid-reypjcyh="true" data-icon="material-symbols:repeat-one-rounded">   <use href="#ai:material-symbols:repeat-one-rounded"></use>  </svg> <svg width="1em" height="1em" viewBox="0 0 24 24" class="icon-shuffle text-xl hidden" aria-hidden="true" data-astro-cid-reypjcyh="true" data-icon="material-symbols:shuffle-rounded">   <use href="#ai:material-symbols:shuffle-rounded"></use>  </svg> </button> <!-- Prev --> <button class="btn-prev text-neutral-600 dark:text-neutral-300 hover:text-[var(--primary)] transition-colors p-2 active:scale-95" title="上一首" aria-label="上一首" data-astro-cid-reypjcyh> <svg width="1em" height="1em" viewBox="0 0 24 24" class="text-3xl" aria-hidden="true" data-astro-cid-reypjcyh="true" data-icon="material-symbols:skip-previous-rounded">   <use href="#ai:material-symbols:skip-previous-rounded"></use>  </svg> </button> <!-- Play/Pause (Feature) --> <button class="btn-play w-12 h-12 bg-[var(--btn-regular-bg)] hover:bg-[var(--btn-regular-bg-hover)] active:bg-[var(--btn-regular-bg-active)] text-[var(--primary)] rounded-full flex items-center justify-center transition-all duration-300" title="播放" aria-label="播放" data-astro-cid-reypjcyh> <svg width="1em" height="1em" viewBox="0 0 24 24" class="icon-play text-3xl ml-0.5" aria-hidden="true" data-astro-cid-reypjcyh="true" data-icon="material-symbols:play-arrow-rounded">   <use href="#ai:material-symbols:play-arrow-rounded"></use>  </svg> <svg width="1em" height="1em" viewBox="0 0 24 24" class="icon-pause text-3xl hidden" aria-hidden="true" data-astro-cid-reypjcyh="true" data-icon="material-symbols:pause-rounded">   <use href="#ai:material-symbols:pause-rounded"></use>  </svg> </button> <!-- Next --> <button class="btn-next text-neutral-600 dark:text-neutral-300 hover:text-[var(--primary)] transition-colors p-2 active:scale-95" title="下一首" aria-label="下一首" data-astro-cid-reypjcyh> <svg width="1em" height="1em" viewBox="0 0 24 24" class="text-3xl" aria-hidden="true" data-astro-cid-reypjcyh="true" data-icon="material-symbols:skip-next-rounded">   <use href="#ai:material-symbols:skip-next-rounded"></use>  </svg> </button> <!-- Playlist Toggle Arrow --> <button class="btn-drawer-toggle text-neutral-400 hover:text-[var(--primary)] transition-all duration-300 p-2 transform active:scale-95" title="列表" aria-label="列表" data-astro-cid-reypjcyh> <svg width="1em" height="1em" viewBox="0 0 24 24" class="text-xl" aria-hidden="true" data-astro-cid-reypjcyh="true" data-icon="mdi:playlist-music">   <use href="#ai:mdi:playlist-music"></use>  </svg> </button> </div> <!-- Lyrics Drawer --> <div class="lrc-drawer grid transition-all duration-300 ease-[cubic-bezier(0.4,0,0.2,1)] grid-rows-[0fr] opacity-0" data-astro-cid-reypjcyh> <div class="overflow-hidden min-h-0" data-astro-cid-reypjcyh> <div class="mt-2 pt-2 border-t border-neutral-100 dark:border-white/5 mx-1" data-astro-cid-reypjcyh> <div class="lrc-container h-48 overflow-y-auto custom-scrollbar flex flex-col items-center gap-2 p-4 py-24 text-center relative scroll-smooth" role="listbox" aria-label="歌词" data-astro-cid-reypjcyh> <div class="text-neutral-400 text-sm py-10" role="option" data-astro-cid-reypjcyh>暂无歌词</div> </div> </div> </div> </div> <!-- Playlist Drawer (Accordion) --> <div class="playlist-drawer grid transition-all duration-300 ease-[cubic-bezier(0.4,0,0.2,1)] grid-rows-[0fr] opacity-0" data-astro-cid-reypjcyh> <div class="overflow-hidden min-h-0" data-astro-cid-reypjcyh> <div class="mt-2 pt-2 border-t border-neutral-100 dark:border-white/5 mx-1" data-astro-cid-reypjcyh> <div class="playlist-container max-h-48 overflow-y-auto custom-scrollbar pr-1 pb-1 flex flex-col gap-1" role="listbox" aria-label="列表" data-astro-cid-reypjcyh> <!-- Items --> </div> </div> </div> </div> <!-- Hidden Audio --> <audio class="audio-player hidden" crossorigin="anonymous" title="音频播放器" data-astro-cid-reypjcyh></audio> <!-- Loading Overlay --> <div class="music-loading absolute inset-0 z-20 flex flex-col items-center justify-center bg-white/60 dark:bg-[#1e1e1e]/60 backdrop-blur-[2px] transition-opacity duration-300 opacity-0 pointer-events-none rounded-xl" aria-busy="true" aria-hidden="true" data-astro-cid-reypjcyh> <div class="w-8 h-8 text-[var(--primary)] animate-spin" data-astro-cid-reypjcyh> <svg width="1em" height="1em" viewBox="0 0 24 24" class="text-3xl" aria-hidden="true" data-astro-cid-reypjcyh="true" data-icon="material-symbols:sync-rounded">   <use href="#ai:material-symbols:sync-rounded"></use>  </svg> </div> </div> </div> <template id="playlist-item-template-music-widget-4gbn76e" data-astro-cid-reypjcyh> <div class="playlist-item flex items-center gap-3 p-2 rounded-lg cursor-pointer hover:bg-neutral-50 dark:hover:bg-white/5 transition-colors group" data-astro-cid-reypjcyh> <div class="w-8 h-8 rounded-md overflow-hidden shrink-0 relative bg-neutral-200 dark:bg-neutral-700" data-astro-cid-reypjcyh> <img src="" class="item-cover w-full h-full object-cover" loading="lazy" alt="" data-astro-cid-reypjcyh> <!-- Active Indicator overlay --> <div class="item-active-overlay absolute inset-0 bg-[var(--primary)]/20 hidden items-center justify-center" data-astro-cid-reypjcyh> <svg width="1em" height="1em" viewBox="0 0 24 24" class="text-[var(--primary)] text-sm" data-astro-cid-reypjcyh="true" data-icon="material-symbols:graphic-eq-rounded">   <use href="#ai:material-symbols:graphic-eq-rounded"></use>  </svg> </div> </div> <div class="flex-1 min-w-0" data-astro-cid-reypjcyh> <div class="item-title text-xs font-bold text-neutral-700 dark:text-neutral-200 truncate group-hover:text-[var(--primary)] transition-colors" data-astro-cid-reypjcyh></div> <div class="item-artist text-[10px] text-neutral-400 truncate" data-astro-cid-reypjcyh></div> </div> </div> </template> <script>(function(){const playerConfigStr = "{\"mode\":\"meting\",\"meting\":{\"api\":\"https://api.i-meto.com/meting/api?server=:server&type=:type&id=:id&r=:r\",\"server\":\"netease\",\"type\":\"playlist\",\"id\":\"12830312100\",\"auth\":\"\",\"fallbackApis\":[\"https://api.injahow.cn/meting/?server=:server&type=:type&id=:id\",\"https://api.moeyao.cn/meting/?server=:server&type=:type&id=:id\"]},\"localPlaylist\":[],\"volume\":0.7,\"playMode\":\"list\",\"showLyrics\":true,\"i18n\":{\"noPlaying\":\"暂未播放\",\"lyrics\":\"歌词\",\"volume\":\"音量\",\"playMode\":\"切换播放模式\",\"prev\":\"上一首\",\"next\":\"下一首\",\"playlist\":\"列表\",\"noLyrics\":\"暂无歌词\",\"loadingLyrics\":\"正在加载歌词...\",\"failedLyrics\":\"歌词加载失败\",\"noSongs\":\"暂无歌曲\",\"error\":\"播放器错误\",\"play\":\"播放\",\"pause\":\"暂停\",\"progress\":\"播放进度\",\"noCover\":\"暂无封面\"}}";
const widgetId = "music-widget-4gbn76e";

(function () {
    const config = JSON.parse(playerConfigStr);
    const widget = document.getElementById(widgetId);
    
    // If widget not found (e.g. removed), stop
    if (!widget) return;

    const ui = {
        widget: widget,
        loading: widget.querySelector('.music-loading'),
        cover: widget.querySelector('.music-cover'),
        title: widget.querySelector('.music-title'),
        artist: widget.querySelector('.music-artist'),
        progressBar: widget.querySelector('.progress-bar'),
        progressThumb: widget.querySelector('.progress-thumb'),
        progressContainer: widget.querySelector('.progress-container'),
        currentTime: widget.querySelector('.current-time'),
        totalTime: widget.querySelector('.total-time'),
        btnPlay: widget.querySelector('.btn-play'),
        iconPlay: widget.querySelector('.icon-play'),
        iconPause: widget.querySelector('.icon-pause'),
        btnPrev: widget.querySelector('.btn-prev'),
        btnNext: widget.querySelector('.btn-next'),
        btnRepeat: widget.querySelector('.btn-repeat'),
        iconRepeat: widget.querySelector('.icon-repeat'),
        iconRepeatOne: widget.querySelector('.icon-repeat-one'),
        iconShuffle: widget.querySelector('.icon-shuffle'),
        btnMute: widget.querySelector('.btn-mute'),
        iconVolHigh: widget.querySelector('.icon-vol-high'),
        iconVolMute: widget.querySelector('.icon-vol-mute'),
        volContainer: widget.querySelector('.vol-container'),
        volBar: widget.querySelector('.vol-bar'),
        btnLrc: widget.querySelector('.btn-lrc-toggle'),
        iconLrcOn: widget.querySelector('.icon-lrc-on'),
        iconLrcOff: widget.querySelector('.icon-lrc-off'),
        lrcDrawer: widget.querySelector('.lrc-drawer'),
        lrcContainer: widget.querySelector('.lrc-container'),
        btnDrawer: widget.querySelector('.btn-drawer-toggle'),
        playlistDrawer: widget.querySelector('.playlist-drawer'),
        playlistContainer: widget.querySelector('.playlist-container'),
        audio: widget.querySelector('.audio-player'),
        itemTemplate: document.getElementById(`playlist-item-template-${widgetId}`)
    };

    // Verify all critical UI elements exist (may be null during Swup page transitions)
    const _critical = [ui.btnPlay, ui.audio, ui.btnRepeat, ui.btnMute, ui.volContainer,
        ui.btnDrawer, ui.btnLrc, ui.lrcDrawer, ui.lrcContainer,
        ui.progressContainer, ui.btnNext, ui.btnPrev, ui.loading,
        ui.cover, ui.title, ui.artist, ui.playlistContainer, ui.itemTemplate];
    if (_critical.some(function(el) { return !el; })) return;

    const state = {
        playlist: [],
        currentIndex: 0,
        isPlaying: false,
        isLoading: false,
        playMode: 0, // 0: List, 1: One, 2: Rand
        lastVolume: localStorage.getItem('music-player-volume') !== null 
            ? parseFloat(localStorage.getItem('music-player-volume')) 
            : (config.volume ?? 0.7),
        isMuted: false,
        lyrics: [], // Parsed lyrics: {time: seconds, text: string}
        currentLrcIndex: -1,
        isUserScrolling: false,
        scrollTimeout: null
    };

    // Initialize state from config
    if (config.playMode === 'random') {
            state.playMode = 2; // Rand
    } else if (config.playMode === 'one') {
            state.playMode = 1; // One
    } else {
            state.playMode = 0; // List (default)
    }

    // UI Helpers
    function setLoading(bool) {
        state.isLoading = bool;
        if (bool) {
            ui.loading.classList.remove('opacity-0', 'pointer-events-none');
        } else {
            ui.loading.classList.add('opacity-0', 'pointer-events-none');
        }
    }

    function formatTime(seconds) {
        if (!seconds || isNaN(seconds)) return "0:00";
        const min = Math.floor(seconds / 60);
        const sec = Math.floor(seconds % 60);
        return `${min}:${sec.toString().padStart(2, '0')}`;
    }

    function parseLRC(lrc) {
        if (!lrc) return [];
        const lines = lrc.split('\n');
        const result = [];
        const timeReg = /\[(\d{2}):(\d{2})\.(\d{2,3})\]/g;
        
        lines.forEach(line => {
            const matches = Array.from(line.matchAll(timeReg));
            if (matches.length > 0) {
                const text = line.replace(timeReg, '').trim();
                if (text) {
                    matches.forEach(match => {
                        const m = parseInt(match[1]);
                        const s = parseInt(match[2]);
                        const ms = parseInt(match[3]);
                        const time = m * 60 + s + ms / (match[3].length === 3 ? 1000 : 100);
                        result.push({ time, text });
                    });
                }
            }
        });
        return result.sort((a, b) => a.time - b.time);
    }

    function renderLyrics(lrcText) {
        state.lyrics = parseLRC(lrcText);
        ui.lrcContainer.innerHTML = '';
        
        if (state.lyrics.length === 0) {
            ui.lrcContainer.innerHTML = `<div class="text-neutral-400 text-sm py-10" role="option">${config.i18n.noLyrics}</div>`;
            return;
        }

        state.lyrics.forEach((line, index) => {
            const lineEl = document.createElement('div');
            lineEl.className = 'lrc-line transition-all duration-300 text-sm text-neutral-400 py-1 cursor-pointer hover:text-[var(--primary)]';
            lineEl.innerText = line.text;
            lineEl.dataset.index = index;
            lineEl.setAttribute('role', 'option');
            lineEl.setAttribute('aria-label', line.text);
            lineEl.onclick = () => {
                ui.audio.currentTime = line.time;
            };
            ui.lrcContainer.appendChild(lineEl);
        });
    }

    function updateLyricSync(currentTime, forceScroll = false) {
        if (!state.lyrics || state.lyrics.length === 0) return;

        let index = -1;
        for (let i = 0; i < state.lyrics.length; i++) {
            if (currentTime >= state.lyrics[i].time) {
                index = i;
            } else {
                break;
            }
        }

        // Always update UI classes when index changes
        if (index !== state.currentLrcIndex) {
                const lines = ui.lrcContainer.querySelectorAll('.lrc-line');
                lines.forEach((line, i) => {
                    if (i === index) {
                        line.classList.add('text-[var(--primary)]', 'font-bold', 'text-base');
                        line.classList.remove('text-neutral-400', 'text-sm');
                    } else {
                        line.classList.remove('text-[var(--primary)]', 'font-bold', 'text-base');
                        line.classList.add('text-neutral-400', 'text-sm');
                    }
                });
                state.currentLrcIndex = index;
        }

        // Handle scrolling separately so it can be forced even if index hasn't changed
        if (index !== -1 && (!state.isUserScrolling || forceScroll)) {
            const line = ui.lrcContainer.querySelector(`.lrc-line[data-index="${index}"]`);
            if (line) {
                const containerHeight = ui.lrcContainer.clientHeight;
                // Use line.offsetTop relative to its offsetParent (the container with relative)
                const lineOffset = line.offsetTop;
                const lineHeight = line.offsetHeight;
                
                const targetScroll = lineOffset - (containerHeight / 2) + (lineHeight / 2);
                
                ui.lrcContainer.scrollTo({
                    top: targetScroll,
                    behavior: forceScroll ? 'auto' : 'smooth'
                });
            }
        }
    }

    // Core Init
    async function init() {
        setLoading(true);
        try {
            if (config.mode === 'meting' && config.meting) {
                await fetchMetingData();
            } else if (config.mode === 'local') {
                state.playlist = config.localPlaylist || [];
            }

            if (state.playlist.length > 0) {
                renderPlaylist();
                // If random mode is initial setting, shuffle start
                let startIndex = 0;
                if (state.playMode === 2) {
                    startIndex = Math.floor(Math.random() * state.playlist.length);
                }
                
                loadTrack(startIndex, false);
                initVolume();
                updateModeUI(); // Reflect initial mode in UI
            } else {
                ui.title.innerText = config.i18n.noSongs;
            }
        } catch (e) {
            console.error("Music Init Error", e);
            ui.title.innerText = config.i18n.error;
        } finally {
            setLoading(false);
        }
    }

    async function fetchMetingData() {
        if (!config.meting) return;
        const { api, server, type, id, auth, fallbackApis } = config.meting;
        
        const apis = [api, ...(fallbackApis || [])];
        
        for (const baseApi of apis) {
            if (!baseApi) continue;
            try {
                let fetchUrl = baseApi.replace(':server', server).replace(':type', type).replace(':id', id).replace(':r', Math.random());
                if (auth) fetchUrl += `&auth=${auth}`;

                const res = await fetch(fetchUrl);
                if (!res.ok) throw new Error(`HTTP error! status: ${res.status}`);
                const data = await res.json();
                
                if (Array.isArray(data) && data.length > 0) {
                    state.playlist = data.map(item => ({
                        name: item.title || item.name || 'Unknown',
                        artist: item.author || item.artist || 'Unknown',
                        url: item.url,
                        pic: item.pic || item.cover || '',
                        lrc: item.lrc
                    }));
                    return; // Found data, exit loop
                }
            } catch (e) {
                console.warn(`Meting API fetch failed for ${baseApi}`, e);
            }
        }
        throw new Error("All Meting APIs failed");
    }

    function renderPlaylist() {
        ui.playlistContainer.innerHTML = '';
        state.playlist.forEach((track, idx) => {
            const clone = ui.itemTemplate.content.cloneNode(true);
            const itemEl = clone.querySelector('.playlist-item');
            const img = clone.querySelector('.item-cover');
            const title = clone.querySelector('.item-title');
            const artist = clone.querySelector('.item-artist');
            
            img.src = track.pic || '';
            img.alt = `${track.name} - ${track.artist}`;
            title.innerText = track.name;
            artist.innerText = track.artist;
            
            // Active State logic handled in updatePlaylistUI
            itemEl.dataset.index = idx;
            itemEl.setAttribute('role', 'option');
            itemEl.setAttribute('aria-label', `${track.name} - ${track.artist}`);
            itemEl.onclick = () => {
                if (state.currentIndex === idx && !ui.audio.paused) {
                    togglePlay();
                } else {
                    loadTrack(idx, true);
                }
            };
            ui.playlistContainer.appendChild(clone);
        });
    }

    function loadTrack(index, autoPlay = false) {
        if (index < 0 || index >= state.playlist.length) return;
        state.currentIndex = index;
        const track = state.playlist[index];

        ui.title.innerText = track.name;
        ui.title.title = track.name;
        ui.artist.innerText = track.artist;
        ui.artist.title = track.artist;
        
        if (track.pic) {
            ui.cover.classList.add('opacity-0');
            ui.cover.src = track.pic;
            ui.cover.alt = `${track.name} - ${track.artist}`;
        } else {
            ui.cover.src = '';
            ui.cover.classList.add('opacity-0');
            ui.cover.alt = config.i18n.noCover;
        }
        
        ui.audio.src = track.url;
        
        // Reset cover rotation
        ui.cover.classList.remove('animate-spin-slow');
        void ui.cover.offsetWidth;
        ui.cover.classList.add('animate-spin-slow');
        ui.cover.style.animationPlayState = 'paused';
        
        // Reset Progress
        ui.progressBar.style.width = '0%';
        ui.progressContainer.setAttribute('aria-valuenow', '0');
        ui.currentTime.innerText = '0:00';
        ui.totalTime.innerText = '0:00';

        // Reset Lyrics
        state.lyrics = [];
        state.currentLrcIndex = -1;
        ui.lrcContainer.innerHTML = `<div class="text-neutral-400 text-sm py-10">${config.i18n.loadingLyrics}</div>`;
        
        if (track.lrc) {
            const isLrcUrl = /^(https?:)?\/\//.test(track.lrc)
                || track.lrc.startsWith('/')
                || /\.(lrc|txt)(\?|#|$)/i.test(track.lrc);

            if (isLrcUrl) {
                fetch(track.lrc)
                    .then(res => res.text())
                    .then(text => renderLyrics(text))
                    .catch(() => ui.lrcContainer.innerHTML = `<div class="text-neutral-400 text-sm py-10">${config.i18n.failedLyrics}</div>`);
            } else {
                renderLyrics(track.lrc);
            }
        } else {
            ui.lrcContainer.innerHTML = `<div class="text-neutral-400 text-sm py-10">${config.i18n.noLyrics}</div>`;
        }

        updatePlaylistUI();

        if (autoPlay) {
            ui.audio.play().then(() => {
                updatePlayState(true);
            }).catch(e => console.warn(e));
        } else {
            updatePlayState(false);
        }
    }

    function updatePlayState(isPlaying) {
        state.isPlaying = isPlaying;
        if (isPlaying) {
            ui.btnPlay.classList.add('bg-[var(--primary)]', 'text-white', 'hover:brightness-110');
            ui.btnPlay.classList.remove('bg-[var(--btn-regular-bg)]', 'hover:bg-[var(--btn-regular-bg-hover)]', 'active:bg-[var(--btn-regular-bg-active)]', 'text-[var(--primary)]');
            ui.iconPlay.classList.add('hidden');
            ui.iconPause.classList.remove('hidden');
            ui.cover.style.animationPlayState = 'running';
            ui.btnPlay.setAttribute('aria-label', config.i18n.pause);
            ui.btnPlay.title = config.i18n.pause;
        } else {
            ui.btnPlay.classList.remove('bg-[var(--primary)]', 'text-white', 'hover:brightness-110');
            ui.btnPlay.classList.add('bg-[var(--btn-regular-bg)]', 'hover:bg-[var(--btn-regular-bg-hover)]', 'active:bg-[var(--btn-regular-bg-active)]', 'text-[var(--primary)]');
            ui.iconPlay.classList.remove('hidden');
            ui.iconPause.classList.add('hidden');
            ui.cover.style.animationPlayState = 'paused';
            ui.btnPlay.setAttribute('aria-label', config.i18n.play);
            ui.btnPlay.title = config.i18n.play;
        }
    }

    function togglePlay() {
        if (ui.audio.paused) {
            ui.audio.play().then(() => updatePlayState(true));
        } else {
            ui.audio.pause();
            updatePlayState(false);
        }
    }

    function playNext(auto = false) {
        let nextIndex;
        if (state.playMode === 1 && auto) { 
            // Single Loop
            ui.audio.currentTime = 0;
            ui.audio.play(); 
            return;
        } else if (state.playMode === 2) { 
            // Random
            nextIndex = Math.floor(Math.random() * state.playlist.length);
        } else {
            // List Loop
            nextIndex = (state.currentIndex + 1) % state.playlist.length;
        }
        loadTrack(nextIndex, true);
    }

    function playPrev() {
        let prevIndex = (state.currentIndex - 1 + state.playlist.length) % state.playlist.length;
        if (state.playMode === 2) {
                prevIndex = Math.floor(Math.random() * state.playlist.length);
        }
        loadTrack(prevIndex, true);
    }

    function updatePlaylistUI() {
            const items = ui.playlistContainer.querySelectorAll('.playlist-item');
            items.forEach(el => {
                const idx = parseInt(el.dataset.index);
                const overlay = el.querySelector('.item-active-overlay');
                const title = el.querySelector('.item-title');
                if (idx === state.currentIndex) {
                    el.classList.add('bg-neutral-100', 'dark:bg-white/10');
                    el.setAttribute('aria-current', 'true');
                    overlay.classList.remove('hidden');
                    overlay.classList.add('flex');
                    title.classList.add('text-[var(--primary)]');
                } else {
                    el.classList.remove('bg-neutral-100', 'dark:bg-white/10');
                    el.removeAttribute('aria-current');
                    overlay.classList.add('hidden');
                    overlay.classList.remove('flex');
                    title.classList.remove('text-[var(--primary)]');
                }
            });
    }

    // Mode Logic
    // Mode 0: List (Def), Mode 1: One, Mode 2: Rand
    // Button Repeat: Cycle 0 -> 1 -> 2 -> 0
    
    function updateModeUI() {
        const primaryColor = 'text-[var(--primary)]';

        // Always primary color if we want to indicate it's interactable, or conditionally
        // Usually Loop List is 'inactive' (grey) or 'active' (primary). 
        // Let's make: List=Grey (default), One=Primary, Rand=Primary
        
        if (state.playMode === 0) {
                ui.btnRepeat.className = `p-2 active:scale-95 transition-colors text-neutral-300 dark:text-neutral-600 hover:text-[var(--primary)]`;
                ui.iconRepeat.classList.remove('hidden');
                ui.iconRepeatOne.classList.add('hidden');
                ui.iconShuffle.classList.add('hidden');
        } else if (state.playMode === 1) {
                ui.btnRepeat.className = `p-2 active:scale-95 transition-colors ${primaryColor}`;
                ui.iconRepeat.classList.add('hidden');
                ui.iconRepeatOne.classList.remove('hidden');
                ui.iconShuffle.classList.add('hidden');
        } else {
                ui.btnRepeat.className = `p-2 active:scale-95 transition-colors ${primaryColor}`;
                ui.iconRepeat.classList.add('hidden');
                ui.iconRepeatOne.classList.add('hidden');
                ui.iconShuffle.classList.remove('hidden');
        }
    }

    ui.btnRepeat.addEventListener('click', () => {
            // Cycle: 0 -> 1 -> 2 -> 0
            state.playMode = (state.playMode + 1) % 3;
            updateModeUI();
    });

    // Volume Logic
    function initVolume() {
        ui.audio.volume = state.lastVolume;
        updateVolumeUI();
    }

    function updateVolumeUI() {
        const pct = state.isMuted ? 0 : state.lastVolume * 100;
        ui.volBar.style.width = `${pct}%`;
        ui.volContainer.setAttribute('aria-valuenow', Math.round(pct).toString());
        
        if (state.isMuted || state.lastVolume === 0) {
            ui.iconVolHigh.classList.add('hidden');
            ui.iconVolMute.classList.remove('hidden');
        } else {
            ui.iconVolHigh.classList.remove('hidden');
            ui.iconVolMute.classList.add('hidden');
        }
    }

    ui.btnMute.addEventListener('click', () => {
        state.isMuted = !state.isMuted;
        ui.audio.muted = state.isMuted;
        updateVolumeUI();
    });

    ui.volContainer.addEventListener('click', (e) => {
            const rect = ui.volContainer.getBoundingClientRect();
            const x = e.clientX - rect.left;
            let val = x / rect.width;
            val = Math.max(0, Math.min(1, val));
            
            state.lastVolume = val;
            state.isMuted = false;
            ui.audio.muted = false;
            ui.audio.volume = val;
            localStorage.setItem('music-player-volume', val.toString());
            updateVolumeUI();
    });

    // Drawer Logic
    ui.btnLrc.addEventListener('click', () => {
            const isOpen = ui.lrcDrawer.style.gridTemplateRows === '1fr';
            if (isOpen) {
                ui.lrcDrawer.style.gridTemplateRows = '0fr';
                ui.lrcDrawer.classList.remove('opacity-100');
                ui.lrcDrawer.classList.add('opacity-0');
                ui.btnLrc.classList.remove('text-[var(--primary)]');
                ui.btnLrc.classList.add('text-neutral-400');
                ui.iconLrcOn.classList.add('hidden');
                ui.iconLrcOff.classList.remove('hidden');
            } else {
                // Close playlist if open
                ui.playlistDrawer.style.gridTemplateRows = '0fr';
                ui.playlistDrawer.classList.remove('opacity-100');
                ui.playlistDrawer.classList.add('opacity-0');
                ui.btnDrawer.classList.remove('text-[var(--primary)]');
                ui.btnDrawer.classList.add('text-neutral-400');

                ui.lrcDrawer.style.gridTemplateRows = '1fr';
                ui.lrcDrawer.classList.add('opacity-100');
                ui.lrcDrawer.classList.remove('opacity-0');
                ui.btnLrc.classList.add('text-[var(--primary)]');
                ui.btnLrc.classList.remove('text-neutral-400');
                ui.iconLrcOn.classList.remove('hidden');
                ui.iconLrcOff.classList.add('hidden');
            }
    });

    ui.btnDrawer.addEventListener('click', () => {
            const isOpen = ui.playlistDrawer.style.gridTemplateRows === '1fr';
            if (isOpen) {
                ui.playlistDrawer.style.gridTemplateRows = '0fr';
                ui.playlistDrawer.classList.remove('opacity-100');
                ui.playlistDrawer.classList.add('opacity-0');
                
                ui.btnDrawer.classList.add('text-neutral-400');
                ui.btnDrawer.classList.remove('text-[var(--primary)]');
            } else {
                // Close lyrics if open
                ui.lrcDrawer.style.gridTemplateRows = '0fr';
                ui.lrcDrawer.classList.remove('opacity-100');
                ui.lrcDrawer.classList.add('opacity-0');
                ui.btnLrc.classList.remove('text-[var(--primary)]');
                ui.btnLrc.classList.add('text-neutral-400');

                ui.playlistDrawer.style.gridTemplateRows = '1fr';
                ui.playlistDrawer.classList.add('opacity-100');
                ui.playlistDrawer.classList.remove('opacity-0');
                
                ui.btnDrawer.classList.remove('text-neutral-400');
                ui.btnDrawer.classList.add('text-[var(--primary)]');
            }
    });

    // Core Events
    ui.btnPlay.addEventListener('click', togglePlay);
    ui.btnNext.addEventListener('click', () => playNext(false));
    ui.btnPrev.addEventListener('click', playPrev);

    ui.lrcContainer.addEventListener('wheel', () => {
            state.isUserScrolling = true;
            resetScrollTimeout();
    });
    ui.lrcContainer.addEventListener('touchstart', () => {
            state.isUserScrolling = true;
            resetScrollTimeout();
    });

    function resetScrollTimeout() {
        clearTimeout(state.scrollTimeout);
        state.scrollTimeout = setTimeout(() => {
            state.isUserScrolling = false;
            updateLyricSync(ui.audio.currentTime, true); // Snap back immediately
        }, 3000); // Wait for 3 seconds of no activity
    }

    ui.cover.addEventListener('load', () => {
            ui.cover.classList.remove('opacity-0');
    });
    ui.cover.addEventListener('error', () => {
            ui.cover.classList.add('opacity-0');
    });
    
    ui.audio.addEventListener('timeupdate', () => {
            if (isNaN(ui.audio.duration)) return;
            const currentTime = ui.audio.currentTime;
            const duration = ui.audio.duration;
            const progress = (currentTime / duration) * 100;
            
            ui.progressBar.style.width = `${progress}%`;
            ui.progressThumb.style.left = `${progress}%`;
            ui.progressContainer.setAttribute('aria-valuenow', Math.round(progress).toString());
            
            ui.currentTime.innerText = formatTime(currentTime);
            ui.totalTime.innerText = formatTime(duration);

            updateLyricSync(currentTime);
    });

    ui.audio.addEventListener('ended', () => playNext(true));
    ui.audio.addEventListener('error', () => { /* Handle error */ });
    
    // Global Mutual Exclusion
    window.addEventListener('firefly-music-play', (e) => {
        if (e.detail.id !== widgetId && !ui.audio.paused) {
            ui.audio.pause();
            updatePlayState(false);
        }
    });

    ui.audio.addEventListener('play', () => {
        window.dispatchEvent(new CustomEvent('firefly-music-play', { detail: { id: widgetId } }));
    });
    
    // Seek
    ui.progressContainer.addEventListener('click', (e) => {
        if (!ui.audio.duration) return;
        const rect = ui.progressContainer.getBoundingClientRect();
        const clickX = e.clientX - rect.left;
        const percent = Math.min(Math.max(clickX / rect.width, 0), 1);
        ui.audio.currentTime = percent * ui.audio.duration;
    });

    init();
})();
})();</script>   </div>  </widget-layout>  <widget-layout data-id="categories" data-is-collapsed="true" class="pb-4 card-base onload-animation" style="animation-delay: 150ms; --collapsedHeight: 7.5rem;" data-astro-cid-wbzkcah3="true"> <div class="widget-title font-bold transition text-lg text-neutral-900 dark:text-neutral-100 relative ml-8 mt-4 mb-2
            before:w-1 before:h-4 before:rounded-md before:bg-(--primary)
            before:absolute before:left-[-16px] before:top-[5.5px] flex items-center justify-between" data-astro-cid-wbzkcah3 style="--collapsedHeight: 7.5rem;"> <span class="widget-name" data-astro-cid-wbzkcah3 style="--collapsedHeight: 7.5rem;">分类</span>  </div> <div id="categories" class="collapse-wrapper px-4 overflow-hidden collapsed" data-astro-cid-wbzkcah3 style="--collapsedHeight: 7.5rem;"> <a href="/archive/?category=API" aria-label="View all posts in the API category"> <button class="
            w-full
            h-10
            rounded-lg
            bg-none
            hover:bg-(--btn-plain-bg-hover)
            active:bg-(--btn-plain-bg-active)
            transition-all
            pl-2
            hover:pl-3
            
            text-neutral-700
            hover:text-(--primary)
            dark:text-neutral-300
            dark:hover:text-(--primary)
        "> <div class="flex items-center justify-between relative mr-2"> <div class="overflow-hidden text-left whitespace-nowrap text-ellipsis  "> API </div> <div class="transition px-2 h-7 ml-4 min-w-8 rounded-lg text-sm font-bold
                    text-(--btn-content) dark:text-(--deep-text)
                    bg-[oklch(0.95_0.025_var(--hue))] dark:bg-(--primary)
                    flex items-center justify-center"> 1 </div> </div> </button> </a><a href="/archive/?category=oi%E7%AE%97%E6%B3%95" aria-label="View all posts in the oi算法 category"> <button class="
            w-full
            h-10
            rounded-lg
            bg-none
            hover:bg-(--btn-plain-bg-hover)
            active:bg-(--btn-plain-bg-active)
            transition-all
            pl-2
            hover:pl-3
            
            text-neutral-700
            hover:text-(--primary)
            dark:text-neutral-300
            dark:hover:text-(--primary)
        "> <div class="flex items-center justify-between relative mr-2"> <div class="overflow-hidden text-left whitespace-nowrap text-ellipsis  "> oi算法 </div> <div class="transition px-2 h-7 ml-4 min-w-8 rounded-lg text-sm font-bold
                    text-(--btn-content) dark:text-(--deep-text)
                    bg-[oklch(0.95_0.025_var(--hue))] dark:bg-(--primary)
                    flex items-center justify-center"> 37 </div> </div> </button> </a><a href="/archive/?category=%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA" aria-label="View all posts in the 博客搭建 category"> <button class="
            w-full
            h-10
            rounded-lg
            bg-none
            hover:bg-(--btn-plain-bg-hover)
            active:bg-(--btn-plain-bg-active)
            transition-all
            pl-2
            hover:pl-3
            
            text-neutral-700
            hover:text-(--primary)
            dark:text-neutral-300
            dark:hover:text-(--primary)
        "> <div class="flex items-center justify-between relative mr-2"> <div class="overflow-hidden text-left whitespace-nowrap text-ellipsis  "> 博客搭建 </div> <div class="transition px-2 h-7 ml-4 min-w-8 rounded-lg text-sm font-bold
                    text-(--btn-content) dark:text-(--deep-text)
                    bg-[oklch(0.95_0.025_var(--hue))] dark:bg-(--primary)
                    flex items-center justify-center"> 1 </div> </div> </button> </a><a href="/archive/?category=%E5%A5%87%E6%8A%80%E6%B7%AB%E5%B7%A7" aria-label="View all posts in the 奇技淫巧 category"> <button class="
            w-full
            h-10
            rounded-lg
            bg-none
            hover:bg-(--btn-plain-bg-hover)
            active:bg-(--btn-plain-bg-active)
            transition-all
            pl-2
            hover:pl-3
            
            text-neutral-700
            hover:text-(--primary)
            dark:text-neutral-300
            dark:hover:text-(--primary)
        "> <div class="flex items-center justify-between relative mr-2"> <div class="overflow-hidden text-left whitespace-nowrap text-ellipsis  "> 奇技淫巧 </div> <div class="transition px-2 h-7 ml-4 min-w-8 rounded-lg text-sm font-bold
                    text-(--btn-content) dark:text-(--deep-text)
                    bg-[oklch(0.95_0.025_var(--hue))] dark:bg-(--primary)
                    flex items-center justify-center"> 5 </div> </div> </button> </a><a href="/archive/?category=%E5%BC%80%E5%8F%91%E8%AE%B0%E5%BD%95" aria-label="View all posts in the 开发记录 category"> <button class="
            w-full
            h-10
            rounded-lg
            bg-none
            hover:bg-(--btn-plain-bg-hover)
            active:bg-(--btn-plain-bg-active)
            transition-all
            pl-2
            hover:pl-3
            
            text-neutral-700
            hover:text-(--primary)
            dark:text-neutral-300
            dark:hover:text-(--primary)
        "> <div class="flex items-center justify-between relative mr-2"> <div class="overflow-hidden text-left whitespace-nowrap text-ellipsis  "> 开发记录 </div> <div class="transition px-2 h-7 ml-4 min-w-8 rounded-lg text-sm font-bold
                    text-(--btn-content) dark:text-(--deep-text)
                    bg-[oklch(0.95_0.025_var(--hue))] dark:bg-(--primary)
                    flex items-center justify-center"> 1 </div> </div> </button> </a><a href="/archive/?category=%E6%96%87%E5%8C%96%E8%AF%BE" aria-label="View all posts in the 文化课 category"> <button class="
            w-full
            h-10
            rounded-lg
            bg-none
            hover:bg-(--btn-plain-bg-hover)
            active:bg-(--btn-plain-bg-active)
            transition-all
            pl-2
            hover:pl-3
            
            text-neutral-700
            hover:text-(--primary)
            dark:text-neutral-300
            dark:hover:text-(--primary)
        "> <div class="flex items-center justify-between relative mr-2"> <div class="overflow-hidden text-left whitespace-nowrap text-ellipsis  "> 文化课 </div> <div class="transition px-2 h-7 ml-4 min-w-8 rounded-lg text-sm font-bold
                    text-(--btn-content) dark:text-(--deep-text)
                    bg-[oklch(0.95_0.025_var(--hue))] dark:bg-(--primary)
                    flex items-center justify-center"> 5 </div> </div> </button> </a><a href="/archive/?category=%E6%98%A5%E6%99%9A" aria-label="View all posts in the 春晚 category"> <button class="
            w-full
            h-10
            rounded-lg
            bg-none
            hover:bg-(--btn-plain-bg-hover)
            active:bg-(--btn-plain-bg-active)
            transition-all
            pl-2
            hover:pl-3
            
            text-neutral-700
            hover:text-(--primary)
            dark:text-neutral-300
            dark:hover:text-(--primary)
        "> <div class="flex items-center justify-between relative mr-2"> <div class="overflow-hidden text-left whitespace-nowrap text-ellipsis  "> 春晚 </div> <div class="transition px-2 h-7 ml-4 min-w-8 rounded-lg text-sm font-bold
                    text-(--btn-content) dark:text-(--deep-text)
                    bg-[oklch(0.95_0.025_var(--hue))] dark:bg-(--primary)
                    flex items-center justify-center"> 2 </div> </div> </button> </a><a href="/archive/?uncategorized=true" aria-label="View all posts in the 未分类 category"> <button class="
            w-full
            h-10
            rounded-lg
            bg-none
            hover:bg-(--btn-plain-bg-hover)
            active:bg-(--btn-plain-bg-active)
            transition-all
            pl-2
            hover:pl-3
            
            text-neutral-700
            hover:text-(--primary)
            dark:text-neutral-300
            dark:hover:text-(--primary)
        "> <div class="flex items-center justify-between relative mr-2"> <div class="overflow-hidden text-left whitespace-nowrap text-ellipsis  "> 未分类 </div> <div class="transition px-2 h-7 ml-4 min-w-8 rounded-lg text-sm font-bold
                    text-(--btn-content) dark:text-(--deep-text)
                    bg-[oklch(0.95_0.025_var(--hue))] dark:bg-(--primary)
                    flex items-center justify-center"> 7 </div> </div> </button> </a><a href="/archive/?category=%E8%BD%AC%E8%BD%BD" aria-label="View all posts in the 转载 category"> <button class="
            w-full
            h-10
            rounded-lg
            bg-none
            hover:bg-(--btn-plain-bg-hover)
            active:bg-(--btn-plain-bg-active)
            transition-all
            pl-2
            hover:pl-3
            
            text-neutral-700
            hover:text-(--primary)
            dark:text-neutral-300
            dark:hover:text-(--primary)
        "> <div class="flex items-center justify-between relative mr-2"> <div class="overflow-hidden text-left whitespace-nowrap text-ellipsis  "> 转载 </div> <div class="transition px-2 h-7 ml-4 min-w-8 rounded-lg text-sm font-bold
                    text-(--btn-content) dark:text-(--deep-text)
                    bg-[oklch(0.95_0.025_var(--hue))] dark:bg-(--primary)
                    flex items-center justify-center"> 3 </div> </div> </button> </a><a href="/archive/?category=%E9%A2%98%E8%A7%A3" aria-label="View all posts in the 题解 category"> <button class="
            w-full
            h-10
            rounded-lg
            bg-none
            hover:bg-(--btn-plain-bg-hover)
            active:bg-(--btn-plain-bg-active)
            transition-all
            pl-2
            hover:pl-3
            
            text-neutral-700
            hover:text-(--primary)
            dark:text-neutral-300
            dark:hover:text-(--primary)
        "> <div class="flex items-center justify-between relative mr-2"> <div class="overflow-hidden text-left whitespace-nowrap text-ellipsis  "> 题解 </div> <div class="transition px-2 h-7 ml-4 min-w-8 rounded-lg text-sm font-bold
                    text-(--btn-content) dark:text-(--deep-text)
                    bg-[oklch(0.95_0.025_var(--hue))] dark:bg-(--primary)
                    flex items-center justify-center"> 1 </div> </div> </button> </a><a href="/archive/?category=%E9%B2%9C%E8%8A%B1" aria-label="View all posts in the 鲜花 category"> <button class="
            w-full
            h-10
            rounded-lg
            bg-none
            hover:bg-(--btn-plain-bg-hover)
            active:bg-(--btn-plain-bg-active)
            transition-all
            pl-2
            hover:pl-3
            
            text-neutral-700
            hover:text-(--primary)
            dark:text-neutral-300
            dark:hover:text-(--primary)
        "> <div class="flex items-center justify-between relative mr-2"> <div class="overflow-hidden text-left whitespace-nowrap text-ellipsis  "> 鲜花 </div> <div class="transition px-2 h-7 ml-4 min-w-8 rounded-lg text-sm font-bold
                    text-(--btn-content) dark:text-(--deep-text)
                    bg-[oklch(0.95_0.025_var(--hue))] dark:bg-(--primary)
                    flex items-center justify-center"> 3 </div> </div> </button> </a> </div> <div class="expand-btn px-4 -mb-2" data-astro-cid-wbzkcah3 style="--collapsedHeight: 7.5rem;"> <button class="btn-plain rounded-lg w-full h-9" title="更多" aria-label="更多" data-astro-cid-wbzkcah3 style="--collapsedHeight: 7.5rem;"> <div class="text-(--primary) flex items-center justify-center gap-2 -translate-x-2" data-astro-cid-wbzkcah3 style="--collapsedHeight: 7.5rem;"> <svg width="1em" height="1em" viewBox="0 0 24 24" class="text-[1.75rem]" aria-hidden="true" data-astro-cid-wbzkcah3="true" data-icon="material-symbols:more-horiz">   <use href="#ai:material-symbols:more-horiz"></use>  </svg> 更多 </div> </button> </div> </widget-layout>  <widget-layout data-id="tags" data-is-collapsed="true" class="pb-4 card-base onload-animation" style="animation-delay: 200ms; --collapsedHeight: 7.5rem;" data-astro-cid-wbzkcah3="true"> <div class="widget-title font-bold transition text-lg text-neutral-900 dark:text-neutral-100 relative ml-8 mt-4 mb-2
            before:w-1 before:h-4 before:rounded-md before:bg-(--primary)
            before:absolute before:left-[-16px] before:top-[5.5px] flex items-center justify-between" data-astro-cid-wbzkcah3 style="--collapsedHeight: 7.5rem;"> <span class="widget-name" data-astro-cid-wbzkcah3 style="--collapsedHeight: 7.5rem;">标签</span>  </div> <div id="tags" class="collapse-wrapper px-4 overflow-hidden collapsed" data-astro-cid-wbzkcah3 style="--collapsedHeight: 7.5rem;">  <div class="flex gap-2 flex-wrap"> <a href="/archive/?tag=API" aria-label="View all posts with the API tag" class="btn-regular h-8 text-sm px-3 rounded-lg">  API </a><a href="/archive/?tag=BA" aria-label="View all posts with the BA tag" class="btn-regular h-8 text-sm px-3 rounded-lg">  BA </a><a href="/archive/?tag=CSP-J" aria-label="View all posts with the CSP-J tag" class="btn-regular h-8 text-sm px-3 rounded-lg">  CSP-J </a><a href="/archive/?tag=csp-s" aria-label="View all posts with the csp-s tag" class="btn-regular h-8 text-sm px-3 rounded-lg">  csp-s </a><a href="/archive/?tag=latex" aria-label="View all posts with the latex tag" class="btn-regular h-8 text-sm px-3 rounded-lg">  latex </a><a href="/archive/?tag=oi" aria-label="View all posts with the oi tag" class="btn-regular h-8 text-sm px-3 rounded-lg">  oi </a><a href="/archive/?tag=oi%E7%AE%97%E6%B3%95" aria-label="View all posts with the oi算法 tag" class="btn-regular h-8 text-sm px-3 rounded-lg">  oi算法 </a><a href="/archive/?tag=spine" aria-label="View all posts with the spine tag" class="btn-regular h-8 text-sm px-3 rounded-lg">  spine </a><a href="/archive/?tag=%E6%9C%80%E7%9F%AD%E8%B7%AF%E7%AE%97%E6%B3%95" aria-label="View all posts with the 最短路算法 tag" class="btn-regular h-8 text-sm px-3 rounded-lg">  最短路算法 </a><a href="/archive/?tag=%E5%88%86%E6%95%B0%E8%A7%84%E5%88%92" aria-label="View all posts with the 分数规划 tag" class="btn-regular h-8 text-sm px-3 rounded-lg">  分数规划 </a><a href="/archive/?tag=%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92" aria-label="View all posts with the 动态规划 tag" class="btn-regular h-8 text-sm px-3 rounded-lg">  动态规划 </a><a href="/archive/?tag=%E5%8D%9A%E5%AE%A2" aria-label="View all posts with the 博客 tag" class="btn-regular h-8 text-sm px-3 rounded-lg">  博客 </a><a href="/archive/?tag=%E5%8D%9A%E5%BC%88%E8%AE%BA" aria-label="View all posts with the 博弈论 tag" class="btn-regular h-8 text-sm px-3 rounded-lg">  博弈论 </a><a href="/archive/?tag=%E5%8E%86%E5%8F%B2%E8%B5%84%E6%96%99" aria-label="View all posts with the 历史资料 tag" class="btn-regular h-8 text-sm px-3 rounded-lg">  历史资料 </a><a href="/archive/?tag=%E5%8E%9F%E7%A5%9E" aria-label="View all posts with the 原神 tag" class="btn-regular h-8 text-sm px-3 rounded-lg">  原神 </a><a href="/archive/?tag=%E5%9B%BE%E8%AE%BA" aria-label="View all posts with the 图论 tag" class="btn-regular h-8 text-sm px-3 rounded-lg">  图论 </a><a href="/archive/?tag=%E5%A5%87%E6%8A%80%E6%B7%AB%E5%B7%A7" aria-label="View all posts with the 奇技淫巧 tag" class="btn-regular h-8 text-sm px-3 rounded-lg">  奇技淫巧 </a><a href="/archive/?tag=%E5%AD%A6%E6%9C%AF" aria-label="View all posts with the 学术 tag" class="btn-regular h-8 text-sm px-3 rounded-lg">  学术 </a><a href="/archive/?tag=%E5%AF%BC%E6%95%B0" aria-label="View all posts with the 导数 tag" class="btn-regular h-8 text-sm px-3 rounded-lg">  导数 </a><a href="/archive/?tag=%E5%B7%AE%E5%88%86%E7%BA%A6%E6%9D%9F" aria-label="View all posts with the 差分约束 tag" class="btn-regular h-8 text-sm px-3 rounded-lg">  差分约束 </a><a href="/archive/?tag=%E5%BC%80%E5%8F%91%E8%AE%B0%E5%BD%95" aria-label="View all posts with the 开发记录 tag" class="btn-regular h-8 text-sm px-3 rounded-lg">  开发记录 </a><a href="/archive/?tag=%E6%88%90%E9%83%BD%E4%B8%9C%E8%BE%B0" aria-label="View all posts with the 成都东辰 tag" class="btn-regular h-8 text-sm px-3 rounded-lg">  成都东辰 </a><a href="/archive/?tag=%E6%90%9C%E7%B4%A2%E7%AE%97%E6%B3%95" aria-label="View all posts with the 搜索算法 tag" class="btn-regular h-8 text-sm px-3 rounded-lg">  搜索算法 </a><a href="/archive/?tag=%E6%95%99%E7%A8%8B" aria-label="View all posts with the 教程 tag" class="btn-regular h-8 text-sm px-3 rounded-lg">  教程 </a><a href="/archive/?tag=%E6%95%B0%E5%AD%A6" aria-label="View all posts with the 数学 tag" class="btn-regular h-8 text-sm px-3 rounded-lg">  数学 </a><a href="/archive/?tag=%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84" aria-label="View all posts with the 数据结构 tag" class="btn-regular h-8 text-sm px-3 rounded-lg">  数据结构 </a><a href="/archive/?tag=%E6%95%B0%E8%AE%BA" aria-label="View all posts with the 数论 tag" class="btn-regular h-8 text-sm px-3 rounded-lg">  数论 </a><a href="/archive/?tag=%E6%95%B4%E6%B4%BB" aria-label="View all posts with the 整活 tag" class="btn-regular h-8 text-sm px-3 rounded-lg">  整活 </a><a href="/archive/?tag=%E6%96%87%E5%8C%96%E8%AF%BE" aria-label="View all posts with the 文化课 tag" class="btn-regular h-8 text-sm px-3 rounded-lg">  文化课 </a><a href="/archive/?tag=%E6%98%A5%E6%99%9A" aria-label="View all posts with the 春晚 tag" class="btn-regular h-8 text-sm px-3 rounded-lg">  春晚 </a><a href="/archive/?tag=%E6%9E%AB%E4%B8%B9" aria-label="View all posts with the 枫丹 tag" class="btn-regular h-8 text-sm px-3 rounded-lg">  枫丹 </a><a href="/archive/?tag=%E6%B8%B8%E8%AE%B0" aria-label="View all posts with the 游记 tag" class="btn-regular h-8 text-sm px-3 rounded-lg">  游记 </a><a href="/archive/?tag=%E7%94%9F%E6%88%90%E6%A0%91" aria-label="View all posts with the 生成树 tag" class="btn-regular h-8 text-sm px-3 rounded-lg">  生成树 </a><a href="/archive/?tag=%E7%AE%97%E6%B3%95" aria-label="View all posts with the 算法 tag" class="btn-regular h-8 text-sm px-3 rounded-lg">  算法 </a><a href="/archive/?tag=%E7%BA%BF%E6%80%A7%E4%BB%A3%E6%95%B0" aria-label="View all posts with the 线性代数 tag" class="btn-regular h-8 text-sm px-3 rounded-lg">  线性代数 </a><a href="/archive/?tag=%E8%AE%A1%E7%AE%97%E5%87%A0%E4%BD%95" aria-label="View all posts with the 计算几何 tag" class="btn-regular h-8 text-sm px-3 rounded-lg">  计算几何 </a><a href="/archive/?tag=%E8%B5%9B%E5%90%8E%E6%80%BB%E7%BB%93" aria-label="View all posts with the 赛后总结 tag" class="btn-regular h-8 text-sm px-3 rounded-lg">  赛后总结 </a><a href="/archive/?tag=%E8%BD%AC%E8%BD%BD" aria-label="View all posts with the 转载 tag" class="btn-regular h-8 text-sm px-3 rounded-lg">  转载 </a><a href="/archive/?tag=%E9%81%97%E4%BC%A0%E5%AD%A6" aria-label="View all posts with the 遗传学 tag" class="btn-regular h-8 text-sm px-3 rounded-lg">  遗传学 </a><a href="/archive/?tag=%E9%97%B2%E8%AF%9D%E6%9D%82%E8%B0%88" aria-label="View all posts with the 闲话杂谈 tag" class="btn-regular h-8 text-sm px-3 rounded-lg">  闲话杂谈 </a><a href="/archive/?tag=%E9%9A%8F%E6%9C%BA%E5%8C%96" aria-label="View all posts with the 随机化 tag" class="btn-regular h-8 text-sm px-3 rounded-lg">  随机化 </a><a href="/archive/?tag=%E9%A2%98%E8%A7%A3" aria-label="View all posts with the 题解 tag" class="btn-regular h-8 text-sm px-3 rounded-lg">  题解 </a><a href="/archive/?tag=%E9%AB%98%E4%B8%AD%E6%95%B0%E5%AD%A6" aria-label="View all posts with the 高中数学 tag" class="btn-regular h-8 text-sm px-3 rounded-lg">  高中数学 </a><a href="/archive/?tag=%E9%AB%98%E4%B8%AD%E7%94%9F%E7%89%A9" aria-label="View all posts with the 高中生物 tag" class="btn-regular h-8 text-sm px-3 rounded-lg">  高中生物 </a><a href="/archive/?tag=%E9%AB%98%E4%B8%AD%E8%AF%AD%E6%96%87" aria-label="View all posts with the 高中语文 tag" class="btn-regular h-8 text-sm px-3 rounded-lg">  高中语文 </a><a href="/archive/?tag=%E9%B2%9C%E8%8A%B1" aria-label="View all posts with the 鲜花 tag" class="btn-regular h-8 text-sm px-3 rounded-lg">  鲜花 </a> </div>  </div> <div class="expand-btn px-4 -mb-2" data-astro-cid-wbzkcah3 style="--collapsedHeight: 7.5rem;"> <button class="btn-plain rounded-lg w-full h-9" title="更多" aria-label="更多" data-astro-cid-wbzkcah3 style="--collapsedHeight: 7.5rem;"> <div class="text-(--primary) flex items-center justify-center gap-2 -translate-x-2" data-astro-cid-wbzkcah3 style="--collapsedHeight: 7.5rem;"> <svg width="1em" height="1em" viewBox="0 0 24 24" class="text-[1.75rem]" aria-hidden="true" data-astro-cid-wbzkcah3="true" data-icon="material-symbols:more-horiz">   <use href="#ai:material-symbols:more-horiz"></use>  </svg> 更多 </div> </button> </div> </widget-layout>  <widget-layout data-id="site-stats" data-is-collapsed="undefined" class="pb-4 card-base onload-animation" style="animation-delay: 250ms; " data-astro-cid-wbzkcah3="true"> <div class="widget-title font-bold transition text-lg text-neutral-900 dark:text-neutral-100 relative ml-8 mt-4 mb-2
            before:w-1 before:h-4 before:rounded-md before:bg-(--primary)
            before:absolute before:left-[-16px] before:top-[5.5px] flex items-center justify-between" data-astro-cid-wbzkcah3 style=""> <span class="widget-name" data-astro-cid-wbzkcah3 style="">站点统计</span>  </div> <div id="site-stats" class="collapse-wrapper px-4 overflow-hidden" data-astro-cid-wbzkcah3 style="">  <div class="flex flex-col gap-2"> <div class="flex items-center justify-between px-3 py-1.5"> <div class="flex items-center gap-2.5"> <div class="text-(--primary) text-xl"> <svg width="1em" height="1em" viewBox="0 0 24 24" data-icon="material-symbols:article-outline">   <use href="#ai:material-symbols:article-outline"></use>  </svg> </div> <span class="text-neutral-700 dark:text-neutral-300 font-medium text-sm"> 文章 </span> </div> <div class="flex items-center"> <span class="text-base font-bold text-neutral-900 dark:text-neutral-100"> 66 </span>  </div> </div><div class="flex items-center justify-between px-3 py-1.5"> <div class="flex items-center gap-2.5"> <div class="text-(--primary) text-xl"> <svg width="1em" height="1em" viewBox="0 0 24 24" data-icon="material-symbols:folder-outline">   <use href="#ai:material-symbols:folder-outline"></use>  </svg> </div> <span class="text-neutral-700 dark:text-neutral-300 font-medium text-sm"> 分类 </span> </div> <div class="flex items-center"> <span class="text-base font-bold text-neutral-900 dark:text-neutral-100"> 11 </span>  </div> </div><div class="flex items-center justify-between px-3 py-1.5"> <div class="flex items-center gap-2.5"> <div class="text-(--primary) text-xl"> <svg width="1em" height="1em" viewBox="0 0 24 24" data-icon="material-symbols:label-outline">   <use href="#ai:material-symbols:label-outline"></use>  </svg> </div> <span class="text-neutral-700 dark:text-neutral-300 font-medium text-sm"> 标签 </span> </div> <div class="flex items-center"> <span class="text-base font-bold text-neutral-900 dark:text-neutral-100"> 46 </span>  </div> </div><div class="flex items-center justify-between px-3 py-1.5"> <div class="flex items-center gap-2.5"> <div class="text-(--primary) text-xl"> <svg width="1em" height="1em" viewBox="0 0 24 24" data-icon="material-symbols:text-ad-outline-rounded">   <use href="#ai:material-symbols:text-ad-outline-rounded"></use>  </svg> </div> <span class="text-neutral-700 dark:text-neutral-300 font-medium text-sm"> 总字数 </span> </div> <div class="flex items-center"> <span class="text-base font-bold text-neutral-900 dark:text-neutral-100"> 263,037 </span>  </div> </div><div class="flex items-center justify-between px-3 py-1.5"> <div class="flex items-center gap-2.5"> <div class="text-(--primary) text-xl"> <svg width="1em" height="1em" viewBox="0 0 24 24" data-icon="material-symbols:calendar-clock-outline">   <use href="#ai:material-symbols:calendar-clock-outline"></use>  </svg> </div> <span class="text-neutral-700 dark:text-neutral-300 font-medium text-sm"> 运行时长 </span> </div> <div class="flex items-center"> <span class="text-base font-bold text-neutral-900 dark:text-neutral-100" data-stat-id="running-days"> 0 </span> <span class="text-sm text-neutral-500 dark:text-neutral-400 ml-1">  天 </span> </div> </div><div class="flex items-center justify-between px-3 py-1.5"> <div class="flex items-center gap-2.5"> <div class="text-(--primary) text-xl"> <svg width="1em" height="1em" viewBox="0 0 24 24" data-icon="material-symbols:ecg-heart-outline">   <use href="#ai:material-symbols:ecg-heart-outline"></use>  </svg> </div> <span class="text-neutral-700 dark:text-neutral-300 font-medium text-sm"> 最后活动 </span> </div> <div class="flex items-center"> <span class="text-base font-bold text-neutral-900 dark:text-neutral-100" data-stat-id="last-update"> 0 </span> <span class="text-sm text-neutral-500 dark:text-neutral-400 ml-1">  天前 </span> </div> </div> </div>  </div>  </widget-layout>   <script>(function(){const siteStartDate = "2023-10-26";
const lastPostDate = "2026-02-21T00:00:00.000Z";
const todayText = "今天";

  function updateDynamicStats() {
    const today = new Date();

    // 更新运行天数
    const startDate = new Date(siteStartDate);
    const diffTime = Math.abs(today.getTime() - startDate.getTime());
    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

    const runningDaysElements = document.querySelectorAll('[data-stat-id="running-days"]');
    runningDaysElements.forEach((element) => {
      element.textContent = diffDays.toString();
    });

    // 更新最后活动时间
    if (lastPostDate) {
      const lastPost = new Date(lastPostDate);
      const timeSinceLastPost = Math.abs(today.getTime() - lastPost.getTime());
      const daysSinceLastUpdate = Math.floor(timeSinceLastPost / (1000 * 60 * 60 * 24));

      const lastUpdateElements = document.querySelectorAll('[data-stat-id="last-update"]');
      lastUpdateElements.forEach((element) => {
        if (daysSinceLastUpdate === 0) {
          element.textContent = todayText;
          if (element.nextElementSibling) {
            element.nextElementSibling.style.display = 'none';
          }
        } else {
          element.textContent = daysSinceLastUpdate.toString();
          if (element.nextElementSibling) {
            element.nextElementSibling.style.display = '';
          }
        }
      });
    }
  }

  // 页面加载时更新
  updateDynamicStats();

  // 页面切换时重新更新
  document.addEventListener("swup:contentReplaced", () => {
    setTimeout(updateDynamicStats, 100);
  });
})();</script></div></div> </div> <div class="footer col-span-1 md:col-span-2 onload-animation xl:col-start-2 xl:col-span-1"> <div class="transition border-t border-black/10 dark:border-white/15 my-10 border-dashed mx-32"></div> <div class="transition border-dashed border-[oklch(85%_0.01_var(--hue))] dark:border-white/15 rounded-2xl mb-12 flex flex-col items-center justify-center px-6"> <div class="transition text-50 text-sm text-center"> <div class="mb-2"> <div><div><p>博客内容遵循 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">署名-非商业性使用-相同方式共享
4.0 国际 (CC BY-NC-SA 4.0) 协议</a></p>
</div>
 <div><p>本网站使用<a target="_blank" rel="noopener" href="https://www.oplog.cn/qexo/">Qexo</a>进行后端管理</p>
</div>
<div><p><a href="https://icp.gov.moe/?keyword=20240858" target="_blank">萌ICP备20240858号</a></p>
</div>
<div><p><a href="https://ipw.cn/ssl/?site=justpureh2o.cn" title="本站支持SSL安全访问" target="_blank"><img style="display:inline-block;vertical-align:middle" alt="本站支持SSL安全访问" src="https://static.ipw.cn/icon/ssl-s1.svg" class="lazyload entered loaded" data-srcset="https://static.ipw.cn/icon/ssl-s1.svg" srcset="https://static.ipw.cn/icon/ssl-s1.svg" data-ll-status="loaded"></a>&nbsp;&nbsp;<a href="https://ipw.cn/ipv6webcheck/?site=justpureh2o.cn" title="本站支持IPv6访问" target="_blank"><img style="display:inline-block;vertical-align:middle" alt="本站支持IPv6访问" src="https://static.ipw.cn/icon/ipv6-certified-s1.svg" class="lazyload entered loaded" data-srcset="https://static.ipw.cn/icon/ipv6-certified-s1.svg" srcset="https://static.ipw.cn/icon/ipv6-certified-s1.svg" data-ll-status="loaded"></a></p>
</div></div> </div> <div class="m-0.5">
&copy; <span id="copyright-year">2026</span> JustPureH<sub>2</sub>O. All Rights Reserved.
<a class="transition link text-(--primary) font-medium" target="_blank" href="/atom.xml">RSS</a> /
<a class="transition link text-(--primary) font-medium" target="_blank" href="/sitemap-index.xml">Sitemap</a> </div> <div class="m-0.5">
Powered by
<a class="transition link text-(--primary) font-medium" target="_blank" href="https://astro.build">Astro</a> &
<a class="transition link text-(--primary) font-medium" target="_blank" href="https://github.com/CuteLeaf/Firefly">Firefly</a> </div> <!-- 
      注意：请勿随意修改或删除 "Powered by Astro & Firefly" 部分，这是对开源项目的尊重和支持。
      如果您需要在底部增加内容，请在src/config/footerConfig.ts中修改enable属性为true，然后编辑src/config/FooterConfig.html文件。
      您可以随意在src/config/FooterConfig.html中随意添加自定义内容，不需要修改Footer.astro文件。
    --> </div> </div> </div> </div> <!-- Spine Web Player CSS 将在 script 中动态加载 --><!-- 引入消息框组件 --><script type="module" src="/_astro/PioMessageBox.astro_astro_type_script_index_0_lang.B6f9rirj.js"></script><script>(function(){const spineModelConfig = {"enable":false,"model":{"path":"/pio/models/spine/firefly/1310.json","scale":1,"x":0,"y":0},"position":{"corner":"bottom-left","offsetX":0,"offsetY":0},"size":{"width":135,"height":165},"interactive":{"enabled":true,"clickAnimations":["emoji_0","emoji_1","emoji_2","emoji_3","emoji_4","emoji_5","emoji_6"],"clickMessages":["你好呀！我是流萤~","今天也要加油哦！✨","想要一起去看星空吗？🌟","记得要好好休息呢~","有什么想对我说的吗？💫","让我们一起探索未知的世界吧！🚀","每一颗星星都有自己的故事~⭐","希望能带给你温暖和快乐！💖"],"messageDisplayTime":3000,"idleAnimations":["idle","emoji_0","emoji_1","emoji_3","emoji_4"],"idleInterval":8000},"responsive":{"hideOnMobile":true,"mobileBreakpoint":768},"zIndex":1000,"opacity":1};
const modelPath = "/pio/models/spine/firefly/1310.json";
const atlasPath = "/pio/models/spine/firefly/1310.atlas";
const cssPath = "/pio/static/spine-player.min.css";
const jsPath = "/pio/static/spine-player.min.js";

  // 动态加载 Spine CSS（带本地备用）
  function loadSpineCSS() {
    if (!spineModelConfig.enable) return;

    // 检查是否已经加载
    const existingLink = document.querySelector('link[href*="spine-player"]');
    if (existingLink) return;

    // 首先尝试加载 CDN CSS
    const cdnLink = document.createElement("link");
    cdnLink.rel = "stylesheet";
    cdnLink.href =
      "https://unpkg.com/@esotericsoftware/spine-player@4.2.*/dist/spine-player.min.css";

    // 监听加载失败事件，自动回退到本地文件
    cdnLink.onerror = function () {
      console.warn("⚠️ Spine CSS CDN failed, trying local fallback...");

      // 移除失败的 CDN link
      if (cdnLink.parentNode) {
        cdnLink.parentNode.removeChild(cdnLink);
      }

      // 创建本地备用 CSS link
      const localLink = document.createElement("link");
      localLink.rel = "stylesheet";
      localLink.href = cssPath;
      localLink.onerror = function () {
        console.error("❌ Failed to load Spine CSS");
      };

      document.head.appendChild(localLink);
    };

    document.head.appendChild(cdnLink);
  }

  // 消息框功能已移至公共组件 MessageBox.astro
  let isClickProcessing = false; // 防止重复点击的标志
  let lastClickTime = 0; // 记录最后一次点击时间

  // 全局变量，防止重复初始化
  window.spineModelInitialized = window.spineModelInitialized || false;
  window.spinePlayerInstance = window.spinePlayerInstance || null;

  // 消息显示函数 - 使用公共消息框组件
  function showMessage(message) {
    // 使用公共消息框组件
    if (window.showModelMessage) {
      window.showModelMessage(message, {
        containerId: "spine-model-container",
        displayTime: spineModelConfig.interactive.messageDisplayTime || 3000
      });
    }
  }

  // 更新响应式显示
  function updateResponsiveDisplay() {
    if (!spineModelConfig.enable) return;

    const container = document.getElementById("spine-model-container");
    if (!container) return;

    // 检查移动端显示设置
    if (
      spineModelConfig.responsive.hideOnMobile &&
      window.innerWidth <= spineModelConfig.responsive.mobileBreakpoint
    ) {
      container.style.display = "none";
    } else {
      container.style.display = "block";
    }
  }

  // 清理函数
  function cleanupSpineModel() {
    console.log("🧹 Cleaning up existing Spine model...");

    // 清理消息显示（使用公共组件）
    if (window.clearModelMessage) {
      window.clearModelMessage();
    }

    // 清理现有的播放器实例
    if (window.spinePlayerInstance) {
      try {
        if (window.spinePlayerInstance.dispose) {
          window.spinePlayerInstance.dispose();
        }
      } catch (e) {
        console.warn("Error disposing spine player:", e);
      }
      window.spinePlayerInstance = null;
    }

    // 清理容器内容
    const playerContainer = document.getElementById("spine-player-container");
    if (playerContainer) {
      playerContainer.innerHTML = "";
    }

    // 重置初始化标志
    window.spineModelInitialized = false;
  }

  async function initSpineModel() {
    if (!spineModelConfig.enable) return;

    // 检查移动端显示设置，如果隐藏则不加载运行时
    if (
      spineModelConfig.responsive.hideOnMobile &&
      window.innerWidth <= spineModelConfig.responsive.mobileBreakpoint
    ) {
      console.log("📱 Mobile device detected, skipping Spine model initialization");
      const container = document.getElementById("spine-model-container");
      if (container) container.style.display = "none";
      return;
    }

    // 检查是否已经初始化
    if (window.spineModelInitialized) {
      console.log("⏭️ Spine model already initialized, skipping...");
      return;
    }

    console.log("🎯 Initializing Spine Model...");

    // 先清理可能存在的旧实例
    cleanupSpineModel();

    // 首先加载 CSS
    loadSpineCSS();

    // 加载 Spine Web Player 运行时
    const loadSpineRuntime = () => {
      return new Promise((resolve, reject) => {
        if (typeof window.spine !== "undefined") {
          console.log("✅ Spine runtime already loaded");
          resolve();
          return;
        }

        console.log("📦 Loading Spine runtime...");
        const script = document.createElement("script");
        script.src =
          "https://unpkg.com/@esotericsoftware/spine-player@4.2.*/dist/iife/spine-player.min.js";
        script.onload = () => {
          console.log("✅ Spine runtime loaded from CDN");
          resolve();
        };
        script.onerror = (_error) => {
          console.warn("⚠️ CDN failed, trying local fallback...");

          // 尝试本地回退
          const fallbackScript = document.createElement("script");
          fallbackScript.src = jsPath;
          fallbackScript.onload = () => {
            console.log("✅ Spine runtime loaded from local fallback");
            resolve();
          };
          fallbackScript.onerror = () => {
            reject(new Error("Failed to load Spine runtime"));
          };
          document.head.appendChild(fallbackScript);
        };
        document.head.appendChild(script);
      });
    };

    // 等待 Spine 库加载
    const waitForSpine = () => {
      return new Promise((resolve, reject) => {
        let attempts = 0;
        const maxAttempts = 50;

        const check = () => {
          attempts++;
          if (typeof window.spine !== "undefined" && window.spine.SpinePlayer) {
            console.log("✅ Spine runtime loaded");
            resolve();
          } else if (attempts >= maxAttempts) {
            reject(new Error("Spine runtime loading timeout"));
          } else {
            setTimeout(check, 100);
          }
        };
        check();
      });
    };

    try {
      // 首先加载 Spine 运行时
      await loadSpineRuntime();

      // 然后等待 Spine 对象可用
      await waitForSpine();

      // 标记为已初始化
      window.spineModelInitialized = true;

      // 创建 SpinePlayer
      new window.spine.SpinePlayer("spine-player-container", {
        skeleton: modelPath,
        atlas: atlasPath,
        animation: "idle",
        backgroundColor: "#00000000", // 透明背景
        showControls: false, // 隐藏控件
        alpha: true,
        premultipliedAlpha: false,
        success: (player) => {
          console.log("🎉 Spine model loaded successfully!");

          // 保存播放器实例引用
          window.spinePlayerInstance = player;

          // 初始化完成后设置默认姿态
          setTimeout(() => {
            if (player.skeleton) {
              try {
                player.skeleton.updateWorldTransform();
                player.skeleton.setToSetupPose();
              } catch (e) {
                console.warn("Error positioning skeleton:", e);
              }
            }
          }, 500);

          // 设置交互功能
          if (spineModelConfig.interactive.enabled) {
            const canvas = document.querySelector(
              "#spine-player-container canvas"
            );
            if (canvas) {
              canvas.addEventListener("click", () => {
                // 防抖处理：防止重复点击
                const currentTime = Date.now();
                if (isClickProcessing || currentTime - lastClickTime < 500) {
                  return; // 500ms 内重复点击忽略
                }

                isClickProcessing = true;
                lastClickTime = currentTime;

                // 随机播放点击动画
                const clickAnims =
                  spineModelConfig.interactive.clickAnimations ||
                  (spineModelConfig.interactive.clickAnimation
                    ? [spineModelConfig.interactive.clickAnimation]
                    : []);

                if (clickAnims.length > 0) {
                  try {
                    const randomClickAnim =
                      clickAnims[Math.floor(Math.random() * clickAnims.length)];
                    player.setAnimation(randomClickAnim, false);

                    // 动画播放完成后回到待机状态
                    setTimeout(() => {
                      const idleAnims =
                        spineModelConfig.interactive.idleAnimations;
                      const randomIdle =
                        idleAnims[Math.floor(Math.random() * idleAnims.length)];
                      player.setAnimation(randomIdle, true);
                    }, 2000);
                  } catch (e) {
                    console.warn("Failed to play click animation:", e);
                  }
                }

                // 显示随机消息
                const messages = spineModelConfig.interactive.clickMessages;
                if (messages && messages.length > 0) {
                  const randomMessage =
                    messages[Math.floor(Math.random() * messages.length)];
                  showMessage(randomMessage);
                }

                // 500ms 后重置防抖标志
                setTimeout(() => {
                  isClickProcessing = false;
                }, 500);
              });

              // 设置待机动画循环
              if (spineModelConfig.interactive.idleAnimations.length > 1) {
                setInterval(() => {
                  try {
                    const idleAnims =
                      spineModelConfig.interactive.idleAnimations;
                    const randomIdle =
                      idleAnims[Math.floor(Math.random() * idleAnims.length)];
                    player.setAnimation(randomIdle, true);
                  } catch (e) {
                    console.warn("Failed to play idle animation:", e);
                  }
                }, spineModelConfig.interactive.idleInterval);
              }
            }
          }

          console.log("✅ Spine model setup complete!");
        },
        error: (_player, reason) => {
          console.error("❌ Spine model loading error:", reason);

          const errorDiv = document.getElementById("spine-error");
          if (errorDiv) {
            errorDiv.style.display = "block";
            errorDiv.innerHTML = `
              <div style="color: #ff4444; padding: 20px; text-align: center; font-size: 14px;">
                <div>⚠️ Spine 模型加载失败</div>
                <div style="font-size: 12px; margin-top: 8px; color: #888;">${reason}</div>
              </div>
            `;
          }

          const canvas = document.getElementById("spine-canvas");
          if (canvas) canvas.style.display = "none";
        },
      });
    } catch (error) {
      console.error("Spine model initialization error:", error);

      // 重置初始化标志，允许重试
      window.spineModelInitialized = false;

      const errorDiv = document.getElementById("spine-error");
      if (errorDiv) {
        errorDiv.style.display = "block";
        errorDiv.innerHTML = `
          <div style="color: #ff4444; padding: 20px; text-align: center; font-size: 14px;">
            <div>⚠️ Spine 运行时加载失败</div>
            <div style="font-size: 12px; margin-top: 8px; color: #888;">${error instanceof Error ? error.message : "未知错误"}</div>
          </div>
        `;
      }
    }
  }

  // 监听页面卸载事件，清理资源
  window.addEventListener("beforeunload", cleanupSpineModel);

  // 监听 Swup 页面切换事件（如果使用了 Swup）
  if (typeof window.swup !== "undefined" && window.swup.hooks) {
    window.swup.hooks.on("content:replace", () => {
      // 只更新响应式显示，不重新创建模型
      setTimeout(() => {
        updateResponsiveDisplay();
      }, 100);
    });
  }

  // 监听 popstate 事件（浏览器前进后退）
  window.addEventListener("popstate", () => {
    setTimeout(() => {
      updateResponsiveDisplay();
    }, 100);
  });

  // 监听窗口大小变化
  window.addEventListener("resize", updateResponsiveDisplay);

  // 页面加载完成后初始化（只初始化一次）
  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", initSpineModel);
  } else {
    initSpineModel();
  }
})();</script>  </div> </div> <div class="floating-controls-container" data-astro-cid-crqbandb> <!-- 悬浮TOC按钮 --><div id="floating-toc-wrapper" class="floating-toc-wrapper" data-is-sidebar-toc-enabled="true" data-sidebar-position="both" data-show-right-sidebar-on-post="true" data-astro-cid-rzdpqib4> <div id="floating-toc-btn" class="floating-btn hide flex items-center rounded-2xl overflow-hidden transition" onclick="window.toggleFloatingTOC()" data-astro-cid-eoir7dmc> <button aria-label="Table of Contents" class="h-full w-full rounded-2xl" data-astro-cid-eoir7dmc> <svg width="1em" height="1em" class="mx-auto" data-astro-cid-eoir7dmc="true" data-icon="material-symbols:format-list-bulleted">   <symbol id="ai:material-symbols:format-list-bulleted" viewBox="0 0 24 24"><path fill="currentColor" d="M9 19v-2h12v2zm0-6v-2h12v2zm0-6V5h12v2zM5 20q-.825 0-1.412-.587T3 18t.588-1.412T5 16t1.413.588T7 18t-.587 1.413T5 20m0-6q-.825 0-1.412-.587T3 12t.588-1.412T5 10t1.413.588T7 12t-.587 1.413T5 14m0-6q-.825 0-1.412-.587T3 6t.588-1.412T5 4t1.413.588T7 6t-.587 1.413T5 8"/></symbol><use href="#ai:material-symbols:format-list-bulleted"></use>  </svg> </button> </div>  <!-- 悬浮TOC面板 - 移到 Wrapper 内部以便相对定位 --> <div id="floating-toc-panel" class="floating-toc-panel hide w-80 max-h-96 overflow-hidden rounded-2xl shadow-2xl backdrop-blur-lg border border-white/20 bg-white/60 dark:bg-black/60 dark:border-white/10 md:w-80 w-[calc(100vw-2rem)] md:max-h-96 max-h-[calc(100vh-8rem)]" style="background-color: rgba(var(--card-bg-rgb, 255, 255, 255), 0.6);" data-astro-cid-rzdpqib4> <div class="p-4 border-b border-gray-200 dark:border-gray-700 sticky top-0 backdrop-blur-xs z-10" style="background-color: rgba(var(--card-bg-rgb, 255, 255, 255), 0.6);" data-astro-cid-rzdpqib4> <div class="flex items-center justify-between" data-astro-cid-rzdpqib4> <h3 class="text-lg font-bold text-(--primary) flex items-center gap-2" data-astro-cid-rzdpqib4> 目录 </h3> <button onclick="window.toggleFloatingTOC()" aria-label="Close TOC" class="btn-plain rounded-lg h-8 w-8 active:scale-90" data-astro-cid-rzdpqib4> <svg width="1em" height="1em" class="text-lg" data-astro-cid-rzdpqib4="true" data-icon="material-symbols:close">   <symbol id="ai:material-symbols:close" viewBox="0 0 24 24"><path fill="currentColor" d="M6.4 19L5 17.6l5.6-5.6L5 6.4L6.4 5l5.6 5.6L17.6 5L19 6.4L13.4 12l5.6 5.6l-1.4 1.4l-5.6-5.6z"/></symbol><use href="#ai:material-symbols:close"></use>  </svg> </button> </div> </div> <div class="toc-scroll-container p-4" data-astro-cid-rzdpqib4> <div class="toc-content" id="floating-toc-content" style="width: 100%; max-width: 100%;" data-astro-cid-rzdpqib4> <!-- TOC内容将由JavaScript动态生成 --> </div> </div> </div> </div>  <script type="module" src="/_astro/FloatingTOC.astro_astro_type_script_index_0_lang.tqHovpS8.js"></script> <div id="back-to-home-btn" class="floating-btn hide flex items-center rounded-2xl overflow-hidden transition" onclick="backToHome()" data-astro-cid-eoir7dmc> <button aria-label="主页" class="h-full w-full rounded-2xl" data-astro-cid-eoir7dmc> <svg width="1em" height="1em" class="mx-auto" data-astro-cid-eoir7dmc="true" data-icon="material-symbols:home-outline-rounded">   <symbol id="ai:material-symbols:home-outline-rounded" viewBox="0 0 24 24"><path fill="currentColor" d="M6 19h3v-5q0-.425.288-.712T10 13h4q.425 0 .713.288T15 14v5h3v-9l-6-4.5L6 10zm-2 0v-9q0-.475.213-.9t.587-.7l6-4.5q.525-.4 1.2-.4t1.2.4l6 4.5q.375.275.588.7T20 10v9q0 .825-.588 1.413T18 21h-4q-.425 0-.712-.288T13 20v-5h-2v5q0 .425-.288.713T10 21H6q-.825 0-1.412-.587T4 19m8-6.75"/></symbol><use href="#ai:material-symbols:home-outline-rounded"></use>  </svg> </button> </div>  <script>(function(){const homeUrl = "/";

  window.backToHome = function() {
    const url = homeUrl;
    if (window.swup) {
      window.swup.navigate(url);
    } else {
      window.location.href = url;
    }
  };
})();</script> <script>(function(){const homeUrl = "/";

  function updateBackToHomeVisibility() {
    const btn = document.getElementById("back-to-home-btn");
    if (!btn) return;

    const path = window.location.pathname.replace(/\/$/, "") || "/";
    const homePath = homeUrl.replace(/\/$/, "") || "/";
    if (path === homePath) {
      btn.classList.add("hide");
    } else {
      btn.classList.remove("hide");
    }
  }

  // Initial check
  updateBackToHomeVisibility();
  
  // Re-check on view transitions or swup navigation
  document.addEventListener("astro:page-load", updateBackToHomeVisibility);
  document.addEventListener("swup:contentReplaced", updateBackToHomeVisibility);
})();</script> <!-- There can't be a filter on parent element, or it will break `fixed` --><div id="back-to-top-btn" class="floating-btn hide flex items-center rounded-2xl overflow-hidden transition" onclick="backToTop()" data-astro-cid-eoir7dmc> <button aria-label="Back to Top" class="h-full w-full rounded-2xl" data-astro-cid-eoir7dmc> <svg width="1em" height="1em" class="mx-auto" data-astro-cid-eoir7dmc="true" data-icon="material-symbols:keyboard-arrow-up-rounded">   <symbol id="ai:material-symbols:keyboard-arrow-up-rounded" viewBox="0 0 24 24"><path fill="currentColor" d="m12 10.8l-3.9 3.9q-.275.275-.7.275t-.7-.275t-.275-.7t.275-.7l4.6-4.6q.3-.3.7-.3t.7.3l4.6 4.6q.275.275.275.7t-.275.7t-.7.275t-.7-.275z"/></symbol><use href="#ai:material-symbols:keyboard-arrow-up-rounded"></use>  </svg> </button> </div>  <script>
  function backToTop() {
    // 直接使用原生滚动，避免OverlayScrollbars冲突
    window.scroll({ top: 0, behavior: "smooth" });
  }

  // 响应式返回顶部按钮管理器
  if (typeof window.BackToTopManager === "undefined") {
    window.BackToTopManager = class BackToTopManager {
      constructor() {
        this.button = document.getElementById("back-to-top-btn");
        this.init();
      }

      init() {
        if (!this.button) return; // wrapper checks removed as it is now flexible

        this.setupScrollListener();
      }

      setupScrollListener() {
        const updateVisibility = () => {
          const scrollTop =
            window.pageYOffset || document.documentElement.scrollTop;

          // 当滚动超过200px时显示按钮
          if (scrollTop > 200) {
            this.button.classList.remove("hide");
          } else {
            this.button.classList.add("hide");
          }
        };

        window.addEventListener("scroll", updateVisibility, { passive: true });
      }
    };
  }
  // ... existing initialization logic ...
  // 页面加载完成后初始化
  document.addEventListener("DOMContentLoaded", () => {
    new BackToTopManager();
  });

  // 如果页面已经加载完成，立即初始化
  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", () => {
      new BackToTopManager();
    });
  } else {
    new BackToTopManager();
  }
</script> </div>   <!-- Sakura Effect -->  <!-- Fancybox Manager --> <script type="module" src="/_astro/FancyboxManager.astro_astro_type_script_index_0_lang.XMGSb5sP.js"></script>  <script type="module" src="/_astro/Layout.astro_astro_type_script_index_0_lang.0g_tWL77.js"></script></body></html> 